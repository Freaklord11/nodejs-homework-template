(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[10923],{19161:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getAllChoices=a,t.getAllChoiceDescendants=function e(t,r=o.default.identity,n=!1){if(!t)return[];let a=[];for(const o of t)!i.isNestedLabelChoice(o)||n&&!r(o)?r(o)&&a.push(i.getLabelChoiceValue(o)):a=a.concat(e(o.subchoices));return a},t.getFirstLeafLabel=function e(t){if(!t)return;for(const r of t){if(!i.isNestedLabelChoice(r))return i.getLabelChoiceValue(r);{const t=e(r.subchoices);if(t)return t}}return},t.trimAllLabelNames=function e(t){return t.forEach(((r,n)=>{i.isNestedLabelChoice(r)?(r.choice=r.choice.trim(),e(r.subchoices)):"string"===typeof r?t[n]=r.trim():o.default.isNil(r)||(r.choice=r.choice.trim())})),t},t.hasSubchoices=t.displayChoice=t.stringifyChoice=t.getChoice=t.generateChildToParentChoiceMapping=void 0;var n,o=(n=r(298784))&&n.__esModule?n:{default:n},i=r(335855);function a(e,t=!1){if(!e)return[];const r=[];for(const n of e)i.isNestedLabelChoice(n)?(t&&r.push(n),r.push(...a(n.subchoices,t))):r.push(n);return r}const s=(e,t)=>{const r=new Map;return e?(e.forEach((e=>{if(r.set(e,t),i.isNestedLabelChoice(e)){const t=s(e.subchoices,e);for(const[e,n]of t.entries())r.set(e,n)}})),r):r};t.generateChildToParentChoiceMapping=s;t.getChoice=(e,t,r)=>{if(!o.default.isNil(t))return a(e,!0).find((e=>r?o.default.isEqual(t,e):t===l(e)))};const l=e=>o.default.isNil(e)?"":o.default.isString(e)?e:e.choice;t.stringifyChoice=l;t.displayChoice=e=>o.default.isNil(e)?"":o.default.isString(e)?e:e.display??e.choice;t.hasSubchoices=e=>!o.default.isNil(e)&&(!o.default.isString(e)&&!!e.subchoices)},320716:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"CameraModel",{enumerable:!0,get:function(){return i.CameraModel}}),t.getProjectionFunction=function(e,{skipDistortion:t=!1}={}){const r=e.imageHeight*(e.scale_factor||1),o=e.imageWidth*(e.scale_factor||1);switch(e.camera_model){case i.CameraModel.ModEquiFish:case i.CameraModel.ModKannala:case i.CameraModel.BrownConrady:case i.CameraModel.Fisheye:case i.CameraModel.Omnidirectional:case i.CameraModel.Ftheta:case i.CameraModel.FisheyeRadialCustom:case void 0:case null:{const s=function(e){const t=new n.Matrix4;if(e.useKitti&&e.kittiNormalizedCoordinates)t.copy(c);else{const r=e.useKitti?c:h(e.fx,e.fy,e.cx,e.cy,e.skew||0),n=f(e.position,e.heading);t.multiplyMatrices(r,n)}return t}(e),l=!e.useKitti,u=f(e.position,e.heading),p=h(e.fx,e.fy,e.cx,e.cy,e.skew||0),m={};return(c,f=1)=>{const h=new n.Vector4(c.x,c.y,c.z,1),y=new n.Vector4(c.x,c.y,c.z,1);e.camera_model===i.CameraModel.Omnidirectional&&e.xi?(h.applyMatrix4(u),h.setW(0),h.normalize(),h.z+=e.xi,h.setW(1),h.applyMatrix4(p)):h.applyMatrix4(s),y.applyMatrix4(u);const T=a.distance(c,e.position)<170,v=h.w>0;if(!v)return{distortPosition:null,preDistortPosition:null,distortGood:!1,visible:!1,projectionValid:v,withinRange:!1};h.multiplyScalar(f/h.w);const x=r*f,_=o*f,M=h.clone();let A,k,P;if(t)A=null,k=v&&d(M,_,x),P=!1;else{try{A=l?g(h,e):M.clone(),k=v&&d(A,_,x),P=l?b(h,e,m):k}catch(E){A=l?g(h,e):M.clone(),k=v&&d(A,_,x),P=l?b(h,e,m):k}e.scale_factor&&(A.multiplyScalar(1/e.scale_factor),M.multiplyScalar(1/e.scale_factor))}return{distortPosition:A,preDistortPosition:M,projectionValid:v,distortGood:P,visible:k,withinRange:T}}}case i.CameraModel.Cylindrical:{const t=f(e.position,e.heading);return(i,s=1,l=!1)=>{const u=new n.Vector4(i.x,i.y,i.z,1);u.applyMatrix4(t);const c=a.distance(i,e.position)<170,f=Math.atan2(u.x,u.z),h=Math.hypot(u.x,u.z),p=f*e.fx+e.cx,m=u.y/h*e.fy+e.cy,g=new n.Vector4(p,m,0,1);g.multiplyScalar(s);const y=d(g,o*s,r*s);e.scale_factor&&g.multiplyScalar(1/e.scale_factor);let b=!0;return l&&(b=u.z>-6),{distortPosition:g,preDistortPosition:g,projectionValid:b,distortGood:b,visible:y,withinRange:c}}}case i.CameraModel.Equirectangular:{const t=f(e.position,e.heading);return(i,s=1)=>{const l=new n.Vector4(i.x,i.y,i.z,1);l.applyMatrix4(t);const u=a.distance(i,e.position)<170,c=Math.hypot(l.x,l.z),f=Math.atan2(l.z,l.x),h=Math.acos(l.x/c),p=f*e.fx+e.cx,m=h*e.fy+e.cy,g=new n.Vector4(p,m,0,1);g.multiplyScalar(s);const y=d(g,o*s,r*s);return e.scale_factor&&g.multiplyScalar(1/e.scale_factor),{distortPosition:g,preDistortPosition:g,projectionValid:!0,distortGood:!0,visible:y,withinRange:u}}}default:throw new Error(`Unknown model ${e.camera_model}`)}},t.createWorldToCamera=f,t.createCameraToProjection=h,t.KITTIProjectionMatrix=t.CAMERA_MODELS_TO_PARAMS=void 0;var n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}(r(814412)),o=l(r(844955)),i=r(167469),a=r(141862),s=l(r(298784));function l(e){return e&&e.__esModule?e:{default:e}}const u=Object.freeze({[i.CameraModel.BrownConrady]:{required:["fx","fy","cx","cy"],optional:["skew","k1","k2","k3","k4","k5","k6","p1","p2","lx","ly","rSqThresh"]},[i.CameraModel.ModEquiFish]:{required:["fx","fy","cx","cy"],optional:["skew","k2","k3","k4"]},[i.CameraModel.ModKannala]:{required:["fx","fy","cx","cy"],optional:["skew","k1","k2","k3","k4"]},[i.CameraModel.Fisheye]:{required:["fx","fy","cx","cy"],optional:["skew","k1","k2","k3","k4"]},[i.CameraModel.Cylindrical]:{required:["fx","fy","cx","cy"],optional:["skew"]},[i.CameraModel.Equirectangular]:{required:["fx","fy","cx","cy"],optional:[]},[i.CameraModel.Omnidirectional]:{required:["fx","fy","cx","cy"],optional:["skew","k1","k2","k3","p1","p2","lx","ly","xi"]},[i.CameraModel.Ftheta]:{required:["fx","fy","cx","cy"],optional:["skew","k1","k2","k3","k4","k5"]},[i.CameraModel.FisheyeRadialCustom]:{required:["fx","fy","cx","cy"],optional:["skew","k1","k2","k3","k4","k5","k6","p1","p2","dcx","dcy"]}});t.CAMERA_MODELS_TO_PARAMS=u;const c=new n.Matrix4;function d(e,t,r){return e.y>=0&&e.y<r&&e.x>=0&&e.x<t}function f(e,t){const r=new n.Vector3(e.x,e.y,e.z),o=new n.Quaternion(t.x,t.y,t.z,t.w),i=new n.Matrix4,a=new n.Matrix4,s=new n.Matrix4;return o.invert(),r.multiplyScalar(-1),i.makeTranslation(r.x,r.y,r.z),a.makeRotationFromQuaternion(o),s.multiplyMatrices(a,i),s}function h(e,t,r,o,i){const a=new n.Matrix4;return a.set(e,i,r,0,0,t,o,0,0,0,0,0,0,0,1,0),a}function p(e,t,r,n,o,i,a){return[(e/r-n)/i,(t/r-o)/a]}function m(e,...t){let r=0,n=1;for(const o of t)r+=o*n,n*=e;return r}function g(e,t){switch(t.camera_model){case i.CameraModel.ModEquiFish:return function(e,t){const[r,o]=p(e.x,e.y,e.w,t.cx,t.cy,t.fx,t.fy),[i,a,s]=[t.k2||0,t.k3||0,t.k4||0],l=Math.sqrt(r*r+o*o),u=Math.atan(l),c=l<1e-5?1:u/l,d=u*u*(i+u*(a+u*s))+1,f=new n.Vector4(0,0,e.z,e.w);return f.x=t.fx*c*r*d+t.cx,f.y=t.fy*c*o*d+t.cy,f.x*=f.w,f.y*=f.w,f}(e,t);case i.CameraModel.ModKannala:return function(e,t){const[r,o]=p(e.x,e.y,e.w,t.cx,t.cy,t.fx,t.fy),[i,a,s,l]=[t.k1||0,t.k2||0,t.k3||0,t.k4||0],u=Math.sqrt(r*r+o*o),c=Math.atan(u),d=Math.atan(c),f=d*d,h=d*(1+f*(i+f*(a+f*(s+l*f)))),m=u>1e-5?Math.tan(h)/u:1,g=new n.Vector4(0,0,e.z,e.w);return g.x=t.fx*r*m+t.cx,g.y=t.fy*o*m+t.cy,g.x*=g.w,g.y*=g.w,g}(e,t);case i.CameraModel.Fisheye:return function(e,t){const[r,o]=p(e.x,e.y,e.w,t.cx,t.cy,t.fx,t.fy),[i,a,s,l]=[t.k1||0,t.k2||0,t.k3||0,t.k4||0],u=Math.sqrt(r*r+o*o),c=Math.atan(u),d=u<1e-5?1:c/u,f=c*c,h=f*(i+f*(a+f*(s+f*l)))+1,m=new n.Vector4(0,0,e.z,e.w);return m.x=t.fx*d*r*h+t.cx,m.y=t.fy*d*o*h+t.cy,m.x*=m.w,m.y*=m.w,m}(e,t);case i.CameraModel.Ftheta:return function(e,t){const[r,o]=p(e.x,e.y,e.w,t.cx,t.cy,t.fx,t.fy),[i,a,s,l,u]=[t.k1||0,t.k2||0,t.k3||0,t.k4||0,t.k5||0],c=Math.sqrt(r*r+o*o),d=c<1e-5?1:1/c,f=m(Math.atan(c),0,i,a,s,l,u),h=new n.Vector4(0,0,e.z,e.w);return h.x=t.fx*d*r*f+t.cx,h.y=t.fy*d*o*f+t.cy,h.x*=h.w,h.y*=h.w,h}(e,t);case i.CameraModel.FisheyeRadialCustom:return function(e,t){const[r,o,i,a,s,l]=[t.k1||0,t.k2||0,t.k3||0,t.k4||0,t.k5||0,t.k6||0],[u,c]=[t.p1||0,t.p2||0],[d,f]=[t.dcx||0,t.dcy||0],[h,g]=p(e.x,e.y,e.w,t.cx,t.cy,t.fx,t.fy),y=h-d,b=g-f,T=y*y+b*b,v=Math.sqrt(T);let x=v<1e-5?1:1/v;x*=m(Math.atan(v),0,1,r,o,i,a,s,l),x*=m(T*x*x,1,u,c);const _=(t.fx*(y*x+d)+t.cx)*e.w,M=(t.fy*(b*x+f)+t.cy)*e.w;return new n.Vector4(_,M,e.z,x<0?-1:e.w)}(e,t);case i.CameraModel.BrownConrady:case i.CameraModel.Omnidirectional:case void 0:case null:return function(e,t){let[r,o]=p(e.x,e.y,e.w,t.cx,t.cy,t.fx,t.fy);const i=r*r+o*o,[a,s,l,u,c,d,f,h,m,g]=[t.k1||0,t.k2||0,t.k3||0,t.k4||0,t.k5||0,t.k6||0,t.p1||0,t.p2||0,t.lx||0,t.ly||0];r+=m,o+=g;const y=(1+i*(a+i*(s+i*l)))/(1+i*(u+i*(c+i*d))),b=new n.Vector4(0,0,e.z,e.w);return b.x=t.cx+t.fx*(r*y+f*(i+2*r*r)+2*h*r*o),b.y=t.cy+t.fy*(o*y+h*(i+2*o*o)+2*f*r*o),b.x*=b.w,b.y*=b.w,b}(e,t);default:throw new Error(`Unknown model ${t.camera_model}`)}}t.KITTIProjectionMatrix=c,c.set(609.695409,180.384202,0,.999945389,-721.421597,7.64479802,0,.000124365378,-1.25125855,-719.651474,0,.010451303,-123.041806,-101.016688,384.38148,-.269386912),c.transpose();const y=e=>Math.abs(e)>1e-4;function b(e,t,r){const[n,a]=p(e.x,e.y,e.w,t.cx,t.cy,t.fx,t.fy);switch(t.camera_model){case i.CameraModel.ModEquiFish:{r.thetaThresh||(r.thetaThresh=function(e){const[t,r,n]=[e.k2||0,e.k3||0,e.k4||0],i=o.default.allRoots([5*n,4*r,3*t,0,1]).filter((e=>e>0));return i.sort(((e,t)=>e-t)),i[0]||1/0}(t));const e=Math.sqrt(n*n+a*a);return Math.atan(e)<r.thetaThresh}case i.CameraModel.ModKannala:{r.thetaThresh||(r.thetaThresh=Math.PI/2);const e=Math.sqrt(n*n+a*a);return Math.atan(e)<r.thetaThresh}case i.CameraModel.Fisheye:{r.thetaSqThresh||(r.thetaSqThresh=function(e){const[t,r,n,i]=[e.k1||0,e.k2||0,e.k3||0,e.k4||0],a=o.default.allRoots([9*i,7*n,5*r,3*t,1]).filter((e=>e>0));return a.sort(((e,t)=>e-t)),a[0]||1/0}(t));const e=Math.sqrt(n*n+a*a),i=Math.atan(e);return i*i<r.thetaSqThresh}case i.CameraModel.FisheyeRadialCustom:return e.w>0;case i.CameraModel.BrownConrady:case i.CameraModel.Omnidirectional:case i.CameraModel.Ftheta:case void 0:case null:r.rSqThresh||(r.rSqThresh=function(e){if("rSqThresh"in e&&!s.default.isNil(e.rSqThresh))return e.rSqThresh;const[t,r,n,i,a,l]=[e.k1,e.k2,e.k3,e.k4,e.k5,e.k6].map((e=>e||0));if(y(i)||y(a)||y(l))return 1/0;const u=o.default.allRoots([7*n,5*r,3*t,1]).filter((e=>e>0));return u.sort(((e,t)=>e-t)),u[0]||1/0}(t));return n*n+a*a<r.rSqThresh;default:throw new Error(`Unknown model ${t.camera_model}`)}}},844162:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t._getOriginalTcFieldId=function(e){const t=e.split(a.FIELD_ID_DELIMITER);if(2===t.length)return t[1];return e},t.default=void 0;var n,o=r(167469),i=r(991984),a=r(227267),s=r(513254),l=r(963494),u=r(222357),c=r(896135),d=(n=r(298784))&&n.__esModule?n:{default:n};const f=(e,t)=>e&&"processsupervision"===e.chatGraderAnnotationType||t&&"processsupervision"===t.chatGraderAnnotationType,h=(e,t,r)=>{const{responseIndex:n}=e,{responseIndex:o}=t,{stepIndicesToGradeOnly:i}=r||void 0;return!(void 0!==n&&void 0!==o&&n===o&&void 0!==i&&!i.includes(n))},p=({chatTaskAnnotationMetadata:e,fieldIdsToGradeOnly:t,stepIndicesToGradeOnly:r,textCollectionPerResponseCandidateIndexToGradeOnly:n})=>{const{originalFieldId:o,candidateIndex:i,responseIndex:a}=e;return void 0===t||void 0===o||!!t.includes(o)&&(!(void 0!==r&&void 0!==a&&!r.includes(a))&&(void 0===n||void 0===i||n.includes(i)))};var m=Object.freeze({chatTextCollection:{taskTypes:[o.TaskType.Chat],title:"chat text collection",graderFn:i.gradePerFrame(((e,t,r,n)=>({textCollection:f(e,t)?{correctWork:0,totalWork:0}:i.gradeIfNotMissing(((e,t)=>"textcollection"===e.chatGraderAnnotationType&&"textcollection"===t.chatGraderAnnotationType&&p({chatTaskAnnotationMetadata:e.chatTaskAnnotationMetadata,fieldIdsToGradeOnly:n?.fieldIdsToGradeOnly,stepIndicesToGradeOnly:n?.stepIndicesToGradeOnly,textCollectionPerResponseCandidateIndexToGradeOnly:n?.textCollectionPerResponseCandidateIndexToGradeOnly})?s.gradeByMatchingResult(s.singleGraderFn,n)(e,t):{correctWork:0,totalWork:0}),e,t)})))},chatTextCollectionCategoryDistance:{taskTypes:[o.TaskType.Chat],title:"chat text collection - category distance",graderFn:i.gradePerFrame(((e,t,r,n)=>({categoryDistance:f(e,t)?{correctWork:0,totalWork:0}:i.gradeIfNotMissing(((e,t)=>"textcollection"===e.chatGraderAnnotationType&&"textcollection"===t.chatGraderAnnotationType&&[l.TextCollectionFieldType.Category,l.TextCollectionFieldType.Number,l.TextCollectionFieldType.Autocomplete].includes(t.type)&&p({chatTaskAnnotationMetadata:e.chatTaskAnnotationMetadata,fieldIdsToGradeOnly:n?.fieldIdsToGradeOnly,stepIndicesToGradeOnly:n?.stepIndicesToGradeOnly,textCollectionPerResponseCandidateIndexToGradeOnly:n?.textCollectionPerResponseCandidateIndexToGradeOnly})?{correctWork:d.default.sum(e.response.map((e=>e.result===u.GraderResult.Correct?1:e.result===u.GraderResult.Incorrect?t.type===l.TextCollectionFieldType.Category?s.getCategoryScoreByDistance(e.expected,e.given,n):s.getCategoryScoreByDistance([e.expected],[e.given],n):0))),totalWork:t.response.length}:{correctWork:0,totalWork:0}),e,t)})))},chatModelResponseSelector:{taskTypes:[o.TaskType.Chat],title:"model response selector",graderFn:i.gradePerFrame(((e,t,r,n)=>({modelResponseSelector:f(e,t)?{correctWork:0,totalWork:0}:i.gradeIfNotMissing(((e,t)=>{if(!h(e.chatTaskAnnotationMetadata,t.chatTaskAnnotationMetadata,n))return{correctWork:0,totalWork:0};if("model-response-selector"===e.chatGraderAnnotationType&&"model-response-selector"===t.chatGraderAnnotationType){if(n?.useLikert){const r=n.steps||[1],o=Math.abs(e.likertValueRaw-t.likertValueRaw);return{correctWork:o<r.length?r[o]:0,totalWork:1}}return{correctWork:e.selectedId===t.selectedId?1:0,totalWork:1}}return{correctWork:0,totalWork:0}}),e,t)})))},chatNerLabels:{taskTypes:[o.TaskType.Chat],title:"chat ner labels",graderFn:c.gradePerFrameForAnnotations(((e,t,r)=>({nerLabels:f(e,t)?{correctWork:0,totalWork:0}:i.gradeIfNotMissing(((e,t)=>"namedentityrecognition"===t?.chatGraderAnnotationType?c.nerLabelsGrader(e,t).nerLabels:{correctWork:0,totalWork:0}),e,t)})))},chatProcessSupervision:{taskTypes:[o.TaskType.Chat],title:"chat process supervision",graderFn:c.gradePerFrameForAnnotations(((e,t,r)=>{return{processSupervisionLabels:(n=e,o=t,"processsupervision"===o?.chatGraderAnnotationType&&"processsupervision"===n?.chatGraderAnnotationType?n.rating===o.rating?{correctWork:1,totalWork:1}:{correctWork:0,totalWork:1}:{correctWork:0,totalWork:0})};var n,o}))},chatModelResponseRanking:{taskTypes:[o.TaskType.Chat],title:"chat model response ranking",graderFn:c.gradePerFrameForAnnotations(((e,t,r,n)=>({modelResponseRankingLabels:f(e,t)?{correctWork:0,totalWork:0}:i.gradeIfNotMissing(((e,t)=>{if(!h(e.chatTaskAnnotationMetadata,t.chatTaskAnnotationMetadata,n))return{correctWork:0,totalWork:0};if("model-response-ranking"===t.chatGraderAnnotationType&&"model-response-ranking"===e.chatGraderAnnotationType&&e.rankings.length===t?.rankings.length){let r=0,n=0;for(let o=0;o<e.rankings.length;o++){const i=e.rankings[o];for(const e of i)d.default.includes(t.rankings[o],e)&&(r+=1),n+=1}return{correctWork:r/n,totalWork:1}}return{correctWork:0,totalWork:0}}),e,t)})))}});t.default=m},227267:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FIELD_ID_DELIMITER=void 0;t.FIELD_ID_DELIMITER="___FIELD_ID_DELIMITER___"},798451:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getBoundingBoxIoU=function(e,t){const r=a(e,t);if(!r)return 0;const n=i(r),o=i(e),s=i(t);return n/(o+s-n)},t.getBoundingBoxOverlap=function(e,t){const r=a(e,t);if(!r)return 0;const n=i(r),o=i(e),s=i(t);if(0===o||0===s)return 1;return Math.max(n/o,n/s)},t.getBoundingBoxArea=i,t.getBoundingBoxIntersect=a,t.getBoundingBoxCenterPoint=function(e){return{x:e.left+e.width/2,y:e.top+e.height/2}},t.getBoundingBoxClosestPointToLeft=function(e,t){if(e.length>0){let r={x:e[0].left,y:e[0].top},n=o.distance(t,r);for(const i of e){const e=o.distance(t,{x:i.left,y:i.top}),a=o.distance(t,{x:i.left,y:i.top+i.height});e<n&&(r={x:i.left,y:i.top},n=e),a<n&&(r={x:i.left,y:i.top+i.height},n=a)}return r}return{x:0,y:0}},t.isBoundingBoxInMargin=function(e,t,r,n){return[t.top-e.top,t.left-e.left,e.top+e.height-(t.top+t.height),e.left+e.width-(t.left+t.width)].every((e=>e>=-r&&e<=n))},t.mergeBoundingBoxes=function(e,t){const r=Math.min(e.top,t.top),o=Math.min(e.left,t.left),i=Math.max(e.left+e.width,t.left+t.width),a=Math.max(e.top+e.height,t.top+t.height);return{type:n.GeometryType.BoundingBox,top:r,left:o,width:i-o,height:a-r}},t.expandBoundingBox=function(e,t){return{type:e.type,top:e.top-t,left:e.left-t,width:e.width+2*t,height:e.height+2*t}},t.isBoundingBoxFullyContained=function(e,t,r){return e.top-r-t.top<=0&&e.left-r-t.left<=0&&e.top+e.height+r-(t.top+t.height)>=0&&e.left+e.width+r-(t.left+t.width)>=0},t.scaleBoundingBox=function(e,t,r){const n=r.width/t.width,o=r.height/t.height;return{type:e.type,left:e.left*n,top:e.top*o,width:e.width*n,height:e.height*o}},t.ocrBoxToBoundingBox=function(e,t){return{type:n.GeometryType.BoundingBox,left:e.Left*t.width,top:e.Top*t.height,width:e.Width*t.width,height:e.Height*t.height}},t.boundingBoxToOcrBox=function(e,t){return{Left:e.left/t.width,Top:e.top/t.height,Width:e.width/t.width,Height:e.height/t.height}};var n=r(116615),o=r(141862);function i(e){return e.width*e.height}function a(e,t){const r=Math.max(e.left,t.left),o=Math.max(e.top,t.top),i=Math.min(e.left+e.width,t.left+t.width)-r,a=Math.min(e.top+e.height,t.top+t.height)-o;return i<=0||a<=0?null:{type:n.GeometryType.BoundingBox,top:o,left:r,width:i,height:a}}},525277:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isLineSegmentIntersect=t.getPointPixels=t.getPointPercent=void 0;t.getPointPercent=(e,{offsetWidth:t,offsetHeight:r})=>({x:e.x/t,y:e.y/r});t.getPointPixels=(e,{offsetWidth:t,offsetHeight:r})=>({x:e.x*t,y:e.y*r});t.isLineSegmentIntersect=(e,t,n,o)=>r(e,n,o)!==r(t,n,o)&&r(e,t,n)!==r(e,t,o);const r=(e,t,r)=>(r.y-e.y)*(t.x-e.x)>(t.y-e.y)*(r.x-e.x)},247740:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPolygonIoU=function(e,t){const r=h(e,t);if(!r)return 0;const n=f(e,t);if(!n)return 0;const o=c(r),i=c(n);if(0===i)return 0;return o/i},t.getPolygonOverlap=function(e,t){const r=h(e,t);if(!r)return 0;const n=c(r),o=c(e),i=c(e);if(0===o||0===i)return 1;return Math.max(n/o,n/i)},t.getPolygonArea=c,t.isPolygonClockwise=d,t.resetPolygonClockwise=function(e){if(d(e))return e;return{type:e.type,vertices:[e.vertices[1],e.vertices[0],e.vertices[3],e.vertices[2]]}},t.getPolygonUnion=f,t.getPolygonIntersect=h,t.getQuadrilateralCenterPoint=function(e){let t=0,r=0;for(const n of e)t+=n.x,r+=n.y;return{x:t/e.length,y:r/e.length}},t.getPolygonClosestPointToLeft=function(e,t){if(e.length>0){const r=s.default.flatten(e);let n={x:r[0].x,y:r[0].y},o=i.distance(t,n);for(const e of r){const r=i.distance(t,e);r<o&&(n=e,o=r)}return n}return{x:0,y:0}},t.checkFastPolygonIntersect=function(e,t){for(let r=0;r<4;r++)for(let n=0;n<4;n++){const o=e.vertices[r],i=e.vertices[(r+1)%4],s=t.vertices[n],l=t.vertices[(n+1)%4];if(a.isLineSegmentIntersect(o,i,s,l))return!0}return g(e,t.vertices[0])||g(t,e.vertices[0])},t.isPolygonInMargin=function(e,t,r,n){const o=Math.min(r,n);return[0,1,2,3].every((r=>((e,t)=>{const r=e.x-t.x,n=e.y-t.y;return Math.sqrt(r*r+n*n)})(e.vertices[r],t.vertices[r])<=o))},t.getLocationPolygon=function(e){if(e.type===o.GeometryType.BoundingBox)return{type:o.GeometryType.Polygon,vertices:[{x:e.left,y:e.top},{x:e.left+e.width,y:e.top},{x:e.left+e.width,y:e.top+e.height},{x:e.left,y:e.top+e.height}]};if(e.type===o.GeometryType.Polygon)return e;l.assertNever(e)},t.ocrPolygonToPolygon=function(e,t){return{type:o.GeometryType.Polygon,vertices:(e??[]).map((e=>({x:e.X*t.width,y:e.Y*t.height})))}},t.scalePolygon=function(e,t,r){return{...e,vertices:e.vertices.map((e=>({x:e.x/t.width*r.width,y:e.y/t.height*r.height})))}},t.isPointInTriangle=t.isPointInQuadrilateral=void 0;var n=u(r(373291)),o=r(116615),i=r(141862),a=r(525277),s=u(r(298784)),l=r(810755);function u(e){return e&&e.__esModule?e:{default:e}}function c(e){let t=0,r=e.vertices.length-1;for(let n=0;n<e.vertices.length;n++){const{x:o,y:i}=e.vertices[n],{x:a,y:s}=e.vertices[r];t+=(a+o)*(s-i),r=n}return Math.abs(t)/2}function d(e){let t=0,r=e.vertices.length-1;for(let n=0;n<e.vertices.length;n++){const{x:o,y:i}=e.vertices[n],{x:a,y:s}=e.vertices[r];t+=(a-o)*(s+i),r=n}return t>0}function f(e,t){const r=n.default.union(p(e),p(t));return 1!==r.regions.length?null:m(r)}function h(e,t){const r=n.default.intersect(p(e),p(t));return 1!==r.regions.length?null:m(r)}function p(e){return{regions:[e.vertices.map((e=>[s.default.round(e.x,5),s.default.round(e.y,5)]))],inverted:!1}}function m(e){return{type:o.GeometryType.Polygon,vertices:e.regions[0].map((e=>({x:e[0],y:e[1]})))}}const g=(e,t)=>y(e.vertices[0],e.vertices[1],e.vertices[2],t)||y(e.vertices[2],e.vertices[3],e.vertices[0],t);t.isPointInQuadrilateral=g;const y=(e,t,r,n)=>{const o=n.x-e.x,i=n.y-e.y,a=(t.x-e.x)*i-(t.y-e.y)*o>0;return(r.x-e.x)*i-(r.y-e.y)*o>0!==a&&(r.x-t.x)*(n.y-t.y)-(r.y-t.y)*(n.x-t.x)>0===a};t.isPointInTriangle=y},43356:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDims=void 0;var n,o=(n=r(298784))&&n.__esModule?n:{default:n},i=r(308408);const a=e=>{const t={},{vertices:r}=e;if(!r||0===r.length)return null;const n=r.reduce(((e,t)=>({minX:Math.min(e.minX,t.x),maxX:Math.max(e.maxX,t.x),minY:Math.min(e.minY,t.y),maxY:Math.max(e.maxY,t.y)})),{minX:r[0].x,maxX:r[0].x,minY:r[0].y,maxY:r[0].y});return t.x=((n.minX+n.maxX)/2).toFixed(0),t.y=((n.minY+n.maxY)/2).toFixed(0),t.w=(n.maxX-n.minX).toFixed(0),t.h=(n.maxY-n.minY).toFixed(0),t},s={[i.AnnotationGeometry.Point]:e=>{const t={},{x:r,y:n}=e;return o.default.isNil(r)||o.default.isNil(n)?null:(t.x=r.toFixed(0),t.y=n.toFixed(0),t)},[i.AnnotationGeometry.Line]:e=>{const t=a(e),{vertices:r}=e;return r&&0!==r.length?(t.l=r.slice(1).reduce(((e,t)=>({dist:e.dist+Math.sqrt((e.prevX-t.x)**2+(e.prevY-t.y)**2),prevX:t.x,prevY:t.y})),{dist:0,prevX:r[0].x,prevY:r[0].y}).dist.toFixed(0),t):null},[i.AnnotationGeometry.Box]:e=>{const t={},{x:r,y:n,width:i,height:a}=e;return o.default.isNil(r)||o.default.isNil(n)||o.default.isNil(i)||o.default.isNil(a)?null:(t.x=(r+i/2).toFixed(0),t.y=(n+a/2).toFixed(0),t.w=i.toFixed(0),t.h=a.toFixed(0),t)},[i.AnnotationGeometry.Ellipse]:e=>{const t={},{center:r,width:n,height:i}=e;return!r||o.default.isNil(n)||o.default.isNil(i)?null:(t.w=n.toFixed(0),t.h=i.toFixed(0),t.x=r[0].toFixed(0),t.y=r[1].toFixed(0),t)},[i.AnnotationGeometry.ExtremalPoints]:a,[i.AnnotationGeometry.Cuboid]:e=>{const t={},{face:r}=e;return r?(t.w=(r.x2-r.x1).toFixed(0),t.h=(r.y2-r.y1).toFixed(0),t.x=((r.x1+r.x2)/2).toFixed(0),t.y=((r.y1+r.y2)/2).toFixed(0),t):null},[i.AnnotationGeometry.Polygon]:a};t.getDims=s},60271:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.orderedPointArraysEqual=t.getRotatedVertices=t.resizeRotatedBox=void 0;const r=e=>[Math.cos(e),1*Math.sin(e)],n=e=>[-1*Math.sin(e),Math.cos(e)];t.resizeRotatedBox=({width:e,height:t,center:o,rotation:i,diff:a,sign:s})=>{const l=a[0]*r(i)[0]+a[1]*r(i)[1],u=Math.abs(e+s[0]*l),c=a[0]*n(i)[0]+a[1]*n(i)[1],d=Math.abs(t+s[1]*c);let f,h;0===s[0]?(f=s[1]*(d-t)/2*Math.sin(-i),h=s[1]*(d-t)/2*Math.cos(-i)):0===s[1]?(f=s[0]*(u-e)/2*Math.cos(i),h=s[0]*(u-e)/2*Math.sin(i)):(f=a[0]/2,h=a[1]/2);return{center:{x:o.x+f,y:o.y+h},width:u,height:d}};t.getRotatedVertices=({width:e,height:t,center:r,rotation:n,returnMidpoints:o})=>{let i;i=o?[{x:0,y:-1*t/2},{x:e/2,y:0},{x:0,y:t/2},{x:-1*e/2,y:0}]:[{x:-1*e/2,y:-1*t/2},{x:e/2,y:-1*t/2},{x:e/2,y:t/2},{x:-1*e/2,y:t/2}];const a=n,s=[Math.cos(a),-1*Math.sin(a)],l=[1*Math.sin(a),Math.cos(a)];return i.map((e=>{const t=s[0]*e.x+s[1]*e.y,n=l[0]*e.x+l[1]*e.y;return{x:t+r.x,y:n+r.y}}))};t.orderedPointArraysEqual=(e,t)=>{if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++){const n=e[r],o=t[r];if(Math.round(n.x)!==Math.round(o.x)||Math.round(n.y)!==Math.round(o.y))return!1}return!0}},950382:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shiftAnnotation=function(e,t,r){if(e.type===o.AnnotationGeometry.Point){const n=e;return{...n,x:n.x+t,y:n.y+r}}{const n=e.vertices.map((e=>({...e,x:e.x+t,y:e.y+r})));return{...e,vertices:n}}},t.freezeAllSeamVertices=d,t.removeAllSeams=function(e){return e.map((e=>e.type===o.AnnotationGeometry.Line||e.type===o.AnnotationGeometry.Polygon?{...e,vertices:e.vertices.map((e=>s.default.omit(e,"seamId")))}:e))},t.unfreezeAnnotation=f,t.lockLabelAndAttributesAnnotation=h,t.unlockLabelAndAttributesAnnotation=p,t.onlyLockLabelAndAttributesCuboidAnnotationsBasedOnLabel=function(e){const t=a.BEE_LABELS_KEEP_LOCKED;return e.map((e=>t.includes(e.label??"")?h(e):p(e)))},t.lockLabelAndAttributesAnnotations=function(e){return e.map(h)},t.unlockLabelAndAttributesAnnotations=function(e){return e.map(p)},t.transformDerivedToPolygonAnnotations=function(e){return e.map(m)},t.transformDerivedToPolygonAnnotation=m,t.unfreezeAnnotationsInsideAR=function(e){return e.map((e=>{const t=e.metadata,r=a.BEE_LABELS_KEEP_LOCKED;return t?.isOutsideAR||r.includes(e.label??"")?g(e):d(f(e))}))},t.freezeFrontendPathAnnotation=function(e){return{...e,vertices:e.vertices.map(((t,r)=>({...t,anchored:!0,...r<e.vertices.length-1||e.type===o.AnnotationGeometry.Polygon?{anchoredSegment:!0}:{}})))}},t.freezeAnnotation=g,t.freezeAnnotations=function(e){return e.map(g)},t.mapBeeInsideAnnotationsAsDeletable=function(e){return e.map((e=>b(e)&&!a.BEE_LABELS_KEEP_LOCKED.includes(e.label??"")?{...e,metadata:{...e.metadata,isUndeletable:!1}}:e))},t.isClockwiseOrder=function(e){if(e.length<2)throw Error("The input edge contains less than 2 vertices; directionality cannot be determined");let t=e;c(e[0],e[e.length-1],0)||(t=[...t,e[0]]);return u(t)<0},t.chooseInsideAnnotationFilter=function(e){const t=e.base_annotations?.options?.remove_bordering_annotations;return t?T:b},t.isInsideAnnotationOrHasSeamId=b,t.isAnnotationStrictlyOutside=function(e){const t=e.vertices?.some((e=>!!e.seamId));return y(e)&&!t},t.isAnnotationStrictlyInside=T,t.isPreviousDerivedAnnotation=t.isAnnotationOutsideAr=t.isSameSegment=t.samePoint=t.signedArea=t.DEFAULT_EPSILON=void 0;var n,o=r(308408),i=r(492027),a=r(281652),s=(n=r(298784))&&n.__esModule?n:{default:n};const l=1e-4;t.DEFAULT_EPSILON=l;const u=e=>{let t=0;for(let r=0,n=1;r<e.length;r++,n++)n%=e.length,t+=e[r].x*e[n].y-e[n].x*e[r].y;return t};t.signedArea=u;const c=(e,t,r)=>{const n=r??l;return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)+Math.abs((e.worldZ??0)-(t.worldZ??0))<=n/2};t.samePoint=c;function d(e){return e.type===o.AnnotationGeometry.Point?e:e.type===o.AnnotationGeometry.Line?{...e,vertices:e.vertices.map((e=>({...e,anchored:!!e.seamId})))}:e.type===o.AnnotationGeometry.Polygon?{...e,vertices:s.default.map(e.vertices,((e,t,r)=>{const n=r[0===t?r.length-1:t-1];return{...e,anchored:!!e.seamId||!!n.seamId,anchoredSegment:!!e.seamId}}))}:e}function f(e){return e.type===o.AnnotationGeometry.Point?e:{...e,vertices:e.vertices.map(((t,r)=>({...t,anchored:!1,...r<e.vertices.length-1?{anchoredSegment:!1}:{}})))}}function h(e){const t={...e.metadata,lockLabelAndAttributes:!0};return{...e,metadata:t}}function p(e){const t={...e.metadata,lockLabelAndAttributes:!1};return{...e,metadata:t}}function m(e){const t={...e.metadata};if(delete t.derivedMetadata,e.type===o.AnnotationGeometry.Point)return{...e,metadata:t};const r=e.vertices.map((e=>{const t={...e};return delete t.layer1VertexId,delete t.layer2VertexId,t}));return{...e,vertices:r,metadata:t}}function g(e){return e.type===o.AnnotationGeometry.Point?(e.anchored=!0,e):{...e,vertices:e.vertices.map(((t,r)=>({...t,anchored:!0,...r<e.vertices.length-1||e.type===o.AnnotationGeometry.Polygon?{anchoredSegment:!0}:{}})))}}t.isSameSegment=(e,t,r)=>{if(e.length!==t.length)return!1;const n=s.default.range(e.length).every((n=>{const o=e[n],i=t[n];return c(o,i,r)})),o=s.default.range(e.length).every((n=>{const o=e[n],i=t[t.length-1-n];return c(o,i,r)}));return n||o};const y=e=>e.metadata&&e.metadata.isOutsideAR;function b(e){const t=e.vertices?.some((e=>!!e.seamId));return!y(e)||t||i.isDerivedAnnotation(e)}function T(e){return!y(e)||i.isDerivedAnnotation(e)}t.isAnnotationOutsideAr=y;t.isPreviousDerivedAnnotation=e=>!!e.metadata?.previousDerivedMetadata},281652:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BEE_LABELS_KEEP_LOCKED=t.BEE_CUBOID_LABELS=void 0;var n=r(143986);const o=["Road Sign","Traffic Light","Pedestrian Crossing Light","Bicycle Crossing Light","Highway Metering Light","Railroad Crossing Light","Lane Control Signal","Uncommon Traffic Light","Traffic Light Can't Tell","Pedestrian Hybrid Beacon","Emergency Vehicle Hybrid Beacon","Traffic Light Ignore","Roadway Gate","Gate","Delete Cuboid"];t.BEE_CUBOID_LABELS=o;const i=o.concat([n.ANNOTATABLE_REGION,n.NO_DATA_ZONE]);t.BEE_LABELS_KEEP_LOCKED=i},297393:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPointIntersections=function(e){if(!e)throw new Error("Computing point intersections with undefined context");e.pointIntersections||(e.pointIntersections=s(e));return e.pointIntersections},t.getPointIntersectionsWeighted=async function(e){if(!e)throw new Error("Computing point intersections with undefined context");e.distanceWeightedPointIntersections||(e.distanceWeightedPointIntersections=await s(e,!0));return e.distanceWeightedPointIntersections};var n=a(r(298784)),o=r(168212),i=a(r(138385));function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){const r=new Map,a=Array.from(e.clusteredSegmentations.keys()).sort(),s=[[a[0],a[1]]];a[2]&&s.push([a[0],a[2]],[a[1],a[2]]);const l=e.isSceneFlattened?1:e.clusteredSegmentations.get(a[0]).length;function u(t,n){for(const[i,a]of s){const s=e.clusteredSegmentations.get(i)[t],l=e.clusteredSegmentations.get(a)[t];o.buildLSSCounts({startSource:i,endSource:a,startLabels:s,endLabels:l,frame:t,intersectionMap:r,pointWeights:n})}}if(t){const t=function(e){if(!e.devicePositions)throw new Error("No device positions in context");const t=n.default.sortBy(n.default.entries(e.devicePositions),(([e])=>n.default.toNumber(e))).map((([,e])=>e));if(!t.length)return;const r=e.weightingByDistance;if(n.default.isEmpty(r))return;const o=new Map(n.default.map(r,((e,t)=>[n.default.toNumber(t)**2,e]))),a=n.default.sortBy(Array.from(o.keys())),s=i.default.fromAxes([t.map((e=>e.x)),t.map((e=>e.y)),t.map((e=>e.z))]);return async e=>{const r=[],i=o.get(n.default.last(a));for(let n=0;n<e.length;n+=3){n%1e4===0&&await new Promise(setImmediate);const l=e.slice(n,n+3),u=t[s.nearestNeighbor(l)],c=(u.x-l[0])**2+(u.y-l[1])**2+(u.z-l[2])**2;let d=i;for(const e of a)if(e>c){d=o.get(e);break}r.push(d)}return r}}(e);return(async()=>{for(let r=0;r<l;r++)u(r,await(t?.(e.pointData[r])));return r})()}for(let n=0;n<l;n++)u(n);return r}},205308:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,o=(n=r(298784))&&n.__esModule?n:{default:n},i=r(599789),a=r(991984),s=r(440169);const l=(e,t,r)=>{let n;const o=r?.attributeTypes?.[e];switch(o){case i.AnnotationAttributeType.Angle:n=c;break;case i.AnnotationAttributeType.XLine:n=d;break;case i.AnnotationAttributeType.YLine:n=f;break;default:n=u}return(r,o)=>n(e,r,o,t)},u=(e,t,r,n)=>{const i=t?.attributes?.[e],a=r?.attributes?.[e];return(n.ltdPerFrameKeys??[]).includes(e)?{correctWork:Array.isArray(i)&&Array.isArray(a)&&i.length===a.length&&a.length>0?a.filter(((e,t)=>e===i[t])).length/a.length:0,totalWork:1,intermediates:{attrKey:e,correct:a,original:i}}:(Array.isArray(i)&&Array.isArray(a)&&(i.sort(),a.sort()),{correctWork:+o.default.isEqual(i,a),totalWork:1,intermediates:{attrKey:e,correct:a,original:i}})},c=(e,t,r,n)=>{const o=+(t?.attributes?.[e]||0),i=+(r?.attributes?.[e]||0),a=n.angleDiffThresholdDegrees||45,s=Math.min(Math.abs(o-i),Math.abs(o-i-360));return{correctWork:s<a?1:0,totalWork:1,intermediates:{angleDiff:s}}},d=(e,t,r,n)=>{let o,i,a=0;const l=+(t?.attributes?.[e]||0),u=+(r?.attributes?.[e]||0);if(t.width)a=r.width,o=t.left+l,i=r.left+u;else{if(!t.edges)throw new Error(`Annotation with type ${t?.type||t?.geometry} does not support the yline attribute.`);{const e=s.getCuboidFrontFaceAsBox(s.formatCuboidAnnotation(t)),n=s.getCuboidFrontFaceAsBox(s.formatCuboidAnnotation(r));a=n.width,o=e.left+l,i=n.left+u}}const c=n.xlineDiffThresholdFraction||.1,d=Math.abs(o-i);return{correctWork:d<a*c?1:0,totalWork:1,intermediates:{xlineDiff:d}}},f=(e,t,r,n)=>{let o,i,a=0;const l=+(t?.attributes?.[e]||0),u=+(r?.attributes?.[e]||0);if(t.height)a=r.height,o=t.top+l,i=r.top+u;else{if(!t.edges)throw new Error(`Annotation with type ${t?.type||t?.geometry} does not support the yline attribute.`);{const e=s.getCuboidFrontFaceAsBox(s.formatCuboidAnnotation(t)),n=s.getCuboidFrontFaceAsBox(s.formatCuboidAnnotation(r));a=n.height,o=e.top+l,i=n.top+u}}const c=n.ylineDiffThresholdFraction||.1,d=Math.abs(o-i);return{correctWork:d<a*c?1:0,totalWork:1,intermediates:{ylineDiff:d}}},h=e=>(t,r)=>{const n=t?.attributes?.[e]??"",o=r?.attributes?.[e]??"";return a.gradeFreeText(n,o)};var p=(e,t,r,n,i,s)=>{i||(i={});const u=s,c=i.textAttributeKeys||u.textAttributeKeys||[],d=t?.frames?.[e],f=r?.frames?.[e],p=o.default.keys(f?.attributes||d?.attributes),m=o.default.isArray(i.enabledAttributeKeys)&&!o.default.isEmpty(i.enabledAttributeKeys)?i.enabledAttributeKeys:void 0,g={};return o.default.forEach(p,(e=>{if("scenarioParams"===e)return;if(m&&!m.includes(e))return;const t=c.includes(e)?h(e):l(e,i,u);g[`attributes_${e}`]=a.gradeIfNotMissing(t,d,f)})),g};t.default=p},51514:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.beeMappingAttributeGrader=t.defaultAttributeGraderFn=t.attributeGrader=void 0;var n,o=(n=r(298784))&&n.__esModule?n:{default:n},i=r(599789),a=r(991984),s=r(691289);const l=(e,t,r,n,l,c)=>{l||(l={});const d=t?.frames?.[e],f=r?.frames?.[e],h=o.default.keys(f?.attributes||d?.attributes),p=o.default.filter(h,(e=>c?.attributeTypes?.[e]!==i.AnnotationAttributeType.Linked&&!s.BANNED_ATTRIBUTE_TYPES.includes(e)&&!s.toLinkingAttributeKeyBase(e))),m={};return o.default.forEach(p,(e=>{const t=u(e,l);m[`attribute_${e}`]=a.gradeIfNotMissing(t,d,f)})),m};t.attributeGrader=l;const u=(e,t)=>(r,n)=>c(e,r,n,t),c=(e,t,r)=>{let n=t?.attributes?.[e],i=r?.attributes?.[e];return Array.isArray(n)&&Array.isArray(i)&&(n=o.default.sortBy(n),i=o.default.sortBy(i)),{correctWork:+o.default.isEqual(n,i),totalWork:1}};t.defaultAttributeGraderFn=c;const d={taskTypes:i.twoDTypes,title:"Bee GIS Attribute Grader",graderFn:a.gradePerFrameWithContext(l,!1)};t.beeMappingAttributeGrader=d},119426:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.INFINITY=void 0;t.INFINITY=1e15},15455:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.beeMappingLinkingGrader=t.calculateCorrectAndTotalWork=t.getLinkedAttributeToAnnotations=t.fromAnnotationLabelChangedLinkingGraderGenerator=t.toAnnotationMissingOrLabelChangedLinkingGraderGenerator=t.toAndFromAnnotationExistLinkingGraderGenerator=t.linkingGrader=void 0;var n,o=(n=r(298784))&&n.__esModule?n:{default:n},i=r(599789),a=r(991984),s=r(691289);const l=(e,t,r,n,l,f)=>{const h=t?.frames?.[e],p=r?.frames?.[e],m=o.default.union(o.default.keys(p?.attributes),o.default.keys(h?.attributes)),g=f?.matchedAnnotationsListContext,{attributeTypes:y,linkTypes:b}=f,T=b?Object.keys(b):[],v=o.default.filter(m,(e=>!!s.toLinkingAttributeKeyBase(e,T)||y?.[e]===i.AnnotationAttributeType.Linked)),x=o.default.compact(o.default.map(v,(e=>s.toLinkingAttributeKeyBase(e,T)))),_=[...new Set(x)],M={};return _.forEach((e=>{const t=u(e,g),r=c(e,g),n=d(e,g);M[`linking_${e}`]=a.gradeIfNotMissing(t,h,p),M[`linking_${e}_UNMATCHED_TO_ANN`]=a.gradeIfNotMissing(r,h,p),M[`linking_${e}_FROM_LABELS_DIFFERENT`]=a.gradeIfNotMissing(n,h,p)})),M};t.linkingGrader=l;const u=(e,t)=>(r,n)=>{const o=r?.label,i=n?.label;if(o!==i)return{correctWork:0,totalWork:0};const{originalToAnnotations:a,correctToAnnotations:s}=f(e,r,n,t),l=a.filter((e=>e?.correctAnnotation&&e?.correctAnnotation?.props.label===e?.currentAnnotation?.props.label)),u=s.filter((e=>e?.correctAnnotation&&e?.correctAnnotation?.props.label===e?.currentAnnotation?.props.label)),{correctWork:c,totalWork:d,intermediates:p}=h(l,u);return{correctWork:c,totalWork:d,intermediates:p}};t.toAndFromAnnotationExistLinkingGraderGenerator=u;const c=(e,t)=>(r,n)=>{const o=r?.label,i=n?.label;if(o!==i)return{correctWork:0,totalWork:0};const{originalToAnnotations:a,correctToAnnotations:s}=f(e,r,n,t),l=a.filter((e=>!e?.correctAnnotation||e.correctAnnotation?.props.label!==e.currentAnnotation?.props.label)),u=s.filter((e=>!e?.correctAnnotation||e.correctAnnotation?.props.label!==e.currentAnnotation?.props.label)),{correctWork:c,totalWork:d}=h(l,u);return{correctWork:c,totalWork:d}};t.toAnnotationMissingOrLabelChangedLinkingGraderGenerator=c;const d=(e,t)=>(r,n)=>{const o=r?.label,i=n?.label;if(o===i)return{correctWork:0,totalWork:0};const{originalToAnnotations:a,correctToAnnotations:s}=f(e,r,n,t),{totalWork:l}=h(a,s);return{correctWork:0,totalWork:l}};t.fromAnnotationLabelChangedLinkingGraderGenerator=d;const f=(e,t,r,n)=>{const i=t?.attributes,a=r?.attributes,s=Object.values(o.default.pickBy(i,((t,r)=>r.includes(e)))),l=Object.values(o.default.pickBy(a,((t,r)=>r.includes(e))));return{originalToAnnotations:s.map((e=>n?.find((t=>t.correctAnnotation?.props?.id===e)))),correctToAnnotations:l.map((e=>n?.find((t=>t.correctAnnotation?.props?.id===e))))}};t.getLinkedAttributeToAnnotations=f;const h=(e,t)=>{const r=e.map((e=>e?.correctAnnotation?.props?.id)),n=t.map((e=>e?.correctAnnotation?.props?.id));return{correctWork:o.default.intersectionBy(r,n).length,totalWork:Math.max(e.length,t.length),intermediates:{extraneous:o.default.difference(r,n),missing:o.default.difference(n,r)}}};t.calculateCorrectAndTotalWork=h;const p={taskTypes:i.twoDTypes,title:"Bee GIS Linking Grader",graderFn:a.gradePerFrameWithContext(l,!1,!1,!1)};t.beeMappingLinkingGrader=p},171665:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.beeMappingLinterDismissalGrader=t.beeMappingLinterDismissalGraderFn=void 0;var n=r(599789),o=r(971599),i=r(991984);const a=e=>e?.lintDismissal.dismissalType===o.LintDismissalType.Rejected,s=(e,t)=>({beeMappingLinterDismissal:i.ignoreIfMissing(((e,t)=>{const r=[];e.metadata?.lintMetadata?.lintDismissals.forEach((e=>{const n=t.metadata?.lintMetadata?.lintDismissals.find((t=>t.lintErrorId===e.lintErrorId));r.push({actual:e,expected:n})})),t.metadata?.lintMetadata?.lintDismissals.forEach((e=>{r.find((t=>t.expected?.lintErrorId===e.lintErrorId))||r.push({actual:void 0,expected:e})}));return{correctWork:r.filter((e=>a(e.actual)===a(e.expected))).length,totalWork:r.length}}),e,t)});t.beeMappingLinterDismissalGraderFn=s;const l={taskTypes:n.twoDTypes,title:"Bee GIS Linter Dismissal Grader",graderFn:i.gradePerFrame(s)};t.beeMappingLinterDismissalGrader=l},60738:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defaultBeeMappingParams=void 0;t.defaultBeeMappingParams={splitTolerance:.1,segmentLinkTolerance:.001,crossSubdivisionThreshold:5,segmentLinkCandidateFcdThreshold:5,maximumSplitSegmentLength:10.3}},438292:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makeGlobalBeeMappingGraderFn=f,t.makeGlobalBeeMappingMatcherFn=m,t.globalGrader=void 0;var n,o=r(167469),i=(n=r(298784))&&n.__esModule?n:{default:n},a=r(45834),s=r(972281),l=r(114861),u=r(691289),c=r(991984),d=r(60738);function f(e){return c.globalGradePerFrame((async(t,r)=>{const n=(await a.mapLimit(u.ALL_LABELS,(async n=>{const o=t.filter((e=>e.label===n)),i=r.filter((e=>e.label===n)),{subdividedSegmentsA:a,subdividedSegmentsB:u}=await s.computeCrossDivision(o,i,e);return s.getSegmentMatches(a,u,e).map((e=>l.scoreSegmentMatch(e,n)))}),1)).flat(),o=i.default.flatMap(u.ALL_LABELS,(e=>u.ALL_ERROR_TYPES.map((t=>{const r=n.filter((t=>t.label===e));return l.transformScoresToGlobalScore(r,t,{label:e,graderType:"beeMapppingGlobal",key:`${e}::${t}`})}))));return i.default.fromPairs(o.map((e=>[e.key,e])))}))}const h=e=>{const t={type:"polyline-fragments",currentId:e.currentId,correctId:e.correctId,props:{label:e.label},rawScoredSegmentMatches:e.scoredSegmentMatches},r=e.currentAnn&&e.correctAnn?"Precision":e.currentAnn?"FalsePositive":"FalseNegative",n=i.default.map(e.scoredSegmentMatches,"score"),o=l.transformScoresToGlobalScore(n,r,{graderType:"beeMapppingGlobal",label:e.label,key:r});return{metadata:t,currentAnnotation:e.currentAnn,correctAnnotation:e.correctAnn,scores:[o],numFalseNegativeFrames:0,numFalsePositiveFrames:0,numIncorrectTruePositiveFrames:0,numTotalTruePositiveFrames:0}},p=(e,t)=>e?`${t}-${e.uuid}`:`${t}-none`;function m(e){return async(t,r)=>{const n=new Map([...t,...r].map((e=>[e.frames[0],e])));n.set(void 0,void 0);const o=t.map((e=>e.frames[0])),c=r.map((e=>e.frames[0])),d=(await a.mapLimit(u.ALL_LABELS,(async t=>{const r=o.filter((e=>e.label===t)),a=c.filter((e=>e.label===t)),{subdividedSegmentsA:u,subdividedSegmentsB:d,segmentToAnnotationMap:f}=await s.computeCrossDivision(r,a,e),h=s.getSegmentMatches(u,d,e).map((e=>({score:l.scoreSegmentMatch(e,t),segmentMatch:e}))),m=new Map([...r.map((e=>[p(e,"a"),e])),["a-none",void 0],...a.map((e=>[p(e,"b"),e])),["b-none",void 0]]),g=i.default.groupBy(h,(({segmentMatch:e})=>{const r=e.currentSegment?f.get(e.currentSegment):void 0,n=e.correctSegment?f.get(e.correctSegment):void 0;return JSON.stringify({currentId:p(r,"a"),correctId:p(n,"b"),label:t})}));return i.default.map(g,((e,t)=>{const{currentId:r,correctId:o,label:i}=JSON.parse(t);return{currentId:r,correctId:o,currentAnn:n.get(m.get(r)),correctAnn:n.get(m.get(o)),label:i,scoredSegmentMatches:e}}))}),1)).flat();return a.mapLimit(d,h,1)}}const g={taskTypes:[o.TaskType.LineAnnotation],title:"(Bee GIS Global) Per-class bag-of-segments Line Grader",graderFn:f(d.defaultBeeMappingParams),matcherFn:m(d.defaultBeeMappingParams),global:!0};t.globalGrader=g},487714:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"beeMappingGlobal",{enumerable:!0,get:function(){return n.globalGrader}}),Object.defineProperty(t,"beeMappingLinkingGrader",{enumerable:!0,get:function(){return o.beeMappingLinkingGrader}}),Object.defineProperty(t,"beeMappingAttributeGrader",{enumerable:!0,get:function(){return i.beeMappingAttributeGrader}}),Object.defineProperty(t,"beeMappingLinterDismissalGrader",{enumerable:!0,get:function(){return a.beeMappingLinterDismissalGrader}});var n=r(438292),o=r(15455),i=r(51514),a=r(171665)},972281:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.computeCrossDivision=t.getSegmentMatches=void 0;var n=r(45834),o=u(r(298784)),i=u(r(289624)),a=r(119426),s=u(r(540742)),l=r(490503);function u(e){return e&&e.__esModule?e:{default:e}}const c=([{x:e,y:t},{x:r,y:n}],o)=>({x:(1-o)*e+o*r,y:(1-o)*t+o*n});function d(e,t){const r=[];for(let n=0;n<e.length-1;n++){const o=[e[n],e[n+1]],i=l.computeSegmentLength(o),a=Math.ceil(i/t);let s=o[0];for(let e=0;e<a;e++){const t=c(o,(e+1)/a);r.push([s,t]),s=t}}return r}const f=(e,t,r)=>{function n(e){const t=o.default.min(e.map((e=>e.x))),r=o.default.min(e.map((e=>e.y))),n=o.default.max(e.map((e=>e.x))),i=o.default.max(e.map((e=>e.y)));return o.default.flatMap(o.default.range(Math.floor(t/32),Math.floor(n/32)+1),(e=>o.default.range(Math.floor(r/32),Math.floor(i/32)+1).map((t=>640*e+t))))}function i(e){return o.default.range(3).flatMap((t=>o.default.range(3).map((r=>e+640*(t-1)+(r-1)))))}const a=e.map(n),u=t.map(n),c=new Map;a.forEach(((e,t)=>{e.forEach((e=>{c.has(e)||c.set(e,new Set),c.get(e).add(t)}))}));const d=o.default.size(e),f=o.default.size(t),h=[];u.forEach(((n,a)=>{const s=new Set;o.default.flatMap(n,i).forEach((e=>{if(c.has(e))for(const t of c.get(e))s.add(t)}));for(const o of s)l.computeFCD(e[o],t[a])<=r.segmentLinkCandidateFcdThreshold+r.segmentLinkTolerance&&h.push([o,d+a])}));const p=((e,t)=>{const r=new s.default(e);for(const[n,o]of t)r.union(n,o);return r.compile()})(d+f,h);return p.map((e=>({indicesA:e.filter((e=>e<d)),indicesB:e.filter((e=>e>=d)).map((e=>e-d))})))};t.getSegmentMatches=(e,t,r)=>{if(o.default.isEmpty(e)&&o.default.isEmpty(t))return[];const n=f(e,t,r),s=[];n.forEach((n=>{const u=n.indicesA.map((t=>e[t])),c=n.indicesB.map((e=>t[e])),d=((e,t)=>e.map((e=>t.map((t=>l.computeFCD(e,t))))))(u,c),f=((e,t,r,n)=>e.map(((e,i)=>t.map(((t,a)=>{const s=l.computeSegmentLength(e),u=l.computeSegmentLength(t),c=e[1].x-e[0].x,d=e[1].y-e[0].y,f=t[1].x-t[0].x,h=t[1].y-t[0].y,p=Math.abs((c*f+d*h)/(s*u));return r[i][a]>n.segmentLinkCandidateFcdThreshold+n.segmentLinkTolerance?0:o.default.min([s,u])*p*Math.exp(-r[i][a]/n.segmentLinkCandidateFcdThreshold)})))).map((e=>e.map((e=>o.default.isFinite(e)?a.INFINITY-e:0)))))(u,c,d,r),h=f.length>0&&f[0].length>0?(e=>e.length?i.default(e):[])(f).filter((([e,t])=>f[e][t]<a.INFINITY)):[];s.push(...h.map((([e,t])=>[n.indicesA[e],n.indicesB[t]])))}));const u=o.default.times(e.length,(()=>!1)),c=o.default.times(t.length,(()=>!1));for(const[o,i]of s)u[o]=c[i]=!0;return[...s.map((([r,n])=>({currentSegment:e[r],correctSegment:t[n],fcd:l.computeFCD(e[r],t[n])}))),...e.filter(((e,t)=>!u[t])).map((e=>({currentSegment:e}))),...t.filter(((e,t)=>!c[t])).map((e=>({correctSegment:e})))]};t.computeCrossDivision=async(e,t,r)=>{const i=[...o.default.flatMap(e,(e=>e.vertices)),...o.default.flatMap(t,(e=>e.vertices))];let a=0;const s=()=>a++%20===0?new Promise(setImmediate):null,u=await n.mapLimit(e,(async e=>(await s(),d(l.projectVerticesOntoPolyline(e.vertices,i,r.crossSubdivisionThreshold,r.splitTolerance),r.maximumSplitSegmentLength))),1),c=await n.mapLimit(t,(async e=>(await s(),d(l.projectVerticesOntoPolyline(e.vertices,i,r.crossSubdivisionThreshold,r.splitTolerance),r.maximumSplitSegmentLength))),1);return{segmentToAnnotationMap:new Map([...o.default.flatMap(u,((t,r)=>t.map((t=>[t,e[r]])))),...o.default.flatMap(c,((e,r)=>e.map((e=>[e,t[r]]))))]),subdividedSegmentsA:o.default.flatten(u),subdividedSegmentsB:o.default.flatten(c)}}},114861:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.transformScoresToGlobalScore=t.scoreSegmentMatch=void 0;var n,o=r(691289),i=r(490503),a=(n=r(298784))&&n.__esModule?n:{default:n};t.scoreSegmentMatch=(e,t)=>{if(!o.isLabel(t))throw new Error("unknown label: "+t);const{currentSegment:r,correctSegment:n,fcd:a}=e;return{label:t,currentLength:r?i.computeSegmentLength(r):0,correctLength:n?i.computeSegmentLength(n):0,isMatch:!!r&&!!n,isCorrect:!!r&&!!n&&a<=5}};t.transformScoresToGlobalScore=(e,t,r)=>{const n=a.default.sumBy(e,"currentLength"),o=a.default.sumBy(e,"correctLength"),i=a.default.sumBy(a.default.filter(e,"isMatch"),"currentLength"),s=a.default.sumBy(a.default.filter(e,"isMatch"),"correctLength"),l=a.default.sumBy(a.default.filter(e,"isCorrect"),"currentLength");let u,c;if("FalseNegative"===t)u=s,c=o;else if("FalsePositive"===t)u=i,c=n;else{if("Precision"!==t)throw new Error(`Unknown error type ${t}`);u=l,c=i}return{...r,errorType:t,numIncorrectFrames:0,numTotalFrames:0,correctWork:u,totalWork:c}}},691289:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isScoredPolylineSegmentsMatchedAnnotations=function(e){return"polyline-fragments"===e?.metadata?.type},t.toLinkingAttributeKeyBase=t.ALL_ERROR_TYPES=t.ALL_SEVERITIES=t.isLabel=t.BANNED_ATTRIBUTE_TYPES=t.ALL_LINKING_ATTRIBUTE_KEY_BASES=t.ALL_LABELS=void 0;var n,o=(n=r(298784))&&n.__esModule?n:{default:n};const i=["Vehicle Lane Center","Bicycle Lane Center","Parking Lane Center","Pedestrian Lane Center","Other Lane Center","Transition","Double-Dashed-Solid","Double-Solid-Dashed","Single-Dotted","Single-Dashed","Single-Solid","Double-Dotted","Double-Dashed","Double-Solid","Double-Dashed-Solid","Double-Solid-Dashed","Virtual Lane Line","Other Lane Line","Stop Line","Yield Line","Speed Line","School Zone Line","Other Sign Line","Vehicle Lane Center","Bicycle Lane Center","Parking Lane Center","Pedestrian Lane Center","Other Lane Center","Curb","Barrier","Other Driveable Region Edge","Transition","Connection"];t.ALL_LABELS=i;const a=["Road Sign to Line","Road Sign to Point","Road Sign to Polygon","Road Surface Marker to Line","Road Surface Marker to Point","Road Surface Marker to Polygon","VLC Neighbor","Permeability None VLC to VLC","Permeability Free VLC to VLC","Sign Line to VLC","Merge Or Split Point to Line","Bike Lane Painted to VLC","Bus Or Taxi Lane Painted to VLC","Buffer Zone to Line Neighbor","Yield Shark's Teeth to VLC","Cul-de-sac to VLC","Crosswalk to VLC","Speed Bump to VLC","Speed Dip to VLC","Traffic Light to VLC","Pedestrian Crossing Light to VLC","Pedestrian Crossing Light to Crosswalk","Bicycle Crossing Light to VLC","Highway Metering Light to VLC","Railroad Crossing Light to VLC","Lane Control Signal to VLC","Uncommon Traffic Light to VLC","Railroad Crossing to VLC","Roadway Gate to Railroad Crossing","Other Relationship","Road Sign Links","Road Surface Marker Links","VLC Links","Neighbor Links","Merge Or Split Point Links","Misc Links","VLC to VLC attributes-Permeability-Not Permeable","VLC to VLC attributes-Permeability-Permeable"];t.ALL_LINKING_ATTRIBUTE_KEY_BASES=a;t.BANNED_ATTRIBUTE_TYPES=["change_id","relationship_change_id","Reference Map UIDs"];t.isLabel=e=>i.includes(e);t.ALL_SEVERITIES=["Critical","Severe","Moderate"];t.ALL_ERROR_TYPES=["FalseNegative","FalsePositive","Precision"];t.toLinkingAttributeKeyBase=(e,t)=>{const r=o.default.sortBy((t??[]).concat(a),(e=>-e.length));return o.default.find(r,(t=>e.includes(t)))}},362714:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.gradeRotation=t.gradeDistance=t.boxDimensionsGrader=t.gradeWidth=t.gradeHeight=t.iouGrader=t.edgeGrader=t.DEFAULT_BOX_ROTATION_THRESHOLD_DEGS=t.DEFAULT_BOX_POSITION_THRESHOLD_PX=t.DEFAULT_BOX_DIMENSION_THRESHOLD_PX=t.DEFAULT_MAX_THRESHOLD_PX=t.DEFAULT_MIN_THRESHOLD_PX=t.DEFAULT_IOU_THRESHOLD=t.DEFAULT_EDGE_THRESHOLD=t.BOX_DISTANCE_LABEL_BIAS=t.BOX_DISTANCE_IOU_THRESHOLD=void 0;var n,o=(n=r(298784))&&n.__esModule?n:{default:n},i=r(167469),a=r(440169),s=r(991984);t.BOX_DISTANCE_IOU_THRESHOLD=.2;t.BOX_DISTANCE_LABEL_BIAS=.075;const l=.05;t.DEFAULT_EDGE_THRESHOLD=l;const u=.75;t.DEFAULT_IOU_THRESHOLD=u;t.DEFAULT_MIN_THRESHOLD_PX=5;t.DEFAULT_MAX_THRESHOLD_PX=15;t.DEFAULT_BOX_DIMENSION_THRESHOLD_PX=5;t.DEFAULT_BOX_POSITION_THRESHOLD_PX=5;t.DEFAULT_BOX_ROTATION_THRESHOLD_DEGS=15;const c=(e,t)=>e?.sensor_id===t?.sensor_id,d={correctWork:0,totalWork:0},f=(e,t,r,{threshold:n=.05,leftThreshold:i=n,rightThreshold:a=n,topThreshold:l=n,bottomThreshold:u=n,minThresholdPx:f=5,maxThresholdPx:h=15,useBoundedThresholds:p=!1})=>c(e,t)?{left:s.gradeIfNotMissing(((e,t)=>{let r=i*t.width;p&&(r=o.default.clamp(r,f,h));const n=Math.abs(e.left-t.left)/t.width,a={leftDiff:n};return{correctWork:+(n*t.width<r),totalWork:1,intermediates:a}}),e,t),right:s.gradeIfNotMissing(((e,t)=>{let r=a*t.width;p&&(r=o.default.clamp(r,f,h));const n=Math.abs(e.left+e.width-(t.left+t.width))/t.width,i={rightDiff:n};return{correctWork:+(n*t.width<r),totalWork:1,intermediates:i}}),e,t),top:s.gradeIfNotMissing(((e,t)=>{let r=l*t.height;p&&(r=o.default.clamp(r,f,h));const n=Math.abs(e.top-t.top)/t.height,i={topDiff:n};return{correctWork:+(n*t.height<r),totalWork:1,intermediates:i}}),e,t),bottom:s.gradeIfNotMissing(((e,t)=>{let r=u*t.height;p&&(r=o.default.clamp(r,f,h));const n=Math.abs(e.top+e.height-(t.top+t.height))/t.height,i={bottomDiff:n};return{correctWork:+(n*t.height<r),totalWork:1,intermediates:i}}),e,t)}:{left:d,right:d,top:d,bottom:d};t.edgeGrader=f;const h=(e,t,r,{threshold:n=.75})=>c(e,t)?{iou:s.gradeIfNotMissing(((e,t)=>{const r=a.boxIou(e,t);return{correctWork:+(r>n),totalWork:1,intermediates:{iou:r}}}),e,t)}:{iou:d};t.iouGrader=h;const p=(e,t,r)=>{const n=void 0!==e.rotation||void 0!==t.rotation,o=n&&e.width<e.height?e.width:e.height,i=n&&t.width<t.height?t.width:t.height,a=Math.abs(o-i);return{correctWork:+(a<r),totalWork:1,intermediates:{diff:a}}};t.gradeHeight=p;const m=(e,t,r)=>{const n=void 0!==e.rotation||void 0!==t.rotation,o=n&&e.width<e.height?e.height:e.width,i=n&&t.width<t.height?t.height:t.width,a=Math.abs(o-i);return{correctWork:+(a<r),totalWork:1,intermediates:{diff:a}}};t.gradeWidth=m;const g=(e,t,r,{threshold:n=5,heightThreshold:o=n,widthThreshold:i=n})=>c(e,t)?{height:s.gradeIfNotMissing(((e,t)=>p(e,t,o)),e,t),width:s.gradeIfNotMissing(((e,t)=>m(e,t,i)),e,t)}:{height:d,width:d};t.boxDimensionsGrader=g;const y=e=>({x:e.left+e.width/2,y:e.top+e.height/2}),b=(e,t,r)=>{const n=y(e),o=y(t),i=a.findDistance(a.vertexToArr(n),a.vertexToArr(o));return{correctWork:+(i<=r),totalWork:1,intermediates:{distance:i}}};t.gradeDistance=b;const T=(e,t,r)=>{let n=e.rotation??0,o=t.rotation??0;e.width<e.height&&(n=a.addRadians(n,Math.PI/2)),t.width<t.height&&(o=a.addRadians(o,Math.PI/2)),n<0&&(n+=Math.PI),o<0&&(o+=Math.PI);return{correctWork:+(a.radianDifference(n,o)<=r*(Math.PI/180)),totalWork:1}};t.gradeRotation=T;var v={edges:{taskTypes:[i.TaskType.VideoBoxAnnotation,i.TaskType.Annotation],title:"Edge positions",graderFn:s.gradePerFrame(f),paramConfigs:[{name:"threshold",label:"Default Edge Threshold",type:"number",defaultValue:l},{name:"leftThreshold",label:"Left Threshold",type:"number",defaultValue:l},{name:"rightThreshold",label:"Right Threshold",type:"number",defaultValue:l},{name:"bottomThreshold",label:"Bottom Threshold",type:"number",defaultValue:l},{name:"topThreshold",label:"Top Threshold",type:"number",defaultValue:l},{name:"maxThresholdPx",label:"Maximum Edge Threshold",type:"number",defaultValue:15},{name:"minThresholdPx",label:"Minimum Edge Threshold",type:"number",defaultValue:5},{name:"useBoundedThresholds",label:"Whether to bound thresholds",type:"boolean",defaultValue:!1}]},iou:{taskTypes:[i.TaskType.VideoBoxAnnotation,i.TaskType.Annotation,i.TaskType.VideoPlaybackAnnotation],title:"Box size and position",graderFn:s.gradePerFrame(h),paramConfigs:[{name:"threshold",label:"IOU Threshold",type:"number",defaultValue:u}]},adjustmentDistance:{taskTypes:[i.TaskType.VideoBoxAnnotation,i.TaskType.VideoPlaybackAnnotation],title:"Adjustment Distance Grader",graderFn:s.gradePerFrame(((e,t,r,{threshold:n=10})=>c(e,t)?{adjustmentDistance:s.gradeIfNotMissing(((e,t)=>{const r=Math.pow(e.top-t.top,2),o=Math.pow(e.top+e.height-(t.top+t.height),2),i=Math.pow(e.left+e.width-(t.left+t.width),2),a=Math.pow(e.left-t.left,2),s=Math.sqrt(r+o+i+a);return{correctWork:+(s<n),totalWork:1,intermediates:{topDiff:r,bottomDiff:o,rightDiff:i,leftDiff:a,result:s,threshold:n}}}),e,t)}:{adjustmentDistance:d})),paramConfigs:[{name:"threshold",label:"Error Threshold",type:"number",defaultValue:10}]},boxDimensions:{taskTypes:[i.TaskType.VideoBoxAnnotation,i.TaskType.Annotation,i.TaskType.VideoPlaybackAnnotation],title:"Box Dimensions grader",graderFn:s.gradePerFrame(g),paramConfigs:[{name:"threshold",label:"Default Dimension Threshold",type:"number",defaultValue:5},{name:"heightThreshold",label:"Height Threshold",type:"number",defaultValue:5},{name:"widthThreshold",label:"Width Threshold",type:"number",defaultValue:5}]},boxRotation:{taskTypes:[i.TaskType.VideoBoxAnnotation,i.TaskType.Annotation,i.TaskType.VideoPlaybackAnnotation],title:"Box Rotation grader",graderFn:s.gradePerFrame(((e,t,r,{threshold:n=15})=>c(e,t)?{rotation:s.gradeIfNotMissing(((e,t)=>T(e,t,n)),e,t)}:{rotation:d})),paramConfigs:[{name:"rotationThreshold",label:"Rotation Threshold (degrees)",type:"number",defaultValue:15}]},boxPosition:{taskTypes:[i.TaskType.VideoBoxAnnotation,i.TaskType.Annotation,i.TaskType.VideoPlaybackAnnotation],title:"Box Position grader",graderFn:s.gradePerFrame(((e,t,r,{threshold:n=5})=>c(e,t)?{position:s.gradeIfNotMissing(((e,t)=>b(e,t,n)),e,t)}:{position:d})),paramConfigs:[{name:"threshold",label:"Default Position Threshold",type:"number",defaultValue:5}]}};t.default=v},152672:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.unifyAnswers=t.checkSingleQuestion=t.responseIOUScore=void 0;var n,o=(n=r(298784))&&n.__esModule?n:{default:n},i=r(167469),a=r(991984);const s=(e,t)=>0===e.length?+(0===t.length):o.default.intersection(e,t).length/o.default.union(e,t).length;t.responseIOUScore=s;const l=(e,t)=>s(e,t);t.checkSingleQuestion=l;const u=e=>o.default.isArray(e)?e:[e];t.unifyAnswers=u;var c=Object.freeze({correctChoices:{taskTypes:[i.TaskType.Categorization],title:"categorization choices",graderFn:a.gradePerFrame(((e,t,r)=>{const n=(e,t)=>{const r=u(e.choices),n=u(t.choices);return{choices:{correctWork:l(r,n),totalWork:1,intermediates:{originalAnswers:r,correctAnswers:n}}}};if(o.default.isEmpty(t)){return{choices:{correctWork:0,totalWork:0}}}if(o.default.isEmpty(e)){return{choices:{correctWork:+(o.default.findIndex(t.acceptedAnnotations,(({annotation:e})=>!e))>=0),totalWork:1}}}return a.gradeForAcceptedAnnotations(e,t,n,r&&r.acceptedAnnotationMatchIndexes)}))}});t.default=c},674291:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.covariantAttributeGrader=t.defaultAttributeGraderFn=t.attributeGrader=void 0;var n,o=(n=r(298784))&&n.__esModule?n:{default:n},i=r(599789),a=r(991984),s=r(800259);const l=(e,t,r,n,l,c)=>{l||(l={});const d=t?.frames?.[e],f=r?.frames?.[e],h=o.default.keys(f?.attributes||d?.attributes),p=o.default.filter(h,(e=>c?.attributeTypes?.[e]!==i.AnnotationAttributeType.Linked&&!s.toLinkingAttributeKeyBase(e))),m={};return o.default.forEach(p,(e=>{const t=u(e,l);m[`attribute_${e}`]=a.gradeIfNotMissing(t,d,f)})),m};t.attributeGrader=l;const u=(e,t)=>(r,n)=>c(e,r,n,t),c=(e,t,r)=>{let n=t?.attributes?.[e],i=r?.attributes?.[e];return Array.isArray(n)&&Array.isArray(i)&&(n=o.default.sortBy(n),i=o.default.sortBy(i)),{correctWork:+o.default.isEqual(n,i),totalWork:1}};t.defaultAttributeGraderFn=c;const d={taskTypes:i.twoDTypes,title:"Covariant Attribute Grader",graderFn:a.gradePerFrameWithContext(l,!1)};t.covariantAttributeGrader=d},34038:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.covariantLinkingGrader=t.calculateCorrectAndTotalWork=t.getLinkedAttributeToAnnotations=t.fromAnnotationLabelChangedLinkingGraderGenerator=t.toAnnotationMissingOrLabelChangedLinkingGraderGenerator=t.toAndFromAnnotationExistLinkingGraderGenerator=t.linkingGrader=void 0;var n,o=(n=r(298784))&&n.__esModule?n:{default:n},i=r(599789),a=r(991984),s=r(800259);const l=(e,t,r,n,l,f)=>{const h=t?.frames?.[e],p=r?.frames?.[e],m=o.default.union(o.default.keys(p?.attributes),o.default.keys(h?.attributes)),g=f?.matchedAnnotationsListContext,y=o.default.filter(m,(e=>{const t=f?.attributeTypes;return!!s.toLinkingAttributeKeyBase(e)||t?.[e]===i.AnnotationAttributeType.Linked})),b=o.default.compact(o.default.map(y,(e=>s.toLinkingAttributeKeyBase(e)))),T=[...new Set(b)],v={};return T.forEach((e=>{const t=u(e,g),r=c(e,g),n=d(e,g);v[`linking_${e}`]=a.gradeIfNotMissing(t,h,p),v[`linking_${e}_UNMATCHED_TO_ANN`]=a.gradeIfNotMissing(r,h,p),v[`linking_${e}_FROM_LABELS_DIFFERENT`]=a.gradeIfNotMissing(n,h,p)})),v};t.linkingGrader=l;const u=(e,t)=>(r,n)=>{const o=r?.label,i=n?.label;if(o!==i)return{correctWork:0,totalWork:0};const{originalToAnnotations:a,correctToAnnotations:s}=f(e,r,n,t),l=a.filter((e=>e?.correctAnnotation&&e?.correctAnnotation?.props.label===e?.currentAnnotation?.props.label)),u=s.filter((e=>e?.correctAnnotation&&e?.correctAnnotation?.props.label===e?.currentAnnotation?.props.label)),{correctWork:c,totalWork:d,intermediates:p}=h(l,u);return{correctWork:c,totalWork:d,intermediates:p}};t.toAndFromAnnotationExistLinkingGraderGenerator=u;const c=(e,t)=>(r,n)=>{const o=r?.label,i=n?.label;if(o!==i)return{correctWork:0,totalWork:0};const{originalToAnnotations:a,correctToAnnotations:s}=f(e,r,n,t),l=a.filter((e=>!e?.correctAnnotation||e.correctAnnotation?.props.label!==e.currentAnnotation?.props.label)),u=s.filter((e=>!e?.correctAnnotation||e.correctAnnotation?.props.label!==e.currentAnnotation?.props.label)),{correctWork:c,totalWork:d}=h(l,u);return{correctWork:c,totalWork:d}};t.toAnnotationMissingOrLabelChangedLinkingGraderGenerator=c;const d=(e,t)=>(r,n)=>{const o=r?.label,i=n?.label;if(o===i)return{correctWork:0,totalWork:0};const{originalToAnnotations:a,correctToAnnotations:s}=f(e,r,n,t),{totalWork:l}=h(a,s);return{correctWork:0,totalWork:l}};t.fromAnnotationLabelChangedLinkingGraderGenerator=d;const f=(e,t,r,n)=>{const i=t?.attributes,a=r?.attributes,s=Object.values(o.default.pickBy(i,((t,r)=>r.includes(e)))),l=Object.values(o.default.pickBy(a,((t,r)=>r.includes(e))));return{originalToAnnotations:s.map((e=>n?.find((t=>t.currentAnnotation?.props?.id===e)))),correctToAnnotations:l.map((e=>n?.find((t=>t.correctAnnotation?.props?.id===e))))}};t.getLinkedAttributeToAnnotations=f;const h=(e,t)=>{const r=e.map((e=>e?.correctAnnotation?.props?.id)),n=t.map((e=>e?.correctAnnotation?.props?.id));return{correctWork:o.default.intersectionBy(r,n).length,totalWork:Math.max(e.length,t.length),intermediates:{extraneous:o.default.difference(r,n),missing:o.default.difference(n,r)}}};t.calculateCorrectAndTotalWork=h;const p={taskTypes:i.twoDTypes,title:"Covariant Linking Grader",graderFn:a.gradePerFrameWithContext(l,!1,!1,!1)};t.covariantLinkingGrader=p},388746:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"covariantLinkingGrader",{enumerable:!0,get:function(){return n.covariantLinkingGrader}}),Object.defineProperty(t,"covariantAttributeGrader",{enumerable:!0,get:function(){return o.covariantAttributeGrader}});var n=r(34038),o=r(674291)},800259:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.toLinkingAttributeKeyBase=t.ALL_LINKING_ATTRIBUTE_KEY_BASES=void 0;var n,o=(n=r(298784))&&n.__esModule?n:{default:n};const i=["Object Occlusion Links","Is Hole For"];t.ALL_LINKING_ATTRIBUTE_KEY_BASES=i;t.toLinkingAttributeKeyBase=e=>{const t=o.default.sortBy(i,(e=>-e.length));return o.default.find(t,(t=>e.includes(t)))}},278127:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.FRACTION_STEP=t.DEFAULT_IOU_THRESHOLD=t.DEFAULT_PARALLAX_POINT_THRESHOLD=t.DEFAULT_SIDE_EDGE_THRESHOLD=t.DEFAULT_MAX_FRONT_EDGE_THRESHOLD_PX=t.DEFAULT_MIN_FRONT_EDGE_THRESHOLD_PX=t.DEFAULT_FRONT_EDGE_THRESHOLD=t.CUBOID_DISTANCE_IOU_THRESHOLD=void 0;var n,o=r(167469),i=(n=r(298784))&&n.__esModule?n:{default:n},a=r(991984),s=r(440169);t.CUBOID_DISTANCE_IOU_THRESHOLD=.2;const l=.05;t.DEFAULT_FRONT_EDGE_THRESHOLD=l;t.DEFAULT_MIN_FRONT_EDGE_THRESHOLD_PX=5;t.DEFAULT_MAX_FRONT_EDGE_THRESHOLD_PX=15;const u=.05;t.DEFAULT_SIDE_EDGE_THRESHOLD=u;t.DEFAULT_PARALLAX_POINT_THRESHOLD=.1;t.DEFAULT_IOU_THRESHOLD=.9;const c=.01;t.FRACTION_STEP=c;var d={cuboidFrontEdges:{taskTypes:[o.TaskType.CuboidAnnotation,o.TaskType.VideoCuboidAnnotation],title:"2D Cuboid Front Face Edge Positions",graderFn:a.gradePerFrame(((e,t,r,{threshold:n=.05,leftThreshold:o=n,rightThreshold:l=n,topThreshold:u=n,bottomThreshold:c=n,minThresholdPx:d=5,maxThresholdPx:f=15,useBoundedThresholds:h=!1})=>({edgeFaceTop:a.gradeIfNotMissing(((e,t)=>{const r=s.formatCuboidAnnotation(e),n=s.formatCuboidAnnotation(t),o=Math.abs(r.edges.faceTop.y1-n.edges.faceTop.y1)/n.height,a={faceTopDiff:o};let l=u*n.height;return h&&(l=i.default.clamp(l,d,f)),{correctWork:+(o*n.height<l),totalWork:1,intermediates:a}}),e,t),edgeFaceRight:a.gradeIfNotMissing(((e,t)=>{const r=s.formatCuboidAnnotation(e),n=s.formatCuboidAnnotation(t),o=Math.abs(r.edges.faceRight.x2-n.edges.faceRight.x2)/n.width,a={faceRightDiff:o};let u=l*n.width;return h&&(u=i.default.clamp(u,d,f)),{correctWork:+(o*n.width<u),totalWork:1,intermediates:a}}),e,t),edgeFaceBottom:a.gradeIfNotMissing(((e,t)=>{const r=s.formatCuboidAnnotation(e),n=s.formatCuboidAnnotation(t),o=Math.abs(r.edges.faceBottom.y2-n.edges.faceBottom.y2)/n.height,a={faceTopDiff:o};let l=c*n.height;return h&&(l=i.default.clamp(l,d,f)),{correctWork:+(o*n.height<l),totalWork:1,intermediates:a}}),e,t),edgeFaceLeft:a.gradeIfNotMissing(((e,t)=>{const r=s.formatCuboidAnnotation(e),n=s.formatCuboidAnnotation(t),a=Math.abs(r.edges.faceLeft.x1-n.edges.faceLeft.x1)/n.width,l={faceLeftDiff:a};let u=o*n.width;return h&&(u=i.default.clamp(u,d,f)),{correctWork:+(a*n.width<u),totalWork:1,intermediates:l}}),e,t)}))),paramConfigs:[{name:"threshold",label:"Front Edge Threshold (Fraction of Correct Width or Height)",type:"number",defaultValue:l,min:0,step:c},{name:"leftThreshold",label:"Left Threshold",type:"number",defaultValue:l,min:0,step:c},{name:"rightThreshold",label:"Right Threshold",type:"number",defaultValue:l,min:0,step:c},{name:"bottomThreshold",label:"Bottom Threshold",type:"number",defaultValue:l,min:0,step:c},{name:"topThreshold",label:"Top Threshold",type:"number",defaultValue:l,min:0,step:c},{name:"maxThresholdPx",label:"Maximum Edge Threshold",type:"number",defaultValue:15,min:0},{name:"minThresholdPx",label:"Minimum Edge Threshold",type:"number",defaultValue:5,min:0},{name:"useBoundedThresholds",label:"Whether to bound thresholds",type:"boolean",defaultValue:!1}]},cuboidSideEdges:{taskTypes:[o.TaskType.CuboidAnnotation,o.TaskType.VideoCuboidAnnotation],title:"2D Cuboid Side Face Edge Positions",graderFn:a.gradePerFrame(((e,t,r,{threshold:n=.05})=>({edgeSideTop:a.gradeIfNotMissing(((e,t)=>{const r=s.formatCuboidAnnotation(e),o=s.formatCuboidAnnotation(t),a=s.getExtendedCuboidDirection(o)||s.getExtendedCuboidDirection(r)||"faceLeft",l=r.edges.sideBack||i.default.get(r.edges,a),u=o.edges.sideBack||i.default.get(r.edges,a),c=Math.abs(l.y1-u.y1)/o.sideHeight;return{correctWork:+(c<n),totalWork:1,intermediates:{sideTopDiff:c}}}),e,t),edgeSideBack:a.gradeIfNotMissing(((e,t)=>{const r=s.formatCuboidAnnotation(e),o=s.formatCuboidAnnotation(t),a=s.getExtendedCuboidDirection(o)||s.getExtendedCuboidDirection(r)||"faceLeft",l=r.edges.sideBack||i.default.get(r.edges,a),u=o.edges.sideBack||i.default.get(r.edges,a),c=s.midpoint(o.vertices.faceTopleft,o.vertices.faceBottomright),d=Math.abs(c.x-u.x1),f=Math.abs(l.x1-u.x1)/d;return{correctWork:+(f<n),totalWork:1,intermediates:{sideBackDiff:f}}}),e,t),edgeSideBottom:a.gradeIfNotMissing(((e,t)=>{const r=s.formatCuboidAnnotation(e),o=s.formatCuboidAnnotation(t),a=s.getExtendedCuboidDirection(o)||s.getExtendedCuboidDirection(r)||"faceLeft",l=r.edges.sideBack||i.default.get(r.edges,a),u=o.edges.sideBack||i.default.get(r.edges,a),c=Math.abs(l.y2-u.y2)/o.sideHeight;return{correctWork:+(c<n),totalWork:1,intermediates:{sideBottomDiff:c}}}),e,t)}))),paramConfigs:[{name:"threshold",label:"Side Edge Threshold (Fraction of Correct Side Height or Distance from Front Face Center to Side)",type:"number",defaultValue:u,min:0,step:c}]},parallaxPoint:{taskTypes:[o.TaskType.CuboidAnnotation,o.TaskType.VideoCuboidAnnotation],title:"2D Cuboid Projected Point",graderFn:a.gradePerFrame(((e,t,r,{threshold:n=.1})=>({parallaxPoint:a.gradeIfNotMissing(((e,t)=>{const r=s.formatCuboidAnnotation(e),o=s.formatCuboidAnnotation(t),i=s.projectedPointFromCuboid(r),a=s.projectedPointFromCuboid(o),l=Math.abs(i.y-a.y)/o.sideHeight;return{correctWork:+(l<n),totalWork:1,intermediates:{parallaxPointDiff:l}}}),e,t)}))),paramConfigs:[{name:"threshold",label:"Parallax Point Threshold (Fraction of Correct Side Height)",type:"number",defaultValue:.1,min:0,step:c}]},cuboidIou:{taskTypes:[o.TaskType.CuboidAnnotation,o.TaskType.VideoCuboidAnnotation],title:"2D Cuboid Iou",graderFn:a.gradePerFrame(((e,t,r,{threshold:n=.9})=>({frontFaceIou:a.gradeIfNotMissing(((e,t)=>{const r=s.formatCuboidAnnotation(e),o=s.formatCuboidAnnotation(t),i=s.getCuboidFrontFaceAsBox(r),a=s.getCuboidFrontFaceAsBox(o),l=s.boxIou(i,a);return{correctWork:+(l>=n),totalWork:1,intermediates:{iou:l}}}),e,t),sideFaceIou:a.gradeIfNotMissing(((e,t)=>{const r=s.formatCuboidAnnotation(e),o=s.formatCuboidAnnotation(t),i=((e,t)=>e.isExtended||t.isExtended?e.isExtended&&t.isExtended?null:{correctWork:0,totalWork:1}:{correctWork:1,totalWork:1})(r,o);if(i)return i;try{const e=s.getCuboidSideFaceVertices(r),t=s.getCuboidSideFaceVertices(o),i=s.genericIou(e,t);return{correctWork:+(i>=n),totalWork:1,intermediates:{iou:i}}}catch(a){return{correctWork:0,totalWork:1}}}),e,t),cuboidIou:a.gradeIfNotMissing(((e,t)=>{const r=s.formatCuboidAnnotation(e),o=s.formatCuboidAnnotation(t);try{const e=s.getCuboidVertices(r),t=s.getCuboidVertices(o),i=s.genericIou(e,t);return{correctWork:+(i>=n),totalWork:1,intermediates:{iou:i}}}catch(i){return{correctWork:0,totalWork:1}}}),e,t)}))),paramConfigs:[{name:"threshold",label:"IoU Threshold",type:"number",defaultValue:.9,min:0,step:c}]}};t.default=d},567208:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.linkingIoUScore=t.DocumentTranscriptionErrorType=void 0;var n,o,i=r(991984),a=(n=r(298784))&&n.__esModule?n:{default:n},s=r(167469),l=r(116615),u=r(798451),c=r(247740);t.DocumentTranscriptionErrorType=o,function(e){e.Missing="missing",e.Extraneous="extraneous",e.Label="label",e.Text="text",e.Linking="linking",e.Placement="placement",e.Date="date",e.Money="money",e.Checkbox="checkbox",e.Select="select",e.PageRange="pageRange"}(o||(t.DocumentTranscriptionErrorType=o={}));function d(e,t){return t.includes("trim")&&(e=e.trim()),t.includes("lowercase")&&(e=e.toLowerCase()),e}const f=(e,t)=>a.default.intersection(t,e).length/a.default.union(t,e).length;t.linkingIoUScore=f;const h=(e,t)=>0===t.length?+(0===e.length):a.default.intersection(e,t).length/a.default.union(e,t).length;function p(e,t){return(r,n,o,i)=>({[t]:e(r,n,o,i)})}function m(e,t){return(r,n,o,i,s,l)=>{const u=a.default.get(n?.frames,r),c=a.default.get(o?.frames,r);return{[t]:e(u,c,i,s,l)}}}var g=Object.freeze({documentTranscriptionText:{taskTypes:[s.TaskType.DocumentTranscription],title:"document transcription text",graderFn:i.gradePerFrameWithContext(m(((e,t,r,n,o)=>{const a=o,s=a?.textProcessing??[];return i.gradeIfNotMissing(((e,t)=>i.gradeFreeText(d(e,s),d(t,s),a?.textComparisonMethod??i.TextComparisonMethod.Levenshtein)),e?.text,t?.text)}),o.Text))},documentTranscriptionLinking:{taskTypes:[s.TaskType.DocumentTranscription],title:"document transcription linking",graderFn:i.gradePerFrame(((e,t)=>({[o.Linking]:i.gradeIfNotMissing(((e,t)=>({correctWork:f(e,t),totalWork:1,intermediates:{actual:e,expected:t}})),e?.refs,t?.refs)})))},documentTranscriptionPlacement:{taskTypes:[s.TaskType.DocumentTranscription],title:"document transcription placement",graderFn:i.gradePerFrameWithContext(m(((e,t,r,n,o)=>{const a=o,s=n?.underThreshold??a?.underThreshold??2,d=n?.overThreshold??a?.overThreshold??5;return i.gradeIfNotMissing(((e,t)=>{let r=!1;return e.type===l.GeometryType.BoundingBox&&t.type===l.GeometryType.BoundingBox?r=u.isBoundingBoxInMargin(e,t,s,d):e.type===l.GeometryType.Polygon&&t.type===l.GeometryType.Polygon&&(r=c.isPolygonInMargin(e,t,s,d)),{correctWork:+r,totalWork:1,intermediates:{actual:e,expected:t}}}),e?.location,t?.location)}),o.Placement)),paramConfigs:[{name:"underThreshold",label:"Clipping Margin Threshold",type:"number",defaultValue:2},{name:"overThreshold",label:"Oversizing Margin Threshold",type:"number",defaultValue:5}]},documentTranscriptionDate:{taskTypes:[s.TaskType.DocumentTranscription],title:"document transcription date",graderFn:i.gradePerFrame(p(((e,t)=>i.gradeIfNotMissing(((e,t)=>({correctWork:e.year===t.year&&e.month===t.month&&e.day===t.day?1:0,totalWork:1,intermediates:{actual:e,expected:t}})),e?.date,t?.date)),o.Date))},documentTranscriptionMoney:{taskTypes:[s.TaskType.DocumentTranscription],title:"document transcription money",graderFn:i.gradePerFrame(p(((e,t)=>i.gradeIfNotMissing(((e,t)=>({correctWork:e.amount===t.amount?1:0,totalWork:1,intermediates:{actual:e,expected:t}})),e?.money,t?.money)),o.Money))},documentTranscriptionCheckbox:{taskTypes:[s.TaskType.DocumentTranscription],title:"document transcription checkbox",graderFn:i.gradePerFrame(p(((e,t)=>((e,t)=>{if(a.default.isNil(e)&&a.default.isNil(t))return{correctWork:0,totalWork:0};return{correctWork:!e===!t?1:0,totalWork:1,intermediates:{actual:e,expected:t}}})(e?.checked,t?.checked)),o.Checkbox))},documentTranscriptionSelect:{taskTypes:[s.TaskType.DocumentTranscription],title:"document transcription select",graderFn:i.gradePerFrame(p(((e,t)=>i.gradeIfNotMissing(((e,t)=>({correctWork:h(e,t),totalWork:1,intermediates:{actual:e,expected:t}})),e?.selected,t?.selected)),o.Select))},documentTranscriptionPageRange:{taskTypes:[s.TaskType.DocumentTranscription],title:"document transcription page range iou",graderFn:i.gradePerFrame(p(((e,t)=>i.gradeIfNotMissing((([r,n],[o,i])=>{const s=(a.default.min([n,i])-a.default.max([r,o])+1)/(a.default.max([n,i])-a.default.min([r,o])+1);return{correctWork:s>0?s:0,totalWork:1,intermediates:{actual:e,expected:t}}}),e?.pageRange,t?.pageRange)),o.PageRange))}});t.default=g},587005:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.ELLIPSE_GRADER_IOU_DIFF_THRESHOLD=t.ELLIPSE_DISTANCE_IOU_THRESHOLD=void 0;var n=r(167469),o=r(991984),i=r(440169);t.ELLIPSE_DISTANCE_IOU_THRESHOLD=.6;t.ELLIPSE_GRADER_IOU_DIFF_THRESHOLD=.9;var a={ellipseIou:{taskTypes:[n.TaskType.EllipseAnnotation],title:"Ellipse Intersection-Over-Union",graderFn:o.gradePerFrame(((e,t,r,{threshold:n=.9})=>({ellipseIou:o.gradeIfNotMissing(((e,t)=>{try{const r=i.genericIou(e,t);return{correctWork:+(r>=n),totalWork:1,intermediates:{iou:r}}}catch(r){return{correctWork:0,totalWork:1}}}),e,t)}))),paramConfigs:[{name:"threshold",label:"IoU Threshold",type:"number"}]}};t.default=a},464746:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.evaluationProjectGrader=void 0;var n=r(167469);const o="evaluationProject",i=(e,t,r,n,i,a,s)=>{const l=s?.evaluationScores,u=l?.correctWork||0,c=l?.totalWork||0;return{[o]:{correctWork:u,totalWork:c,graderType:o,label:o,numTotalFrames:1,numIncorrectFrames:Math.max(0,Math.trunc(c)-Math.trunc(u)),errorType:o}}};t.evaluationProjectGrader=i;var a=Object.freeze({[o]:{taskTypes:[n.TaskType.TextCollection,n.TaskType.NamedEntityRecognition],title:"Evaluation project",graderFn:i,global:!0}});t.default=a},995906:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.DEFAULT_POINT_DISTANCE_THRESHOLD=t.DEFAULT_BOX_POSITION_THRESHOLD_PX=t.DEFAULT_BOX_DIMENSION_THRESHOLD_PX=t.DEFAULT_MAX_THRESHOLD_PX=t.DEFAULT_MIN_THRESHOLD_PX=t.DEFAULT_IOU_THRESHOLD=t.DEFAULT_EDGE_THRESHOLD=t.BOX_DISTANCE_LABEL_BIAS=t.BOX_DISTANCE_IOU_THRESHOLD=void 0;var n=r(167469),o=r(991984),i=r(362714),a=r(260160),s=r(242603);t.BOX_DISTANCE_IOU_THRESHOLD=.2;t.BOX_DISTANCE_LABEL_BIAS=.075;const l=.05;t.DEFAULT_EDGE_THRESHOLD=l;const u=.75;t.DEFAULT_IOU_THRESHOLD=u;t.DEFAULT_MIN_THRESHOLD_PX=5;t.DEFAULT_MAX_THRESHOLD_PX=15;t.DEFAULT_BOX_DIMENSION_THRESHOLD_PX=5;t.DEFAULT_BOX_POSITION_THRESHOLD_PX=5;t.DEFAULT_POINT_DISTANCE_THRESHOLD=6;const c=[n.TaskType.PolygonAnnotation];var d={extremalPointEdges:{taskTypes:c,title:"Extremal Point Box Edge positions",graderFn:o.gradePerFrame(((e,t,r,{threshold:n=.05,leftThreshold:o=n,rightThreshold:s=n,topThreshold:l=n,bottomThreshold:u=n,minThresholdPx:c=5,maxThresholdPx:d=15,useBoundedThresholds:f=!1})=>{const h=a.extremalPointAnnotToBoxAnnot(e),p=a.extremalPointAnnotToBoxAnnot(t);return i.edgeGrader(h,p,r,{threshold:n,leftThreshold:o,rightThreshold:s,topThreshold:l,bottomThreshold:u,minThresholdPx:c,maxThresholdPx:d,useBoundedThresholds:f})})),paramConfigs:[{name:"threshold",label:"Default Edge Threshold",type:"number",defaultValue:l},{name:"leftThreshold",label:"Left Threshold",type:"number",defaultValue:l},{name:"rightThreshold",label:"Right Threshold",type:"number",defaultValue:l},{name:"bottomThreshold",label:"Bottom Threshold",type:"number",defaultValue:l},{name:"topThreshold",label:"Top Threshold",type:"number",defaultValue:l},{name:"maxThresholdPx",label:"Maximum Edge Threshold",type:"number",defaultValue:15},{name:"minThresholdPx",label:"Minimum Edge Threshold",type:"number",defaultValue:5},{name:"useBoundedThresholds",label:"Whether to bound thresholds",type:"boolean",defaultValue:!1}]},extremalPointIOU:{taskTypes:c,title:"Extremal Point Box size and position",graderFn:o.gradePerFrame(((e,t,r,{threshold:n=.75})=>{const o=a.extremalPointAnnotToBoxAnnot(e),s=a.extremalPointAnnotToBoxAnnot(t);return i.iouGrader(o,s,r,{threshold:n})})),paramConfigs:[{name:"threshold",label:"IOU Threshold",type:"number",defaultValue:u}]},extremalPointDimensions:{taskTypes:c,title:"Extremal Point Box Dimensions grader",graderFn:o.gradePerFrame(((e,t,r,{threshold:n=5,heightThreshold:o=n,widthThreshold:s=n})=>{const l=a.extremalPointAnnotToBoxAnnot(e),u=a.extremalPointAnnotToBoxAnnot(t);return i.boxDimensionsGrader(l,u,r,{threshold:n,heightThreshold:o,widthThreshold:s})})),paramConfigs:[{name:"threshold",label:"Default Dimension Threshold",type:"number",defaultValue:5},{name:"heightThreshold",label:"Height Threshold",type:"number",defaultValue:5},{name:"widthThreshold",label:"Width Threshold",type:"number",defaultValue:5}]},extremalPointDistance:{taskTypes:c,title:"Extremal Point Distance grader",graderFn:o.gradePerFrame(((e,t,r,{threshold:n=6})=>{const o=a.standardizeExtremalPoints(e),i=a.standardizeExtremalPoints(t);return{top:s.distanceGrader(o.top,i.top,r,{threshold:n}).pointDistance,left:s.distanceGrader(o.left,i.left,r,{threshold:n}).pointDistance,bottom:s.distanceGrader(o.bottom,i.bottom,r,{threshold:n}).pointDistance,right:s.distanceGrader(o.right,i.right,r,{threshold:n}).pointDistance}})),paramConfigs:[{name:"threshold",label:"Distance Threshold",type:"number",defaultValue:6}]}};t.default=d},583456:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.fireflyDirectMatchGrader=void 0;var n,o=(n=r(298784))&&n.__esModule?n:{default:n},i=r(167469),a=r(991984),s=r(222357),l=r(963494),u=r(513254);const c=(e,t,r,n)=>{if(1!==e.length||1!==t.length||o.default.isBoolean(e[0])||o.default.isBoolean(t[0])||!n)return 0;const i=e[0],a=t[0],s=Number(i),u=Number(a),c=n.type===l.TextCollectionFieldType.Category?n.choices.length-1:n.options.length-1,d=(e,t)=>e>=.8*t?2:e>=.5*t?1:0,f=d(s,c),h=d(u,c);return f===h?1:1===Math.abs(f-h)?.5:0},d=(e,t,r,n,i,d)=>({fireflyDirectMatch:a.gradeIfNotMissing(((e,t)=>{if([l.TextCollectionFieldType.Category,l.TextCollectionFieldType.Autocomplete].includes(t.type)&&u.shouldGradeField(t.field_id,n?.fieldsWhitelist||d?.fieldsWhitelist,!!e.fieldWasReadOnly)){const r=d?.taskFields?.find((e=>e.field_id===t.field_id));return{correctWork:o.default.sum(e.response.map((e=>e.result===s.GraderResult.Correct?1:e.result===s.GraderResult.Incorrect?t.type===l.TextCollectionFieldType.Category?c(e.expected,e.given,0,r):c([e.expected],[e.given],0,r):0))),totalWork:t.response.length}}return{correctWork:0,totalWork:0}}),e,t)});t.fireflyDirectMatchGrader=d;var f={fireflyDirectMatchGrader:{taskTypes:[i.TaskType.TextCollection],title:"firefly direct match grader",graderFn:a.gradePerFrame(d)}};t.default=f},819354:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"marginLineLengthGrader",{enumerable:!0,get:function(){return n.marginLineLengthGrader}}),Object.defineProperty(t,"zCoordinateMarginLineGrader",{enumerable:!0,get:function(){return o.zCoordinateMarginLineGrader}});var n=r(40025),o=r(362508)},40025:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.marginLineLengthGrader=t.marginLineLength=t.LINE_GRADER_MARGIN_THRESHOLD=void 0;var n=r(167469),o=r(440169),i=r(991984);t.LINE_GRADER_MARGIN_THRESHOLD=5;const a=(e,t,r,{threshold:n=5})=>({marginLineLength:i.gradeIfNotMissing(((e,t)=>{const{lengthCorrectUserLine:r,lengthTotalUserLine:i,lengthTotalCorrectLine:a}=o.getLengthOfLineInMargin(e.vertices,t.vertices,n);return{correctWork:r/Math.max(a,i)*a,totalWork:a}}),e,t)});t.marginLineLength=a;const s={taskTypes:[n.TaskType.LineAnnotation],title:"GIS Margin Line Length Grader",graderFn:i.gradePerFrame(a),paramConfigs:[{name:"threshold",label:"Margin Threshold",type:"number",defaultValue:5}]};t.marginLineLengthGrader=s},362508:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.zCoordinateMarginLineGrader=t.zCoordMarginLineLength=t.XY_LINE_GRADER_MARGIN_THRESHOLD=t.Z_LINE_GRADER_MARGIN_THRESHOLD=void 0;var n=r(167469),o=r(440169),i=r(991984);t.Z_LINE_GRADER_MARGIN_THRESHOLD=.1;t.XY_LINE_GRADER_MARGIN_THRESHOLD=5;const a=(e,t,r,{zthreshold:n=.1,xythreshold:a=5})=>({zCoordMarginLineLength:i.gradeIfNotMissing(((e,t)=>{const{lengthCorrectUserLine:r,lengthTotalUserLine:i,lengthTotalCorrectLine:s}=o.getLengthOfLineInMarginZCoordinate(e.vertices,t.vertices,n,a);return{correctWork:r/Math.max(s,i)*s,totalWork:s}}),e,t)});t.zCoordMarginLineLength=a;const s={taskTypes:[n.TaskType.LidarTopdown],title:"GIS Margin Z Coordinate Grader",graderFn:i.gradePerFrame(a),paramConfigs:[{name:"zthreshold",label:"Margin Threshold for z coordinate",type:"number",defaultValue:.1},{name:"xythreshold",label:"Margin Threshold for matching line",type:"number",defaultValue:5}]};t.zCoordinateMarginLineGrader=s},401387:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"linksGrader",{enumerable:!0,get:function(){return n.linksGrader}}),Object.defineProperty(t,"nonLinksAttributeGrader",{enumerable:!0,get:function(){return o.nonLinksAttributeGrader}});var n=r(682675),o=r(424590)},682675:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.linksGrader=t.calculateCorrectAndTotalWork=t.getLinkedAttributeToAnnotations=t.fromAnnotationLabelChangedLinkingGraderGenerator=t.toAnnotationMissingOrLabelChangedLinkingGraderGenerator=t.toAndFromAnnotationExistLinkingGraderGenerator=t.linksGraderFn=void 0;var n,o=(n=r(298784))&&n.__esModule?n:{default:n},i=r(599789),a=r(991984),s=r(942991);const l=(e,t,r,n,l,f)=>{l||(l={});const h=o.default.get(l,"linkKeys",[]),p=t?.frames?.[e],m=r?.frames?.[e],g=o.default.union(o.default.keys(m?.attributes),o.default.keys(p?.attributes)),y=f?.matchedAnnotationsListContext,b=o.default.filter(g,(e=>{const t=f?.attributeTypes;return!!s.toLinkingAttributeKeyBase(e,h)||t?.[e]===i.AnnotationAttributeType.Linked})),T=o.default.compact(o.default.map(b,(e=>s.toLinkingAttributeKeyBase(e,h)))),v=[...new Set(T)],x={};return v.forEach((e=>{const t=u(e,y),r=c(e,y),n=d(e,y);x[`linking_${e}`]=a.gradeIfNotMissing(t,p,m),x[`linking_${e}_UNMATCHED_TO_ANN`]=a.gradeIfNotMissing(r,p,m),x[`linking_${e}_FROM_LABELS_DIFFERENT`]=a.gradeIfNotMissing(n,p,m)})),x};t.linksGraderFn=l;const u=(e,t)=>(r,n)=>{const o=r?.label,i=n?.label;if(o!==i)return{correctWork:0,totalWork:0};const{originalToAnnotations:a,correctToAnnotations:s}=f(e,r,n,t),l=a.filter((e=>e?.correctAnnotation&&e?.correctAnnotation?.props.label===e?.currentAnnotation?.props.label)),u=s.filter((e=>e?.correctAnnotation&&e?.correctAnnotation?.props.label===e?.currentAnnotation?.props.label)),{correctWork:c,totalWork:d,intermediates:p}=h(l,u,!0);return{correctWork:c,totalWork:d,intermediates:p}};t.toAndFromAnnotationExistLinkingGraderGenerator=u;const c=(e,t)=>(r,n)=>{const o=r?.label,i=n?.label;if(o!==i)return{correctWork:0,totalWork:0};const{originalToAnnotations:a,correctToAnnotations:s}=f(e,r,n,t),l=a.filter((e=>!e?.correctAnnotation||e.correctAnnotation?.props.label!==e.currentAnnotation?.props.label)),u=s.filter((e=>!e?.correctAnnotation||e.correctAnnotation?.props.label!==e.currentAnnotation?.props.label)),{correctWork:c,totalWork:d}=h(l,u);return{correctWork:c,totalWork:d}};t.toAnnotationMissingOrLabelChangedLinkingGraderGenerator=c;const d=(e,t)=>(r,n)=>{const o=r?.label,i=n?.label;if(o===i)return{correctWork:0,totalWork:0};const{originalToAnnotations:a,correctToAnnotations:s}=f(e,r,n,t),{totalWork:l}=h(a,s);return{correctWork:0,totalWork:l}};t.fromAnnotationLabelChangedLinkingGraderGenerator=d;const f=(e,t,r,n)=>{const i=t?.attributes,a=r?.attributes,s=Object.values(o.default.pickBy(i,((t,r)=>r.includes(e)))),l=Object.values(o.default.pickBy(a,((t,r)=>r.includes(e))));return{originalToAnnotations:s.map((e=>n?.find((t=>t.currentAnnotation?.props?.id===e)))),correctToAnnotations:l.map((e=>n?.find((t=>t.correctAnnotation?.props?.id===e))))}};t.getLinkedAttributeToAnnotations=f;const h=(e,t,r=!1)=>{const n=e.map((e=>e?.correctAnnotation?.props?.id)),i=t.map((e=>e?.correctAnnotation?.props?.id)),a=Math.max(e.length,t.length);let s=o.default.intersectionBy(n,i).length;const l=o.default.difference(n,i);return r&&l&&l.length>0&&(s-=l.length),{correctWork:s,totalWork:a,intermediates:{extraneous:l,missing:o.default.difference(i,n)}}};t.calculateCorrectAndTotalWork=h;const p={taskTypes:i.twoDTypes,title:"Links Grader",graderFn:a.gradePerFrameWithContext(l,!1,!1,!1)};t.linksGrader=p},424590:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.nonLinksAttributeGrader=t.defaultAttributeGraderFn=t.attributeGrader=void 0;var n,o=(n=r(298784))&&n.__esModule?n:{default:n},i=r(599789),a=r(991984),s=r(942991);const l=(e,t,r,n,l,c)=>{l||(l={});const d=o.default.get(l,"linkKeys",[]),f=t?.frames?.[e],h=r?.frames?.[e],p=o.default.keys(h?.attributes||f?.attributes),m=o.default.filter(p,(e=>c?.attributeTypes?.[e]!==i.AnnotationAttributeType.Linked&&!s.toLinkingAttributeKeyBase(e,d))),g={};return o.default.forEach(m,(e=>{const t=u(e,l);g[`attribute_${e}`]=a.gradeIfNotMissing(t,f,h)})),g};t.attributeGrader=l;const u=(e,t)=>(r,n)=>c(e,r,n,t),c=(e,t,r)=>{let n=t?.attributes?.[e],i=r?.attributes?.[e];return Array.isArray(n)&&Array.isArray(i)&&(n=o.default.sortBy(n),i=o.default.sortBy(i)),{correctWork:+o.default.isEqual(n,i),totalWork:1}};t.defaultAttributeGraderFn=c;const d={taskTypes:i.twoDTypes,title:"Non-links Attribute Grader",graderFn:a.gradePerFrameWithContext(l,!1)};t.nonLinksAttributeGrader=d},942991:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.toLinkingAttributeKeyBase=void 0;var n,o=(n=r(298784))&&n.__esModule?n:{default:n};t.toLinkingAttributeKeyBase=(e,t)=>{const r=o.default.sortBy(t,(e=>-e.length));return o.default.find(r,(t=>e.includes(t)))}},524183:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.gradersForTaskType=t.calculatePathLength=t.extraneousGrader=void 0;var n=X(r(298784)),o=r(599789),i=r(167469),a=r(308408),s=r(19161),l=r(991984),u=X(r(205308)),c=X(r(362714)),d=X(r(587005)),f=X(r(278127)),h=X(r(729493)),p=X(r(147368)),m=X(r(233193)),g=X(r(152672)),y=X(r(513254)),b=X(r(464746)),T=X(r(909452)),v=X(r(896135)),x=X(r(242603)),_=X(r(355427)),M=X(r(216383)),A=X(r(642101)),k=r(313220),P=X(r(63226)),E=X(r(567208)),I=X(r(30353)),L=X(r(272455)),w=X(r(875611)),C=X(r(944129)),F=X(r(247915)),O=X(r(835802)),S=X(r(798921)),D=X(r(856753)),N=X(r(197845)),R=X(r(580792)),G=X(r(995906)),W=Z(r(68380)),B=Z(r(487714)),j=Z(r(190913)),U=Z(r(819354)),H=Z(r(388746)),z=Z(r(401387)),V=X(r(410718)),q=X(r(583456)),Y=X(r(844162));function X(e){return e&&e.__esModule?e:{default:e}}function Z(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}const $=(e,t,r,o,a,s)=>{const l=n.default.keys(e&&e.frames),u=n.default.keys(t&&t.frames),c=n.default.keys(s&&s.frames),d=n.default.union(l,u,c),f=u.length||l.length||c.length||1,h=n.default.difference(l,u),p=n.default.map(d,((a,l)=>{const u=n.default.get(e,["frames",a]),c=n.default.get(t,["frames",a]),f=n.default.get(s,["frames",a]),h=r?.props.overriddenTaskType===i.TaskType.EventAnnotation&&!!o?.eventEndpointLeniency&&(l<o.eventEndpointLeniency||l>=d.length-o.eventEndpointLeniency);return c||h?{frame:a,correctWork:0,totalWork:0,relativeCorrectWork:0,relativeTotalWork:0,introducedErrorCorrectWork:0}:u&&f?{frame:a,correctWork:-1,totalWork:0,relativeCorrectWork:0,relativeTotalWork:1,introducedErrorCorrectWork:0,carriedOverWork:1}:u&&!f?{frame:a,correctWork:-1,totalWork:0,relativeCorrectWork:-1,relativeTotalWork:0,introducedErrorCorrectWork:-1}:!u&&f?{frame:a,correctWork:0,totalWork:0,relativeCorrectWork:1,relativeTotalWork:1,introducedErrorCorrectWork:0}:void 0})),m=n.default.map(n.default.filter(p,(e=>+(e?.relativeCorrectWork!==e?.relativeTotalWork))),"frame"),g=m.length,y=-n.default.sumBy(p,"correctWork");return{extraneous:{correctWork:n.default.sumBy(p,"correctWork")/f,totalWork:0,relativeCorrectWork:n.default.sumBy(p,"relativeCorrectWork")/f,relativeTotalWork:n.default.sumBy(p,"relativeTotalWork")/f,introducedErrorCorrectWork:n.default.sumBy(p,"introducedErrorCorrectWork")/f,carriedOverWork:n.default.sumBy(p,(e=>e?.carriedOverWork??0))/f,incorrectFrames:h,relativeIncorrectFrames:m,errorType:"extraneous",numIncorrectFrames:y,numTotalFrames:f,numRelativeIncorrectFrames:g}}};t.extraneousGrader=$;const K=(e,t,r,o=1,i=1)=>{const a=[],l=[],u=s.generateChildToParentChoiceMapping(r);let c=s.getChoice(r,e);for(;!n.default.isNil(c);)a.push(c),c=u.get(c);let d=s.getChoice(r,t);for(;!n.default.isNil(d);)l.push(d),d=u.get(d);a.reverse(),l.reverse();let f=0;for(;a[f]===l[f]&&!n.default.isNil(l[f]);)f+=1;if(0===f&&l.length!==f)return 1e3;return i*(l.length-f)+o*(a.length-f)};t.calculatePathLength=K;const Q=n.default.values(i.TaskType),J={missing:{taskTypes:Q,title:"Missing",graderFn:l.gradePerFrame(((e,t)=>n.default.findIndex(t.acceptedAnnotations,(({annotation:e})=>n.default.isNil(e)))>=0&&n.default.isEmpty(e)?{missing:{correctWork:1,totalWork:1}}:{missing:l.gradeIfNotMissing((()=>({correctWork:1,totalWork:1})),e,t)}),!0)},extraneous:{taskTypes:Q,title:"Extraneous",graderFn:$},labels:{taskTypes:Q,title:"Labels",graderFn:l.gradeSingle(((e,t,r,o={},i)=>{const{partialCredit:s,penaltyFactor:l=.5}=o;let u=0;if(s){if(e.props.overriddenTaskType===t.props.overriddenTaskType&&!n.default.isNil(e.props.overriddenTaskType)){const r=a.taskTypeToGeometry[e.props.overriddenTaskType];if(n.default.isNil(r))throw new Error(`No geometry corresponding to task type ${e.props.overriddenTaskType} for original annotation ${e.props.id}`);const o=i.labelChoices?.[r];if(n.default.isNil(o))throw new Error(`No label choices corresponding to geometry ${r} for original annotation ${e.props.id}`);u=+(l**(.5*K(e?.props?.label,t?.props?.label,o))).toFixed(3)}}else u=+(e?.props?.label===t?.props?.label);return{correctWork:u,totalWork:1,incorrectFrames:0===u?n.default.union(...[e,t].map((e=>n.default.keys(e?.frames)))):[]}}),"label"),paramConfigs:[{name:"partialCredit",label:"Give partial credit",type:"boolean",defaultValue:!1},{name:"penaltyFactor",label:"Penalty multiplier for each level",type:"number"}]},lenientLabels:{taskTypes:Q,title:"Lenient Labels",graderFn:l.gradeSingle(((e,t,r,o={})=>{const i=e?.props?.label,a=t?.props?.label;let s=+(i===a);return n.default.get(o,"partialCreditKeysAndValues",[]).forEach((e=>{e.initialLabel===i&&e.expectedLabel===a&&(s=e.partialCredit)})),{correctWork:s,totalWork:1,incorrectFrames:0===s?n.default.union(...[e,t].map((e=>n.default.keys(e?.frames)))):[]}}),"lenientLabel"),paramConfigs:[{name:"partialCreditKeysAndValues",label:"ordered pairs of labels to give partial credit for",type:"any",defaultValue:[]}]},attributes:{taskTypes:[...o.twoDTypes,...o.lidarTypes],title:"Attributes",graderFn:l.gradePerFrameWithContext(u.default,!1),paramConfigs:[{name:"angleDiffThresholdDegrees",label:"Angle Diff Threshold (Degrees)",type:"number"},{name:"xlineDiffThresholdFraction",label:"XLine Diff Threshold (Fraction of Correct Width)",type:"number"},{name:"ylineDiffThresholdFraction",label:"YLine Diff Threshold (Fraction of Correct Height)",type:"number"},{name:"enabledKeys",label:"Only run graders for these attributes",type:"any"},{name:"ltdPerFrameKeys",label:"Per Frame LTD Attributes",type:"any"}]}},ee={...J,linkingUuid:{taskTypes:o.lidarLinkingSubtaskTypes,title:"Linking Uuid",graderFn:l.gradePerFrame(k.linkingUuidGrader)},...c.default,...d.default,...f.default,...h.default,...D.default,...N.default,...R.default,...L.default,...p.default,...m.default,...U,...g.default,...y.default,...b.default,...T.default,...v.default,...x.default,..._.default,...M.default,...E.default,...G.default,...V.default,...Y.default,...A.default,...P.default,...w.default,...C.default,...F.default,...O.default,...S.default,...q.default,...W,...B,...j,...I.default,...H,...z},te={[i.TaskType.Annotation]:{...J,...c.default,linkingUuid:ee.linkingUuid,beeMappingLinkingGrader:B.beeMappingLinkingGrader,beeMappingAttributeGrader:B.beeMappingAttributeGrader,beeMappingLinterDismissalGrader:B.beeMappingLinterDismissalGrader},[i.TaskType.VideoBoxAnnotation]:{...J,...c.default,beeMappingLinkingGrader:B.beeMappingLinkingGrader,beeMappingAttributeGrader:B.beeMappingAttributeGrader},[i.TaskType.LidarLinking]:{...J,...c.default},[i.TaskType.PolygonAnnotation]:{...J,..._.default,...G.default,...j,beeMappingLinkingGrader:B.beeMappingLinkingGrader,beeMappingAttributeGrader:B.beeMappingAttributeGrader,beeMappingLinterDismissalGrader:B.beeMappingLinterDismissalGrader},[i.TaskType.CuboidAnnotation]:{...J,...f.default,beeMappingLinkingGrader:B.beeMappingLinkingGrader,beeMappingAttributeGrader:B.beeMappingAttributeGrader,beeMappingLinterDismissalGrader:B.beeMappingLinterDismissalGrader},[i.TaskType.LineAnnotation]:{...J,...m.default,beeMappingGlobal:B.beeMappingGlobal,beeMappingLinkingGrader:B.beeMappingLinkingGrader,beeMappingAttributeGrader:B.beeMappingAttributeGrader,beeMappingLinterDismissalGrader:B.beeMappingLinterDismissalGrader},[i.TaskType.PointAnnotation]:{...J,...x.default,beeMappingLinkingGrader:B.beeMappingLinkingGrader,beeMappingAttributeGrader:B.beeMappingAttributeGrader,beeMappingLinterDismissalGrader:B.beeMappingLinterDismissalGrader}};t.gradersForTaskType=te;var re=ee;t.default=re},875611:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.gradeE5=void 0;var n,o=(n=r(298784))&&n.__esModule?n:{default:n},i=r(167469),a=r(991984),s=r(39083),l=r(74909);const u=e=>({E1:{correctWork:o.default.isEmpty(e)?0:1,totalWork:1}}),c=(e,t)=>({E2:a.ignoreIfMissing(((e,t)=>({correctWork:+(e.uuid===t.uuid),totalWork:1})),e,t)}),d=(e,t,r,{e3Threshold:n=1.5})=>({E3:a.ignoreIfMissing(((e,t)=>{const r=Math.abs(s.computeAngleDiff(e.yaw,t.yaw));return{correctWork:+(r<n),totalWork:1,intermediates:{headingDiff:r}}}),e,t)}),f=(e,t,r,{e4UpperBoundThreshold:n=.15,e4LowerBoundThreshold:o=-.05})=>({E4:a.ignoreIfMissing(((e,t)=>{const r=t.dimensions.x-e.dimensions.x,i=t.dimensions.y-e.dimensions.y,a=t.dimensions.z-e.dimensions.z;return{correctWork:+(r<n&&i<n&&a<n&&r>=o&&i>=o&&a>=o),totalWork:1,intermediates:{wDiff:r,lDiff:i,hDiff:a}}}),e,t)}),h=(e,t,r,{e5Threshold:n=.2})=>({E5:a.ignoreIfMissing(((e,t)=>{const r=l.naiveDistance(e.position,t.position);return{correctWork:+(r<n),totalWork:1,intermediates:{positionDiff:r}}}),e,t)});t.gradeE5=h;const p=(e,t)=>({E7:a.ignoreIfMissing(((e,t)=>{const r=e.label;return{correctWork:+(r===t.label||"UNKNOWN_ZONE"===r),totalWork:1}}),e,t)}),m=(e,t)=>({E8:{correctWork:o.default.isEmpty(t)?0:1,totalWork:1}});var g={E0:{taskTypes:[i.TaskType.LidarAnnotation],title:"Falcon E0",graderFn:a.gradePerFrame(((e,t,r,n)=>{const o=u(e).E1.correctWork,i=c(e,t).E2.correctWork,a=d(e,t,0,n).E3.correctWork,s=f(e,t,0,n).E4.correctWork,l=h(e,t,0,n).E5.correctWork,g=p(e,t).E7.correctWork,y=m(0,t).E8.correctWork;return{E0:{correctWork:o&&i&&a&&s&&l&&g&&y?1:0,totalWork:1}}}),!0)},E1:{taskTypes:[i.TaskType.LidarAnnotation],title:"Falcon E1",graderFn:a.gradePerFrame(u,!0)},E2:{taskTypes:[i.TaskType.LidarAnnotation],title:"Falcon E2",graderFn:a.gradePerFrame(c,!0)},E3:{taskTypes:[i.TaskType.LidarAnnotation],title:"Falcon E3",graderFn:a.gradePerFrame(d,!0)},E4:{taskTypes:[i.TaskType.LidarAnnotation],title:"Falcon E4",graderFn:a.gradePerFrame(f,!0)},E5:{taskTypes:[i.TaskType.LidarAnnotation],title:"Falcon E5",graderFn:a.gradePerFrame(h,!0)},E7:{taskTypes:[i.TaskType.LidarAnnotation],title:"Falcon E7",graderFn:a.gradePerFrame(p,!0)},E8:{taskTypes:[i.TaskType.LidarAnnotation],title:"Falcon E8",graderFn:a.gradePerFrame(m,!0)}};t.default=g},580792:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(167469),o=r(991984);var i={gridSegmentationMatrixDifference:{taskTypes:[n.TaskType.GridSegmentation],title:"Grader for Grid Segmentation matrix difference",graderFn:o.gradePerFrame(((e,t)=>({gridSegmentationMatrixDifference:o.gradeIfNotMissing(((e,t)=>{if(e.values.length!==t.values.length||e.width!==t.width||e.height!==t.height||e.values.length!==e.width*e.height)throw new Error("Grid Segmentation values must have the same shape.");const r=e.width*e.height;let n=0,o=0,i=0;for(let a=0;a<r;a++)o=e.values[a],i=t.values[a],n+=o!==i?1:0;return{correctWork:1-n/r,totalWork:1,intermediates:{differentValuesCount:n,totalNumbersCount:r}}}),e,t)})))}};t.default=i},729493:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.PARAMS_WITH_FRONTEND_VIS=t.typedLidarGraders=t.sizeGrader=t.positionGrader=t.headingGrader=t.DEFAULT_FACE_POSITION_GRADER_CONFIG=t.DEFAULT_GROUP_IOU_THRESHOLD=t.DEFAULT_FACE_POSITION_OUTER_THRESHOLD=t.DEFAULT_FACE_POSITION_INNER_THRESHOLD=t.DEFAULT_PITCH_THRESHOLD=t.DEFAULT_BANK_THRESHOLD=t.DEFAULT_WEAK_HEADING_THRESHOLD=t.DEFAULT_HEADING_THRESHOLD=t.DEFAULT_STRICT_Z_THRESHOLD=t.DEFAULT_WEAK_Z_THRESHOLD=t.DEFAULT_IOU_THRESHOLD=t.DEFAULT_DIMENSIONS_THRESHOLD=t.DEFAULT_SIZE_THRESHOLD=t.DEFAULT_SINGLE_AXIS_POSITION_THRESHOLD=t.DEFAULT_POSITION_THRESHOLD=void 0;var n=r(167469),o=d(r(298784)),i=r(74909),a=r(39083),s=r(825555),l=r(108040),u=d(r(141862)),c=r(991984);function d(e){return e&&e.__esModule?e:{default:e}}t.DEFAULT_POSITION_THRESHOLD=.6;t.DEFAULT_SINGLE_AXIS_POSITION_THRESHOLD=.2;t.DEFAULT_SIZE_THRESHOLD=.6;const f=.25;t.DEFAULT_DIMENSIONS_THRESHOLD=f;t.DEFAULT_IOU_THRESHOLD=.6;t.DEFAULT_WEAK_Z_THRESHOLD=.2;t.DEFAULT_STRICT_Z_THRESHOLD=.02;const h=.17;t.DEFAULT_HEADING_THRESHOLD=h;t.DEFAULT_WEAK_HEADING_THRESHOLD=.78;t.DEFAULT_BANK_THRESHOLD=.17;t.DEFAULT_PITCH_THRESHOLD=.17;const p=.025;t.DEFAULT_FACE_POSITION_INNER_THRESHOLD=p;const m=.1;t.DEFAULT_FACE_POSITION_OUTER_THRESHOLD=m;t.DEFAULT_GROUP_IOU_THRESHOLD=.5;const g=()=>new s.ParamConfig(s.MULTI_FRAME_PARAM_CONFIG_FLAG,!1,{label:"Parameterize per-frame. Unchecking will reset all multi-frame parameterization."}),y=Object.freeze({innerThreshold:p,outerThreshold:m,rightInnerThreshold:p,rightOuterThreshold:m,leftInnerThreshold:p,leftOuterThreshold:m,frontInnerThreshold:p,frontOuterThreshold:m,backInnerThreshold:p,backOuterThreshold:m,topInnerThreshold:p,topOuterThreshold:m,bottomInnerThreshold:p,bottomOuterThreshold:m});t.DEFAULT_FACE_POSITION_GRADER_CONFIG=y;const b=(e,t)=>(r,n,i,{yawThreshold:s=t,useRadians:l=!0})=>{const d=(l?s:u.default.deg2rad(s))%Math.PI;return{[`${e}${e&&"-"}heading`]:c.gradeIfNotMissing(((e,t)=>{const r=Math.abs(a.computeAngleDiff(e.yaw,t.yaw)),n={headingDiff:r};return o.default.includes(["no label zone","no label"],o.default.toLower(t.label))?{correctWork:1,totalWork:1,intermediates:n}:{correctWork:+(r<d),totalWork:1,intermediates:n}}),r,n)}};t.headingGrader=b;const T=(e,t,r,{threshold:n=.6})=>({position:c.gradeIfNotMissing(((e,t)=>{const r=i.naiveDistance(e.position,t.position);return{correctWork:+(r<n),totalWork:1,intermediates:{positionDiff:r}}}),e,t)});t.positionGrader=T;const v=(e,t,r,{threshold:n=.6})=>({size:c.gradeIfNotMissing(((e,t)=>{const r=i.naiveDistance(e.dimensions,t.dimensions);return{correctWork:+(r<n),totalWork:1,intermediates:{sizeDiff:r}}}),e,t)});t.sizeGrader=v;const x=(e,t)=>(r,n,o,{threshold:i=t})=>({[`${e}-Z`]:c.gradeIfNotMissing(((e,t)=>{const r=e=>e.position.z-e.dimensions.z/2,n=e?r(e)-r(t):0,o={zDiff:n};return{correctWork:+(Math.abs(n)<i),totalWork:1,intermediates:o}}),r,n)}),_={precision:5},M={..._,type:"Number",min:.001,step:1e-4,supportMultiFrameParameterization:!0},A=["innerThreshold","outerThreshold"],k=[g(),...o.default.keys(y).filter((e=>!A.includes(e))).map((e=>{const[t,r]=o.default.startCase(e).split(" ");return new s.ParamConfig(e,y[e],{label:`${t} (${r})`,...M})}))],P=[g(),...o.default.map(l.Axis,(e=>new s.ParamConfig(`${e}Threshold`,.2,{label:`${e.toUpperCase()} Threshold`,min:0,supportMultiFrameParameterization:!0,..._})))],E=[g(),new s.ParamConfig("yawThreshold",o.default.round(u.default.rad2deg(h),3),{..._,label:"Heading Threshold",min:0,supportMultiFrameParameterization:!0}),new s.ParamConfig("useRadians",!1,{label:"Use Radians",type:"boolean"})],I={iou_lidar:{taskTypes:[n.TaskType.LidarAnnotation,n.TaskType.LidarCuboidPlane],title:"IOU",graderFn:c.gradePerFrame(((e,t,r,{threshold:n=.6})=>({iou:c.gradeIfNotMissing(((e,t)=>{const r=a.computeIOU(e.position,e.dimensions,e.yaw,t.position,t.dimensions,t.yaw);return{correctWork:+(r>n),totalWork:1,intermediates:{iou:r}}}),e,t)}))),paramConfigs:[new s.ParamConfig("threshold",.6,{..._,label:"IOU Threshold"})]},size:{taskTypes:[n.TaskType.LidarAnnotation,n.TaskType.LidarCuboidPlane],title:"Size",graderFn:c.gradePerFrame(v),paramConfigs:[new s.ParamConfig("threshold",.6,_)]},dimensions:{taskTypes:[n.TaskType.LidarAnnotation],title:"Dimensions",graderFn:c.gradePerFrame(((e,t,r,{wThreshold:n=.25,lThreshold:i=.25,hThreshold:a=.25,partialScore:s=!1})=>({dimensions:c.gradeIfNotMissing(((e,t)=>{const r=Math.abs(e.dimensions.x-t.dimensions.x),l=Math.abs(e.dimensions.y-t.dimensions.y),u=Math.abs(e.dimensions.z-t.dimensions.z),c=[r<n,l<i,u<a].map((e=>+e)),d={wDiff:r,lDiff:l,hDiff:u,dimensionScores:c};return{correctWork:s?o.default.sum(c)/3:+o.default.every(c),totalWork:1,intermediates:d}}),e,t)}))),paramConfigs:[new s.ParamConfig("wThreshold",f,{..._,label:"Width Dimension Threshold"}),new s.ParamConfig("hThreshold",f,{..._,label:"Height Dimension Threshold"}),new s.ParamConfig("lThreshold",f,{..._,label:"Length Dimension Threshold"}),new s.ParamConfig("partialScore",!1,{label:"Points for Partial Work"})]},segmentedDimensions:{taskTypes:[n.TaskType.LidarAnnotation,n.TaskType.LidarCuboidPlane],title:"Segmented Dimensions",graderFn:c.gradePerFrame(((e,t,r,{wThreshold:n=.25,lThreshold:o=.25,hThreshold:i=.25})=>({width:c.gradeIfNotMissing(((e,t)=>{const r=Math.abs(e.dimensions.x-t.dimensions.x);return{correctWork:+(r<n),totalWork:1,intermediates:{diff:r}}}),e,t),length:c.gradeIfNotMissing(((e,t)=>{const r=Math.abs(e.dimensions.y-t.dimensions.y);return{correctWork:+(r<o),totalWork:1,intermediates:{diff:r}}}),e,t),height:c.gradeIfNotMissing(((e,t)=>{const r=Math.abs(e.dimensions.z-t.dimensions.z);return{correctWork:+(r<i),totalWork:1,intermediates:{diff:r}}}),e,t)}))),paramConfigs:[new s.ParamConfig("wThreshold",f,{..._,label:"Width Dimension Threshold"}),new s.ParamConfig("hThreshold",f,{..._,label:"Height Dimension Threshold"}),new s.ParamConfig("lThreshold",f,{..._,label:"Length Dimension Threshold"})]},position:{taskTypes:[n.TaskType.LidarAnnotation,n.TaskType.LidarCuboidPlane,n.TaskType.LidarPointAnnotation],title:"Position",graderFn:c.gradePerFrame(T),paramConfigs:[new s.ParamConfig("threshold",.6,_)]},heading:{taskTypes:[n.TaskType.LidarAnnotation,n.TaskType.LidarCuboidPlane],title:"Heading",graderFn:c.gradePerFrame(b("normal",h)),supportMultiFrameParameterization:!0,paramConfigs:E},yaw:{taskTypes:[n.TaskType.LidarAnnotation,n.TaskType.LidarCuboidPlane],title:"Yaw",graderFn:c.gradePerFrame(b("",h)),supportMultiFrameParameterization:!0,paramConfigs:E},weakHeading:{taskTypes:[n.TaskType.LidarAnnotation,n.TaskType.LidarCuboidPlane],title:"Weak Heading (45 deg)",graderFn:c.gradePerFrame(b("weak",.78))},bank:{taskTypes:[n.TaskType.LidarAnnotation,n.TaskType.LidarCuboidPlane],title:"Bank",graderFn:c.gradePerFrame(((e,t,r,{threshold:n=.17})=>({bank:c.gradeIfNotMissing(((e,t)=>{const r=Math.abs(a.computeAngleDiff(e.roll,t.roll));return{correctWork:+(r<n),totalWork:1,intermediates:{bankDiff:r}}}),e,t)})))},pitch:{taskTypes:[n.TaskType.LidarAnnotation,n.TaskType.LidarCuboidPlane],title:"Pitch",graderFn:c.gradePerFrame(((e,t,r,{threshold:n=.17})=>({pitch:c.gradeIfNotMissing(((e,t)=>{const r=Math.abs(a.computeAngleDiff(e.pitch,t.pitch));return{correctWork:+(r<n),totalWork:1,intermediates:{pitchDiff:r}}}),e,t)})))},stationary:{taskTypes:[n.TaskType.LidarAnnotation,n.TaskType.LidarCuboidPlane],title:"Stationary",graderFn:c.gradeSingle(((e,t)=>({correctWork:+(o.default.get(e,"props.stationary")===o.default.get(t,"props.stationary")),totalWork:1})),"stationary")},zCoordinate:{taskTypes:[n.TaskType.LidarAnnotation,n.TaskType.LidarCuboidPlane],title:"Z-Coordinate",graderFn:c.gradePerFrame(x("weak",.2))},strictZCoordinate:{taskTypes:[n.TaskType.LidarAnnotation,n.TaskType.LidarCuboidPlane],title:"Strict Z-Coordinate",graderFn:c.gradePerFrame(x("strict",.02))},facePosition:{taskTypes:[n.TaskType.LidarAnnotation,n.TaskType.LidarCuboidPlane],title:"Face Position (Outwards)",graderFn:c.gradePerFrame(((e,t,r,{innerThreshold:n=.025,outerThreshold:a=.1,rightInnerThreshold:s=n,rightOuterThreshold:l=a,leftInnerThreshold:u=n,leftOuterThreshold:d=a,frontInnerThreshold:f=n,frontOuterThreshold:h=a,backInnerThreshold:p=n,backOuterThreshold:m=a,topInnerThreshold:g=n,topOuterThreshold:y=a,bottomInnerThreshold:b=n,bottomOuterThreshold:T=a})=>{const v=[1,-1,1,-1,1,-1],x=[[s,l],[u,d],[f,h],[p,m],[g,y],[b,T]];return{facePosition:c.gradeIfNotMissing(((e,t)=>{const r=i.getFaceCenters(t),n=i.getFaceCenters(e),{xVector3:a,yVector3:s,zVector3:l}=i.getEdgeVectors(e),u=[a,a,s,s,l,l],c=n.map(((e,t)=>e.distanceTo(r[t]))),d=o.default.zipWith(n,r,u,v,x,((e,t,r,n,o)=>+((e,t,r,n,o,i)=>{const a=e.clone().sub(t),s=a.dot(r)>=0?1:-1,l=a.projectOnVector(r).length()*n*s;return l<i&&l>-o})(e,t,r,n,o[0],o[1]))),f={centers1:n,centers2:r,faceScores:d,faceDistances:c};return{correctWork:o.default.sum(d)/6,totalWork:1,intermediates:f}}),e,t)}})),supportMultiFrameParameterization:!0,paramConfigs:k},perAxisPosition:{taskTypes:[n.TaskType.LidarAnnotation,n.TaskType.LidarCuboidPlane],title:"Per Axis Position",graderFn:c.gradePerFrame(((e,t,r,n)=>({position:c.gradeIfNotMissing(((e,t)=>{const r={};let i=0;return o.default.forEach(l.Axis,(o=>{const a=n[`${o}Threshold`],s=e.position[o]-t.position[o],l=+(Math.abs(s)<a);r[`${o}PositionDiff`]=s,r[`${o}PositionWork`]=l,i+=l})),{correctWork:i,totalWork:3,intermediates:r}}),e,t)}))),supportMultiFrameParameterization:!0,paramConfigs:P},groupIou:{taskTypes:[n.TaskType.LidarAnnotation,n.TaskType.LidarCuboidPlane],title:"Cuboid Group IOU",graderFn:c.globalGradePerFrame(((e,t,{labels:r=[],threshold:n=.5})=>{const i=(e,t)=>{const r=a.computeGroupIOU(e,t);return{correctWork:+(r>=n),totalWork:1,intermediates:{iou:r}}};return o.default.reduce(r,((r,n)=>{const a=o.default.filter(e,{label:n}),s=o.default.filter(t,{label:n}),l=c.gradeIfNotMissing(i,a,s);return r[`groupIou-${n}`]={...l,label:n},r}),{})})),global:!0}};t.typedLidarGraders=I;const L=I;t.PARAMS_WITH_FRONTEND_VIS=["facePosition","perAxisPosition","yaw","dimensions"];var w=L;t.default=w},856753:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.DEFAULT_LIDAR_POINT_ANNOTATION_DISTANCE_THRESHOLD=void 0;var n=r(167469),o=r(991984),i=r(74909),a=r(894574);t.DEFAULT_LIDAR_POINT_ANNOTATION_DISTANCE_THRESHOLD=.5;var s={lidarPointAnnotationDistance:{taskTypes:[n.TaskType.LidarPointAnnotation],title:"Lidar Point Annotation Distance",graderFn:o.gradePerFrame(((e,t,r,{threshold:n=.5})=>({lidarPointAnnotationDistance:o.gradeIfNotMissing(((e,t)=>{const{position:r,label:o}=e,{position:s,label:l}=t;if(!l||!s||!o||!r)return{correctWork:0,totalWork:0};const u=i.naiveDistance(r,s),c=a.CONSENSUS_ERROR_THRESHOLDS[l]||n;return{correctWork:+(u<=c),totalWork:1,intermediates:{distance:u,threshold:c}}}),e,t)})))}};t.default=s},197845:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.DEFAULT_LIDAR_POLYGON_THRESHOLD=void 0;var n,o=(n=r(298784))&&n.__esModule?n:{default:n},i=r(167469),a=r(991984);t.DEFAULT_LIDAR_POLYGON_THRESHOLD=.05;var s={lidarPolygonZLevel:{taskTypes:[i.TaskType.LidarPolygon],title:"Grader for Lidar Polygon Z Level",graderFn:a.gradePerFrame(((e,t,r,{threshold:n=.05})=>({lidarPolygonZLevel:a.gradeIfNotMissing(((e,t)=>{const r=o.default.meanBy(e.vertices,(e=>e.z)),i=o.default.meanBy(t.vertices,(e=>e.z)),a=Math.abs(r-i);return{correctWork:+(a<=n),totalWork:1,intermediates:{distance:a,threshold:n}}}),e,t)})))}};t.default=s},147368:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.DEFAULT_CLUSTER_OVERLAP_THRESHOLD=void 0;var n,o=(n=r(298784))&&n.__esModule?n:{default:n},i=r(167469),a=r(825555),s=r(297393),l=r(991984);t.DEFAULT_CLUSTER_OVERLAP_THRESHOLD=.8;const u=[{cutoff:.9,work:1},{cutoff:.8,work:.75},{cutoff:.7,work:.5}];var c={clusterOverlap:{taskTypes:[i.TaskType.LidarSegmentation],title:"Cluster Overlap",graderFn:l.gradePerFrameWithContext(((e,t,r,n,{threshold:i=.8},a)=>({clusterOverlap:l.gradeIfNotMissing(((t,r)=>{const n=s.getPointIntersections(a),[l,u]=o.default.sortBy([t,r],(e=>e.props.response)),c=`${e}_${l.props.response}_${u.props.response}_${l.props.cluster}_${u.props.cluster}`,d=n?.get(c)||0,f=t.frames[e].numPoints-d,h=d/r.frames[e].numPoints;return{correctWork:+(h>=i),totalWork:1,intermediates:{incorrectPoints:f,correctPoints:d,overlap:h}}}),t,r)})))},lssIoU:{taskTypes:[i.TaskType.LidarSegmentation],title:"Lidar Semantic Segmentation IoU",graderFn:l.gradePerFrameWithContext(((e,t,r,n,{correctWorkThresholds:i=u},c)=>({lssIoU:l.gradeIfNotMissing(((t,r)=>{const n=s.getPointIntersections(c),[l,u]=o.default.sortBy([t,r],(e=>e.props.response)),d=`${e}_${l.props.response}_${u.props.response}_${l.props.cluster}_${u.props.cluster}`,f=n?.get(d)||0,h=t.frames[e]?t.frames[e].numPoints-f:0,p=(t.frames?.[e]?.numPoints||0)+(r.frames?.[e]?.numPoints||0),m=f/(p-f);return{correctWork:a.getHighestWorkThreshold(i,m)?.work??0,totalWork:o.default.maxBy(i,(e=>e.cutoff))?.work??1,intermediates:{incorrectPoints:h,correctPoints:f,totalPoints:p,correctWorkThresholds:i},metrics:{lssIou:m}}}),t,r)})))},numPoints:{taskTypes:[i.TaskType.LidarSegmentation],title:"Point Count",graderFn:(e,t)=>{const r=o.default.reduce(t?.frames,((e,{numPoints:t})=>e+=t??0),0);return{numPoints:{correctWork:r,totalWork:r,errorType:"numPoints",numIncorrectFrames:0,numTotalFrames:o.default.size(t?.frames)}}}}};t.default=c},272455:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.weightedProjectionIOU=t.LIDAR_POINT_THRESHOLD=t.LONG_RANGE_PROJECTION_THRESHOLD=void 0;var n,o=r(825555),i=r(167469),a=r(991984),s=r(440169),l=r(74909),u=r(729493),c=(n=r(298784))&&n.__esModule?n:{default:n};t.LONG_RANGE_PROJECTION_THRESHOLD=.7;t.LIDAR_POINT_THRESHOLD=5;const d=(e,t)=>{const r=s.polygonFor(e).convexHull(),n=s.polygonFor(t).convexHull();return{projUnion:r.union(n).getArea(),projIntersection:r.intersection(n).getArea()}},f=(e,t)=>{let r=0,n=0;for(let o=0;o<e.length;o++){const i=e[o],a=t[o];if(!i||!a)continue;const{projUnion:s,projIntersection:l}=d(i,a);r+=s,n+=l}return n&&r?n/r:0};t.weightedProjectionIOU=f;const h={type:"Number",min:.001,step:1e-4};var p={facePositionAndProjectionIou:{taskTypes:[i.TaskType.LidarAnnotation],title:"Long Range Lidar Projections",graderFn:a.gradePerFrame(((e,t,r,{projectionIouThreshold:n=.7,innerThreshold:o=u.DEFAULT_FACE_POSITION_INNER_THRESHOLD,outerThreshold:i=u.DEFAULT_FACE_POSITION_OUTER_THRESHOLD,rightInnerThreshold:s=o,rightOuterThreshold:d=i,leftInnerThreshold:h=o,leftOuterThreshold:p=i,frontInnerThreshold:m=o,frontOuterThreshold:g=i,backInnerThreshold:y=o,backOuterThreshold:b=i,topInnerThreshold:T=o,topOuterThreshold:v=i,bottomInnerThreshold:x=o,bottomOuterThreshold:_=i})=>{const M=(e,t)=>{if(!e||!t)return!1;const r=!c.default.every(e.projections,(e=>c.default.isNull(e))),n=!c.default.every(t.projections,(e=>c.default.isNull(e))),o=e.numberOfPoints<=5,i=t.numberOfPoints<=5;return r&&n&&o&&i},A=["x","x","y","y","z","z"],k=[1,-1,1,-1,1,-1],P=[[s,d],[h,p],[m,g],[y,b],[T,v],[x,_]];return{projectionIou:((r,o)=>{if(c.default.isEmpty(e)||c.default.isEmpty(t)||!M(r,o))return{correctWork:0,totalWork:0};const i=f(r.projections,o.projections);return{correctWork:+(i>=n),totalWork:1,intermediates:{iou:i,longRange:!0}}})(e,t),facePosition:a.gradeIfNotMissing(((e,t)=>{if(M(e,t))return{correctWork:0,totalWork:0};const r=l.getFaceCenters(t),n=l.getFaceCenters(e),o=c.default.zipWith(n,r,A,k,P,((e,t,r,n,o)=>+((e,t,r,n)=>e<t+n&&e>t-r)(e[r]*n,t[r]*n,o[0],o[1]))),i={centers1:n,centers2:r,faceScores:o,longRange:!1};return{correctWork:c.default.sum(o)/6,totalWork:1,intermediates:i}}),e,t)}})),paramConfigs:[new o.ParamConfig("rightInnerThreshold",u.DEFAULT_FACE_POSITION_INNER_THRESHOLD,{label:"Right (Inner)",...h}),new o.ParamConfig("rightOuterThreshold",u.DEFAULT_FACE_POSITION_OUTER_THRESHOLD,{label:"Right (Outer)",...h}),new o.ParamConfig("leftInnerThreshold",u.DEFAULT_FACE_POSITION_INNER_THRESHOLD,{label:"Left (Inner)",...h}),new o.ParamConfig("leftOuterThreshold",u.DEFAULT_FACE_POSITION_OUTER_THRESHOLD,{label:"Left (Outer)",...h}),new o.ParamConfig("frontInnerThreshold",u.DEFAULT_FACE_POSITION_INNER_THRESHOLD,{label:"Front (Inner)",...h}),new o.ParamConfig("frontOuterThreshold",u.DEFAULT_FACE_POSITION_OUTER_THRESHOLD,{label:"Front (Outer)",...h}),new o.ParamConfig("backInnerThreshold",u.DEFAULT_FACE_POSITION_INNER_THRESHOLD,{label:"Back (Inner)",...h}),new o.ParamConfig("backOuterThreshold",u.DEFAULT_FACE_POSITION_OUTER_THRESHOLD,{label:"Back (Outer)",...h}),new o.ParamConfig("topInnerThreshold",u.DEFAULT_FACE_POSITION_INNER_THRESHOLD,{label:"Top (Inner)",...h}),new o.ParamConfig("topOuterThreshold",u.DEFAULT_FACE_POSITION_OUTER_THRESHOLD,{label:"Top (Outer)",...h}),new o.ParamConfig("bottomInnerThreshold",u.DEFAULT_FACE_POSITION_INNER_THRESHOLD,{label:"Bottom (Inner)",...h}),new o.ParamConfig("bottomOuterThreshold",u.DEFAULT_FACE_POSITION_OUTER_THRESHOLD,{label:"Bottom (Outer)",...h})]}};t.default=p},63226:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.DEFAULT_MAX_STRAY_POINTS=t.DEFAULT_STRAY_POINTS_THRESHOLD=void 0;var n,o=(n=r(298784))&&n.__esModule?n:{default:n},i=r(167469),a=r(297393),s=r(991984);t.DEFAULT_STRAY_POINTS_THRESHOLD=.05;t.DEFAULT_MAX_STRAY_POINTS=10;var l={strayPoints:{taskTypes:[i.TaskType.LidarSegmentation],title:"Stray Points",graderFn:s.gradePerFrameWithContext(((e,t,r,n,{maxStray:i=10,threshold:l=.05},u)=>({annotationOverlap:s.gradeIfNotMissing(((r,n)=>{if(!u)throw new Error("Missing context for stray points grader");const s=a.getPointIntersections(u),[c,d]=o.default.sortBy([r,n],(e=>e.props.response)),f=`${e}_${c.props.response}_${d.props.response}_${c.props.cluster}_${d.props.cluster}`,h=s.get(f)||0,p=t.frames[e]?t.frames[e].numPoints-h:0,m=Math.min(i,l*(t.frames[e]?t.frames[e].numPoints:0));return{correctWork:+(p<m),totalWork:1,intermediates:{incorrectPoints:p,maxIncorrect:m}}}),t,r)})))}};t.default=l},233193:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.LINE_GRADER_MARGIN_THRESHOLD=t.LINE_DISTANCE_MARGIN_THRESHOLD=t.LINE_EP_DISTANCE_THRESHOLD=void 0;var n=r(167469),o=r(440169),i=r(991984),a=r(362508);t.LINE_EP_DISTANCE_THRESHOLD=15;t.LINE_DISTANCE_MARGIN_THRESHOLD=50;t.LINE_GRADER_MARGIN_THRESHOLD=5;var s={endpointDistance:{taskTypes:[n.TaskType.LineAnnotation],title:"Line Endpoint Distance",graderFn:i.gradePerFrame(((e,t,r,{threshold:n=15})=>({endpointDistance:i.gradeIfNotMissing(((e,t)=>{const r=o.calculateEndpointDistance(e.vertices,t.vertices);return{correctWork:+(r<=n),totalWork:1,intermediates:{distance:r}}}),e,t)}))),paramConfigs:[{name:"threshold",label:"Endpoint Distance Threshold",type:"number",defaultValue:15}]},margin:{taskTypes:[n.TaskType.LineAnnotation],title:"Line Margin",graderFn:i.gradePerFrame(((e,t,r,{threshold:n=5,partialCredit:a=!1})=>({margin:i.gradeIfNotMissing(((e,t)=>{if(a){const{numUserPoints:r,numUserPointsInMargin:i,numCorrectPoints:a}=o.getAmountOfLineInMargin(e.vertices,t.vertices,n),s={inMargin:+(i===r)},l=r-i;return{correctWork:Math.max(a-l,0)/a,totalWork:1,intermediates:s}}const r=+o.lineInMargin(e.vertices,t.vertices,n);return{correctWork:r,totalWork:1,intermediates:{inMargin:r}}}),e,t)}))),paramConfigs:[{name:"threshold",label:"Margin Threshold",type:"number",defaultValue:5},{name:"partialCredit",label:"Partial Credit",type:"boolean",defaultValue:!1}]},zCoordMargin:{taskTypes:[n.TaskType.LineAnnotation],title:"GIS Line Margin Z Coordinate Grader",graderFn:i.gradePerFrame(a.zCoordMarginLineLength),paramConfigs:[{name:"zthreshold",label:"Margin Threshold for z coordinate",type:"number",defaultValue:a.Z_LINE_GRADER_MARGIN_THRESHOLD},{name:"xythreshold",label:"Margin Threshold for matching line",type:"number",defaultValue:a.XY_LINE_GRADER_MARGIN_THRESHOLD}]},frechetLineDistance:{taskTypes:[n.TaskType.LineAnnotation],title:"Frechet Line Distance",graderFn:i.gradePerFrame(((e,t,r,{threshold:n=5})=>({frechetDistance:i.gradeIfNotMissing(((e,t)=>{const r=o.discreteFrechetDistance(e.vertices,t.vertices);return{correctWork:+(r<n),totalWork:1,intermediates:{frechetLineDistance:r}}}),e,t)}))),paramConfigs:[{name:"threshold",label:"Frechet Line Distance Threshold",type:"number",defaultValue:5}]}};t.default=s},313220:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.linkingUuidGrader=void 0;var n=r(991984);t.linkingUuidGrader=(e,t)=>({linkingUuid:n.ignoreIfMissing(((e,t)=>{if(!e.is_base_annotation&&!t.is_base_annotation)return{correctWork:0,totalWork:0};if(!e.is_base_annotation||!t.is_base_annotation)return{correctWork:0,totalWork:1};return{correctWork:+(!!e?.uuid&&e.uuid===t?.uuid),totalWork:1}}),e,t)})},804850:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.globalGraderLiteParams=t.defaultMammothMappingParams=void 0;const r={splitTolerance:.1,segmentLinkTolerance:.001,crossSubdivisionThreshold:5,segmentLinkCandidateFcdThreshold:5,maximumSplitSegmentLength:10.3};t.defaultMammothMappingParams=r;const n={...r,maximumSplitSegmentLength:100};t.globalGraderLiteParams=n},662171:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makeGlobalMammothMappingGraderFn=h,t.makeGlobalMammothMappingMatcherFn=g,t.legacyGlobalGrader=t.globalGraderLite=t.globalGrader=void 0;var n,o=r(167469),i=(n=r(298784))&&n.__esModule?n:{default:n},a=r(105879),s=r(604744),l=r(401976),u=r(896888),c=r(991984),d=r(804850);const f=(e,t)=>`mammothMapping${t}${e}`;function h(e){return c.globalGradePerFrame(((t,r)=>{const n=i.default.flatMap(l.ALL_LABELS,(n=>{const o=t.filter((e=>e.label===n)),i=r.filter((e=>e.label===n)),{subdividedSegmentsA:l,subdividedSegmentsB:u}=a.computeCrossDivision(o,i,e);return a.getSegmentMatches(l,u,e).map((e=>s.scoreSegmentMatch(e,n)))})),o=[...i.default.flatMap(l.ALL_LABELS,(e=>l.ALL_ERROR_TYPES.map((t=>{const r=n.filter((t=>t.label===e)),o=u.ERROR_TYPE_LABEL_SEVERITY_MAP[t][e];return s.transformScoresToGlobalScore(r,t,f(t,o),{label:e,graderType:"mammothMapppingGlobal",key:`${e}::${t}`})})))),...i.default.flatMap(l.ALL_SEVERITIES,(e=>l.ALL_ERROR_TYPES.map((t=>{const r=n.filter((r=>u.ERROR_TYPE_LABEL_SEVERITY_MAP[t][r.label]===e));return s.transformScoresToGlobalScore(r,t,f(t,e),{graderType:"mammothMapppingGlobal",label:"mixed",key:f(t,e)})}))))];return i.default.fromPairs(o.map((e=>[e.key,e])))}))}const p=e=>{const t={type:"polyline-fragments",currentId:e.currentId,correctId:e.correctId,props:{label:e.label},rawScoredSegmentMatches:e.scoredSegmentMatches},r=e.currentAnn&&e.correctAnn?"Precision":e.currentAnn?"FalsePositive":"FalseNegative",n=u.ERROR_TYPE_LABEL_SEVERITY_MAP[r][e.label],o=i.default.map(e.scoredSegmentMatches,"score"),a=s.transformScoresToGlobalScore(o,r,f(r,n),{graderType:"mammothMapppingGlobal",label:e.label,key:r});return{metadata:t,currentAnnotation:e.currentAnn,correctAnnotation:e.correctAnn,scores:[a],numFalseNegativeFrames:0,numFalsePositiveFrames:0,numIncorrectTruePositiveFrames:0,numTotalTruePositiveFrames:0}},m=(e,t)=>e?`${t}-${e.uuid}`:`${t}-none`;function g(e){return(t,r)=>{const n=new Map([...t,...r].map((e=>[e.frames[0],e])));n.set(void 0,void 0);const o=t.map((e=>e.frames[0])),u=r.map((e=>e.frames[0]));return i.default.flatMap(l.ALL_LABELS,(t=>{const r=o.filter((e=>e.label===t)),l=u.filter((e=>e.label===t)),{subdividedSegmentsA:c,subdividedSegmentsB:d,segmentToAnnotationMap:f}=a.computeCrossDivision(r,l,e),h=a.getSegmentMatches(c,d,e).map((e=>({score:s.scoreSegmentMatch(e,t),segmentMatch:e}))),p=new Map([...r.map((e=>[m(e,"a"),e])),["a-none",void 0],...l.map((e=>[m(e,"b"),e])),["b-none",void 0]]),g=i.default.groupBy(h,(({segmentMatch:e})=>{const r=e.currentSegment?f.get(e.currentSegment):void 0,n=e.correctSegment?f.get(e.correctSegment):void 0;return JSON.stringify({currentId:m(r,"a"),correctId:m(n,"b"),label:t})}));return i.default.map(g,((e,t)=>{const{currentId:r,correctId:o,label:i}=JSON.parse(t);return{currentId:r,correctId:o,currentAnn:n.get(p.get(r)),correctAnn:n.get(p.get(o)),label:i,scoredSegmentMatches:e}}))})).map(p)}}const y={taskTypes:[o.TaskType.LineAnnotation],title:"(Mammoth GIS Global) Per-class bag-of-segments Line Grader",graderFn:h(d.defaultMammothMappingParams),matcherFn:g(d.defaultMammothMappingParams),global:!0};t.globalGrader=y;const b={taskTypes:[o.TaskType.LineAnnotation],title:"(Mammoth GIS Global Lite) Faster Per-class bag-of-segments Line Grader",graderFn:h(d.globalGraderLiteParams),matcherFn:g(d.globalGraderLiteParams),global:!0};t.globalGraderLite=b;const T={taskTypes:[o.TaskType.LineAnnotation],title:"(Legacy) Per-class bag-of-segments Line Grader",graderFn:h(d.defaultMammothMappingParams),matcherFn:g(d.defaultMammothMappingParams),global:!0};t.legacyGlobalGrader=T},68380:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"mammothMappingGlobal",{enumerable:!0,get:function(){return n.globalGrader}}),Object.defineProperty(t,"nuroLine",{enumerable:!0,get:function(){return n.legacyGlobalGrader}}),Object.defineProperty(t,"mammothMappingLite",{enumerable:!0,get:function(){return n.globalGraderLite}}),Object.defineProperty(t,"mammothMapping",{enumerable:!0,get:function(){return o.legacyLocalGrader}});var n=r(662171),o=r(676116)},676116:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.legacyLocalGrader=t.localMammothMappingGraderFn=void 0;var n,o=r(662171),i=r(167469),a=(n=r(298784))&&n.__esModule?n:{default:n};const s=async(e,t)=>await o.globalGrader.graderFn(a.default.compact([e]),a.default.compact([t]));t.localMammothMappingGraderFn=s;const l={taskTypes:[i.TaskType.LineAnnotation],title:"(Mammoth GIS) Matched pairs segments Line Grader",graderFn:s,global:!1};t.legacyLocalGrader=l},896888:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PRECISION_FCD_THRESHOLDS=t.ERROR_TYPE_LABEL_SEVERITY_MAP=t.INFINITY=void 0;t.INFINITY=1e15;const r={FalsePositive:{"road boundary":"Critical","road boundary (polygon)":"Critical","reversible lane center":"Critical","shared turn lane center":"Critical","vehicle lane center":"Critical","vehicle lane connection":"Critical","traffic line":"Moderate",driveway:"Moderate","dashed odot":"Severe","dashed sdot":"Severe","solid odot":"Severe","solid sdot":"Severe","bicycle lane":"Moderate"},FalseNegative:{"road boundary":"Critical","road boundary (polygon)":"Critical","reversible lane center":"Critical","shared turn lane center":"Critical","vehicle lane center":"Critical","vehicle lane connection":"Critical","traffic line":"Critical",driveway:"Critical","dashed odot":"Severe","dashed sdot":"Severe","solid odot":"Severe","solid sdot":"Severe","bicycle lane":"Moderate"},Precision:{"road boundary":"Critical","road boundary (polygon)":"Critical","reversible lane center":"Critical","shared turn lane center":"Critical","vehicle lane center":"Critical","vehicle lane connection":"Critical","traffic line":"Severe",driveway:"Severe","dashed odot":"Severe","dashed sdot":"Severe","solid odot":"Severe","solid sdot":"Severe","bicycle lane":"Moderate"}};t.ERROR_TYPE_LABEL_SEVERITY_MAP=r;t.PRECISION_FCD_THRESHOLDS={"road boundary":1,"road boundary (polygon)":1,"reversible lane center":2,"shared turn lane center":2,"vehicle lane center":2,"vehicle lane connection":2,"traffic line":2,driveway:1,"dashed odot":1,"dashed sdot":1,"solid odot":1,"solid sdot":1,"bicycle lane":3}},105879:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.computeCrossDivision=t.getSegmentMatches=void 0,r(825555);var n=l(r(298784)),o=l(r(289624)),i=l(r(540742)),a=r(896888),s=r(490503);function l(e){return e&&e.__esModule?e:{default:e}}const u=([{x:e,y:t},{x:r,y:n}],o)=>({x:(1-o)*e+o*r,y:(1-o)*t+o*n});function c(e,t){const r=[];for(let n=0;n<e.length-1;n++){const o=[e[n],e[n+1]],i=s.computeSegmentLength(o),a=Math.ceil(i/t);let l=o[0];for(let e=0;e<a;e++){const t=u(o,(e+1)/a);r.push([l,t]),l=t}}return r}const d=(e,t,r)=>{function o(e){const t=n.default.min(e.map((e=>e.x))),r=n.default.min(e.map((e=>e.y))),o=n.default.max(e.map((e=>e.x))),i=n.default.max(e.map((e=>e.y)));return n.default.flatMap(n.default.range(Math.floor(t/32),Math.floor(o/32)+1),(e=>n.default.range(Math.floor(r/32),Math.floor(i/32)+1).map((t=>640*e+t))))}function a(e){return n.default.range(3).flatMap((t=>n.default.range(3).map((r=>e+640*(t-1)+(r-1)))))}const l=e.map(o),u=t.map(o),c=new Map;l.forEach(((e,t)=>{e.forEach((e=>{c.has(e)||c.set(e,new Set),c.get(e).add(t)}))}));const d=n.default.size(e),f=n.default.size(t),h=[];u.forEach(((o,i)=>{const l=new Set;n.default.flatMap(o,a).forEach((e=>{if(c.has(e))for(const t of c.get(e))l.add(t)}));for(const n of l)s.computeFCD(e[n],t[i])<=r.segmentLinkCandidateFcdThreshold+r.segmentLinkTolerance&&h.push([n,d+i])}));const p=((e,t)=>{const r=new i.default(e);for(const[n,o]of t)r.union(n,o);return r.compile()})(d+f,h);return p.map((e=>({indicesA:e.filter((e=>e<d)),indicesB:e.filter((e=>e>=d)).map((e=>e-d))})))};t.getSegmentMatches=(e,t,r)=>{if(n.default.isEmpty(e)&&n.default.isEmpty(t))return[];const i=d(e,t,r),l=[];i.forEach((i=>{const u=i.indicesA.map((t=>e[t])),c=i.indicesB.map((e=>t[e])),d=((e,t)=>e.map((e=>t.map((t=>s.computeFCD(e,t))))))(u,c),f=((e,t,r,o)=>e.map(((e,i)=>t.map(((t,a)=>{const l=s.computeSegmentLength(e),u=s.computeSegmentLength(t),c=e[1].x-e[0].x,d=e[1].y-e[0].y,f=t[1].x-t[0].x,h=t[1].y-t[0].y,p=Math.abs((c*f+d*h)/(l*u));return r[i][a]>o.segmentLinkCandidateFcdThreshold+o.segmentLinkTolerance?0:n.default.min([l,u])*p*Math.exp(-r[i][a]/o.segmentLinkCandidateFcdThreshold)})))).map((e=>e.map((e=>n.default.isFinite(e)?a.INFINITY-e:0)))))(u,c,d,r),h=f.length>0&&f[0].length>0?(e=>e.length?o.default(e):[])(f).filter((([e,t])=>f[e][t]<a.INFINITY)):[];l.push(...h.map((([e,t])=>[i.indicesA[e],i.indicesB[t]])))}));const u=n.default.times(e.length,(()=>!1)),c=n.default.times(t.length,(()=>!1));for(const[n,o]of l)u[n]=c[o]=!0;return[...l.map((([r,n])=>({currentSegment:e[r],correctSegment:t[n],fcd:s.computeFCD(e[r],t[n])}))),...e.filter(((e,t)=>!u[t])).map((e=>({currentSegment:e}))),...t.filter(((e,t)=>!c[t])).map((e=>({correctSegment:e})))]};t.computeCrossDivision=(e,t,r)=>{const o=[...n.default.flatMap(e,(e=>e.vertices)),...n.default.flatMap(t,(e=>e.vertices))],i=e.map((e=>c(s.projectVerticesOntoPolyline(e.vertices,o,r.crossSubdivisionThreshold,r.splitTolerance),r.maximumSplitSegmentLength))),a=t.map((e=>c(s.projectVerticesOntoPolyline(e.vertices,o,r.crossSubdivisionThreshold,r.splitTolerance),r.maximumSplitSegmentLength)));return{segmentToAnnotationMap:new Map([...n.default.flatMap(i,((t,r)=>t.map((t=>[t,e[r]])))),...n.default.flatMap(a,((e,r)=>e.map((e=>[e,t[r]]))))]),subdividedSegmentsA:n.default.flatten(i),subdividedSegmentsB:n.default.flatten(a)}}},604744:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.transformScoresToGlobalScore=t.scoreSegmentMatch=void 0;var n,o=r(401976),i=r(896888),a=r(490503),s=(n=r(298784))&&n.__esModule?n:{default:n};t.scoreSegmentMatch=(e,t)=>{if(!o.isLabel(t))throw new Error("unknown label: "+t);const{currentSegment:r,correctSegment:n,fcd:s}=e;return{label:t,currentLength:r?a.computeSegmentLength(r):0,correctLength:n?a.computeSegmentLength(n):0,isMatch:!!r&&!!n,isCorrect:!!r&&!!n&&s<=i.PRECISION_FCD_THRESHOLDS[t]}};t.transformScoresToGlobalScore=(e,t,r,n)=>{const o=s.default.sumBy(e,"currentLength"),i=s.default.sumBy(e,"correctLength"),a=s.default.sumBy(s.default.filter(e,"isMatch"),"currentLength"),l=s.default.sumBy(s.default.filter(e,"isMatch"),"correctLength"),u=s.default.sumBy(s.default.filter(e,"isCorrect"),"currentLength");let c,d;if("FalseNegative"===t)c=l,d=i;else if("FalsePositive"===t)c=a,d=o;else{if("Precision"!==t)throw new Error(`Unknown error type ${t}`);c=u,d=a}return{...n,errorType:t,errorTypeWithSeverity:r,numIncorrectFrames:0,numTotalFrames:0,correctWork:c,totalWork:d}}},401976:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isScoredPolylineSegmentsMatchedAnnotations=function(e){return"polyline-fragments"===e?.metadata?.type},t.ALL_ERROR_TYPES=t.ALL_SEVERITIES=t.isLabel=t.ALL_LABELS=void 0;const r=["road boundary","road boundary (polygon)","reversible lane center","shared turn lane center","vehicle lane center","vehicle lane connection","traffic line","driveway","dashed odot","dashed sdot","solid odot","solid sdot","bicycle lane"];t.ALL_LABELS=r;t.isLabel=e=>r.includes(e);t.ALL_SEVERITIES=["Critical","Severe","Moderate"];t.ALL_ERROR_TYPES=["FalseNegative","FalsePositive","Precision"]},190913:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"mammothMappingPolygonGrader",{enumerable:!0,get:function(){return n.mammothMappingPolygonGrader}});var n=r(912140)},290637:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.POLYGON_IOU_THRESHOLD=t.POLYGON_ERROR_TYPE_LABEL_SEVERITY_MAP=void 0;const r={FalsePositive:{intersection:"Severe","keep clear zone":"Moderate","parking area":"Severe","pedestrian crosswalk":"Moderate","road boundary (polygon)":"Critical","speed regulator":"Severe"},FalseNegative:{intersection:"Critical","keep clear zone":"Severe","parking area":"Severe","pedestrian crosswalk":"Critical","road boundary (polygon)":"Critical","speed regulator":"Critical"},Precision:{intersection:"Severe","keep clear zone":"Critical","parking area":"Severe","pedestrian crosswalk":"Critical","road boundary (polygon)":"Critical","speed regulator":"Severe"}};t.POLYGON_ERROR_TYPE_LABEL_SEVERITY_MAP=r;t.POLYGON_IOU_THRESHOLD=.9},912140:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mammothMappingPolygonGrader=t.localMammothMappingPolygonGraderFn=void 0;var n,o=r(167469),i=r(440169),a=(n=r(298784))&&n.__esModule?n:{default:n},s=r(290637),l=r(991984),u=r(105879),c=r(604744),d=r(804850);const f=(e,t)=>`mammothMappingPolygon${s.POLYGON_ERROR_TYPE_LABEL_SEVERITY_MAP[e][t]}${e}`,h=e=>({...e,vertices:[...e.vertices,e.vertices[0]]}),p=(e,t)=>a.default.mapValues((()=>{if(e&&t){const r=e.label;if("road boundary (polygon)"===r)return((e,t)=>{const r=h(e),n=h(t),o=d.defaultMammothMappingParams,{subdividedSegmentsA:i,subdividedSegmentsB:s}=u.computeCrossDivision([r],[n],o),l="road boundary (polygon)",p=u.getSegmentMatches(i,s,o).map((e=>c.scoreSegmentMatch(e,l))),m=a.default.sum(p.map((e=>e.correctLength))),g=a.default.sum(p.filter((e=>e.isCorrect)).map((e=>e.currentLength)));return{[f("Precision",l)]:{correctWork:g,totalWork:m},[f("FalseNegative",l)]:{correctWork:m,totalWork:m}}})(e,t);const n=i.genericIou(e,t),o=i.getPolygonPerimeter(t);return{[f("Precision",r)]:{correctWork:n<s.POLYGON_IOU_THRESHOLD?0:o,totalWork:o},[f("FalseNegative",r)]:{correctWork:o,totalWork:o}}}if(t){const e=t.label,r=i.getPolygonPerimeter(t);return{[f("FalseNegative",e)]:{correctWork:0,totalWork:r}}}{const t=e.label,r=i.getPolygonPerimeter(e);return{[f("FalsePositive",t)]:{correctWork:-r,totalWork:0}}}})(),((e,t)=>({...e,errorType:t,numIncorrectFrames:e.correctWork<e.totalWork?1:0,numTotalFrames:1})));t.localMammothMappingPolygonGraderFn=p;const m={taskTypes:[o.TaskType.PolygonAnnotation],title:"Mammoth GIS Polygon Grader",graderFn:l.gradePerFrame(p,!1,!1,!0),global:!1};t.mammothMappingPolygonGrader=m},247915:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.comparisonGraderFn=t.melonAudioDeviceGraderFn=t.adjustCoefficient=t.melonAudioRankFnGenerator=t.DEFAULT_ACCEPTABLE_DEVICES=void 0;var n,o=(n=r(298784))&&n.__esModule?n:{default:n},i=r(167469),a=r(991984),s=r(222357);const l=r(555956),u=["headphone","headset","airpod","usb audio device"].map((e=>e.toLowerCase()));var c;t.DEFAULT_ACCEPTABLE_DEVICES=u,function(e){e.Pearson="pearson",e.Spearman="spearman",e.Kendall="kendall"}(c||(c={}));const d=(e,t,r)=>(n,i,a)=>{const u=[];n.forEach((e=>{const t=e.field_id,r=e.response[0],n=r.result;if(!a?.questionPrefix||e.field_id.startsWith(a.questionPrefix))if(n===s.GraderResult.Correct){const e=r.given[0],n=f(e);u.push({model:t,expected:n,given:n})}else if(n===s.GraderResult.Incorrect){const e=r;u.push({model:t,expected:f(e.expected[0]),given:f(e.given[0])})}}));const c=new l(u,{expected:"metric",given:"metric"})[t]("expected","given"),d=o.default.get(c,r),p=a?.correlationThreshold,m=isNaN(d)||void 0!==p&&d<p?0:h(d),g=n.length,y={modelScores:u,modelCount:g,metadata:c};return{[a?.questionPrefix?`${e}_${a.questionPrefix}`:e]:{label:`${e} correlation`,correctWork:m,totalWork:1,intermediates:y}}};t.melonAudioRankFnGenerator=d;const f=e=>"string"===typeof e?parseFloat(e):"number"===typeof e?e:NaN,h=e=>(e+1)/2;t.adjustCoefficient=h;const p=(e,t,r,n,i)=>{const a=i?.responseMetadata?.audioDevices||[],s=r?.acceptableDevices||[],l=0===s.length?u:s,c=a.map((e=>e.label)),d=r?.failWhenMissingDevice??!0;let f;if(0===c.length)f=+!d;else{f=+(o.default.intersection(c.map((e=>e.toLowerCase())),l.map((e=>e.toLowerCase()))).length>0)}return{audioDeviceRequirement:{label:"audio device requirement",totalWork:1,correctWork:f,intermediates:{givenDevices:c,acceptableDevices:l}}}};t.melonAudioDeviceGraderFn=p;const m=(e,t,r)=>{const n={};e.forEach((e=>{const t=e.field_id,r=e.response[0],o=r.result;if(o===s.GraderResult.Correct){const e=r.given[0],o=f(e);n[t]=o}else if(o===s.GraderResult.Incorrect){const e=f(r.given[0]);n[t]=e}}));const{operator:i,firstAnnotation:a,secondAnnotation:l}=r,u={"===":(e,t)=>e===t,"!==":(e,t)=>e!==t,">":(e,t)=>e>t,">=":(e,t)=>e>=t,"<":(e,t)=>e<t,"<=":(e,t)=>e<=t};let c=0;o.default.has(u,i)&&u[i](n[a],n[l])&&(c=1);return{comparison:{label:"comparison between categories",totalWork:1,correctWork:c,intermediates:{modelScoresRecord:n}}}};t.comparisonGraderFn=m;var g={melonAudioPearsonRank:{taskTypes:[i.TaskType.TextCollection],title:"melon audio pearson rank",graderFn:a.globalGradePerFrame(d(c.Pearson,"correlationCoefficient","correlationCoefficient")),global:!0},melonAudioSpearmanRank:{taskTypes:[i.TaskType.TextCollection],title:"melon audio spearman rank",graderFn:a.globalGradePerFrame(d(c.Spearman,"spearmansRho","rho")),global:!0},melonAudioKendallRank:{taskTypes:[i.TaskType.TextCollection],title:"melon audio kendall rank",graderFn:a.globalGradePerFrame(d(c.Kendall,"kendallsTau","b.tauB")),global:!0},melonAudioDevice:{taskTypes:[i.TaskType.TextCollection],title:"melon audio device",graderFn:a.globalGradePerFrame(p),global:!0},comparisonGrader:{taskTypes:[i.TaskType.TextCollection],title:"comparion grader",graderFn:a.globalGradePerFrame(m),global:!0}};t.default=g},835802:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.melonImageGrader=void 0;var n,o=(n=r(298784))&&n.__esModule?n:{default:n},i=r(167469),a=r(963494),s=r(991984),l=r(222357);const u=(e,t)=>({melonImage:s.gradeIfNotMissing(((e,t)=>t.type===a.TextCollectionFieldType.Category?{correctWork:o.default.sum(e.response.map((e=>{if(e.result===l.GraderResult.Correct)return 1;if(e.result===l.GraderResult.Incorrect){if(1!==e.given.length||1!==e.expected.length)return 0;const t=Number(e.given[0]),r=Number(e.expected[0]);if(r>0&&t>0)return 1;if(r<0&&t<0)return 1;if(0===r&&t>=-1&&t<=1)return 1}return 0}))),totalWork:t.response.length}:{correctWork:0,totalWork:0}),e,t)});t.melonImageGrader=u;var c=Object.freeze({melonImage:{taskTypes:[i.TaskType.TextCollection],title:"melon image",graderFn:s.gradePerFrame(u)}});t.default=c},410718:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.indexAssignmentDistance=t.timespanIou=t.MultiModalTranscriptionNerAnnotationComponentWeights=t.MultiModalTranscriptionNerAnnotationComponents=t.MULTI_MODAL_TRANSCRIPTION_NER_MATCHING_THRESHOLD=t.MULTI_MODAL_TRANSCRIPTION_TIMESTAMP_GRADING_THRESHOLD=t.MULTI_MODAL_TRANSCRIPTION_TIMESTAMP_MATCHING_THRESHOLD=void 0;var n,o=r(167469),i=r(991984),a=(n=r(298784))&&n.__esModule?n:{default:n};t.MULTI_MODAL_TRANSCRIPTION_TIMESTAMP_MATCHING_THRESHOLD=.4;t.MULTI_MODAL_TRANSCRIPTION_TIMESTAMP_GRADING_THRESHOLD=.8;var s;t.MULTI_MODAL_TRANSCRIPTION_NER_MATCHING_THRESHOLD=.3,t.MultiModalTranscriptionNerAnnotationComponents=s,function(e){e[e.TokenOverlap=0]="TokenOverlap",e[e.LabelAssignment=1]="LabelAssignment",e[e.IndexAssignment=2]="IndexAssignment"}(s||(t.MultiModalTranscriptionNerAnnotationComponents=s={}));const l={[s.TokenOverlap]:.6,[s.LabelAssignment]:.2,[s.IndexAssignment]:.2};t.MultiModalTranscriptionNerAnnotationComponentWeights=l;const u=(e,t)=>{const r=Math.max(e[0],t[0]),n=Math.min(e[1],t[1]);return Math.max(0,n-r)/(Math.max(e[1],t[1])-Math.min(e[0],t[0]))};t.timespanIou=u;const c=(e,t)=>Math.exp(-Math.abs(e-t)/10);t.indexAssignmentDistance=c;const d=e=>(t,r,...n)=>"transcript"===(r?.props.type??t?.props.type)?i.gradePerFrame(e)(t,r,...n):{};var f,h=Object.freeze({multiModalTranscriptionTimestamp:{taskTypes:[o.TaskType.MultiModalTranscription],title:"MultiModalTranscription Timestamp IOU",graderFn:d(((e,t,r,{threshold:n=.8})=>({multiModalTranscriptionTimestamp:i.gradeIfNotMissing(((e,t)=>{const r=u(e.timestamps,t.timestamps);return{correctWork:+(r>=n),totalWork:1,intermediates:{iou:r}}}),e,t)}))),paramConfigs:[{name:"threshold",label:"IoU Threshold",type:"number"}]},multiModalTranscriptionSpeaker:{taskTypes:[o.TaskType.MultiModalTranscription],title:"MultiModalTranscription Speaker Assignment",graderFn:d(((e,t)=>({multiModalTranscriptionSpeaker:i.gradeIfNotMissing(((e,t)=>{return{correctWork:(r=e.speakerIndex??"0",n=t.speakerIndex??"0",r===n?1:0),totalWork:1};var r,n}),e,t)})))},multiModalTranscriptionText:{taskTypes:[o.TaskType.MultiModalTranscription],title:"MultiModalTranscription Text",graderFn:d(((e,t)=>({multiModalTranscriptionText:i.gradeIfNotMissing(((e,t)=>i.gradeFreeText(e.text,t.text,i.TextComparisonMethod.NormalizedLevenshtein)),e,t)})))},multiModalTranscriptionNerText:{taskTypes:[o.TaskType.MultiModalTranscription],title:"MultiModalTranscription NER Text",graderFn:(f=(e,t,r)=>{const n=(e,t)=>{var r,n;return{multiModalTranscriptionNerTextGrader:(r=e,n=t,{correctWork:l[s.TokenOverlap]*i.gradeFreeText(r.text,n.text,i.TextComparisonMethod.NormalizedLevenshtein).correctWork+l[s.LabelAssignment]*(r.label===n.label?1:0)+l[s.IndexAssignment]*c(r.transcriptSectionStart,n.transcriptSectionStart),totalWork:1})}};return a.default.isEmpty(t)?{multiModalTranscriptionNerText:{correctWork:0,totalWork:0}}:a.default.isEmpty(e)?{multiModalTranscriptionNerText:{correctWork:+(a.default.findIndex(t.acceptedAnnotations,(({annotation:e})=>!e))>=0),totalWork:1}}:a.default.isNil(t.text)||a.default.isNil(t.label)||a.default.isNil(t.transcriptSectionStart)||a.default.isNil(t.transcriptSectionEnd)||a.default.isNil(e.text)||a.default.isNil(e.label)||a.default.isNil(e.transcriptSectionStart)||a.default.isNil(e.transcriptSectionEnd)?{multiModalTranscriptionNerText:{correctWork:0,totalWork:0}}:i.gradeForAcceptedAnnotations(e,t,n,r&&r.acceptedAnnotationMatchIndexes)},(e,t,...r)=>"annotation"===(t?.props.type??e?.props.type)?i.gradePerFrame(f)(e,t,...r):{})}});t.default=h},896135:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.gradePerFrameForAnnotations=t.nerRelationshipsGrader=t.nerLabelsGrader=t.endpointGrader=t.nullGrader=void 0;var n,o=(n=r(298784))&&n.__esModule?n:{default:n},i=r(167469),a=r(991984);t.nullGrader=()=>{};const s=(e,t,r)=>{const n=(e,t)=>{var r;var n;return{start:(r=t,{correctWork:+(e.start===r.start),totalWork:1}),end:(n=t,{correctWork:+(e.end===n.end),totalWork:1})}};if(o.default.isEmpty(t)){const e={correctWork:0,totalWork:0};return{start:e,end:e}}if(o.default.isEmpty(e)){const e={correctWork:+(o.default.findIndex(t.acceptedAnnotations,(({annotation:e})=>!e))>=0),totalWork:1};return{start:e,end:e}}return o.default.isNil(t.start)||o.default.isNil(t.end)||o.default.isNil(e.start)||o.default.isNil(e.end)?{start:{correctWork:0,totalWork:0},end:{correctWork:0,totalWork:0}}:a.gradeForAcceptedAnnotations(e,t,n,r&&r.acceptedAnnotationMatchIndexes)};t.endpointGrader=s;const l=(e,t,r)=>{const n=(e,t)=>{var r,n;return{nerLabels:(r=e.label,n=t.label,{correctWork:+(r===n),totalWork:1})}};if(o.default.isEmpty(t)){return{nerLabels:{correctWork:0,totalWork:0}}}if(o.default.isEmpty(e)){return{nerLabels:{correctWork:+(o.default.findIndex(t.acceptedAnnotations,(({annotation:e})=>!e))>=0),totalWork:1}}}return o.default.isNil(t.label)||o.default.isNil(e.label)?{nerLabels:{correctWork:0,totalWork:0}}:a.gradeForAcceptedAnnotations(e,t,n,r&&r.acceptedAnnotationMatchIndexes)};t.nerLabelsGrader=l;const u=(e,t,r,n,i,a)=>{if(o.default.isEmpty(t?.name))return{nerRelationships:{correctWork:0,totalWork:0}};if(o.default.isEmpty(e))return{nerRelationships:{correctWork:0,totalWork:1}};return{nerRelationships:{correctWork:+(!(a.directedRelationshipNames.includes(e.name)&&r?.reversed)&&e.name===t.name),totalWork:1}}};t.nerRelationshipsGrader=u;const c=e=>(t,r,...n)=>"annotation"===(r?.props.type??t?.props.type)?a.gradePerFrame(e)(t,r,...n):{};t.gradePerFrameForAnnotations=c;var d,f=Object.freeze({textEndpoints:{taskTypes:[i.TaskType.NamedEntityRecognition],title:"Text endpoints",graderFn:c(s)},nerLabels:{taskTypes:[i.TaskType.NamedEntityRecognition,i.TaskType.MultiModalTranscription],title:"Text Labels",graderFn:c(l)},nerRelationships:{taskTypes:[i.TaskType.NamedEntityRecognition,i.TaskType.MultiModalTranscription],title:"Text relationships",graderFn:(d=u,(e,t,...r)=>"relationship"===(t?.props.type??e?.props.type)?a.gradePerFrame(d)(e,t,...r):{})}});t.default=f},642101:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.hasCorrectLabels=void 0;var n,o=(n=r(298784))&&n.__esModule?n:{default:n},i=r(991984),a=r(167469),s=r(440169);class l{appendError(e){this.count+=1,this.details.push(e)}toJson(){return{count:this.count,details:this.details}}constructor(){this.count=0,this.details=[]}}const u={small_vehicles:["car_or_van_or_suv","pickup_truck"],large_vehicles:["truck","pickup_truck","trailer","front_of_semi_truck","bendy_bus","rigid_bus","train"],emergency_vehicles:["firetruck","police_car","ambulance"],construction_vehicles:["construction_vehicle"],other_vehicles:["motorcycle","bicycle","bicycle_rack","police_bicycle","police_motorcycle"],pedestrians:["adult_pedestrian","child pedestrian"],"construction_workers_&_police_officers":["police","construction_worker"],animals:["small_animal","large_animal"],others:["stroller","wheelchair","other_pushable_pullable","portable_personal_mobility_vehicle"],movable_objects:["traffic_cone","temporary_traffic_barrier","movable_obstacle_in_road"]},c=o.default.flatMap(u),d={};o.default.forEach(u,((e,t)=>{o.default.forEach(e,(e=>{d[e]=t}))}));const f=["vehicle_activity"],h=["rider_status","emergency_lights","is_directing_traffic"],p=(e,t)=>o.default.get(e,"height",0)>t,m=e=>c.includes(e),g=(e,t=[])=>{if(e.correctLabel!==e.currentLabel)return!1;const r=o.default.get(e.correctAnnotation,"attributes",{}),n=o.default.get(e.currentAnnotation,"attributes",{}),i=o.default.differenceWith(o.default.entries(r),o.default.entries(n),o.default.isEqual);for(const[o]of i)if(!t.includes(o))return!1;return!0};t.hasCorrectLabels=g;const y=e=>e.currentAnnotation&&!e.correctAnnotation&&m(e.currentLabel)?`extra ${e.currentLabel}`:null,b=e=>!e.currentAnnotation&&e.correctAnnotation&&m(e.correctLabel)?`missing ${e.correctLabel}`:null,T=e=>{if(!e.currentAnnotation||!e.correctAnnotation)return null;const t=[];return((e,t)=>{const r=e.currentAnnotation,n=e.correctAnnotation,i=[r.left-n.left,r.top-n.top,r.left+r.width-(n.left+n.width),r.top+r.height-(n.top+n.height)];return o.default.every(i,(e=>Math.abs(e)<t))})(e,2)||t.push("loose bounding box"),g(e,f)||t.push(`incorrect label (${e.currentLabel})`),t.length>0?`${e.correctLabel}: ${t.join(", ")}`:null},v=e=>{const t=p(e.correctAnnotation,40);return e.correctAnnotation&&e.currentAnnotation&&((e=>d[e.currentLabel]!==d[e.correctLabel])(e)&&t||((e,t)=>{const r=o.default.get(e.currentAnnotation,"attributes",{}),n=o.default.get(e.currentAnnotation,"attributes",{}),i=o.default.difference(o.default.entries(r),o.default.entries(n));for(const[o]of i)if(t.includes(o))return!0;return!1})(e,h)&&t||((e,t)=>s.genericIou(e.correctAnnotation,e.currentAnnotation)<t)(e,.7))},x=e=>{const t=e.top,r=e.left,n=e.height,o=e.width,i=[];return i.push({x:r,y:t}),i.push({x:r+o,y:t}),i.push({x:r+o,y:t+n}),i.push({x:r,y:t+n}),i.push({x:r,y:t}),i},_=e=>{const t=o.default.get(e.correctAnnotation,"frames.0");t&&(t.vertices=x(t));const r=o.default.get(e.currentAnnotation,"frames.0");return r&&(r.vertices=x(r)),{correctLabel:o.default.get(e.correctAnnotation,"props.label"),currentLabel:o.default.get(e.currentAnnotation,"props.label"),correctAnnotation:t,currentAnnotation:r}};var M={neutronBox:{taskTypes:[a.TaskType.Annotation],title:"neutron rubric",graderFn:i.globalGradePerFrame(((e,t,{recallThreshold:r=.95,precisionThreshold:n=.95},o)=>{const i=o.map(_),a=new l,s=new l;let u=0;const c=new l,d=new l;let f=0;for(const l of i){l.correctAnnotation&&(u+=1),l.currentAnnotation&&(f+=1);const e=b(l);e&&(p(l.correctAnnotation,40)?a.appendError(e):s.appendError(e));const t=y(l);t&&(p(l.currentAnnotation,40)?c.appendError(t):d.appendError(t));const r=T(l);r&&(v(l)?c.appendError(r):d.appendError(r))}const h=u>0?1-(3*a.count+s.count)/u:+(0===f),m=f>0?1-(3*c.count+d.count)/f:+(0===f);return{recall:{label:"recall",correctWork:+(h>r),totalWork:1,intermediates:{recall:h,"critical false negatives":a.toJson(),"non-critical false negatives":s.toJson(),"total ground truth annotations":u}},precision:{label:"precision",correctWork:+(m>n),totalWork:1,intermediates:{precision:m,"critical errors":c.toJson(),"non-critical errors":d.toJson(),"total annotations":f}}}})),global:!0}};t.default=M},242603:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.pointGraders=t.distanceGrader=t.POINT_DISTANCE_THRESHOLD=void 0;var n=r(440169),o=r(167469),i=r(991984);t.POINT_DISTANCE_THRESHOLD=6;const a={correctWork:0,totalWork:0},s=(e,t,r,{threshold:o=6})=>{return s=t,e?.sensor_id===s?.sensor_id?{pointDistance:i.gradeIfNotMissing(((e,t)=>{const r=n.findDistance(n.vertexToArr(e),n.vertexToArr(t));return{correctWork:+(r<=o),totalWork:1,intermediates:{distance:r}}}),e,t)}:{pointDistance:a};var s};t.distanceGrader=s;const l={pointDistance:{taskTypes:[o.TaskType.PointAnnotation],title:"Distance",graderFn:i.gradePerFrame(s)}};t.pointGraders=l;var u=l;t.default=u},355427:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.splitIntoPolygonLikes=t.polygonIouClampedGrader=t.DEFAULT_PX_MAPPINGS=t.POLYGON_GRADER_MARGIN_THRESHOLD=t.POLYGON_GRADER_IOU_DIFF_THRESHOLD=t.VIDEO_POLYGON_DISTANCE_IOU_THRESHOLD=t.POLYGON_DISTANCE_IOU_THRESHOLD=void 0;var n=r(167469),o=r(991984),i=r(440169),a=r(311311);t.POLYGON_DISTANCE_IOU_THRESHOLD=.6;t.VIDEO_POLYGON_DISTANCE_IOU_THRESHOLD=.3;t.POLYGON_GRADER_IOU_DIFF_THRESHOLD=.9;t.POLYGON_GRADER_MARGIN_THRESHOLD=5;const s=[{min:0,max:5,threshold:.5},{min:5,max:10,threshold:.6}];t.DEFAULT_PX_MAPPINGS=s;const l=(e,t,r,{threshold:n=.9,mappings:a=s})=>({polygonIouClamped:o.gradeIfNotMissing(((e,t)=>{let r=n;try{const e=i.polygonFor(t).getArea(),n=a.filter((t=>t.min<=e&&t.max>e));n.length>0&&(r=n[0].threshold)}catch(o){}try{const n=i.genericIou(e,t);return{correctWork:+(n>=r),totalWork:1,intermediates:{iou:n}}}catch(s){return{correctWork:0,totalWork:1}}}),e,t)});t.polygonIouClampedGrader=l;const u=e=>a.splitPointsByFragment(e.vertices,e.multiple_polygon_vertices).filter((e=>e.length)).map((e=>({vertices:e})));t.splitIntoPolygonLikes=u;var c={polygonIou:{taskTypes:[n.TaskType.PolygonAnnotation,n.TaskType.LidarPolygon],title:"Polygon Intersection-Over-Union",graderFn:o.gradePerFrame(((e,t,r,{threshold:n=.9})=>({polygonIou:o.gradeIfNotMissing(((e,t)=>{try{const r=u(e),o=u(t),a=i.fragmentsIou(r,o);return{correctWork:+(a>=n),totalWork:1,intermediates:{iou:a}}}catch(r){return{correctWork:0,totalWork:1}}}),e,t)}))),paramConfigs:[{name:"threshold",label:"IoU Threshold",type:"number"}]},polygonMargin:{taskTypes:[n.TaskType.PolygonAnnotation,n.TaskType.LidarPolygon],title:"Polygon Margin",graderFn:o.gradePerFrame(((e,t,r,{threshold:n=5})=>({polygonMargin:o.gradeIfNotMissing(((e,t)=>{const r=a.splitPointsByFragment(e.vertices,e.multiple_polygon_vertices),o=a.splitPointsByFragment(t.vertices,t.multiple_polygon_vertices),s=+i.lineListInMargin(i.loopBackToStart(r),i.loopBackToStart(o),n);return{correctWork:s,totalWork:1,intermediates:{inMargin:s}}}),e,t)}))),paramConfigs:[{name:"threshold",label:"Margin Threshold",type:"number",defaultValue:5}]},polygonIouClamped:{taskTypes:[n.TaskType.PolygonAnnotation,n.TaskType.LidarPolygon],title:"Polygon Intersection-Over-Union with clamping by size",graderFn:o.gradePerFrame(l),paramConfigs:[{name:"threshold",label:"default IoU Threshold",type:"number"},{name:"mappings",label:"possible px range to threshold mappings",type:"any"}]}};t.default=c},216383:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.getEdgeAccuracy=t.queryNearestNeighbor=t.kdTreeify=t.getSegmentIouDetail=t.getSegmentIou=void 0;var n,o=r(167469),i=r(991984),a=(n=r(298784))&&n.__esModule?n:{default:n};const s=(e,t)=>l(e,t).iou;t.getSegmentIou=s;const l=(e,t)=>{const r=e.columnMin<=t.columnMax&&e.columnMax>=t.columnMin;if(!(e.rowMin<=t.rowMax&&e.rowMax>=t.rowMin)||!r)return{iou:0,intersection:0};const n=e.intersectionArea(t);if(0===n)return{iou:0,intersection:0};const o=e.unionArea(t);return{iou:o>0?n/o:0,intersection:n}};t.getSegmentIouDetail=l;const u=(e,t)=>({segmentIou:i.gradeIfNotMissing(((e,t)=>{const r=e.segment,n=t.segment,o=s(r,n);return{correctWork:o,totalWork:1,intermediates:{segmentIou:o}}}),e,t)}),c=(e,t=0)=>{const r=e.sort(((e,r)=>e[t]-r[t]));if(0===e.length)return null;const n=Math.floor(r.length/2);return{point:r[n],left:c(r.slice(0,n),t?0:1),right:c(r.slice(n+1),t?0:1)}};t.kdTreeify=c;const d=(e,t)=>(e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1]),f=(e,t,r=null,n=1/0,o=0)=>{if(null===e)return r;let i,a;d(e.point,t)<n&&(r=e.point,n=d(r,t)),t[o]<e.point[o]?(i=e.left,a=e.right):(i=e.right,a=e.left),n=(r=f(i,t,r,n,o?0:1))?d(r,t):1/0;const s=Math.abs(t[o]-e.point[o]);return s*s<n&&(r=f(a,t,r,n,o?0:1)),r};t.queryNearestNeighbor=f;const h=(e,t,r)=>{const n=e.getEdge(),o=t.getEdge(),i=c(o);let a=0,s=0;for(const l of n){const e=f(i,l);e&&(d(l,e)<=r*r&&(a+=1),s+=1)}return s?a/s:0};t.getEdgeAccuracy=h;const p=(e,t)=>{const r=a.default.get(t,"nonCritical",[]),n=e.props.label;return r.includes(n)?.5:1};var m={segmentIou:{taskTypes:[o.TaskType.SegmentAnnotation],title:"Overlap between matching segment annotations",graderFn:(e,t,r,{threshold:n=1}={},o,s)=>{const l=a.default.get(e,"frames.[0]"),c=a.default.get(t,"frames.[0]"),d=a.default.get(s,"frames.[0]"),f="segmentIou",{correctWork:h,totalWork:p}=u(l,c).segmentIou,m=h>=n?1:h,g={errorType:f,rawErrorType:f,correctWork:m,totalWork:p,relativeCorrectWork:m,relativeTotalWork:p,introducedErrorCorrectWork:0,numIncorrectFrames:+(h<n&&p),incorrectFrames:p&&h<n?["0"]:[],numTotalFrames:1,isMissingProp:!l||void 0,isExtraneousProp:!c||void 0};if(!o||!c)return{[f]:g};if(!l){if(d){const{correctWork:e,totalWork:t}=u(d,c).segmentIou,r=e<t;return{[i.getMissingPropErrorType(f)]:Object.assign({},g,{relativeCorrectWork:-1,relativeTotalWork:0,introducedErrorCorrectWork:r?0:-1,isMissingProp:!0})}}return{[i.getMissingPropErrorType(f)]:Object.assign({},g,{relativeCorrectWork:0,relativeTotalWork:1,isMissingProp:!0})}}if(!d)return{[f]:Object.assign({},g,{relativeCorrectWork:h,relativeTotalWork:1})};const y=((e,t,r)=>{const n=t.difference(r),o=r.difference(t),i=e.difference(r),a=r.difference(e),s=i.intersectionArea(n),l=a.intersectionArea(o),u=i.getArea()-s,c=a.getArea()-l,d=t.getArea()||1,f=-(u+c);return{relativeCorrectWork:(s+l+f)/d,relativeTotalWork:(n.getArea()+o.getArea())/d,introducedErrorCorrectWork:f/d}})(l.segment,c.segment,d.segment);return{[f]:Object.assign({},g,y)}},paramConfigs:[{name:"threshold",label:"IOU Threshold",type:"number",defaultValue:1}]},segmentEdgeFScore:{taskTypes:[o.TaskType.SegmentAnnotation],title:"F-Score computed from classifying edge pixels as explainable or not",graderFn:i.gradePerFrame(((e,t,r,n)=>({edgeFScore:i.gradeIfNotMissing(((e,t)=>{const r=e.segment,o=t.segment,i=h(r,o,n?.bandwidth??3),a=h(o,r,n?.bandwidth??3),s=i+a?2*i*a/(i+a):0;return{correctWork:s,totalWork:1,intermediates:{fScore:s}}}),e,t)}))),paramConfigs:[{name:"bandwidth",label:"Edge Width",type:"number",defaultValue:3}]},segmentAnnotationPrecisionRecall:{taskTypes:[o.TaskType.SegmentAnnotation],title:"Per annotation precision recall grader",graderFn:(e,t,r,n,o,i)=>{let s=0,l=0,c=0,d=0;for(const m of i||[]){const e=m.currentAnnotation,t=m.correctAnnotation,n=a.default.get(e,"frames.[0]"),o=a.default.get(t,"frames.[0]");if(!o&&!n)continue;let i=0,f=0,h=0,g=0;const{correctWork:y}=u(n,o).segmentIou;if(o&&!n)i+=1,f+=1;else if(n&&!o)h+=1,g+=1;else if(n&&o&&(i+=1,h+=1,n.label!==o.label?g+=1:g+=1-y,n.attributes||o.attributes)){const e=a.default.union(a.default.keys(n.attributes||{}),a.default.keys(o.attributes||{}));h+=e.length,g+=e.filter((e=>n.attributes?.[e]!==o.attributes?.[e])).length}const b=p(t||e,r);s+=b*i,l+=b*f,c+=b*h,d+=b*g}const f="segmentAnnotationRecall",h="segmentAnnotationPrecision";return{[f]:{errorType:f,correctWork:s-l,totalWork:s,relativeCorrectWork:s-l,relativeTotalWork:s},[h]:{errorType:h,correctWork:c-d,totalWork:c,relativeCorrectWork:c-d,relativeTotalWork:c}}},global:!0},pixelPrecision:{taskTypes:[o.TaskType.SegmentAnnotation],title:"Pixel Precision",graderFn:(e,t,r,n,o,i)=>{const a={errorPixels:0,totalPixels:0};for(const l of i||[]){const e=l.currentAnnotation,t=l.correctAnnotation;if(!t&&!e)continue;const n=p(t||e,r);if(t){if(e)if(t.props.label===e.props.label)a.totalPixels+=t.props.area*n,a.errorPixels+=e.frames[0].segment.difference(t.frames[0].segment).getArea()*n;else{const e=t.props.area*n;a.errorPixels+=e,a.totalPixels+=e}}else{const t=e.props.area*n;a.errorPixels+=t,a.totalPixels+=t}}const s="pixelPrecision";return{[s]:{errorType:s,rawErrorType:s,correctWork:a.totalPixels-a.errorPixels,totalWork:a.totalPixels,relativeCorrectWork:a.totalPixels-a.errorPixels,relativeTotalWork:a.totalPixels,introducedErrorCorrectWork:0}}},global:!0},pixelRecall:{taskTypes:[o.TaskType.SegmentAnnotation],title:"Pixel Recall",graderFn:(e,t,r,n,o,i)=>{const a={totalPixels:0,missingPixels:0};for(const l of i||[]){const e=l.currentAnnotation,t=l.correctAnnotation;if(!t&&!e)continue;const n=p(t||e,r);if(!t)continue;const o=t.props.area*n;a.totalPixels+=o,e||(a.missingPixels=o)}const s="pixelRecall";return{[s]:{errorType:s,rawErrorType:s,correctWork:a.totalPixels-a.missingPixels,totalWork:a.totalPixels,relativeCorrectWork:a.totalPixels-a.missingPixels,relativeTotalWork:a.totalPixels,introducedErrorCorrectWork:0}}},global:!0}};t.default=m},30353:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.sizeChartGrader=void 0;var n,o=(n=r(298784))&&n.__esModule?n:{default:n},i=r(167469),a=r(991984),s=r(222357),l=r(810755);function u(e){return"inch"===e?"in":e}function c(e,t){if(e===t)return!0;if(e.length-t.length===1){let r=0,n=0;for(r=0;r<e.length;r++)e[r]===t[n]&&(n+=1);return r-n<=1}if(t.length-e.length===1){let r=0,n=0;for(r=0;r<t.length;r++)t[r]===e[n]&&(n+=1);return r-n<=1}if(t.length===e.length){let r=0;for(let n=0;n<t.length;n++)t[n]!==e[n]&&(r+=1);return r<=1}return!1}function d(e){return o.default.flatMap(e,(e=>o.default.map(e.conversions,(t=>({label:e.label,conversion:t,sizeGroupingKey:[e.label,t.key,t.value].join("__DELIM__").replace(/ /g,"").toLowerCase()})))))}function f(e){return o.default.flatMap(e,(e=>o.default.map(e.measurements,(t=>({label:e.label,measurement:t,sizeGroupingKey:[e.label,t.measurement,u(t.size_unit_override)].join("__DELIM__").replace(/ /g,"").toLowerCase(),measurementGroupingKey:[t.measurement,u(t.size_unit_override)].join("__DELIM__").replace(/ /g,"").toLowerCase()})))))}function h(e){return o.default.map(e,(e=>e.label))}function p(e){let t=0;t+=d(e.sizes).length;const r=f(e.sizes);return t+=2*o.default.uniqBy(r,"sizeGroupingKey").length,t+=o.default.uniqBy(r,"measurementGroupingKey").length,t}function m(e,t,r){const n=h(e.sizes),i=h(t.sizes),a=o.default.differenceBy(n,i);r.missingLabels+=a.length;const s=o.default.differenceBy(i,n);r.extraneousLabels+=s.length;const l=d(e.sizes),p=d(t.sizes),m=o.default.differenceBy(l,p,"sizeGroupingKey");r.missingConversions+=m.length;const g=o.default.differenceBy(p,l,"sizeGroupingKey");r.extraneousConversions+=g.length;const y=f(e.sizes).sort(),b=f(t.sizes).sort();if(b.length>y.length)r.extraneousMeasurements+=b.length-y.length;else if(b.length<y.length)r.missingMeasurements+=y.length-b.length;else{const e=o.default.difference(y,b),t=o.default.differenceWith(e.map((e=>e.sizeGroupingKey)),b.map((e=>e.sizeGroupingKey)),c),n=o.default.differenceWith(b.map((e=>e.sizeGroupingKey)),e.map((e=>e.sizeGroupingKey)),c);r.missingMeasurements+=t.length,r.extraneousMeasurements+=n.length,r.typosMeasurements+=2*b.length-t.length-n.length}const T=o.default.values(o.default.groupBy([...y,...b],(e=>e.sizeGroupingKey))).filter((e=>e.length>=2));o.default.forEach(T,(([e,t])=>{r.minSizeFloatError+=e&&t&&e.measurement.min_size_float===t.measurement.min_size_float?0:1,r.maxSizeFloatError+=e&&t&&e.measurement.max_size_float===t.measurement.max_size_float?0:1}));const v=o.default.values(o.default.groupBy([...y,...b],(e=>e.measurementGroupingKey)));o.default.forEach(v,(e=>{r.sizeUnitOverride+=1===o.default.uniqBy(e.map((e=>u(e.measurement.size_unit_override))),"size_unit_override").length?0:1}))}const g=(e,t,r,n)=>{const i="sizeChart";l.assertDefined(n);const a=o.default.groupBy(e,"field_id"),u=a.containsSizeChart?.[0];if(!u||o.default.get(u,"response.0.result")!==s.GraderResult.Correct)return{sizeChart:{label:i,correctWork:0,totalWork:20}};if("no"===o.default.get(u,"response.0")||"website_down"===o.default.get(u,"response.0"))return{sizeChart:{label:i,correctWork:20,totalWork:20}};const c={sizeChartName:0,missingConversions:0,extraneousConversions:0,missingMeasurements:0,extraneousMeasurements:0,typosMeasurements:0,missingLabels:0,extraneousLabels:0,minSizeFloatError:0,maxSizeFloatError:0,sizeUnitOverride:0,jsonParseError:0},d=a.size_chart_name??[];for(const l of d)c.sizeChartName+=o.default.get(l,"response.0.result")===s.GraderResult.Correct?0:1;const f=a.json_input??[];for(const l of f)if(o.default.get(l,"response.0.result")!==s.GraderResult.Correct){let e;try{e=JSON.parse(o.default.get(l,"response.0.expected"));m(e,JSON.parse(o.default.get(l,"response.0.given")),c)}catch{c.jsonParseError+=e?p(e):1}}if(c.missingLabels+c.extraneousLabels+c.missingConversions+c.extraneousConversions+c.missingMeasurements+c.extraneousMeasurements+c.sizeUnitOverride>0)return{sizeChart:{label:i,correctWork:0,totalWork:20,intermediates:{errors:c}}};let h=20;return 0!==c.sizeChartName&&(h-=1),0!==c.typosMeasurements&&(h-=1),h-=6*Math.min(c.minSizeFloatError+c.maxSizeFloatError,3),{sizeChart:{label:i,correctWork:Math.max(h,0),totalWork:20,intermediates:{errors:c}}}};t.sizeChartGrader=g;var y=Object.freeze({sizeChart:{taskTypes:[i.TaskType.TextCollection],title:"e-commerse size chart grader",graderFn:a.globalGradePerFrame(g),global:!0}});t.default=y},798921:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.snowberryCqlGraderFn=t.CqlField=void 0;var n,o,i=r(167469),a=r(991984),s=r(222357);t.CqlField=n,function(e){e.IsUnjudgeable="is_unjudgeable",e.PoorVideoQuality="poor_video_quality",e.PoorAudioQuality="poor_audio_quality",e.NegativeCharacteristics="negative_characteristics",e.TypesOfContent="types_of_content"}(n||(t.CqlField=n={})),function(e){e.Unjudgeable="unjudgeable",e.Good="good",e.Bad="bad",e.Debatable="debatable",e.Empty="empty"}(o||(o={}));const l=e=>{if(0===Object.keys(e).length)return o.Empty;const t=e[n.IsUnjudgeable]&&"no"!==e[n.IsUnjudgeable][0],r=e[n.PoorVideoQuality]&&"no"!==e[n.PoorVideoQuality][0],i=e[n.PoorAudioQuality]&&"no"!==e[n.PoorAudioQuality][0],a=e[n.NegativeCharacteristics]&&"none"!==e[n.NegativeCharacteristics][0],s=r||i||a,l=e[n.TypesOfContent]&&"debatable"!==e[n.TypesOfContent][0];return t?o.Unjudgeable:s?o.Bad:l?o.Good:o.Debatable},u=e=>{const{givenResponsesPerField:t,expectedResponsesPerField:r}=(e=>{const t={},r={};return e.forEach((e=>{const n=e.field_id,o=e.response[0],i=o.result;i===s.GraderResult.Correct||i===s.GraderResult.Matched?(t[n]=o.given,r[n]=o.given):(i!==s.GraderResult.Missing&&(t[n]=o.given),i!==s.GraderResult.Extraneous&&(r[n]=o.expected))})),{givenResponsesPerField:t,expectedResponsesPerField:r}})(e);let i=0;const a=l(t),u=l(r),c=((e,t)=>{const r=[n.PoorVideoQuality,n.PoorAudioQuality,n.NegativeCharacteristics,n.TypesOfContent];for(const n of r)if((e[n]?.[0]||t[n]?.[0])&&e[n]?.[0]!==t[n]?.[0])return!1;return!0})(t,r);a===o.Empty?i=0:a===u?i=a!==o.Good&&a!==o.Bad||c?1:.97:a===o.Unjudgeable&&u!==o.Unjudgeable||a!==o.Unjudgeable&&u===o.Unjudgeable?i=.3:a===o.Debatable&&u===o.Good||a===o.Bad&&u===o.Debatable?i=.75:(a===o.Debatable&&u!==o.Debatable||a!==o.Debatable&&u===o.Debatable)&&(i=.5);return{snapCql:{label:"snap cql",totalWork:1,correctWork:i,intermediates:{givenAnswer:a,expectedAnswer:u}}}};t.snowberryCqlGraderFn=u;var c={snowberryCqlGrader:{taskTypes:[i.TaskType.TextCollection],title:"snowberry cql grader",graderFn:a.globalGradePerFrame(u),global:!0}};t.default=c},944129:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.quizGrader=t.entityExtraneousFn=t.modifierGrader=t.textGrader=t.priceGrader=void 0;var n,o=(n=r(298784))&&n.__esModule?n:{default:n},i=r(167469),a=r(991984),s=r(524183),l=r(513254),u=r(222357),c=r(963494),d=r(934788);const f=(e,t,r)=>n=>{if(!n||0===n.response.length)return u.IGNORED_GRADER_OUTPUT;const o=n.response[0];return o.result===u.GraderResult.Correct?e(o.given,o.given):o.result===u.GraderResult.Incorrect?e(o.given,o.expected):o.result===u.GraderResult.Missing?t?t(o.expected):u.MISSING_GRADER_OUTPUT:o.result===u.GraderResult.Extraneous&&r?r(o.given):u.IGNORED_GRADER_OUTPUT},h=e=>parseFloat(e)||0,p=(e,t,r,n)=>{const o=(e,t)=>({correctWork:+(h(e)===h(t)),totalWork:1}),i=e=>({correctWork:+(0===h(e)),totalWork:1}),a=n?.parentGiven?"_parentGiven":"";return{[`itemPrice${a}`]:d.gradeIfFieldMatch(["item_price","price_value"],f(o,i))(e,t),[`optionPrice${a}`]:d.gradeIfFieldMatch(["option_price"],f(o,i))(e,t)}};t.priceGrader=p;const m=e=>e.trim().toLowerCase(),g=(e,t)=>({menuText:d.gradeIfTypeMatch(c.TextCollectionFieldType.Text,f(((e,t)=>a.gradeFreeText(m(e),m(t),a.TextComparisonMethod.Levenshtein))))(e,t)});t.textGrader=g;const y=(e,t,r,n)=>{const o=(e,t)=>({correctWork:+(h(e)===h(t)),totalWork:1}),i=(e,t)=>({correctWork:-d.redundantDifference(e,t||[]).length,totalWork:0}),a=n?.parentGiven?"_parentGiven":"";return{[`extraMin${a}`]:d.gradeIfFieldMatch(["extra_min"],f(o))(e,t),[`extraMax${a}`]:d.gradeIfFieldMatch(["extra_max"],f(o))(e,t),[`extraFree${a}`]:d.gradeIfFieldMatch(["extra_free"],f(o))(e,t),[`extraNumChoice${a}`]:d.gradeIfFieldMatch(["extra_num_choice"],f(o))(e,t),[`itemDefaultOptionsCount${a}`]:d.gradeIfFieldMatch(["item_default_options"],f(((e,t)=>({correctWork:d.redundantIntersection(e,t).length,totalWork:t.length})),(e=>({correctWork:0,totalWork:e.length}))))(e,t),[`itemDefaultOptionsExtraneous${a}`]:d.gradeIfFieldMatch(["item_default_options"],f(i,(()=>({correctWork:0,totalWork:0})),i))(e,t)}};t.modifierGrader=y;const b=()=>u.CORRECT_GRADER_OUTPUT,T=(e,t)=>(r,n)=>({[`${t}Count`]:d.gradeIfFieldMatch([e],f(b))(r,n)}),v=e=>{if(!e)return!1;const t=e.frames[0].response;return 0!==t.length&&t[0].result!==u.GraderResult.Missing},x=(e,t)=>async(r,n,o,i,a,l)=>{const u=`${t}Extraneous${l?.props?.grandParentGiven?"_parentGiven":""}`;if(r&&e===r.props.label||n&&e===n.props.label||l&&e===l.props.label){const e=await s.extraneousGrader(v(r)?r:void 0,v(n)?n:void 0,o,i,a,v(l)?l:void 0);return e.extraneous.errorType=u,{[u]:e.extraneous}}return{}};t.entityExtraneousFn=x;const _=(e,t)=>{const r=d.gradeIfFieldLike(["Question"],l.singleGraderFn)(e,t);return{[`${t?.field_id}`]:r}};t.quizGrader=_;const M={dragonfruitCategoryCount:{taskTypes:[i.TaskType.TextCollection],title:"Number of categories",graderFn:a.gradePerFrame(T("category_name","category"))},dragonfruitItemCount:{taskTypes:[i.TaskType.TextCollection],title:"Number of items",graderFn:a.gradePerFrame(T("item_name","item"))},dragonfruitItemPriceLabelCount:{taskTypes:[i.TaskType.TextCollection],title:"Number of item price labels",graderFn:a.gradePerFrame(T("price_label","itemPrice"))},dragonfruitExtraCount:{taskTypes:[i.TaskType.TextCollection],title:"Number of extras",graderFn:a.gradePerFrame(T("extra_name","extra"))},dragonfruitOptionCount:{taskTypes:[i.TaskType.TextCollection],title:"Number of options",graderFn:a.gradePerFrame(T("option_name","option"))}},A={dragonfruitCategoryExtraneous:{taskTypes:[i.TaskType.TextCollection],title:"Extraneous categories",graderFn:x("category_name","category")},dragonfruitItemExtraneous:{taskTypes:[i.TaskType.TextCollection],title:"Extraneous items",graderFn:x("item_name","item")},dragonfruitItemPriceLabelExtraneous:{taskTypes:[i.TaskType.TextCollection],title:"Extraneous item price labels",graderFn:x("price_label","itemPrice")},dragonfruitExtraExtraneous:{taskTypes:[i.TaskType.TextCollection],title:"Extraneous extras",graderFn:x("extra_name","extra")},dragonfruitOptionExtraneous:{taskTypes:[i.TaskType.TextCollection],title:"Extraneous options",graderFn:x("option_name","option")}};var k={dragonfruitPrice:{taskTypes:[i.TaskType.TextCollection],title:"Menu price",graderFn:d.textCollectionGradePerFrame(p)},dragonfruitText:{taskTypes:[i.TaskType.TextCollection],title:"Transcription text",graderFn:d.textCollectionGradePerFrame(g)},dragonfruitModifier:{taskTypes:[i.TaskType.TextCollection],title:"Entry modifiers",graderFn:d.textCollectionGradePerFrame(y)},...M,dragonfruitEntityCount:{taskTypes:[i.TaskType.TextCollection],title:"Number of menu entries",graderFn:d.textCollectionGradePerFrame(((e,t,r,n)=>{const o=n?.grandParentGiven?"_parentGiven":"";return{[`categoryCount${o}`]:d.gradeIfFieldMatch(["category_name"],f(b))(e,t),[`itemCount${o}`]:d.gradeIfFieldMatch(["item_name"],f(b))(e,t),[`itemPriceLabelCount${o}`]:d.gradeIfFieldMatch(["price_label"],f(b))(e,t),[`extraCount${o}`]:d.gradeIfFieldMatch(["extra_name"],f(b))(e,t),[`optionCount${o}`]:d.gradeIfFieldMatch(["option_name"],f(b))(e,t)}}))},...A,dragonfruitExtraneous:{taskTypes:[i.TaskType.TextCollection],title:"Extraneous entries",graderFn:async(...e)=>{const t=await Promise.all([x("category_name","category")(...e),x("item_name","item")(...e),x("price_label","itemPrice")(...e),x("extra_name","extra")(...e),x("option_name","option")(...e)]);return o.default.merge(t)}},dragonfruitQuizGrader:{taskTypes:[i.TaskType.TextCollection],title:"Quiz Categorization Question",graderFn:d.textCollectionGradePerFrame(_)}};t.default=k},513254:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shouldGradeField=D,t.default=t.textCollectionGraders=t.categoryDistanceGrader=t.getCategoryScoreByDistance=t.DecayFunction=t.tokenIOUTextGrader=t.clampedEditDistanceFallbackFn=t.numericValueFallbackFn=t.singleGraderFn=t.categoryFieldFullPathGrader=t.calculatePrecisionMultiSelectFullPathScore=t.calculateIOUMultiSelectFullPathScore=t.computeTranscriptionEntitiesScore=t.extractTranscriptionEntities=t.checkTranscriptionEntitiesFormatting=t.categoryFieldLeafGrader=t.gradeByMatchingResult=t.multiSelectConfirmationRateGradingWeights=t.TextParamKey=void 0;var n,o=d(r(298784)),i=r(167469),a=d(r(952256)),s=r(963494),l=r(991984),u=r(934788),c=r(222357);function d(e){return e&&e.__esModule?e:{default:e}}t.TextParamKey=n,function(e){e.CaseInsensitive="caseInsensitive",e.AlphaNumericOnly="alphaNumericOnly",e.Trim="trim",e.SkipEmpty="skipEmpty",e.IgnoreCurlyQuotes="ignoreCurlyQuotes"}(n||(t.TextParamKey=n={}));const f={[n.CaseInsensitive]:u.safeToLowerCase,[n.AlphaNumericOnly]:u.safeAlphaNum,[n.Trim]:u.safeTrim,[n.IgnoreCurlyQuotes]:u.safeIgnoreCurlyQuotes},h={missing:1,extraneous:0};t.multiSelectConfirmationRateGradingWeights=h;const p=e=>{if(void 0!==e.result){if(e.result===c.GraderResult.Missing)return e.expected;if(e.result===c.GraderResult.Correct||e.result===c.GraderResult.Incorrect||e.result===c.GraderResult.Extraneous)return e.given;throw new Error(`Unexpected grader result: ${JSON.stringify(e)}`)}return e},m=e=>e.map(p),g=(e,t)=>(r,n)=>r&&0!==r.response.length?o.default.every(r.response,(e=>e.result===c.GraderResult.Missing))?c.MISSING_GRADER_OUTPUT:e(r,n,void 0,t):c.IGNORED_GRADER_OUTPUT;t.gradeByMatchingResult=g;const y=(e,t)=>(t?.forEach((t=>{e=e.map(f[t]??o.default.identity)})),e),b=(e,t)=>({correctWork:o.default.sum(e.response.map((e=>e.result===c.GraderResult.Correct?1:e.result===c.GraderResult.Incorrect?u.redundantIou(e.expected,e.given):0))),totalWork:t.response.length});t.categoryFieldLeafGrader=b;const T=(e,t)=>{const r=Object.keys(t),n=o.default.compact(Object.values(t));let i=0,a=0;for(const o of e)if(r.includes(o)){if(i+=1,i>=a+2)return!1;t[o]||(a+=1)}else if(n.includes(o)&&(a+=1,a>i))return!1;return!0};t.checkTranscriptionEntitiesFormatting=T;const v=(e,t)=>{const r=Object.keys(t).filter((e=>t[e])),n=[];let i,a;for(let s=0;s<e.length;s++){const l=e[s];if(r.includes(l)&&(a=s,i=l),!o.default.isNil(i)&&!o.default.isNil(a)&&t[i]===l){const t=o.default.map(e.slice(a+1,s).split(","),(e=>e.trim()));n.push(t),i=null,a=null}}return n};t.extractTranscriptionEntities=v;const x=(e,t,r)=>{const n=v(e,r),o=v(t,r);return{correctWork:u.redundantListOfList(n,o,u.redundantIou),totalWork:n.length}};t.computeTranscriptionEntitiesScore=x;const _=e=>o.default.flatten(o.default.values(e||{}).map((e=>e.values))),M=e=>o.default.mapValues(e||{},(e=>e.values)),A=(e,t,r)=>{const n=[];o.default.forOwn(e,((e,i)=>{o.default.forOwn(t,((t,o)=>{const a=((e,t,r)=>{const{incorrectPath:n,partialPath:o}=r,i=u.redundantIntersection(e,t),a=Math.max(e.length,t.length);let s=i.length/a;return k(s)||(s*=n),e.length<t.length&&(s*=o),s})(e,t,r);n.push({actualChoice:i,expectedChoice:o,score:a})}))}));return o.default.sortBy(n,(({score:e})=>e))},k=e=>1===e,P=(e,t,r)=>{const n=r?.missing??1,i=r?.extraneous??1,a=new Set,s=new Set,l=new Set;o.default.forOwn(e,((e,t)=>e.forEach((e=>{a.add(e),l.add(e)})))),o.default.forOwn(t,((e,t)=>e.forEach((e=>{s.add(e),l.add(e)}))));let u=0,c=0;return l.forEach((e=>{a.has(e)&&!s.has(e)?c+=i:s.has(e)&&!a.has(e)?c+=n:(u+=1,c+=1)})),u===c?1:u/c};t.calculateIOUMultiSelectFullPathScore=P;const E=(e,t=">")=>{const r={};for(const n of e){const e=n.split(t).map((e=>e.trim())),o=[];for(let r=0;r<e.length;r++){const n=e.slice(0,r+1).join(` ${t} `);o.push(n)}r[n]=o}return r},I=(e,t,r)=>{if(o.default.isEqual(Object.keys(e),Object.keys(t)))return 1;const n=o.default.isEmpty(e),i=o.default.isEmpty(t);if(n&&i)return 1;if(n!==i)return 0;const a=r?.pathHierarchyDelimiter?E(Object.keys(e),r?.pathHierarchyDelimiter):e,s=r?.pathHierarchyDelimiter?E(Object.keys(t),r?.pathHierarchyDelimiter):t,l=(e=>{const t={};return e.forEach(((e,r)=>{t[e]=r+1})),t})(Object.values(s).flat()),u={},c=r&&r.tiers?Object.fromEntries(Object.entries(r.tiers).map((([e,t])=>[Number(e),t]))):{},d=r&&r.tiers?o.default.max(Object.keys(c).map(Number)):1;for(const[o,f]of Object.entries(a)){let e=null;if(s[o])e=1;else{let t=0,n=0;for(let r=0;r<f.length;r++){const o=r+1,i=c[Math.min(o,d)]??1;l[f[r]]&&(t++,e=i),n++}r&&r.tiers||(e=t/n)}u[o]=e||0}return o.default.mean(Object.values(u))??0};t.calculatePrecisionMultiSelectFullPathScore=I;const L=(e,t,r,n)=>({correctWork:o.default.sum(e.response.map((e=>{if(e.result===c.GraderResult.Correct)return 1;if(e.result===c.GraderResult.Incorrect){const r=M(e.categoryMetadata?.given),i=t.fullPaths?t.fullPaths:e.categoryMetadata?.expected,a=M(i);switch(n?.strategy){case s.TextCollectionFullPathGradingStrategy.WeightedMultiSelect:{const e=n?.weights,t=((e,t,r)=>{const{perChoiceBase:n,perChoiceError:i,missing:a,extraneous:s}=r,l=A(e,t,r),u=o.default.cloneDeep(e),c=o.default.cloneDeep(t),d=[],f=o.default.sum(n.slice(0,o.default.size(t)));for(;!o.default.isEmpty(u)&&!o.default.isEmpty(c);){const e=l.pop();if(!e)break;const{actualChoice:t,expectedChoice:r,score:o}=e,a=d.length;if(t in u&&r in c){delete u[t],delete c[r];let e=o*n[a];k(o)||(e+=(1-o)*i[a]),d.push({actualChoice:t,expectedChoice:r,weightedScore:e})}}let h=o.default.sumBy(d,(({weightedScore:e})=>e)),p=0,m=0;o.default.isEmpty(c)?o.default.isEmpty(u)||(m=s*o.default.size(u)):p=a*o.default.size(c),h+=p+m;const g=h/f;return Math.max(g,0)})(r,a,e);return t}case s.TextCollectionFullPathGradingStrategy.IOUMultiSelect:{const e=n?.iouWeights;return P(r,a,e)}case s.TextCollectionFullPathGradingStrategy.PrecisionMultiSelect:{const e=n?.precisionWeights;return I(r,a,e)}default:{const r=_(e.categoryMetadata?.given),n=t.fullPaths?_(t.fullPaths):_(e.categoryMetadata?.expected),o=Math.max(n.length,r.length);return 0!==o?u.redundantIntersection(n,r).length/o:0}}}return 0}))),totalWork:t.response.length});t.categoryFieldFullPathGrader=L;const w=e=>`${e.year}-${e.month}-${e.day} ${e.hour}:${e.minute}`,C=(e,t,r,n)=>{const i=m(e.response),a=m(t.response);return n?.checkExactOrder?{correctWork:Number(o.default.isEqual(i,a)),totalWork:1}:a.length?n?.kendallsTau?function(e,t){let r=0;try{const n=t.map((e=>"null"===e?-1:e.includes(",")?e.split(",").map((e=>Number(e))).sort().map((e=>`${e}`)):e)).flat().map((e=>Number(e))),o=e.map((e=>"null"===e?-1:e.includes(",")?e.split(",").map((e=>Number(e))).sort().map((e=>`${e}`)):e)).flat().map((e=>Number(e))).map((e=>n.indexOf(e)+1));let i=0,a=0;for(const[e,t]of o.entries())for(const r of o.slice(e+1,o.length))t<r&&(i+=1),t>r&&(a+=1);r=Math.abs((i-a)/(i+a))}catch(n){throw new Error(`Error in evalKendallsTau: ${n}`)}isNaN(r)&&(r=0);return{correctWork:r,totalWork:1}}(i,a):function(e,t,r){const n=t.length,i=[...Array(n).keys()],a=new Map;i.forEach((e=>{a.set(t[e],Math.pow(n-e,2))}));const s=o.default.sum(i.map((t=>(a.get(e[t])??0)/(t+1)))),l=o.default.sum(i.map((e=>(a.get(t[e])??0)/(e+1))));return{correctWork:Math.pow(s/l,r),totalWork:1}}(i,a,n?.ndcgPenalty??2):{correctWork:0,totalWork:0}};const F=(e,t,r,i)=>{const a=t.type;if(e.type!==a)throw new Error(`Inconsistent original and correct annotation types: ${e.type} vs ${a}`);switch(a){case s.TextCollectionFieldType.TranscriptionText:return((e,t)=>{const r=o.default.head(m(t.response)),n=t.tags,i=o.default.head(m(e.response));return T(r,n)&&T(i,n)?x(r,i,n):{correctWork:0,totalWork:0}})(e,t);case s.TextCollectionFieldType.Text:case s.TextCollectionFieldType.Number:case s.TextCollectionFieldType.Select:case s.TextCollectionFieldType.Autocomplete:case s.TextCollectionFieldType.QueryableTextAndResults:case s.TextCollectionFieldType.JSON:case s.TextCollectionFieldType.Boolean:case s.TextCollectionFieldType.Markdown:return((e,t,r,i)=>{const a=m(t.response),s=m(e.response),l=i?.fieldTextParams?.[e.field_id],c=o.default.keys(o.default.pickBy(l,o.default.identity)),d=y(a,c),f=y(s,c);return c.includes(n.SkipEmpty)&&o.default.every(f,o.default.isEmpty)&&o.default.every(d,o.default.isEmpty)?{correctWork:0,totalWork:0}:{correctWork:u.redundantIou(d,f),totalWork:1}})(e,t,0,i);case s.TextCollectionFieldType.Category:return b(e,t);case s.TextCollectionFieldType.Datetime:return((e,t)=>{const r=m(e.response).map(w),n=m(t.response).map(w);return{correctWork:u.redundantIou(n,r),totalWork:1}})(e,t);case s.TextCollectionFieldType.TimeRange:return((e,t)=>({correctWork:o.default.sum(t.response.map(((t,r)=>u.redundantIou(p(t),p(e.response[r])||[])))),totalWork:t.response.length}))(e,t);case s.TextCollectionFieldType.RankingOrder:return C(e,t,r,i);case s.TextCollectionFieldType.BoundingBox:case s.TextCollectionFieldType.Code:case s.TextCollectionFieldType.WorkspaceContainer:case s.TextCollectionFieldType.FileUpload:case s.TextCollectionFieldType.WfeButton:return{correctWork:0,totalWork:0}}};t.singleGraderFn=F;const O=(e,t,r,n)=>{const i=t.type;if(e.type!==i)throw new Error(`Inconsistent original and correct annotation types: ${e.type} vs ${i}`);if(n?.tolerance&&i===s.TextCollectionFieldType.Text){const r=Number(o.default.head(m(e.response))),i=Number(o.default.head(m(t.response)));if(!isNaN(r)&&!isNaN(i)){const e=Math.abs(r-i);return{correctWork:Math.max(n.tolerance-e,0)/n.tolerance,totalWork:1}}}return F(e,t,r,n)};t.numericValueFallbackFn=O;const S=(e,t,r,n)=>{const i=t.type;if(e.type!==i)throw new Error(`Inconsistent original and correct annotation types: ${e.type} vs ${i}`);if(i===s.TextCollectionFieldType.TranscriptionText||i===s.TextCollectionFieldType.Text||i===s.TextCollectionFieldType.Autocomplete){const r=o.default.head(m(e.response)).replace(/\W/g,"").toLowerCase(),n=o.default.head(m(t.response)).replace(/\W/g,"").toLowerCase();if(0===n.length)return{correctWork:0===r.length?1:0,totalWork:1};const i=a.default(r,n);if(i>=n.length)return{correctWork:0,totalWork:1};const s=(n.length-i)/n.length;return{correctWork:Math.pow(s,n.length<=20?4:3),totalWork:1}}if(i===s.TextCollectionFieldType.Number){const r=Number(o.default.head(m(e.response))),n=Number(o.default.head(m(t.response)));if(!isNaN(r)&&!isNaN(n)){const e=Math.abs(r-n);return{correctWork:Math.pow(2,-e),totalWork:1}}}return F(e,t,r,n)};function D(e,t,r){return!r&&!(!o.default.isNil(t)&&!o.default.includes(t,e))}t.clampedEditDistanceFallbackFn=S;const N=(e,t,r,n)=>{const o=t.type;if(e.type!==o)throw new Error(`Inconsistent original and correct annotation types: ${e.type} vs ${o}`);const i=r?.fieldsWhitelist||n?.fieldsWhitelist;if(o!==s.TextCollectionFieldType.Text&&o!==s.TextCollectionFieldType.Autocomplete||i&&!i.includes(t.field_id)||e.fieldWasReadOnly)return{correctWork:0,totalWork:0};{if(!Array.isArray(e.response)||!Array.isArray(t.response))return{correctWork:0,totalWork:0};const n=p(e.response[0]),o=p(t.response[0]),i=r?.redundant?l.TextComparisonMethod.TokenIOURedundant:l.TextComparisonMethod.TokenIOU;return l.gradeFreeText(n,o,i)}},R=(e,t,r,n,i,a)=>{const u=n?.fieldsWhitelist||a?.fieldsWhitelist;if(!t||o.default.isEmpty(t)||t.type!==s.TextCollectionFieldType.Text||u&&!u.includes(t.field_id)||e.fieldWasReadOnly){return{tokenIOUText:{correctWork:0,totalWork:0}}}if(o.default.isEmpty(e)||e?.response[0].result===c.GraderResult.Missing){return{tokenIOUText:{correctWork:+(o.default.findIndex(t.acceptedAnnotations,(({annotation:e})=>!e))>=0),totalWork:1}}}return l.gradeForAcceptedAnnotations(e,t,((e,t)=>({tokenIOUText:N(e,t,n)})),r&&r.acceptedAnnotationMatchIndexes)};var G;t.tokenIOUTextGrader=R,t.DecayFunction=G,function(e){e.Linear="linear",e.Constant="constant",e.CustomSteps="custom_steps"}(G||(t.DecayFunction=G={}));const W=(e,t,r)=>{const n=r?.maxAcceptableDistance||0,i=r?.valueMap||{};if(1!==e.length||1!==t.length||n<0||o.default.isBoolean(e[0])||o.default.isBoolean(t[0]))return 0;const a=e[0],s=t[0],l=o.default.isNil(i[a])?""===a?-1/0:Number(a):i[a],u=o.default.isNil(i[s])?""===s?-1/0:Number(s):i[s],c=Math.abs(l-u);if(c>n)return 0;if(0===n)return l===u?1:0;if(r?.decayFunction===G.Constant)return 1;if(r?.decayFunction===G.CustomSteps){const e=Math.floor(c),t=r?.steps??[];return e>=t.length?0:t[e]}return 1-c/n};t.getCategoryScoreByDistance=W;const B=(e,t,r,n,i,a)=>({categoryDistance:l.gradeIfNotMissing(((e,t)=>[s.TextCollectionFieldType.Category,s.TextCollectionFieldType.Number,s.TextCollectionFieldType.Autocomplete].includes(t.type)&&D(t.field_id,n?.fieldsWhitelist||a?.fieldsWhitelist,!!e.fieldWasReadOnly)?{correctWork:o.default.sum(e.response.map((e=>e.result===c.GraderResult.Correct?1:e.result===c.GraderResult.Incorrect?t.type===s.TextCollectionFieldType.Category?W(e.expected,e.given,n):W([e.expected],[e.given],n):0))),totalWork:t.response.length}:{correctWork:0,totalWork:0}),e,t)});t.categoryDistanceGrader=B;const j=Object.freeze({textCollection:{taskTypes:[i.TaskType.TextCollection],title:"text content",graderFn:l.gradePerFrame(((e,t,r,n,o,i)=>({textFieldContent:l.gradeIfNotMissing(((e,t)=>D(t.field_id,n?.fieldsWhitelist||i?.fieldsWhitelist,!!e.fieldWasReadOnly)?g(F,n)(e,t):{correctWork:0,totalWork:0}),e,t)})))},textCategoryFullChoicePath:{taskTypes:[i.TaskType.TextCollection],title:"full choice path",graderFn:l.gradePerFrame(((e,t,r,n,i,a)=>{const u=n?.fieldsWhitelist||a?.fieldsWhitelist,c=o.default.isEqual(n?.iouWeights,h);return l.gradeForAcceptedAnnotations(e,t,((e,t)=>{return{["fullChoicePath"+(c?"ConfirmationRate":"")]:(r=e,i=t,i.type!==s.TextCollectionFieldType.Category||!o.default.isNil(u)&&!u.includes(r.field_id)||r.fieldWasReadOnly?{correctWork:0,totalWork:0}:g(L,n)(r,i))};var r,i}),r&&r.acceptedAnnotationMatchIndexes)}))},tokenIOUText:{taskTypes:[i.TaskType.TextCollection],title:"token iou text grader",graderFn:l.gradePerFrame(R)},gradientGrader:{taskTypes:[i.TaskType.TextCollection],title:"gradient grader",graderFn:l.gradePerFrame(((e,t,r,n,i,a)=>({textFieldContent:l.gradeIfNotMissing(((e,t)=>{if(D(t.field_id,n?.fieldsWhitelist||a?.fieldsWhitelist,!!e.fieldWasReadOnly)){let r={gradientList:["1","2","3","4","5"],fieldsWhitelist:[]};return n&&(r=n),(e=>(t,r)=>{if(!t||0===t.response.length||!r||0===r.response.length)return c.IGNORED_GRADER_OUTPUT;if(o.default.every(t.response,(e=>e.result===c.GraderResult.Missing)))return c.MISSING_GRADER_OUTPUT;const n=e.gradientList,i=t.response.length,a=t.response.map((e=>{if("correct"===e.result)return 1;const t=o.default.get(e,"given.0",null),r=o.default.get(e,"expected.0",null);if(r&&t){if(!n.includes(t)||!n.includes(r))return 0;const e=1-Math.abs(n.indexOf(t)-n.indexOf(r))/((n.length-1)/2);return Math.max(0,e)}return 0}));return{correctWork:o.default.sum(a),totalWork:i}})(r)(e,t)}return{correctWork:0,totalWork:0}}),e,t)})))},rankingOrderFieldGrader:{taskTypes:[i.TaskType.TextCollection],title:"ranking order field grader",graderFn:l.gradePerFrame(((e,t,r,n,o,i)=>({textFieldContent:l.gradeIfNotMissing(((e,o)=>D(o.field_id,n?.fieldsWhitelist||i?.fieldsWhitelist,!!e.fieldWasReadOnly)&&t?.type===s.TextCollectionFieldType.RankingOrder?g(C,n)(e,o,r,n):{correctWork:0,totalWork:0}),e,t)})))},clampedEditDistanceWithFallback:{taskTypes:[i.TaskType.TextCollection],title:"clamped alphanumeric edit distance grader that falls back to textcollection",graderFn:l.gradePerFrame(((e,t,r,n,o,i)=>({textFieldContent:l.gradeIfNotMissing(((e,t)=>D(t.field_id,n?.fieldsWhitelist||i?.fieldsWhitelist,!!e.fieldWasReadOnly)?g(S,n)(e,t):{correctWork:0,totalWork:0}),e,t)})))},numericValueWithFallback:{taskTypes:[i.TaskType.TextCollection],title:"numeric value grader that falls back to textcollection",graderFn:l.gradePerFrame(((e,t,r,n,o,i)=>({textFieldContent:l.gradeIfNotMissing(((e,t)=>D(t.field_id,n?.fieldsWhitelist||i?.fieldsWhitelist,!!e.fieldWasReadOnly)?g(O,n)(e,t):{correctWork:0,totalWork:0}),e,t)})))},categoryDistance:{taskTypes:[i.TaskType.TextCollection],title:"category distance",graderFn:l.gradePerFrame(B)}});t.textCollectionGraders=j;var U=j;t.default=U},909452:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(167469),o=r(991984);var i=Object.freeze({transcriptionContent:{taskTypes:[n.TaskType.Transcription],title:"transcription content",graderFn:o.gradePerFrame(((e,t)=>({transcriptionContent:o.gradeIfNotMissing(((e,t)=>o.gradeFreeText(e.value,t.value)),e,t)})))}});t.default=i},168212:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isLSS=function(e,t,r){return!!t&&!!r&&e.taskType===i.TaskType.LidarSegmentation},t.parseIntersectionKey=function(e){const t=e.split("_");if(5!==t.length)return null;const[r,n,o,i,a]=t;return{frame:parseInt(r),source:n,dest:o,sourceId:i,destId:a}},t.convertMatchedLidarSemsegLabelDeltaToLidarSemsegLabelDelta=function(e){return o.default.omit(e,"totalPoints","isMatch")},t.getDeltaKey=c,t.buildLabelDeltaWeightingMap=f,t.getWeightingForDelta=h,t.aggregateClassResults=m,t.averageClassResults=y,t.upsertClassResults=b,t.generateLssMetrics=t.generatePerIndexInfo=t.generateMatchedDeltas=t.generateLabelIntersections=t.buildLSSCounts=void 0;var n,o=(n=r(298784))&&n.__esModule?n:{default:n},i=r(167469),a=r(825555),s=r(297393),l=r(810755);t.buildLSSCounts=({startSource:e,endSource:t,frame:r,startLabels:n,endLabels:o,intersectionMap:i=new Map,pointWeights:a})=>{if(n.length!==o.length)throw new Error(`Unexpected length, start had ${n.length}, end had ${o.length}`);const s=n.length,l={};for(let u=0;u<s;u++){const e=n[u],t=o[u];l[e]||(l[e]={}),l[e][t]||(l[e][t]=0);const r=a?a[u]:1;l[e][t]+=r}for(const u in l)for(const n in l[u]){const o=`${r}_${e}_${t}_${u}_${n}`;i.set(o,l[u][n])}return i};const u=({graderParams:e,pointIntersections:t,distanceWeightedPointIntersections:r,currentInfoMap:n,correctInfoMap:i})=>{const s=[a.ResponseSource.Current,a.ResponseSource.Correct],l=new Date,u=o.default.omitBy({project:e?.project?.toString(),subtask:e?.subtask?.toString(),attempt:e?.attempt?.toString(),graderSource:e?.source},o.default.isNil),c=[];return t.forEach(((e,t)=>{const[o,d,f,h,p]=t.split("_");if(!s.includes(d)||!s.includes(f))return;const m=parseInt(o),g=d===a.ResponseSource.Correct,y=parseInt(g?h:p),b=parseInt(g?p:h),T=n[b],v=i[y];T&&v&&c.push({correctLabelIndex:y,currentLabelIndex:b,currentLabel:T.label,correctLabel:v.label,currentIsInstance:T.instance,correctIsInstance:v.instance,pointCount:e,distanceWeightedPointCount:r?r.get(t):void 0,frame:m,gradedAt:l,...u})})),c};function c(e){return`${e.currentLabelIndex}-${e.correctLabelIndex}`}t.generateLabelIntersections=u;const d=e=>{const t=o.default.groupBy(e,(e=>e.frame)),r=o.default.map(o.default.groupBy(e,c),(e=>{const t=o.default.omit(e[0],"frame","pointCount","distanceWeightedPointCount"),r=o.default.sumBy(e,(e=>e.distanceWeightedPointCount??e.pointCount));return Object.assign({},t,{totalPointsAcrossFrames:r})})),n={},i={};r.forEach((e=>{e.correctLabel===e.currentLabel&&(n[e.currentLabelIndex]+=e.totalPointsAcrossFrames,i[e.correctLabelIndex]+=e.totalPointsAcrossFrames)}));const a=o.default.groupBy(r,(e=>e.correctLabelIndex)),s={},l={};function u(e){s[e.correctLabelIndex]=e,l[e.currentLabelIndex]=e,e.isMatch=!0}function d(e){return e.currentLabel===e.correctLabel&&!s[e.correctLabelIndex]&&!l[e.currentLabelIndex]}return o.default.sortBy(o.default.keys(a),(e=>{const t=a[e];return-1*o.default.sumBy(t,(e=>e.totalPointsAcrossFrames??0))})).forEach((e=>{const t=a[e];if(!t.length)return;const r=t[0];if(s[r.correctLabelIndex])return;const n=t.filter(d);if(!n.length)return;const l=n[0];if(!l.correctIsInstance)return void u(l);const c=i[r.correctLabelIndex],f=o.default.maxBy(n,(e=>0===c?e.correctLabelIndex===e.currentLabelIndex:e.totalPointsAcrossFrames/(c||1)));f&&u(f)})),o.default.mapValues(t,(e=>{const t=o.default.groupBy(e,(e=>e.correctLabelIndex)),r=o.default.mapValues(t,(e=>o.default.sumBy(e,(e=>e.distanceWeightedPointCount??e.pointCount)))),n={};return o.default.forEach(t,((e,t)=>{const i=o.default.toNumber(t),a=s[i],l=r[i],u=e.map((e=>o.default.assign({isMatch:!!a&&e.currentLabelIndex===a.currentLabelIndex,totalPoints:l},e)));n[i]=u})),n}))};function f(e){const t={};return e?.forEach((({correctedLabel:e,originalLabel:r,weight:n})=>{t[e]||(t[e]={}),t[e][r]=n})),t}t.generateMatchedDeltas=d;function h(e,t){return t[e.correctLabel]?.[e.currentLabel]??1}const p=e=>{const t={};return e.forEach((e=>{const{label:r,index:n,instance:o}=e.props,i={label:r,instance:!!o,index:n};t[n]=i})),t};t.generatePerIndexInfo=p;function m(e){const t={weightedNumOriginal:0,weightedNumExpected:0,weightedNumIntersection:0,weightedNumUnion:0};return e.forEach((e=>{o.default.forEach(e,((e,r)=>{t[r]+=e}))})),t}function g(e){const t=e.weightedNumUnion;return 0===t?1:Math.min(e.weightedNumIntersection/t,1)}function y(e){return Object.assign({weightedAverage:g(e)},e)}function b(e,t,r){T(e,t,r,!0),T(e,t,r,!1)}function T(e,t,r,n){const o=n?"weightedNumOriginal":"weightedNumExpected",i=e[n?"currentLabel":"correctLabel"];t[i]||(t[i]={weightedNumOriginal:0,weightedNumExpected:0,weightedNumIntersection:0,weightedNumUnion:0});const a=t[i],s=(e.distanceWeightedPointCount??e.pointCount)*r;a[o]+=s,e.isMatch&&!n?(a.weightedNumIntersection+=s,a.weightedNumUnion+=s):e.isMatch||(a.weightedNumUnion+=s)}t.generateLssMetrics=async({context:e,currentAnnotations:t,correctAnnotations:r,graderParams:n,labelDeltaWeighting:i})=>{const a=f(i),c=s.getPointIntersections(e),g=await s.getPointIntersectionsWeighted(e),T=p(t),v=p(r),x=u({graderParams:n,pointIntersections:c,distanceWeightedPointIntersections:g,currentInfoMap:T,correctInfoMap:v});l.assertDefined(x,{message:"Could not get label intersections"});const _=d(x),M={};return o.default.forEach(_,(e=>{o.default.forEach(e,(e=>{o.default.forEach(e,(e=>{const t=h(e,a);b(e,M,t)}))}))})),{classResults:o.default.mapValues(M,(e=>y(e))),averagedClassResult:y(m(o.default.values(M)))}}},440169:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.vertexToArr=L,t.radianDifference=function(e,t){return Math.abs(w(e-t))},t.interpolatePointsSegmentsLinear=F,t.calcMinDist=function(e,t){const r=L(n.default.first(e)),o=L(n.default.last(e)),i=L(n.default.first(t)),a=L(n.default.last(t));return Math.min(I(r,i)+I(o,a),I(r,a)+I(o,i))},t.calculateEndpointDistance=function(e,t){const r=L(n.default.first(e)),o=L(n.default.last(e)),i=L(n.default.first(t)),a=L(n.default.last(t));return Math.min(Math.max(I(r,i),I(o,a)),Math.max(I(r,a),I(o,i)))},t.nearestPointOnSegment=S,t.vertexSqDistanceToSegment=D,t.lineInMargin=function(e,t,r){const o=t.slice(0,-1).map(((e,r)=>[e,t[r+1]]));e=C(e);const i=O(o,r);return n.default.every(e,(e=>i(e)))},t.loopBackToStart=function(e){return e.map((e=>[...e,e[0]]))},t.lineListInMargin=function(e,t,r){if(n.default.isEmpty(t))return!0;const o=t.map((e=>e.slice(0,-1).map(((t,r)=>[t,e[r+1]])))).flat(),i=e.map((e=>C(e))).flat(),a=O(o,r);return n.default.every(i,(e=>a(e)))},t.getAmountOfLineInMargin=function(e,t,r){const o=t.slice(0,-1).map(((e,r)=>[e,t[r+1]]));e=C(e);const i=O(o,r),a=n.default.filter(e,(e=>i(e)));return t=C(t),{numUserPoints:e.length,numUserPointsInMargin:a.length,numCorrectPoints:t.length}},t.getLengthOfLineInMargin=function(e,t,r){const o=t.slice(0,-1).map(((e,r)=>[e,t[r+1]])),i=F(e),a=O(o,r),s=n.default.filter(i,(e=>a(e.point))),l=n.default.sumBy(s,(e=>e.pixelLength)),u=n.default.sumBy(i,(e=>e.pixelLength)),c=n.default.sumBy(o,(e=>I(L(e[0]),L(e[1]))));return{lengthCorrectUserLine:l,lengthTotalUserLine:u,lengthTotalCorrectLine:c}},t.getLengthOfLineInMarginZCoordinate=function(e,t,r,o){const a=t.slice(0,-1).map(((e,r)=>[e,t[r+1]])),s=F(e),l=a.map((e=>{const[t,r]=e;if(n.default.isNil(t.worldZ)||n.default.isNil(r.worldZ))throw new Error("Z coordinate is not defined");return[{...t,z:t.worldZ},{...r,z:r.worldZ}]})),u=s.map((e=>{const{point:t,pixelLength:r}=e;if(n.default.isNil(t.worldZ))throw new Error("Z coordinate is not defined");return{point:{...t,z:t.worldZ},pixelLength:r}})),c=function(e,t,r){const o=new i.default(e.length);for(const[n,i]of e){const e=Math.min(n.x,i.x),t=Math.max(n.x,i.x),a=Math.min(n.y,i.y),s=Math.max(n.y,i.y);o.add(e-r,a-r,t+r,s+r)}return o.finish(),r=>{const i=o.search(r.x,r.y,r.x,r.y),a=n.default.map(i,(t=>({distance:D(r,e[t]),idx:t,nearestPoint:S(r,e[t])}))),s=n.default.minBy(a,(e=>e.distance));if(!s)return!1;const{idx:l,nearestPoint:u}=s,c=function(e,t){const{x:r,y:n}=e,[{x:o,y:i,z:a},{x:s,y:l,z:u}]=t;if(o!==s&&(r<Math.min(o,s)||r>Math.max(o,s)))throw new Error("The point does not lie on the line segment.");if(i!==l&&(n<Math.min(i,l)||n>Math.max(i,l)))throw new Error("The point does not lie on the line segment.");const c=Math.sqrt((r-o)**2+(n-i)**2)/Math.sqrt((s-o)**2+(l-i)**2);return a+c*(u-a)}(u,e[l]);return Math.abs(c-r.z)<=t}}(l,r,o),d=n.default.filter(u,(e=>c(e.point))),f=n.default.sumBy(d,(e=>e.pixelLength)),h=n.default.sumBy(s,(e=>e.pixelLength)),p=n.default.sumBy(a,(e=>I(L(e[0]),L(e[1]))));return{lengthCorrectUserLine:f,lengthTotalUserLine:h,lengthTotalCorrectLine:p}},t.idsMatch=t.addRadians=t.normalizeToNegPiPi=t.findDistance=t.findDistance2=t.getExtendedCuboidDirection=t.getCuboidVertices=t.getCuboidSideFaceVertices=t.getCuboidFrontFaceVertices=t.getCuboidFrontFaceAsBox=t.formatCuboidAnnotation=t.projectedPointFromCuboid=t.discreteFrechetDistance=t.midpoint=t.rotatedBoxIou=t.boxIou=t.getPolygonPerimeter=t.fragmentsIou=t.genericIou=t.genericIouNucleus=t.iouWithBuffer=t.polygonListIou=t.iou=t.polygonListPolyboolIou=t.polyboolIou=t.geoJsonFor=t.polygonFor=t.geometryFactory=t.geom=t.ACCURACY_THRESHOLD=t.POLYGON_DIFF_THRESHOLD=t.MARGIN_OF_ERROR_FOR_CUBOIDANNOTATION=t.MARGIN_OF_ERROR_FOR_ANNOTATION=void 0;var n=d(r(298784)),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}(r(593539)),i=d(r(533637)),a=r(903779),s=d(r(132764)),l=d(r(373291)),u=r(60271),c=d(r(378970));function d(e){return e&&e.__esModule?e:{default:e}}t.MARGIN_OF_ERROR_FOR_ANNOTATION=10;t.MARGIN_OF_ERROR_FOR_CUBOIDANNOTATION=95;t.POLYGON_DIFF_THRESHOLD=.7;t.ACCURACY_THRESHOLD=.9;const f=o.geom;t.geom=f;const h=new f.GeometryFactory;t.geometryFactory=h;const p=e=>{const t=n.default.map(n.default.concat(e.vertices,[e.vertices[0]]),(e=>new f.Coordinate(e.x,e.y)));return h.createPolygon(h.createLinearRing(t),[])};t.polygonFor=p;const m=e=>{const t=e.vertices.map((e=>[e.x,e.y]));return t.push(t[0]),l.default.polygonFromGeoJSON(a.polygon([t]).geometry)};t.geoJsonFor=m;const g=(e,t)=>{const r=l.default.intersect(e,t),n=l.default.union(e,t),o=s.default(l.default.polygonToGeoJSON(r)),i=s.default(l.default.polygonToGeoJSON(n));return o&&i?o/i:0};t.polyboolIou=g;const y=(e,t)=>{const r=c.default(e,t);let o,i=0;n.default.each(r,(([e,t])=>{const r=l.default.intersect(e,t),n=s.default(l.default.polygonToGeoJSON(r));i+=n})),n.default.each([...e,...t],(e=>{o=o?l.default.union(o,e):e}));const a=s.default(l.default.polygonToGeoJSON(o));return i&&a?i/a:0};t.polygonListPolyboolIou=y;const b=(e,t)=>{const r=e.intersection(t);if(!r?.getArea())return 0;const n=e.union(t);return n?r.getArea()/n.getArea():0};t.iou=b;const T=(e,t)=>{const r=c.default(e,t);let o,i=0;return n.default.each(r,(([e,t])=>{const r=e.intersection(t);r&&(i+=r.getArea())})),n.default.each([...e,...t],(e=>{o=o?e.union(o):e})),o?i/o.getArea():0};t.polygonListIou=T;const v=(e,t)=>{const r=e.buffer(0).intersection(t.buffer(0)),n=e.buffer(0).union(t.buffer(0));return r&&n?r.getArea()/n.getArea():0};t.iouWithBuffer=v;t.genericIouNucleus=(e,t)=>{const r=p(e),n=p(t);try{const e=b(r,n);return Number.isNaN(e)||!isFinite(e)?0:e}catch(o){const e=v(r,n);return Number.isNaN(e)||!isFinite(e)?0:e}};const x=(e,t)=>{try{const r=p(e),n=p(t);return b(r,n)}catch(r){try{const r=p(e).buffer(.001),n=p(t).buffer(.001);return b(r,n)}catch(n){const r=m(e),o=m(t);return g(r,o)}}};t.genericIou=x;t.fragmentsIou=(e,t)=>{try{const r=e.map((e=>p(e))),n=t.map((e=>p(e)));return T(r,n)}catch(r){try{const r=e.map((e=>p(e).buffer(.001))),n=t.map((e=>p(e).buffer(.001)));return T(r,n)}catch(n){const r=e.map(m),o=t.map(m);return y(r,o)}}};t.getPolygonPerimeter=e=>{if(e.vertices.length<3)return 1;return p(e)?.getLength()||1};t.boxIou=(e,t)=>{const r=e.rotation??0,n=t.rotation??0;if(0!==r||0!==n)return _(e,t);const o=Math.max(e.left,t.left),i=Math.min(e.left+e.width,t.left+t.width),a=Math.max(e.top,t.top),s=Math.min(e.top+e.height,t.top+t.height),l=Math.max(0,i-o)*Math.max(0,s-a);return l/(e.width*e.height+t.width*t.height-l)};const _=(e,t)=>{const r=u.getRotatedVertices({height:e.height,width:e.width,rotation:e.rotation??0,center:{x:e.left+e.width/2,y:e.top+e.height/2},returnMidpoints:!1}),n=u.getRotatedVertices({height:t.height,width:t.width,rotation:t.rotation??0,center:{x:t.left+t.width/2,y:t.top+t.height/2},returnMidpoints:!1});return x({vertices:r},{vertices:n})};t.rotatedBoxIou=_;const M=e=>{if(!e)return 0;const t=n.default.get(e,"x1"),r=n.default.get(e,"x2"),o=n.default.get(e,"y1"),i=n.default.get(e,"y2");return Math.pow(Math.pow(t-r,2)+Math.pow(o-i,2),.5)},A=(e,t)=>({x:(e.x+t.x)/2,y:(e.y+t.y)/2});t.midpoint=A;t.discreteFrechetDistance=(e,t)=>{const r=k(e,t),n=k(e.reverse(),t);return Math.min(r,n)};const k=(e,t)=>{const r=[...Array(e.length)].map((()=>Array(t.length)));r[0][0]=I(L(e[0]),L(t[0]));for(let n=1;n<e.length;n++)r[n][0]=Math.max(r[n-1][0],I(L(e[n]),L(t[0])));for(let n=1;n<t.length;n++)r[0][n]=Math.max(r[0][n-1],I(L(e[0]),L(t[n])));for(let n=1;n<e.length;n++)for(let o=1;o<t.length;o++)r[n][o]=Math.max(Math.min(r[n-1][o],r[n-1][o-1],r[n][o-1]),I(L(e[n]),L(t[o])));return r[e.length-1][t.length-1]};t.projectedPointFromCuboid=e=>{const t=A(e.vertices.faceTopleft,e.vertices.faceBottomright);return((e,t)=>{if(!e||!t)return null;const{x1:r,x2:n,y1:o,y2:i}=e,{x1:a,x2:s,y1:l,y2:u}=t,c=(r-n)*(l-u)-(o-i)*(a-s);return 0===c?null:{x:((r*i-o*n)*(a-s)-(r-n)*(a*u-l*s))/c,y:((r*i-o*n)*(l-u)-(o-i)*(a*u-l*s))/c}})(e.edges.sideTop,e.edges.sideBottom)||t};t.formatCuboidAnnotation=e=>{const t={edges:n.default.keyBy(e.edges,(e=>n.default.camelCase(e.description))),vertices:n.default.keyBy(e.vertices,(e=>n.default.camelCase(e.description))),isExtended:!!e.edges&&e.edges.length>4};return t.width=M(t.edges.faceTop),t.height=M(t.edges.faceLeft),t.sideHeight=M(t.edges.sideBack)||t.height,t};t.getCuboidFrontFaceAsBox=e=>({top:e.vertices.faceTopleft.y,left:e.vertices.faceTopleft.x,height:e.vertices.faceBottomright.y-e.vertices.faceTopleft.y,width:e.vertices.faceBottomright.x-e.vertices.faceTopleft.x});const P=e=>({vertices:[e.vertices.faceTopleft,e.vertices.faceTopright,e.vertices.faceBottomright,e.vertices.faceBottomleft]});t.getCuboidFrontFaceVertices=P;t.getCuboidSideFaceVertices=e=>({vertices:[e.vertices.faceTopright,e.vertices.sideTopcorner,e.vertices.sideBottomcorner,e.vertices.faceBottomright]});t.getCuboidVertices=e=>e.isExtended?{vertices:[e.vertices.faceTopleft,e.vertices.faceTopright,e.vertices.sideTopcorner,e.vertices.sideBottomcorner,e.vertices.faceBottomright,e.vertices.faceBottomleft]}:P(e);t.getExtendedCuboidDirection=e=>{if(!e.isExtended)return null;return Math.abs(e.edges.sideBack.x1-e.edges.faceLeft.x1)>Math.abs(e.edges.sideBack.x1-e.edges.faceRight.x1)?"faceRight":"faceLeft"};const E=(e,t)=>Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2);t.findDistance2=E;const I=(e,t)=>Math.sqrt(E(e,t));function L(e){return[e.x,e.y]}t.findDistance=I;const w=e=>((e=((e%=2*Math.PI)+2*Math.PI)%(2*Math.PI))>Math.PI&&(e-=2*Math.PI),e);t.normalizeToNegPiPi=w;function C(e,t=1){return n.default.flatten(e.map(((r,o)=>{if(o===e.length-1)return[r];const i=e[o+1],a=I(L(r),L(i)),s=n.default.ceil(a/t),l=(i.x-r.x)/s,u=(i.y-r.y)/s;return n.default.times(s,(e=>({x:r.x+e*l,y:r.y+e*u})))})))}function F(e,t=1){return n.default.flatten(e.map(((r,o)=>{if(o===e.length-1)return[];const i=e[o+1],a=I(L(r),L(i)),s=n.default.ceil(a/t),l=a/s,u=i.worldZ,c=r.worldZ,d=!n.default.isNil(u)&&!n.default.isNil(c),f=(i.x-r.x)/s,h=(i.y-r.y)/s,p=d?(u-c)/s:0,m=n.default.times(s+1,(e=>({x:r.x+e*f,y:r.y+e*h,worldZ:d?c+e*p:void 0})));return n.default.times(s,(e=>{const t=m[e],r=m[e+1],o=n.default.isNil(t.worldZ)||n.default.isNil(r.worldZ)?void 0:(t.worldZ+r.worldZ)/2;return{point:{x:(t.x+r.x)/2,y:(t.y+r.y)/2,worldZ:o},pixelLength:l}}))})))}function O(e,t){const r=new i.default(e.length);for(const[n,o]of e){const e=Math.min(n.x,o.x),i=Math.max(n.x,o.x),a=Math.min(n.y,o.y),s=Math.max(n.y,o.y);r.add(e-t,a-t,i+t,s+t)}return r.finish(),o=>{const i=r.search(o.x,o.y,o.x,o.y);return n.default.some(i,(r=>D(o,e[r])<=t*t))}}function S(e,t){const{x:r,y:n}=e,[{x:o,y:i},{x:a,y:s}]=t,l=a-o,u=s-i,c=l*l+u*u,d=c?((r-o)*l+(n-i)*u)/c:-1;return d<0?{x:o,y:i}:d>1?{x:a,y:s}:{x:o+d*l,y:i+d*u}}function D(e,t){const{x:r,y:n}=e,{x:o,y:i}=S(e,t),a=r-o,s=n-i;return a*a+s*s}t.addRadians=(e,t)=>w(e+t);t.idsMatch=(e,t)=>!!e?.id&&e.id===t?.id},910951:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}(r(814412));class o{static fromObject(e){return new o(s(e.root),new Map(e.nodes.map((([e,t])=>[e,s(t)]))))}static empty(){return new o({id:0,offset:0,count:0,depth:0,children:[],index:new Uint32Array(0),boundingBox:new n.Box3})}static fromPositions(e,t){if(0===e.length)return o.empty();const r=t?.maxDepth||this.defaultOptions.maxDepth,i=t?.maxElements||this.defaultOptions.maxElements,a=Math.floor(e.length/3),s=new Uint32Array(a),l=new Uint32Array(4),u=new Uint32Array(4),c=new Uint32Array(a),d=new Uint8Array(a),f=new n.Vector3,h=new n.Vector3,p=new Map;for(let n=0;n<a;n++)s[n]=n;const m=(e,t,r=0)=>{const o={id:p.size,offset:e,count:t,depth:r,index:s.subarray(e,e+t),boundingBox:new n.Box3,children:[]};return p.set(o.id,o),o},g=t=>{c.set(s.subarray(t.offset,t.offset+t.count)),u.fill(0),l.fill(0),t.boundingBox.getCenter(h);for(let r=0;r<t.count;r++)d[r]=e[3*c[r]]>h.x?1:0,d[r]+=e[3*c[r]+1]>h.y?2:0,l[d[r]]++;let n=t.offset;for(let e=0;e<4;e++)u[e]=n,n+=l[e];const o=[];for(let e=0;e<4;e++){const r=m(u[e],l[e],t.depth+1);o.push(r)}for(let r=0;r<t.count;r++){const t=d[r];s[u[t]++]=c[r],f.fromArray(e,3*c[r]),o[d[r]].boundingBox.expandByPoint(f)}t.children=o;for(const e of o)e.count>i&&e.depth<r&&g(e)},y=m(0,a);for(let n=0;n<y.count;n++)f.fromArray(e,3*(y.offset+n)),y.boundingBox.expandByPoint(f);return g(y),new o(y,p)}get index(){return this.root.index}get count(){return this.root.count}getIndexForNodes(e){const t=e.reduce(((e,t)=>e+t.count),0);let r=0;const n=new Uint32Array(t);for(const o of e)for(let e=0;e<o.count;e++)n[r++]=this.index[o.offset+e];return n}queryNodes(e,t=1/0){const r=[],n=o=>{e(o)&&(0===o.children.length||o.depth>=t?r.push(o):o.children.forEach((e=>n(e))))};return n(this.root),r}queryNodesWithFull(e,t,r=1/0){const n=[],o=i=>{e(i)&&(0===i.children.length||i.depth>=r||t(i)?n.push(i):i.children.forEach((e=>o(e))))};return o(this.root),n}queryIndex(e,t=1/0){return this.getIndexForNodes(this.queryNodes(e,t))}toObject(){return{root:a(this.root),nodes:l(this.nodes,a)}}clone(){return this}constructor(e,t){this.root=e,this.nodes=t||new Map([[0,e]])}}t.BoxQuadTree=o,o.defaultOptions={maxDepth:8,maxElements:1e3};var i=o;function a(e){return{id:e.id,count:e.count,depth:e.depth,index:e.index,offset:e.offset,boundingBox:{min:e.boundingBox.min.toArray(),max:e.boundingBox.max.toArray()},children:e.children.map(a)}}function s(e){return{id:e.id,count:e.count,depth:e.depth,index:e.index,offset:e.offset,boundingBox:new n.Box3((new n.Vector3).fromArray(e.boundingBox.min),(new n.Vector3).fromArray(e.boundingBox.max)),children:e.children.map(s)}}function l(e,t){const r=[];for(const[n,o]of e.entries())r.push([n,t(o)]);return r}t.default=i},141971:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(r(298784)),o=i(r(910951));function i(e){return e&&e.__esModule?e:{default:e}}class a{static build(e=o.default.empty()){return new a(e)}get selectedNodeIds(){return Array.from(this.nodes.keys())}clone(){return a.build(this.boxTree).copy(this)}copy(e){if(this.boxTree!==e.boxTree)throw new Error("Selections should share the same box tree.");return this.clear(),e.nodes.forEach(((e,t)=>{this.nodes.set(t,{ids:e.ids?e.ids.slice():void 0,full:e.full})})),this}getNode(e){if(!this.nodes.has(e)){const t={};return this.nodes.set(e,t),t}return this.nodes.get(e)}clear(){return this.nodes.clear(),this}selectNode(e){const t=this.boxTree.nodes.get(e);return this.nodes.set(e,{ids:t.index,full:!0}),this}union(e){return this.assertComparable(e),e.nodes.forEach(((e,t)=>{if(e.ids?.length){const r=this.getNode(t);r.ids?.length?r.ids=Uint32Array.from(n.default.uniq([...Array.from(r.ids),...Array.from(e.ids)])):r.ids=e.ids}})),this}intersection(e){this.assertComparable(e);const t=[];return this.nodes.forEach(((r,o)=>{if(r.ids?.length&&e.nodes.has(o)){const t=e.getNode(o);r.ids=Uint32Array.from(n.default.intersection(r.ids,t.ids))}r.ids?.length&&e.nodes.has(o)||t.push(o)})),t.forEach((e=>{this.nodes.delete(e)})),this}difference(e){return this.assertComparable(e),this.nodes.forEach(((t,r)=>{if(t.ids?.length&&e.nodes.has(r)){const o=e.getNode(r);o.ids?.length&&(t.ids=Uint32Array.from(n.default.difference(t.ids,o.ids)))}})),this}select(e,t){return this.getNode(e).ids=t,this}forEach(e){this.nodes.forEach((t=>{const r=t.ids;if(r)for(let n=0;n<r.length;n++)e(r[n])}))}getCount(){let e=0;return this.nodes.forEach((t=>{e+=t.ids?.length||0})),e}isEmpty(){return 0===this.getCount()}getIndex(){const e=new Uint32Array(this.getCount());let t=0;return this.nodes.forEach((r=>{r.ids&&(e.set(r.ids,t),t+=r.ids.length)})),e}constructor(e){this.assertComparable=e=>{if(this.boxTree!==e.boxTree)throw new Error("Selections should share the same box tree.")},this.boxTree=e,this.nodes=new Map}}t.BoxTreeSelection=a},252575:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={},o=a(r(910951));Object.keys(o).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(n,e)||e in t&&t[e]===o[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}}))}));var i=a(r(141971));function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}Object.keys(i).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(n,e)||e in t&&t[e]===i[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}}))}))},545224:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(252575),o=r(592159),i=r(145564);class a extends o.PointCloud{static fromPointCloud(e,t){if(e instanceof a)return e;const r=t?.boxQuadTree||(e.xyz?n.BoxQuadTree.fromPositions(e.xyz):n.BoxQuadTree.empty());return new a({...e,boxQuadTree:r})}static fromObject(e){const t=o.PointCloud.buildFromObject(e.pointCloud),r=n.BoxQuadTree.fromObject(e.boxQuadTree);return new a({...t,boxQuadTree:r})}toObject(){return{pointCloud:super.toJSON(),boxQuadTree:this.boxQuadTree.toObject()}}clone(){return new a({boxQuadTree:this.boxQuadTree.clone(),...super.clone()})}getFilterContext(){return{points:this.xyz,timestamps:this.pointTimestampArray,boxTree:this.boxQuadTree}}applySelection(e){return this.applyIndex(e.getIndex())}applyFilter(e){return this.applySelection(e.getSelection(this.getFilterContext()))}getIndexByFilter(e){return e.getSelection(this.getFilterContext()).getIndex()}getIndexBySmartSample(e){return this.getIndexByFilter(new i.SmartSampleFilter(e))}filterByRange(e){return this.applyFilter(new i.RangeQueryFilter(e))}getIndexByFilterByRange(e){return this.getIndexByFilter(new i.RangeQueryFilter(e))}filterByRangeAndTimestamp(e,t,r){return this.applyFilter(new i.RangeTimestampFilter(e,t,r))}filterByCuboid(e){return this.applyFilter(new i.CuboidFilter(e))}filterByNotInCuboid(e){return this.applyFilter(new i.CuboidSubtractionFilter(e))}getIndexByCuboid(e){return this.getIndexByFilter(new i.CuboidFilter(e))}filterByCuboidBorder(e,t=0,r=0,n=0){return this.applyFilter(new i.CuboidBorderFilter(e,t,r,n))}filterByPointsOutsideCuboidFace(e,t=0,r=0,n=0){return new i.CuboidBorderFilter(e,t,r,n).filterPointsInPartialExteriorBorder(this.getFilterContext())}filterByCylinder(e){return this.applyFilter(new i.CylinderFilter(e))}filterByCuboidAndTimestamp(e,t,r){return this.applyFilter(new i.HyperCuboidFilter(e,t,r))}getIndexByCuboidAndTimestamp(e,t,r){return this.getIndexByFilter(new i.HyperCuboidFilter(e,t,r))}countPointsInCuboid(e){return new i.CuboidFilter(e).countPoints(this.getFilterContext())}countPointsInCuboidAndTimestamp(e,t,r){return new i.HyperCuboidFilter(e,t,r).countPoints(this.getFilterContext())}countPointsOutsideCuboidFace(e,t=0,r=0,n=0){return new i.CuboidBorderFilter(e,t,r,n).countPointsInPartialExteriorBorder(this.getFilterContext())}constructor(e){super(e),this.boxQuadTree=e.boxQuadTree}}t.IndexedPointCloud=a},592159:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,o=(n=r(298784))&&n.__esModule?n:{default:n},i=r(257868);class a{static buildFromObject(e){return new a({xyz:e.xyz,photoColors:e.photoColors,bloomLevel:e.bloomLevel,intensities:e.intensities,deviceIds:e.deviceIds,uniqueDeviceIds:e.uniqueDeviceIds,ids:e.ids,meta:e.meta,pointTimestampArray:e.pointTimestampArray})}static combinePointClouds(e){if(!e.length)return new a;const t={xyz:e.map((e=>e.xyz)),intensities:e.map((e=>e.intensities)),photoColors:e.map((e=>e.photoColors)),bloomLevel:e.map((e=>e.bloomLevel)),deviceIds:e.map((e=>e.deviceIds)),ids:e.map((e=>e.ids)),pointTimestampArray:e.map((e=>e.pointTimestampArray))},r=o.default.uniq(o.default.flatten(o.default.compact(e.map((e=>e.uniqueDeviceIds)))));return new a({xyz:i.concat(t.xyz),intensities:o.default.every(t.intensities)?i.concat(o.default.compact(t.intensities)):null,photoColors:o.default.every(t.photoColors)?i.concat(o.default.compact(t.photoColors)):null,bloomLevel:o.default.every(t.bloomLevel)?i.concat(o.default.compact(t.bloomLevel)):null,deviceIds:o.default.every(t.deviceIds)?i.concat(o.default.compact(t.deviceIds)):null,ids:o.default.every(t.ids)?i.concat(o.default.compact(t.ids)):null,pointTimestampArray:o.default.every(t.pointTimestampArray)?i.concat(o.default.compact(t.pointTimestampArray)):null,uniqueDeviceIds:r,meta:e[0].meta})}toJSON(){return{xyz:this.xyz,photoColors:this.photoColors,bloomLevel:this.bloomLevel,intensities:this.intensities,deviceIds:this.deviceIds,uniqueDeviceIds:this.uniqueDeviceIds,ids:this.ids,meta:this.meta,pointTimestampArray:this.pointTimestampArray}}zeros(e){return new a({xyz:new Float32Array(3*e),intensities:this.intensities?new Float32Array(e):null,photoColors:this.photoColors?new Uint8Array(3*e):null,bloomLevel:this.bloomLevel?new Uint8Array(e):null,deviceIds:this.deviceIds?new Float32Array(e):null,ids:this.ids?new Uint32Array(e):null,pointTimestampArray:this.pointTimestampArray?new Float64Array(e):null})}randomSample(e){if(e>=this.numPoints)return this;const t=o.default.sampleSize(o.default.range(this.numPoints),e);return this.slice(t)}subPointCloud(e,t){return new a({xyz:this.xyz.subarray(3*e,3*t),intensities:this.intensities?this.intensities.subarray(e,t):null,photoColors:this.photoColors?this.photoColors.subarray(3*e,3*t):null,bloomLevel:this.bloomLevel?this.bloomLevel.subarray(e,t):null,deviceIds:this.deviceIds?this.deviceIds.subarray(e,t):null,ids:this.ids?this.ids.subarray(e,t):null,pointTimestampArray:this.pointTimestampArray?this.pointTimestampArray.subarray(e,t):null,meta:this.meta})}slice(e){return this.applyIndex(Uint32Array.from(e))}applyIndex(e){const t=this.deviceIds?i.pick(this.deviceIds,e):null,r=t?this.uniqueDeviceIds:null;return new a({xyz:i.pick(this.xyz,e,3),intensities:this.intensities?i.pick(this.intensities,e):null,photoColors:this.photoColors?i.pick(this.photoColors,e,3):null,bloomLevel:this.bloomLevel?i.pick(this.bloomLevel,e):null,deviceIds:t,uniqueDeviceIds:r,ids:this.ids?i.pick(this.ids,e):null,pointTimestampArray:this.pointTimestampArray?i.pick(this.pointTimestampArray,e):null,meta:this.meta})}clone(){return new a({xyz:this.xyz.slice(),intensities:this.intensities?this.intensities.slice():null,photoColors:this.photoColors?this.photoColors.slice():null,bloomLevel:this.bloomLevel?this.bloomLevel.slice():null,deviceIds:this.deviceIds?this.deviceIds.slice():null,uniqueDeviceIds:this.deviceIds?this.uniqueDeviceIds?.slice():null,ids:this.ids?this.ids.slice():null,pointTimestampArray:this.pointTimestampArray?this.pointTimestampArray.slice():null,meta:o.default.clone(this.meta)})}constructor(e={}){if(e.xyz=e.xyz||new Float32Array(0),!(e.xyz instanceof Float32Array))throw new Error("Malformed xyz (incorrect type)");if(e.ids){if(!(e.ids instanceof Uint32Array))throw new Error("Malformed ids (incorrect type)");if(e.ids.length!==e.xyz.length/3)throw new Error("Malformed ids (incorrect length)")}this.numPoints=e.xyz.length/3,this.xyz=e.xyz,this.meta=e.meta,this.photoColors=e.photoColors??null,this.bloomLevel=e.bloomLevel??null,this.intensities=e.intensities??null,this.deviceIds=e.deviceIds??null,this.uniqueDeviceIds=e.uniqueDeviceIds??null,this.pointTimestampArray=e.pointTimestampArray??null,this.ids=e.ids??null,!o.default.isEmpty(this.deviceIds)&&o.default.isEmpty(this.uniqueDeviceIds)&&(this.uniqueDeviceIds=o.default.uniq(this.deviceIds))}}t.PointCloud=a},827004:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(252575);t.BaseFilter=class{selectNode(e){return!0}getIdsFromNode(e,t){return t.index}getSelection(e){const t=n.BoxTreeSelection.build(e.boxTree);return e.boxTree.queryNodes((e=>this.selectNode(e))).forEach((r=>t.select(r.id,this.getIdsFromNode(e,r)))),t}}},674026:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(814412),o=r(252575),i=r(376570);const a=new n.Vector3;class s extends i.CuboidFilter{shouldSelectId(e,t){a.set(e.points[3*t+0]-this.cuboid.position.x,e.points[3*t+1]-this.cuboid.position.y,e.points[3*t+2]-this.cuboid.position.z),a.applyMatrix3(this.rotation);const r=Math.abs(a.x),n=Math.abs(a.y),o=Math.abs(a.z),i=Math.min(this.diag[0],this.diag[0]+this.borderX),s=Math.max(this.diag[0],this.diag[0]+this.borderX),l=Math.min(this.diag[1],this.diag[1]+this.borderY),u=Math.max(this.diag[1],this.diag[1]+this.borderY),c=Math.min(this.diag[2],this.diag[2]+this.borderZ),d=Math.max(this.diag[2],this.diag[2]+this.borderZ);return r>i&&n>l&&o>c&&r<=s&&n<=u&&o<=d}shouldSelectPointInPartialExteriorBorder(e,t){if(a.set(e.points[3*t+0]-this.cuboid.position.x,e.points[3*t+1]-this.cuboid.position.y,e.points[3*t+2]-this.cuboid.position.z),a.applyMatrix3(this.rotation),this.borderX>0){const e=a.x>this.diag[0]&&a.x<=this.diag[0]+this.borderX,t=a.y>=-this.diag[1]&&a.y<=this.diag[1]&&a.z>=-this.diag[2]&&a.z<=this.diag[2];return e&&t}if(this.borderX<0){const e=a.x<-this.diag[0]&&a.x>=-this.diag[0]+this.borderX,t=a.y>=-this.diag[1]&&a.y<=this.diag[1]&&a.z>=-this.diag[2]&&a.z<=this.diag[2];return e&&t}if(this.borderY>0){const e=a.y>this.diag[1]&&a.y<=this.diag[1]+this.borderY,t=a.x>=-this.diag[0]&&a.x<=this.diag[0]&&a.z>=-this.diag[2]&&a.z<=this.diag[2];return e&&t}if(this.borderY<0){const e=a.y<-this.diag[1]&&a.y>=-this.diag[1]+this.borderY,t=a.x>=-this.diag[0]&&a.x<=this.diag[0]&&a.z>=-this.diag[2]&&a.z<=this.diag[2];return e&&t}if(this.borderZ>0){const e=a.z>this.diag[2]&&a.z>=this.diag[2]+this.borderZ,t=a.x>=-this.diag[0]&&a.x<=this.diag[0]&&a.y>=-this.diag[1]&&a.y<=this.diag[1];return e&&t}if(this.borderZ<0){const e=a.z<-this.diag[2]&&a.z>=-this.diag[2]+this.borderZ,t=a.x>=-this.diag[0]&&a.x<=this.diag[0]&&a.y>=-this.diag[1]&&a.y<=this.diag[1];return e&&t}return!1}filterPointsInPartialExteriorBorder(e){const t=o.BoxTreeSelection.build(e.boxTree);return e.boxTree.queryNodes((e=>this.selectNode(e))).forEach((r=>{let n=0;const o=new Uint32Array(r.count);for(let t=0;t<r.count;t++)this.shouldSelectPointInPartialExteriorBorder(e,r.index[t])&&(o[n++]=r.index[t]);t.select(r.id,o.slice(0,n))})),t}countPointsInPartialExteriorBorder(e){let t=0;return e.boxTree.queryNodes((e=>this.selectNode(e))).forEach((r=>{for(let n=0;n<r.count;n++)this.shouldSelectPointInPartialExteriorBorder(e,r.index[n])&&t++})),t}constructor(e,t=0,r=0,n=0){super({...e,dimensions:{x:e.dimensions.x+t,y:e.dimensions.y+r,z:e.dimensions.z+n}}),this.borderX=t,this.borderY=r,this.borderZ=n,this.diag=[.5*e.dimensions.x,.5*e.dimensions.y,.5*e.dimensions.z]}}t.CuboidBorderFilter=s},376570:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(814412),o=r(565407);const i=new n.Vector3,a=new n.Vector3,s=new n.Box3;class l extends o.RangeQueryFilter{shouldSelectId(e,t){return i.set(e.points[3*t+0]-this.cuboid.position.x,e.points[3*t+1]-this.cuboid.position.y,e.points[3*t+2]-this.cuboid.position.z),i.applyMatrix3(this.rotation),i.x>=-this.diag[0]&&i.y>=-this.diag[1]&&i.z>=-this.diag[2]&&i.x<=this.diag[0]&&i.y<=this.diag[1]&&i.z<=this.diag[2]}getIdsFromNode(e,t){const r=new Uint32Array(t.count);let n=0;for(let o=0;o<r.length;o++)this.shouldSelectId(e,t.index[o])&&(r[n++]=t.index[o]);return r.slice(0,n)}countPoints(e){let t=0;return e.boxTree.queryNodes(this.selectNode).forEach((r=>{for(let n=0;n<r.index.length;n++)this.shouldSelectId(e,r.index[n])&&t++})),t}constructor(e){super(function(e){s.makeEmpty();const t=u(e);for(let r=0;r<=1;r++)for(let n=0;n<=1;n++)for(let o=0;o<=1;o++)i.set(r,n,o).subScalar(.5).multiply(a.set(e.dimensions.x,e.dimensions.y,e.dimensions.z)).applyMatrix3(t).add(a.set(e.position.x,e.position.y,e.position.z)),s.expandByPoint(i);return{minX:s.min.x,maxX:s.max.x,minY:s.min.y,maxY:s.max.y,minZ:s.min.z,maxZ:s.max.z}}(e)),this.cuboid=e,this.rotation=u(e),this.diag=[.5*e.dimensions.x,.5*e.dimensions.y,.5*e.dimensions.z]}}function u({yaw:e,pitch:t,roll:r}){const o=new n.Euler(-(t||0),r||0,e,"ZYX"),i=(new n.Matrix4).makeRotationFromEuler(o);return(new n.Matrix3).setFromMatrix4(i).transpose()}t.CuboidFilter=l},467913:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(814412),o=r(376570);const i=new n.Vector3;class a extends o.CuboidFilter{shouldSelectId(e,t){return i.set(e.points[3*t+0]-this.cuboid.position.x,e.points[3*t+1]-this.cuboid.position.y,e.points[3*t+2]-this.cuboid.position.z),i.applyMatrix3(this.rotation),i.x<-this.diag[0]||i.y<-this.diag[1]||i.z<-this.diag[2]||i.x>this.diag[0]||i.y>this.diag[1]||i.z>this.diag[2]}constructor(e){super(e),this.cuboid=e}}t.CuboidSubtractionFilter=a},71930:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(814412),o=r(565407);const i=new n.Vector3;class a extends o.RangeQueryFilter{getIdsFromNode(e,t){const r=this.cylinder.radius*this.cylinder.radius;let n=0;const o=new Uint32Array(t.count);for(let a=0;a<o.length;a++)i.set(e.points[3*t.index[a]+0]-this.cylinder.center[0],e.points[3*t.index[a]+1]-this.cylinder.center[1],e.points[3*t.index[a]+2]-this.cylinder.center[2]),i.x*i.x+i.y*i.y<r&&2*i.z>-this.cylinder.height&&2*i.z<this.cylinder.height&&(o[n++]=t.index[a]);return o.slice(0,n)}constructor(e){super(function(e){return{minX:e.center[0]-e.radius,maxX:e.center[0]+e.radius,minY:e.center[1]-e.radius,maxY:e.center[1]+e.radius,minZ:e.center[2]-e.height/2,maxZ:e.center[2]+e.height/2}}(e)),this.cylinder=e}}t.CylinderFilter=a},774371:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(376570);class o extends n.CuboidFilter{shouldSelectId(e,t){return e.timestamps[t]>=this.start&&e.timestamps[t]<=this.end&&super.shouldSelectId(e,t)}getIdsFromNode(e,t){if(!e.timestamps)throw new Error("Cannot apply timestamp filter in this pointcloud");return super.getIdsFromNode(e,t)}constructor(e,t,r){super(e),this.start=t,this.end=r}}t.HyperCuboidFilter=o},565407:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(814412),o=r(827004);class i extends o.BaseFilter{constructor(e){super(),this.selectNode=e=>e.boundingBox.intersectsBox(this.box3),this.box3=new n.Box3(new n.Vector3(e.minX,e.minY,e.minZ),new n.Vector3(e.maxX,e.maxY,e.maxZ))}}t.RangeQueryFilter=i},243474:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(565407);class o extends n.RangeQueryFilter{getIdsFromNode(e,t){if(!e.timestamps)throw new Error("Cannot apply timestamp filter in this pointcloud");const r=new Uint32Array(t.count);let n=0;for(let o=0;o<r.length;o++)e.timestamps[t.index[o]]>=this.start&&e.timestamps[t.index[o]]<=this.end&&(r[n++]=t.index[o]);return r.slice(0,n)}constructor(e,t,r){super(e),this.start=t,this.end=r}}t.RangeTimestampFilter=o},787863:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(827004);class o extends n.BaseFilter{getIdsFromNode(e,t){if(0===e.points.length||0===this.sampleRate)return new Uint32Array;const r=Math.floor(t.count*this.sampleRate),n=new Uint32Array(r),o=1/this.sampleRate;for(let i=0;i<r;i++)n[i]=t.index[i*o];return n}constructor(e){super(),this.sampleRate=e}}t.SampleFilter=o},35914:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,o=(n=r(298784))&&n.__esModule?n:{default:n},i=r(252575);t.SmartSampleFilter=class{getSelection({boxTree:e}){const t=i.BoxTreeSelection.build(e),r=e.queryNodes((()=>!0)),n=r.map((t=>Math.pow(t.count/e.count,.25))),a=o.default.sum(n);return r.forEach(((r,o)=>{let i=0;const s=e.count*this.sampleRate*(n[o]/a),l=r.count/s,u=new Uint32Array(2*s);for(let e=0;e<r.count&&!(i>=u.length);e+=l)u[i++]=r.index[e<<0];t.select(r.id,u.subarray(0,i))})),t}constructor(e){this.sampleRate=e}}},145564:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={},o=p(r(827004));Object.keys(o).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(n,e)||e in t&&t[e]===o[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}}))}));var i=p(r(565407));Object.keys(i).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(n,e)||e in t&&t[e]===i[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}}))}));var a=p(r(674026));Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(n,e)||e in t&&t[e]===a[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}}))}));var s=p(r(376570));Object.keys(s).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(n,e)||e in t&&t[e]===s[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}}))}));var l=p(r(467913));Object.keys(l).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(n,e)||e in t&&t[e]===l[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return l[e]}}))}));var u=p(r(71930));Object.keys(u).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(n,e)||e in t&&t[e]===u[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}}))}));var c=p(r(787863));Object.keys(c).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(n,e)||e in t&&t[e]===c[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return c[e]}}))}));var d=p(r(35914));Object.keys(d).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(n,e)||e in t&&t[e]===d[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return d[e]}}))}));var f=p(r(774371));Object.keys(f).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(n,e)||e in t&&t[e]===f[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return f[e]}}))}));var h=p(r(243474));function p(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}Object.keys(h).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(n,e)||e in t&&t[e]===h[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return h[e]}}))}))},152122:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={};t.default=void 0;var o=l(r(592159));Object.keys(o).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(n,e)||e in t&&t[e]===o[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}}))}));var i=l(r(549041));Object.keys(i).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(n,e)||e in t&&t[e]===i[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}}))}));var a=l(r(545224));Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(n,e)||e in t&&t[e]===a[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}}))}));var s=l(r(198360));function l(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}Object.keys(s).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(n,e)||e in t&&t[e]===s[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}}))}));var u=o.PointCloud;t.default=u},198360:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},549041:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.normalizeIntensities=function(e){if(o.default.mean(e)<.005)for(let n=0;n<e.length;n++)e[n]*=63356,e[n]=Math.tanh(e[n]);const t=o.default.max(e)||0;let r=1;t>255?r=65536:t>1&&(r=255);if(r>1)for(let n=0;n<e.length;n++)e[n]/=r;for(let n=0;n<e.length;n++)isNaN(e[n])&&(e[n]=0)},t.processIntensityData=function(e,t){let r=t.mean;void 0===r&&(r=o.default.mean(e));let n=t.variance;if(void 0===n){let t=0;for(const n of e)t+=Math.pow(n-r,2);n=t/e.length}t.intensityBand=r+n};var n,o=(n=r(298784))&&n.__esModule?n:{default:n}},490063:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=e.slice();return t.sort(i),function(e){if(e.length<=1)return e.slice();const t=[];for(const n of e){for(;t.length>=2;){const e=t[t.length-1],r=t[t.length-2];if((e.x-r.x)*(n.y-r.y)<(e.y-r.y)*(n.x-r.x))break;t.pop()}t.push(n)}t.pop();const r=[];for(let n=e.length-1;n>=0;n--){const t=e[n];for(;r.length>=2;){const e=r[r.length-1],n=r[r.length-2];if((e.x-n.x)*(t.y-n.y)<(e.y-n.y)*(t.x-n.x))break;r.pop()}r.push(t)}return r.pop(),1===t.length&&1===r.length&&o.default.isEqual(t,r)?t:t.concat(r)}(t)};var n,o=(n=r(298784))&&n.__esModule?n:{default:n};function i(e,t){return e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:e.y>t.y?1:0}},74909:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getEuler=p,t.getToCuboidTransformationMatrix=m,t.getEdgeVectors=g,t.getHeadingVector=function(e){const t=p(e);return new o.Vector3(0,1,0).applyEuler(t)},t.containingPoints=y,t.cuboidsOverlap=function(e,t){return y(e.cuboidProps,b(t.cuboidProps)).length>0||y(t.cuboidProps,b(e.cuboidProps)).length>0},t.getCorners=b,t.getEdges=T,t.getVisibleCameras=function(e,t){const r=e.map(((e,t)=>({camIndex:t,camera:e})));return t?r.filter((({camera:e})=>{const r=e.projectFn?e.projectFn.bind(e):c.getProjectionFunction(e);return b(t).some((e=>r?.(e).visible))})):r},t.getProjectedConvexHullOnCamera=function(e,t){let r=t.projectFn;r||(r=c.getProjectionFunction(t));const n=b(e),o=[];let i=!0;for(const a of n){const{preDistortPosition:e,distortPosition:n,distortGood:s,visible:l}=r(a);l&&(i=!1);const u=s?n:e;u.x=Math.max(0,u.x),u.x=Math.min(t.imageWidth*(t.scale_factor||1),u.x),u.y=Math.max(0,u.y),u.y=Math.min(t.imageHeight*(t.scale_factor||1),u.y),o.push(u)}if(i)return[];return d.default(o)},t.transformPoint=function(e,t){const{xVector3:r,yVector3:n}=g(e),i=s.parseVector3(t);i.sub(s.parseVector3(e.position));const a=r.dot(i),l=n.dot(i),u=i.z;return new o.Vector3(a,l,u)},t.naiveDistance=function(e,t){const r=s.parseVector3(e),n=s.parseVector3(t);return s.vsub(r,n).length()},t.cuboidVolume=v,t.cuboidsIOU=function(e,t,r=5){return n.default.round(l.computeIOU(e.position,e.dimensions,e.yaw,t.position,t.dimensions,t.yaw),r)},t.cuboidsIOV=function(e,t,r=5){const o=Math.max(0,Math.min(l.zBounds(e.position,e.dimensions).hi,l.zBounds(t.position,t.dimensions).hi)-Math.max(l.zBounds(e.position,e.dimensions).lo,l.zBounds(t.position,t.dimensions).lo)),i=l.getIntersectionPolygonArea(e.position,e.dimensions,e.yaw,t.position,t.dimensions,t.yaw),a=Math.max(v(e),1e-5);return n.default.round(o*i/a,r)},t.cuboidsIntersect=function(e,t){return l.computeIOU(e.position,e.dimensions,e.yaw,t.position,t.dimensions,t.yaw)>0},t.cuboidContainsCuboid=function(e,t){const r=b(t);return y(e,r).length===r.length},t.cuboidContainsPoint=function(e,t){const r=b(e);return r.some((e=>e.x>=t.x))&&r.some((e=>e.x<=t.x))&&r.some((e=>e.y>=t.y))&&r.some((e=>e.y<=t.y))&&r.some((e=>e.z>=t.z))&&r.some((e=>e.z<=t.z))},t.cuboidAABB=x,t.cuboidsPoints=function(e,t,r,n,a=0,s=0,l=0,u=!1,c=1.33){const d={},f={},h={},p=[],g=[],y=[],b={};e.forEach((e=>{e&&e.id&&(u&&(d[e.id]=[],r&&(f[e.id]=[]),n&&(h[e.id]=[])),b[e.id]=m(e))}));const T=e.map((e=>{const t=Math.min(e.extrapolatedFrameDist||0,5);return x(e,a+t*c,s+t*c,l+t*c)})),v=new i.RBush3D(8);v.load(T);const _=new o.Vector3,M=new o.Vector3,A={minX:0,maxX:0,minY:0,maxY:0,minZ:0,maxZ:0};function k({cuboid:e}){if(!e||!e.id)return!0;const t=b[e.id];M.set(_.x-e.position.x,_.y-e.position.y,_.z-e.position.z),M.applyMatrix3(t);const r=Math.abs(M.x),n=Math.abs(M.y),o=Math.abs(M.z),i=Math.min(e.extrapolatedFrameDist||0,5),u=a+i*c,d=s+i*c,f=l+i*c,h=-u/2,p=-d/2,m=-f/2,g=.5*e.dimensions.x+u/2,y=.5*e.dimensions.y+d/2,T=.5*e.dimensions.z+f/2;return r<h||r>g||n<p||n>y||o<m||o>T}for(let o=0;o<t.length;o+=3){A.minX=A.maxX=t[o],A.minY=A.maxY=t[o+1],A.minZ=A.maxZ=t[o+2];const e=v.search(A);e.length&&(_.set(t[o],t[o+1],t[o+2]),e.forEach((e=>{if(k(e))return;const t=e.cuboid.id;u?(d[t].push(_.x,_.y,_.z),r&&f[t].push(r[o/3])):(p.push(_.x,_.y,_.z),r&&g.push(r[o/3]))})))}for(const o of n??[]){A.minX=A.maxX=o.position.x,A.minY=A.maxY=o.position.y,A.minZ=A.maxZ=o.position.z;const e=v.search(A);e.length&&(_.set(o.position.x,o.position.y,o.position.z),e.forEach((e=>{k(e)||(u?h[e.cuboid.id].push(o):y.push(o))})))}if(u){const e={};for(const t in d)e[t]={points:new Float32Array(d[t]),intensities:r?new Float32Array(f[t]):null,radar_points:n?h[t]:null};return e}return{points:new Float32Array(p),intensities:r?new Float32Array(g):null,radar_points:n?y:null}},t.cuboidsHavePointsInPadding=function(e,t,r){const n={},a={},s=new Set(e.map((e=>e.id))),l={};e.forEach((e=>{e&&e.id&&(e.id in n||(n[e.id]=!1,a[e.id]=0),l[e.id]=m(e))}));const u=e.map((e=>x(e))),c=new i.RBush3D(8);c.load(u);const d=new o.Vector3,f=new o.Vector3,h={minX:0,maxX:0,minY:0,maxY:0,minZ:0,maxZ:0};for(let o=0;o<t.length&&0!==s.size;o+=3){h.minX=h.maxX=t[o],h.minY=h.maxY=t[o+1],h.minZ=h.maxZ=t[o+2];const e=c.search(h);e.length&&(d.set(t[o],t[o+1],t[o+2]),e.forEach((e=>{const t=e.cuboid;if(!t||!t.id||!s.has(t.id))return;const o=l[t.id];f.set(d.x-t.position.x,d.y-t.position.y,d.z-t.position.z),f.applyMatrix3(o);const i=Math.abs(f.x),u=Math.abs(f.y),c=Math.abs(f.z),h=.5*t.dimensions.x,p=.5*t.dimensions.y,m=.5*t.dimensions.z;return i<0&&i>h||u<0&&u>p||c<0&&c>m?void 0:i>=h-r||u>=p-r||c>=m-r?(s.delete(t.id),n[t.id]=!0):void a[t.id]++})))}return{pointsInPaddingById:n,pointCounts:a}},t.cuboidInsidePolygon2D=function(e,t){const r=b(e);return n.default.some(r,(e=>_(e.x,e.y,t)))},t.insidePolygon=_,t.polygonContainsPolygon=function(e,t){for(const r of t)if(!_(r.x,r.y,e))return!1;return!0},t.extendCuboid=M,t.transformPointsToCuboid=function(e,t){const r=new Float32Array(t.length),n=[e.position.x,e.position.y,e.position.z],o=[[Math.cos(e.yaw),-Math.sin(e.yaw),0],[Math.sin(e.yaw),Math.cos(e.yaw),0],[0,0,1]];for(let i=0;i<t.length/3;i++)for(let e=0;e<3;e++){r[3*i+e]=0;for(let a=0;a<3;a++)r[3*i+e]+=(t[3*i+a]-n[a])*o[a][e]}return r},t.getCuboidMatrix4=function(e){const{x:t,y:r,z:n}=e.position,i=(new o.Matrix4).makeRotationFromEuler(p(e));return(new o.Matrix4).makeTranslation(t,r,n).multiply(i)},t.applyMatrix4Transform=function(e,t){const r=new o.Vector3,n=new o.Quaternion,i=new o.Vector3;t.decompose(r,n,i);const a=(new o.Euler).setFromQuaternion(n,h);e.position={x:r.x,y:r.y,z:r.z},e.pitch=-a.x,e.roll=a.y,e.yaw=a.z},t.matchCloseCuboids=function(e,t,r=.2,o=.9){const i={};t.forEach((e=>i[e.id]=e));const s={};e.forEach((e=>{e.id in i&&delete i[e.id]})),e.forEach((e=>{for(const t in i){const n=i[t];if(a.distance3D(n.position,e.position)>r)return;const u=l.computeIOU(e.position,e.dimensions,e.yaw,n.position,n.dimensions,n.yaw);u>o&&(!(e.id in s)||s[e.id].iou<u)&&(s[e.id]={iou:u,cuboid:n})}}));for(const n in s){const e=s[n].cuboid;s[e.id]={cuboid:e,iou:0}}return n.default.values(s).map((e=>e.cuboid.id))},t.getCuboidHalves=function(e){const{xVector3:t,yVector3:r}=g(e);t.multiplyScalar(e.dimensions.x/4),r.multiplyScalar(e.dimensions.y/4);const o=n.default.cloneDeep(e);A(o.position,t),o.dimensions.x/=2;const i=n.default.cloneDeep(e);k(i.position,t),i.dimensions.x/=2;const a=n.default.cloneDeep(e);A(a.position,r),a.dimensions.y/=2;const s=n.default.cloneDeep(e);return k(s.position,r),s.dimensions.y/=2,{left:o,right:i,front:s,back:a}},t.createSimpleCuboidClone=function(e){return{dimensions:{x:e.dimensions.x,y:e.dimensions.y,z:e.dimensions.z},position:{x:e.position.x,y:e.position.y,z:e.position.z},yaw:e.yaw,pitch:e.pitch,roll:e.roll,id:e.id,label:e.label}},t.cuboidToPlane=function(e){const t=new o.BoxGeometry(e.dimensions.x,e.dimensions.y,e.dimensions.z),r=new o.Object3D;r.position.set(e.position.x,e.position.y,e.position.z),r.rotateZ(e.yaw),r.updateMatrixWorld();return[t.vertices[7],t.vertices[2],t.vertices[1],t.vertices[4]].map((e=>r.localToWorld(e)))},t.combineCuboids=P,t.filterAreaByCuboidPaths=function(e,t,r,n,o,i=0,a=0,s=0){const l=M(P(e),i,a,s),c=u.IndexedPointCloud.fromPointCloud(new u.PointCloud({xyz:t,intensities:r})),d=u.IndexedPointCloud.fromPointCloud(new u.PointCloud({xyz:E(n)})),f=u.IndexedPointCloud.fromPointCloud(new u.PointCloud({xyz:o||new Float32Array})),h=c.getIndexByCuboid(l),p=d.getIndexByCuboid(l),m=f.filterByCuboid(l),g=c.applyIndex(h),y=[];if(n)for(let u=0;u<p.length;u++)y.push(n[p[u]]);return{pointSubset:{points:g.xyz,intensities:g.intensities,groundPoints:m.xyz,radar_points:n?y:null},pointIndices:h}},t.getCuboidName=function(e,t,r=!1){if(!e||!t)return;return(r?n.default.truncate(e,{length:17}):e)+" "+n.default.split(t,"#")[0].slice(-4)},t.minDistanceLines3D=I,t.minDistanceCuboids=function(e,t){const r=T(e),n=T(t);let o=Number.MAX_VALUE;return r.forEach((e=>{n.forEach((t=>{const r=I(e[0],e[1],t[0],t[1]);o=r<o?r:o}))})),o},t.notEmpty=L,t.getCheckpoints=w,t.getCuboidEdges=function(e,t,r,o=20,i){let a=b(t);const l=s.parseVector3(e.position),u=a.map((e=>s.parseVector3(e).distanceTo(l))),c=n.default.indexOf(u,n.default.max(u));a=n.default.range(8).map((e=>a[7^e^c]));const d=[];return[{isDashed:!1,edgePaths:[[0,1,3,2],[1,5,4,0,2,6,4]]},{isDashed:!0,edgePaths:[[5,7,3],[7,6]]}].forEach((({isDashed:e,edgePaths:t})=>{t.forEach((t=>{const n=[];for(let e=0;e+1<t.length;e+=1){const l=w(a[t[e]],a[t[e+1]],o);try{n.push(...l.map(r).filter(L))}catch(s){i?.(s)}}d.push({points:n,isDashed:e})}))})),d},t.getFaceCenters=t.DEFAULT_SEGMENT_COUNT=t.EULER_ORDER=void 0;var n=f(r(298784)),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}(r(814412)),i=r(527352),a=r(141862),s=r(108040),l=r(39083),u=r(152122),c=r(320716),d=f(r(490063));function f(e){return e&&e.__esModule?e:{default:e}}const h="ZYX";t.EULER_ORDER=h;function p(e){return new o.Euler(e.pitch?-e.pitch:0,e.roll||0,e.yaw,h)}function m(e){const t=(new o.Quaternion).setFromEuler(p(e)).invert(),r=(new o.Matrix4).makeRotationFromQuaternion(t);return(new o.Matrix3).getNormalMatrix(r)}function g(e){const t=p(e);return{xVector3:new o.Vector3(1,0,0).applyEuler(t),yVector3:new o.Vector3(0,1,0).applyEuler(t),zVector3:new o.Vector3(0,0,1).applyEuler(t)}}function y(e,t,r,i=!1){return e.pitch||e.roll?function(e,t,r,i=!0){const a=m(e),s=new o.Vector3(e.position.x,e.position.y,e.position.z),l=e.dimensions.x/2+n.default.get(r,"x",0),u=e.dimensions.y/2+n.default.get(r,"y",0),c=e.dimensions.z/2+n.default.get(r,"z",0),d=l**2+u**2+c**2;return t.filter((e=>{if(s.distanceToSquared(e)>d)return!1;const t=e.clone().sub(s).applyMatrix3(a);return i?Math.abs(t.x)<=l&&Math.abs(t.y)<=u&&Math.abs(t.z)<=c:Math.abs(t.x)<l&&Math.abs(t.y)<u&&Math.abs(t.z)<c}))}(e,t,r,i):function(e,t,r,i=!1){const a=e.dimensions.x/2+n.default.get(r,"x",0),s=e.dimensions.y/2+n.default.get(r,"y",0),l=e.dimensions.z/2+n.default.get(r,"z",0),{xVector3:u,yVector3:c}=g(e),d=new o.Vector3(e.position.x,e.position.y,e.position.z);return t.filter((e=>{const t=e.clone().sub(d),r=Math.abs(u.dot(t)),n=Math.abs(c.dot(t)),o=Math.abs(t.z);return i?n<=s&&r<=a&&o<=l:n<s&&r<a&&o<l}))}(e,t,r,i)}function b(e){const t=s.parseVector3(e.position),{xVector3:r,yVector3:n,zVector3:o}=g(e),i=r.multiplyScalar(e.dimensions.x/2),a=n.multiplyScalar(e.dimensions.y/2),l=o.multiplyScalar(e.dimensions.z/2),u=t.clone(),c=t.clone(),d=t.clone(),f=t.clone(),h=t.clone(),p=t.clone(),m=t.clone(),y=t.clone();return u.add(i).add(a).add(l),c.sub(i).add(a).add(l),d.add(i).sub(a).add(l),f.sub(i).sub(a).add(l),h.add(i).add(a).sub(l),p.sub(i).add(a).sub(l),m.add(i).sub(a).sub(l),y.sub(i).sub(a).sub(l),[u,c,d,f,h,p,m,y]}function T(e){const t=b(e);return[[t[0],t[1]],[t[1],t[3]],[t[3],t[2]],[t[2],t[0]],[t[4],t[5]],[t[5],t[7]],[t[7],t[6]],[t[6],t[4]],[t[0],t[4]],[t[1],t[5]],[t[3],t[7]],[t[2],t[6]]]}t.DEFAULT_SEGMENT_COUNT=20;function v(e){return e.dimensions.x*e.dimensions.y*e.dimensions.z}function x(e,t=0,r=0,n=0){const i=t+e.dimensions.x/2,a=r+e.dimensions.y/2,s=n+e.dimensions.z/2,l=-(2*t+e.dimensions.x)/2,u=-(2*r+e.dimensions.y)/2,c=-(2*n+e.dimensions.z)/2,d=[l,u,c,l,u,s,l,a,c,l,a,s,i,u,c,i,u,s,i,a,c,i,a,s],f=new o.Vector3;let h=Number.POSITIVE_INFINITY,m=Number.POSITIVE_INFINITY,g=Number.POSITIVE_INFINITY,y=Number.NEGATIVE_INFINITY,b=Number.NEGATIVE_INFINITY,T=Number.NEGATIVE_INFINITY;const v=p(e),x=new o.Quaternion;x.setFromEuler(v);for(let o=0;o<d.length;o+=3)f.set(d[o],d[o+1],d[o+2]),f.applyQuaternion(x),h=Math.min(f.x,h),m=Math.min(f.y,m),g=Math.min(f.z,g),y=Math.max(f.x,y),b=Math.max(f.y,b),T=Math.max(f.z,T);h+=e.position.x,y+=e.position.x,m+=e.position.y,b+=e.position.y,g+=e.position.z,T+=e.position.z;return{cuboid:e,minX:h,minY:m,minZ:g,maxX:y,maxY:b,maxZ:T}}function _(e,t,r){let n=!1;for(let o=0,i=r.length-1;o<r.length;i=o++){const a=r[o].x,s=r[o].y,l=r[i].x,u=r[i].y;s>t!==u>t&&e<(l-a)*(t-s)/(u-s)+a&&(n=!n)}return n}function M(e,t,r,n){return{...e,dimensions:{x:e.dimensions.x+t,y:e.dimensions.y+r,z:e.dimensions.z+n}}}t.getFaceCenters=e=>{const t=s.parseVector3(e.position),{xVector3:r,yVector3:n,zVector3:o}=g(e),i=r.multiplyScalar(e.dimensions.x/2),a=n.multiplyScalar(e.dimensions.y/2),l=o.multiplyScalar(e.dimensions.z/2);return[t.clone().add(i),t.clone().sub(i),t.clone().add(a),t.clone().sub(a),t.clone().add(l),t.clone().sub(l)]};const A=function(e,t){e.x+=t.x,e.y+=t.y,e.z+=t.z},k=function(e,t){e.x-=t.x,e.y-=t.y,e.z-=t.z};function P(e){const t=new o.Box3;for(const o of e){const e=b(o);for(let r=0;r<e.length;r++)t.expandByPoint(e[r])}const r=t.getCenter(new o.Vector3),n=t.getSize(new o.Vector3);return{...e[0],yaw:0,position:{x:r.x,y:r.y,z:r.z},dimensions:{x:n.x,y:n.y,z:n.z}}}function E(e){if(!e)return new Float32Array;const t=new Float32Array(3*e.length);for(let r=0;r<e.length;r++)t[3*r+0]=e[r].position.x,t[3*r+1]=e[r].position.y,t[3*r+2]=e[r].position.z;return t}function I(e,t,r,n){const i=(new o.Vector3).subVectors(t,e),a=(new o.Vector3).subVectors(n,r),s=(new o.Vector3).subVectors(e,r),l=i.dot(i),u=i.dot(a),c=a.dot(a),d=i.dot(s),f=a.dot(s);let h,p,m,g;const y=l*c-u*u;h=y,p=y,y<Number.EPSILON?(m=0,h=1,g=f,p=c):(m=u*f-c*d,g=l*f-u*d,m<0?(m=0,g=f,p=c):m>h&&(m=h,g=f+u,p=c)),g<0?(g=0,-d<0?m=0:-d>l?m=h:(m=-d,h=l)):g>p&&(g=p,-d+u<0?m=0:-d+u>l?m=h:(m=-d+u,h=l));const b=Math.abs(m)<Number.EPSILON?0:m/h,T=Math.abs(g)<Number.EPSILON?0:g/p,v=(new o.Vector3).copy(i).multiplyScalar(b),x=(new o.Vector3).copy(a).multiplyScalar(T);return(new o.Vector3).copy(s).add(v).sub(x).length()}function L(e){return null!==e&&void 0!==e}function w(e,t,r=20){return n.default.range(r+1).map((n=>e.clone().lerp(t,n/r)))}},39083:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.computeAngleDiff=l,t.computeIOU=h,t.computeGroupIOU=p,t.build2DPolygonFor=m,t.getIntersectionPolygonArea=g,t.mistakeProperties=t.mistakeCategory=t.zBounds=t.xyzToPoint3D=void 0;var n,o=(n=r(298784))&&n.__esModule?n:{default:n},i=r(593539),a=r(74909);const s=Math.PI;function l(e,t){let r=e-t;return r-=2*s*Math.round(r/(2*s)),r}const u=new i.geom.GeometryFactory,c=({x:e,y:t,z:r})=>Math.max(e,0)*Math.max(t,0)*Math.max(r,0);t.xyzToPoint3D=e=>({x:e[0],y:e[1],z:e[2]});const d=({z:e},{z:t})=>({lo:e-Math.max(t,0)/2,hi:e+Math.max(t,0)/2});t.zBounds=d;const f=e=>{const[t,...r]=e.map((e=>m(e.position,e.dimensions,e.yaw)));let n=t;for(const o of r)n=n.union(o);return n};function h(e,t,r,n,o,i){const a=Math.max(0,Math.min(d(e,t).hi,d(n,o).hi)-Math.max(d(e,t).lo,d(n,o).lo));if(0===a)return 0;const s=c(t)+c(o),l=a*g(e,t,r,n,o,i);let u=s-l;return u=Math.max(u,.001),l/u}function p(e,t){const[r,n]=[e,t].map(f);return r.intersection(n).getArea()/r.union(n).getArea()}function m({x:e,y:t},{x:r,y:n},o){const a=[[(r=Math.max(r,0))/2,(n=Math.max(n,0))/2],[r/2,-n/2],[-r/2,-n/2],[-r/2,n/2],[r/2,n/2]].map((([r,n])=>new i.geom.Coordinate(e+r*Math.cos(o)-n*Math.sin(o),t+n*Math.cos(o)+r*Math.sin(o))));return u.createPolygon(u.createLinearRing(a),[])}function g(e,t,r,n,o,i){return m(e,t,r).intersection(m(n,o,i)).getArea()}const y=Object.freeze({BAD_SIZE:"badSize",BAD_POSITION:"badPosition",BAD_HEADING:"badHeading",BAD_HEADING_25DEG:"badHeading25Deg",BAD_HEADING_45DEG:"badHeading45Deg",STRICT_BAD_HEADING:"strictBadHeading",DEFINITELY_BAD_HEADING:"definitelyBadHeading",MISSING:"missing",EXTRANEOUS:"extraneous",STATIONARY:"stationary",MISLABELED:"mislabeled",BAD_ATTRIBUTES:"badAttributes",BAD_ATTRIBUTES_WEAK:"badAttributesWeak",BAD_Z:"badZ",DEFINITELY_BAD_Z:"definitelyBadZ",WEAK_BAD_Z:"weakBadZ",STRICT_BAD_POSITION:"strictBadPosition",STRICT_BAD_SIZE:"strictBadSize",STRICT_BAD_Z:"strictBadZ",FACE_POSITION:"facePosition",FACE_POSITION_OUTWARDS:"facePositionOutwards",BAD_IOU:"badIOU",WEAK_BAD_IOU:"weakBadIOU",FACE_PARAMETRIZED:"faceParametrized",ATTR_PARAMETRIZED:"attrParametrized",POSITION_RANGE:"positionRange",FACE_RANGE:"faceRange",BAD_GROUP_IOU:"badGroupIOU"});t.mistakeCategory=y;const b=(e,t={},r=!1)=>(n,i)=>{const a=o.default.keys(i.frames);if(r){const r={};o.default.map(a,(a=>{const s=n.frames[a],l=i.frames[a],u=e(s,l,t,a);o.default.map(u,((e,t)=>{r[t]=r[t]||[],e&&r[t].push(a)}))}));return o.default.map(r,((e,t)=>({isIncorrect:e.length>0,frames:e,errorType:t})))}{const r=o.default.compact(o.default.map(a,(r=>{const o=n.frames[r],a=i.frames[r];return e(o,a,t,r)?r:void 0})));return[{isIncorrect:r.length>0,frames:r}]}},T=(e,t,{threshold:r})=>!e||a.naiveDistance(e.dimensions,t.dimensions)>r,v=(e,t,{threshold:r})=>!e||a.naiveDistance(e.position,t.position)>r,x=(e,t,{perFramePositionRanges:r,sizeRange:n},o)=>{const i=(e,t,r)=>e>Math.max(t,r)+.01||Math.min(t,r)>e+.01,a=(e,t,r)=>e&&(i(e.x,t[0],r[0])||i(e.y,t[1],r[1])||i(e.z,t[2],r[2]));if(r[o]){const{r1:t,r2:n}=r[o];if(a(e&&e.position,t,n))return!0}if(n){const{r1:t,r2:r}=n;return a(e&&e.dimensions,t,r)}return!1},_=(e,t,{perFrameFaceRanges:r,faceRanges:n},i)=>{if(!e)return!0;const s=o.default.get(r,i)||n;if(!s)return!1;const{r1:l,r2:u}=s,c=a.getFaceCenters({...l,yaw:0}),d=a.getFaceCenters({...u,yaw:0}),f=a.getFaceCenters({...e,yaw:0}),h=o.default.zipWith(f,c,d,["x","x","y","y","z","z"],((e,t,r,n)=>{return o=e[n],i=t[n],a=r[n],o>Math.max(i,a)+.02||Math.min(i,a)>o+.02;var o,i,a}));return o.default.some(h)},M=(e,t,{yawThreshold:r})=>{if(o.default.includes(["no label zone","no label"],o.default.toLower(t.label)))return!1;const n=e?l(e.yaw,t.yaw):1/0;return Math.abs(n)>r},A=(e,t,{threshold:r})=>{const n=e=>e.position.z-e.dimensions.z/2,o=e?n(e)-n(t):0;return Math.abs(o)>r},k=(e,t,r,n)=>t?o.default.mapValues(t.attributes,((i,a)=>((e,t,{attributeThreshold:r,perFrameAttributeRanges:n},i,a)=>{if(n&&n[i]){const t=n[i];return!!e&&t[a]&&!o.default.includes(t[a],e.attributes[a])}if("visibility"===a){const n=o.default.get(e,"attributes.visibility"),i=o.default.get(t,"attributes.visibility");if(n&&n!==i){let e={"41%-60%":["61%-80%"],"61%-80%":["41%-60%"]};r>0&&(e={"21%-40%":["41%-60%"],"41%-60%":["21%-40%","61%-80%"],"61%-80%":["41%-60%","81%-100%"],"81%-100%":["61%-80%"]});const t=e[n];if(!t||!o.default.includes(t,i))return!0}return!1}return!!e&&e.attributes[a]!==t.attributes[a]})(e,t,r,n,a))):{},P=(e,t,{threshold:r})=>!e||h(e.position,e.dimensions,e.yaw,t.position,t.dimensions,t.yaw)<r;const E=(e,t,{threshold:r,perFramePerFaceThresholds:n,noLabelThreshold:i=.3},s)=>{if(!e)return!0;if(o.default.includes(["no label zone","no label"],o.default.toLower(t.label)))return P(e,t,{threshold:i});const l=a.getFaceCenters(t),u=a.getFaceCenters(e);let c;if(n&&n[s]){const e=n[s];c=o.default.zipWith(u,l,e,((e,t,r)=>e.distanceTo(t)>r))}else c=o.default.zipWith(u,l,((e,t)=>e.distanceTo(t)>r));return o.default.some(c)},I={[y.BAD_SIZE]:{title:"Incorrect size",grader:b(T,{threshold:.6}),maxPerFrameWeight:1},[y.BAD_POSITION]:{title:"Incorrect position",grader:b(v,{threshold:.6}),maxPerFrameWeight:1},[y.STRICT_BAD_HEADING]:{title:"Incorrect heading (2 deg, really strict)",description:"Accepts headings within 2 degrees. So if the correct answer is 100, the grader would \naccept answers between 98 degrees and 102 degrees. This is really strict.",grader:b(M,{yawThreshold:.04}),maxPerFrameWeight:1},[y.DEFINITELY_BAD_HEADING]:{title:"Incorrect heading (5 deg, pretty strict)",description:"Accepts headings within 5 degrees. So if the correct answer is 100, the grader would \naccept answers between 95 degrees and 105 degrees.",grader:b(M,{yawThreshold:.09}),maxPerFrameWeight:1},[y.BAD_HEADING]:{title:"Incorrect heading (10 deg)",description:"Accepts headings within 10 degrees (this is pretty strict). So if the correct answer is 100, the \ngrader would accept answers between 75 degrees and 125 degrees",grader:b(M,{yawThreshold:.17}),maxPerFrameWeight:1},[y.BAD_HEADING_25DEG]:{title:"Incorrect heading (25 deg)",description:"Accepts headings within 25 degrees. So if the correct answer is 100, the grader would accept answers \nbetween 75 degrees and 125 degrees",grader:b(M,{yawThreshold:.44}),maxPerFrameWeight:1},[y.BAD_HEADING_45DEG]:{title:"Incorrect heading (45 deg)",description:"Accepts headings within 45 degrees. So if the correct answer is 100, the grader would accept answers \nbetween 55 degrees and 145 degrees. Good for pedestrians, esp when pedestrians are blurry.",grader:b(M,{yawThreshold:.78}),maxPerFrameWeight:1},[y.BAD_Z]:{title:"Incorrect Z-index",grader:b(A,{threshold:.03}),maxPerFrameWeight:1},[y.BAD_ATTRIBUTES]:{title:"Incorrect Attributes",grader:b(k,{},!0),maxPerFrameWeight:1},[y.BAD_ATTRIBUTES_WEAK]:{title:"Incorrect Attributes (relaxed)",grader:b(k,{attributeThreshold:1},!0),maxPerFrameWeight:1},[y.STATIONARY]:{title:"Stationary",grader:(e,t)=>[{isIncorrect:e.stationary!==t.stationary}],maxPerFrameWeight:0},[y.MISLABELED]:{title:"Incorrect label",grader:(e,t)=>[{isIncorrect:e.label!==t.label}],maxPerFrameWeight:0},[y.STRICT_BAD_SIZE]:{title:"Incorrect size (strict)",grader:b(T,{threshold:.3}),maxPerFrameWeight:1},[y.STRICT_BAD_POSITION]:{title:"Incorrect position (strict)",grader:b(v,{threshold:.3}),maxPerFrameWeight:1},[y.WEAK_BAD_Z]:{title:"Incorrect Z-index (relaxed)",grader:b(A,{threshold:.2}),maxPerFrameWeight:1},[y.STRICT_BAD_Z]:{title:"Incorrect Z-index (strict)",grader:b(A,{threshold:.035}),maxPerFrameWeight:1},[y.MISSING]:{title:"Missing cuboid",maxPerFrameWeight:0},[y.EXTRANEOUS]:{title:"Cuboid should have been deleted",maxPerFrameWeight:1},[y.DEFINITELY_BAD_Z]:{title:"Incorrect Z-index (very wrong)",grader:b(A,{threshold:.05}),maxPerFrameWeight:1},[y.FACE_POSITION]:{title:"Incorrect cuboid (position or size)",description:"Use this grader to grade the tasker's cuboid by checking the center positions of each face. \nThis grader will consider tasker correct if each of the faces in the tasker's cuboid is\nwithin 0.2m of the corresponding face of the cuboid in the answer key.",grader:b(E,{threshold:.2}),maxPerFrameWeight:1},[y.FACE_POSITION_OUTWARDS]:{title:"Incorrect cuboid (position or size)",description:"Use this grader when the answer key cuboids are the tightest acceptable answer. \nThis grader will consider tasker correct if tasker's cuboid is no more than 0.05m smaller \nthan the answer key cuboid and no more than 0.2m larger than the answer key cuboid",grader:b(((e,t,{innerThreshold:r,outerThreshold:n,perFramePerFaceInnerThresholds:i,perFramePerFaceOuterThresholds:s},l)=>{if(!e)return!0;o.default.includes(["no label zone","no label"],o.default.toLower(t.label))&&(r=.5,n=5);const u=a.getFaceCenters(t),c=a.getFaceCenters(e);function d(e,t,r,n){return e>t+n||e<t-r}const f=["x","x","y","y","z","z"],h=[1,-1,1,-1,1,-1];let p;if(i&&i[l]&&s&&s[l]){const e=i[l],t=s[l];p=o.default.zipWith(c,u,f,h,((r,n,o,i)=>d(r[o]*i,n[o]*i,e,t)))}else p=o.default.zipWith(c,u,f,h,((e,t,o,i)=>d(e[o]*i,t[o]*i,r,n)));return o.default.some(p)}),{outerThreshold:.2,innerThreshold:.05}),maxPerFrameWeight:1},[y.BAD_IOU]:{title:"Incorrect cuboid (overlap, strict)",description:"Use this grader when tasker's cuboid should overlap cuboid from answer key by at least 75%",grader:b(P,{threshold:.75}),maxPerFrameWeight:1},[y.WEAK_BAD_IOU]:{title:"Incorrect cuboid (overlap, relaxed)",description:"Use this grader when tasker's cuboid should overlap cuboid from answer key by at least 50%",grader:b(P,{threshold:.5}),maxPerFrameWeight:1},[y.FACE_PARAMETRIZED]:{title:"Incorrect cuboid (position or size)",description:"This is a parameterized grader - only use this if you know what you are doing.",grader:e=>b(E,e),maxPerFrameWeight:1},[y.ATTR_PARAMETRIZED]:{title:"Incorrect attributes",description:"This is a parameterized grader - only use this if you know what you are doing.",grader:e=>b(k,e,!0),maxPerFrameWeight:1},[y.POSITION_RANGE]:{title:"Incorrect cuboid (position)",description:"This is a parameterized grader - only use this if you know what you are doing.",grader:e=>b(x,e),maxPerFrameWeight:1},[y.FACE_RANGE]:{title:"Incorrect cuboid (position or size)",description:"This grader will consider tasker correct if tasker's cuboid is no more \nthan 0.02 larger or smaller than the cuboid range",grader:e=>b(_,e),maxPerFrameWeight:1},[y.BAD_GROUP_IOU]:{title:"Incorrect Cuboid Group",grader:((e,t={})=>(r,n)=>{const i=o.default.keys(n.cuboids[0].frames),a=o.default.compact(o.default.map(i,(o=>{const i=r.cuboids.map((e=>e.frames[o])),a=n.cuboids.map((e=>e.frames[o]));return e(i,a,t)?o:void 0})));return[{isIncorrect:a.length>0,frames:a}]})((function(e,t,{threshold:r}){return p(e,t)<r}),{threshold:.5}),maxPerFrameWeight:1}};t.mistakeProperties=I},894574:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPointKey=M,t.filterDuplicateMissingAnnotations=function(e){const[t,r]=i.default.partition(e,(e=>i.default.every(e.props.perFrame.position,(e=>e))));return i.default.uniqBy([...t,...r],(e=>M(e.props.static)))},t.READ_ONLY_ACTIONS=t.MAX_ERROR_THRESHOLD=t.MEAN_ERROR_THRESHOLD=t.CONSENSUS_ERROR_THRESHOLDS=t.SKELETON_LABELS=t.SHOULDER_RIGHT_LABEL=t.SHOULDER_LEFT_LABEL=t.ELBOW_RIGHT_LABEL=t.ELBOW_LEFT_LABEL=t.WRIST_RIGHT_LABEL=t.WRIST_LEFT_LABEL=t.HIP_RIGHT_LABEL=t.HIP_LEFT_LABEL=t.KNEE_RIGHT_LABEL=t.KNEE_LEFT_LABEL=t.ANKLE_RIGHT_LABEL=t.ANKLE_LEFT_LABEL=t.CENTER_HEAD_LABEL=t.NOSE_LABEL=t.KeypointFailure=void 0;var n,o,i=(n=r(298784))&&n.__esModule?n:{default:n};t.KeypointFailure=o,function(e){e.MissingCamera="missing-camera",e.InvisibleCuboid="invisible-cuboid",e.ImproperSubtasks="improper-subtasks",e.MissingCuboid="missing-cuboid",e.MultiCuboid="multi-cuboid",e.GeneralError="general-error",e.MissingPoints="missing-points",e.FloatingCuboid="floating-cuboid",e.UndergroundCuboid="underground-cuboid"}(o||(t.KeypointFailure=o={}));const a="Nose";t.NOSE_LABEL=a;const s="Center of Head";t.CENTER_HEAD_LABEL=s;const l="Ankle-Left";t.ANKLE_LEFT_LABEL=l;const u="Ankle-Right";t.ANKLE_RIGHT_LABEL=u;const c="Knee-Left";t.KNEE_LEFT_LABEL=c;const d="Knee-Right";t.KNEE_RIGHT_LABEL=d;const f="Hip-Left";t.HIP_LEFT_LABEL=f;const h="Hip-Right";t.HIP_RIGHT_LABEL=h;const p="Wrist-Left";t.WRIST_LEFT_LABEL=p;const m="Wrist-Right";t.WRIST_RIGHT_LABEL=m;const g="Elbow-Left";t.ELBOW_LEFT_LABEL=g;const y="Elbow-Right";t.ELBOW_RIGHT_LABEL=y;const b="Shoulder-Left";t.SHOULDER_LEFT_LABEL=b;const T="Shoulder-Right";t.SHOULDER_RIGHT_LABEL=T;const v=[b,T,g,y,p,m,f,h,c,d,l,u,s,a];t.SKELETON_LABELS=v;const x=Object.freeze({[s]:.036,[a]:.049,[b]:.049,[T]:.049,[g]:.054,[y]:.054,[p]:.079,[m]:.079,[f]:.065,[h]:.065,[c]:.064,[d]:.064,[l]:.077,[u]:.077});t.CONSENSUS_ERROR_THRESHOLDS=x;t.MEAN_ERROR_THRESHOLD=.04;t.MAX_ERROR_THRESHOLD=.15;const _=Object.freeze({origLabels:{_ignore:{changeParams:!1}},currLabels:{_ignore:{changeParams:!1}},blockCreateAndDelete:!0,creatable:[],editableAttrs:[],enforceWithoutOrigLabel:!0});function M(e){return`${e.label}-${e.linkedCuboidId}`}t.READ_ONLY_ACTIONS=_},108040:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Axis=t.vec3ArraySortBy=t.foreachVec4Array=t.foreachVec3Array=t.mapFilterVec3Array=t.filterMapVec3Array=t.mapVec3Array=t.filterVec3Array=t.filterCountVec3Array=t.prettify=t.vsub=t.vadd=t.vectorToObject=t.parseVector4=t.parseVector3=t.parseVector2=void 0;var n=a(r(298784)),o=a(r(141862)),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}(r(814412));function a(e){return e&&e.__esModule?e:{default:e}}t.parseVector2=e=>new i.Vector2(parseFloat(e.x),parseFloat(e.y));t.parseVector3=e=>new i.Vector3(parseFloat(e.x),parseFloat(e.y),parseFloat(e.z));t.parseVector4=e=>new i.Vector4(parseFloat(e.x),parseFloat(e.y),parseFloat(e.z),parseFloat(e.w));t.vectorToObject=e=>{if(e.isVector4){const t=e;return{type:"vec4",x:t.x,y:t.y,z:t.z}}if(e.isVector3){const t=e;return{type:"vec3",x:t.x,y:t.y,z:t.z}}{const t=e;return{type:"vec2",x:t.x,y:t.y}}};t.vadd=(e,t)=>{if(e.isVector2||e.isVector3||e.isVector4){const r=e.clone();return r.add(t),r}return e-t};t.vsub=(e,t)=>{if(e.isVector2||e.isVector3||e.isVector4){const r=e.clone();return r.sub(t),r}return e-t};t.prettify=e=>{const t=o.default.round(e.x,4),r=o.default.round(e.y,4),n=o.default.round(e.z,4),i=o.default.round(e.w,4);return e.isVector4?`<${t}, ${r}, ${n}, ${i}>`:e.isVector3?`<${t}, ${r}, ${n}>`:e.isVector2?`<${t}, ${r}>`:e.toString()};t.filterCountVec3Array=(e,t,r=-1)=>{let n=0;const o=new i.Vector3;for(let i=0;i<e.length&&(o.fromArray(e,i),!t(o)||(n++,n!==r));i+=3);return n};t.filterVec3Array=(e,t)=>{const r=new Float32Array(e.length);let n=0;const o=new i.Vector3;for(let i=0;i<e.length;i+=3){o.fromArray(e,i);t(o)&&(o.toArray(r,n),n+=3)}return r.slice(0,n)};t.mapVec3Array=(e,t)=>{const r=new Float32Array(e.length),n=new i.Vector3;for(let o=0;o<e.length;o+=3)n.fromArray(e,o),t(n).toArray(r,o);return r};t.filterMapVec3Array=(e,t)=>{const r=new Float32Array(e.length);let n=0;const o=new i.Vector3;for(let i=0;i<e.length;i+=3){o.fromArray(e,i);t(o)&&(o.toArray(r,n),n+=3)}return r.slice(0,n)};t.mapFilterVec3Array=(e,t)=>{const r=new Float32Array(e.length);let n=0;const o=new i.Vector3;for(let i=0;i<e.length;i+=3){o.fromArray(e,i);const a=t(o);a&&(a.toArray(r,n),n+=3)}return r.slice(0,n)};t.foreachVec3Array=(e,t)=>{const r=new i.Vector3;for(let n=0;n<e.length;n+=3)r.fromArray(e,n),t(r,n/3)};t.foreachVec4Array=(e,t)=>{const r=new i.Vector4;for(let n=0;n<e.length;n+=4)r.fromArray(e,n),t(r,n/4)};var s;t.vec3ArraySortBy=(e,t)=>{const r=new Float32Array(e.length),o=new i.Vector3,a=n.default.range(e.length/3);void 0===t&&(t=[n.default.identity]),t instanceof Function&&(t=[t]),t=n.default.map(t,(t=>r=>t((t=>o.fromArray(e,3*t))(r))));const s=n.default.sortBy(a,t);for(let n=0;n<s.length;n++)r[3*n]=e[3*s[n]],r[3*n+1]=e[3*s[n]+1],r[3*n+2]=e[3*s[n]+2];return r},t.Axis=s,function(e){e.X="x",e.Y="y",e.Z="z"}(s||(t.Axis=s={}))},378970:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(...e){return e.reduce(((e,t)=>e.flatMap((e=>t.map((t=>[e,t].flat()))))))}},490503:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.downsampleCoordsByAngle=function(e,t=2.5){if(e.length<=2)return e;const r=[];e.slice(0,-1).forEach(((t,n)=>{const o=e[n+1],i=o.x-t.x,a=o.y-t.y;r.push(Math.atan2(a,i)*(180/Math.PI))}));const n=[];let o=0;for(;o<r.length;){const e=r[o];let i=0,a=o+1;for(;a<r.length&&(i+=Math.abs(r[a]-e),!(i>=t));)n.push(a),a++;o=a}return e.filter(((e,t)=>!n.includes(t)))},t.extendLineSegment=t.projectVerticesOntoPolyline=t.computeDistanceToPolyline=t.computeFCD=t.projectVertexOntoLine=t.polylineLen=t.computeSegmentLength=t.dist=void 0;var n,o=(n=r(298784))&&n.__esModule?n:{default:n},i=r(440169),a=r(950382);const s=(e,t)=>Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y));t.dist=s;t.computeSegmentLength=([e,t])=>s(e,t);t.polylineLen=e=>o.default.sum(o.default.range(e.length-1).map((t=>s(e[t],e[t+1]))));t.projectVertexOntoLine=([e,t],r,n)=>{a.samePoint(e,t,0)&&(t={x:e.x+1,y:e.y});const o=r.x-e.x,i=r.y-e.y,l=t.x-e.x,u=t.y-e.y,c=(o*l+i*u)/(l*l+u*u);if(n&&(c<=n[0]||c>=n[1]))return null;const d={x:e.x+c*l,y:e.y+c*u};return{proj:d,coeff:c,distance:s(r,d)}};t.computeFCD=(e,t)=>Math.sqrt(o.default.max([i.vertexSqDistanceToSegment(e[0],t),i.vertexSqDistanceToSegment(e[1],t),i.vertexSqDistanceToSegment(t[0],e),i.vertexSqDistanceToSegment(t[1],e)]));t.computeDistanceToPolyline=(e,t)=>Math.sqrt(o.default.min(o.default.range(t.length-1).map((r=>i.vertexSqDistanceToSegment(e,[t[r],t[r+1]])))));t.projectVerticesOntoPolyline=(e,t,r=1/0,n=0)=>o.default.flatMap(e,((i,l)=>{if(l+1===e.length)return[i];const u=e[l+1],c=s(i,u),d=function([e,t],[r,n],o){a.samePoint(e,t,0)&&(t={x:e.x+1,y:e.y});const i=t.x-e.x,l=t.y-e.y,u=i*i+l*l,c=n*u,d=r*u;return t=>{const r=t.x-e.x,n=t.y-e.y,a=r*i+n*l;if(a<=d||a>=c)return null;const f=a/u,h={x:e.x+f*i,y:e.y+f*l},p=s(t,h);return p>o?null:{proj:h,coeff:f,distance:p}}}([i,u],0===c?[0,1]:[n/c,1-n/c],r),f=[];for(const e of t){const t=d(e);t&&f.push(t)}f.sort(((e,t)=>e.coeff-t.coeff));const h=[],p=n/c;for(const e of f)(0===h.length||0===p||e.coeff>o.default.last(h).coeff+p)&&h.push(e);return[i,...o.default.map(h,"proj")]}));t.extendLineSegment=(e,t,r)=>{if(0===s(e,t))return e;const n=r/s(e,t);return{x:t.x+n*(t.x-e.x),y:t.y+n*(t.y-e.y)}}},716375:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"AreaGeofence",{enumerable:!0,get:function(){return n.AreaGeofence}}),Object.defineProperty(t,"VolumeGeofence",{enumerable:!0,get:function(){return n.VolumeGeofence}}),Object.defineProperty(t,"WhaleGeofence",{enumerable:!0,get:function(){return n.WhaleGeofence}}),Object.defineProperty(t,"Geofence",{enumerable:!0,get:function(){return n.Geofence}}),Object.defineProperty(t,"AttributeCondition",{enumerable:!0,get:function(){return n.AttributeCondition}}),Object.defineProperty(t,"ActualAttributeConditions",{enumerable:!0,get:function(){return n.ActualAttributeConditions}}),Object.defineProperty(t,"CategoricalAttribute",{enumerable:!0,get:function(){return n.CategoricalAttribute}}),Object.defineProperty(t,"NumericalAttribute",{enumerable:!0,get:function(){return n.NumericalAttribute}}),Object.defineProperty(t,"NumericalArrayAttribute",{enumerable:!0,get:function(){return n.NumericalArrayAttribute}}),Object.defineProperty(t,"LinkedAttribute",{enumerable:!0,get:function(){return n.LinkedAttribute}}),Object.defineProperty(t,"NERGlobalAttribute",{enumerable:!0,get:function(){return n.NERGlobalAttribute}}),Object.defineProperty(t,"AnnotationAttribute",{enumerable:!0,get:function(){return n.AnnotationAttribute}}),Object.defineProperty(t,"AnnotationAttributes",{enumerable:!0,get:function(){return n.AnnotationAttributes}}),Object.defineProperty(t,"AnnotationGeometry",{enumerable:!0,get:function(){return n.AnnotationGeometry2D}}),t.isBoxAnnotation=function(e){return!!e.geometry&&e.geometry===n.AnnotationGeometry2D.Box||"type"in e&&e.type===n.AnnotationGeometry2D.Box},t.isLinkableBoxAnnotation=function(e){return!!e.type&&e.type===n.AnnotationGeometry2D.Box},t.isLinkablePointAnnotation=function(e){return!!e.type&&e.type===n.AnnotationGeometry2D.Point},t.isLinkablePolygonAnnotation=function(e){return!!e.type&&e.type===n.AnnotationGeometry2D.Polygon},t.isPathAnnotation=function(e){return!!e.geometry&&i.includes(e.geometry)&&!!e.vertices},t.isPolygonAnnotation=function(e){return(!!e.geometry&&e.geometry===n.AnnotationGeometry2D.Polygon||"type"in e&&e.type===n.AnnotationGeometry2D.Polygon)&&!!e.vertices},t.isLineAnnotation=function(e){return(!!e.geometry&&e.geometry===n.AnnotationGeometry2D.Line||"type"in e&&e.type===n.AnnotationGeometry2D.Line)&&!!e.vertices},t.isPathImageAnnotation=function(e){return e.geometry===n.AnnotationGeometry2D.Line||e.geometry===n.AnnotationGeometry2D.Polygon},t.isPointAnnotation=function(e){return!!e.geometry&&e.geometry===n.AnnotationGeometry2D.Point||"type"in e&&e.type===n.AnnotationGeometry2D.Point},t.isCuboidAnnotation=function(e){return!!e.geometry&&e.geometry===n.AnnotationGeometry2D.Cuboid||"type"in e&&e.type===n.AnnotationGeometry2D.Cuboid},t.isFrontendOrBackendPathAnnotation=function(e){return f(e)||h(e)},t.isFrontendOrBackendPolygonAnnotation=f,t.isFrontendOrBackendLineAnnotation=h,t.isFrontendOrBackendPointAnnotation=function(e){let t;"geometry"in e?t=e.geometry:"type"in e&&(t=e.type);return t===n.AnnotationGeometry2D.Point&&"x"in e&&"y"in e},t.isFrontendOrBackendSpotterAnnotation=function(e){return[o.SPOTTER_POLYGON,o.SPOTTER_POINT].includes(e.label??"")},t.LinkNotPresent=t.GLOBAL_ATTRIBUTES_GRADER_ID=t.CuboidEdgeDesc=t.CuboidVertexDesc=t.KeyframeType=t.taskTypeToGeometry=t.geometryToVideoTaskType=t.geometryToTaskType=t.pathGeometries=void 0;var n=r(167469),o=r(143986);const i=[n.AnnotationGeometry2D.Line,n.AnnotationGeometry2D.Polygon];t.pathGeometries=i;const a={Polygon:n.TaskType.PolygonAnnotation,Point:n.TaskType.PointAnnotation,[n.AnnotationGeometry2D.Ellipse]:n.TaskType.EllipseAnnotation,[n.AnnotationGeometry2D.Point]:n.TaskType.PointAnnotation,[n.AnnotationGeometry2D.Box]:n.TaskType.Annotation,[n.AnnotationGeometry2D.Line]:n.TaskType.LineAnnotation,[n.AnnotationGeometry2D.Cuboid]:n.TaskType.CuboidAnnotation,[n.AnnotationGeometry2D.Polygon]:n.TaskType.PolygonAnnotation,[n.AnnotationGeometry2D.LidarCuboid]:n.TaskType.LidarAnnotation,[n.AnnotationGeometry2D.LidarPoint]:n.TaskType.LidarPointAnnotation};t.geometryToTaskType=a;const s={[n.AnnotationGeometry2D.Ellipse]:n.TaskType.EllipseAnnotation,[n.AnnotationGeometry2D.Point]:n.TaskType.PointAnnotation,[n.AnnotationGeometry2D.Box]:n.TaskType.VideoBoxAnnotation,[n.AnnotationGeometry2D.Line]:n.TaskType.LineAnnotation,[n.AnnotationGeometry2D.Cuboid]:n.TaskType.VideoCuboidAnnotation,[n.AnnotationGeometry2D.Polygon]:n.TaskType.VideoPolygonAnnotation};t.geometryToVideoTaskType=s;const l={[n.TaskType.PointAnnotation]:n.AnnotationGeometry2D.Point,[n.TaskType.LineAnnotation]:n.AnnotationGeometry2D.Line,[n.TaskType.Annotation]:n.AnnotationGeometry2D.Box,[n.TaskType.CuboidAnnotation]:n.AnnotationGeometry2D.Cuboid,[n.TaskType.PolygonAnnotation]:n.AnnotationGeometry2D.Polygon,[n.TaskType.VideoBoxAnnotation]:n.AnnotationGeometry2D.Box,[n.TaskType.VideoCuboidAnnotation]:n.AnnotationGeometry2D.Cuboid,[n.TaskType.VideoPolygonAnnotation]:n.AnnotationGeometry2D.Polygon,[n.TaskType.LidarAnnotation]:n.AnnotationGeometry2D.LidarCuboid,[n.TaskType.LidarPointAnnotation]:n.AnnotationGeometry2D.LidarPoint};var u,c,d;t.taskTypeToGeometry=l,t.KeyframeType=u,function(e){e.Start="start",e.Middle="middle",e.End="end"}(u||(t.KeyframeType=u={})),t.CuboidVertexDesc=c,function(e){e.FaceTopLeft="face-topleft",e.FaceBottomLeft="face-bottomleft",e.FaceTopRight="face-topright",e.FaceBottomRight="face-bottomright",e.SideTopCorner="side-topcorner",e.SideBottomCorner="side-bottomcorner"}(c||(t.CuboidVertexDesc=c={})),t.CuboidEdgeDesc=d,function(e){e.FaceTop="face-top",e.FaceBottom="face-bottom",e.FaceLeft="face-left",e.FaceRight="face-right",e.SideTop="side-top",e.SideBottom="side-bottom",e.SideBack="side-back"}(d||(t.CuboidEdgeDesc=d={}));t.GLOBAL_ATTRIBUTES_GRADER_ID="_global_attributes";function f(e){let t;return"geometry"in e?t=e.geometry:"type"in e&&(t=e.type),t===n.AnnotationGeometry2D.Polygon&&"vertices"in e}function h(e){let t;return"geometry"in e?t=e.geometry:"type"in e&&(t=e.type),t===n.AnnotationGeometry2D.Line&&"vertices"in e}t.LinkNotPresent="__LINK_NOT_PRESENT__"},492027:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createLineFromPoints=t.createEdgeFromPoints=t.getPointsFromLine=t.createLineFromEdges=t.isSharedDerivedPoint=t.isLayer2DerivedPoint=t.isLayer1DerivedPoint=t.hasDerivedVertices=t.hasLayer2Vertices=t.hasLayer1Vertices=t.isPrimitiveAnnotation=t.isDerivedAnnotation=t.isDerivedLayerPoint=t.CONSERVATIVE_DRZ_VERTEX_SPACIN_DECIMAL_PLACE=t.CONSERVATIVE_DRZ_VERTEX_SPACING=t.DEFAULT_PERCISION_DRZ_ALIGNMENT_DECIMAL_PLACE=t.DEFAULT_PERCISION_DRZ_ALIGNMENT=t.DERIVED_ANNOTATION_VERSION=void 0;var n,o=(n=r(298784))&&n.__esModule?n:{default:n},i=r(308408);t.DERIVED_ANNOTATION_VERSION=2;t.DEFAULT_PERCISION_DRZ_ALIGNMENT=1e-5;t.DEFAULT_PERCISION_DRZ_ALIGNMENT_DECIMAL_PLACE=5;t.CONSERVATIVE_DRZ_VERTEX_SPACING=1e-7;t.CONSERVATIVE_DRZ_VERTEX_SPACIN_DECIMAL_PLACE=7;t.isDerivedLayerPoint=e=>!!e.layer1VertexId||!!e.layer2VertexId;t.isDerivedAnnotation=e=>!!e.metadata?.derivedMetadata;t.isPrimitiveAnnotation=e=>!!e.vertices?.some(l);const a=e=>i.isPathAnnotation(e)&&o.default.some(e.vertices,(e=>l(e)));t.hasLayer1Vertices=a;const s=e=>i.isPathAnnotation(e)&&o.default.some(e.vertices,(e=>u(e)));t.hasLayer2Vertices=s;t.hasDerivedVertices=e=>a(e)||s(e);const l=e=>!!e.layer1VertexId;t.isLayer1DerivedPoint=l;const u=e=>!!e.layer2VertexId;t.isLayer2DerivedPoint=u;t.isSharedDerivedPoint=(e,t)=>{const r=o.default.round(e.x,5)===o.default.round(t.x,5),n=o.default.round(e.y,5)===o.default.round(t.y,5);return r&&n};t.createLineFromEdges=e=>({edges:e});t.getPointsFromLine=e=>{const t=[];return e.edges.forEach(((e,r)=>{0===r&&t.push(e.start),t.push(e.end)})),t};const c=(e,t)=>({start:e,end:t});t.createEdgeFromPoints=c;t.createLineFromPoints=e=>{const t=[];return e.forEach(((r,n)=>{n!==e.length-1&&t.push(c(r,e[n+1]))})),{edges:t}}},946305:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},308408:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={},o=s(r(716375));Object.keys(o).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(n,e)||e in t&&t[e]===o[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}}))}));var i=s(r(492027));Object.keys(i).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(n,e)||e in t&&t[e]===i[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}}))}));var a=s(r(946305));function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(n,e)||e in t&&t[e]===a[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}}))}))},116615:function(e,t){"use strict";var r,n,o,i,a,s;Object.defineProperty(t,"__esModule",{value:!0}),t.FieldType=t.FeaturePricingTier=t.FeaturePriority=t.ContentFlag=t.FeatureType=t.GeometryType=void 0,t.GeometryType=r,function(e){e.BoundingBox="box",e.Polygon="polygon"}(r||(t.GeometryType=r={})),t.FeatureType=n,function(e){e.Text="text",e.Block="block",e.Group="group",e.Record="record"}(n||(t.FeatureType=n={})),t.ContentFlag=o,function(e){e.Line="line",e.Key="key",e.Value="value",e.Thead="thead",e.Tbody="tbody",e.Date="date",e.Money="money",e.Checkbox="checkbox",e.Region="region",e.Query="query",e.Span="span"}(o||(t.ContentFlag=o={})),t.FeaturePriority=i,function(e){e.P0="Most Critical",e.P1="Critical",e.default="Regular"}(i||(t.FeaturePriority=i={})),t.FeaturePricingTier=a,function(e){e.Basic="Basic",e.Premium="Premium"}(a||(t.FeaturePricingTier=a={})),t.FieldType=s,function(e){e.Select="select"}(s||(t.FieldType=s={}))},257868:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createEmpty=i,t.pick=function(e,t,r=1){const n=i(e,t.length*r);for(let o=0;o<t.length;o++)for(let i=0;i<r;i++)n[o*r+i]=e[t[o]*r+i];return n},t.concat=function(e){if(!e.length)return;const t=o.default.sum(e.map((e=>e.length))),r=i(e[0],t);let n=0;return e.forEach((e=>{r.set(e,n),n+=e.length})),r},t.range=function(e,t){const r=new Uint32Array(t-e);for(let n=0;n<r.length;n++)r[n]=n+e;return r};var n,o=(n=r(298784))&&n.__esModule?n:{default:n};function i(e,t=0){return new(0,e.constructor)(t)}},311311:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addPathVertex=t.updatePathVertex=t.moveAndClampPolygon=t.getFragmentsFromVertices=t.addNewFragment=t.splitPointsByFragment=t.isMultiPolygon=void 0;var n,o=(n=r(298784))&&n.__esModule?n:{default:n},i=r(136622);t.isMultiPolygon=e=>!o.default.isEmpty(e.multiple_polygon_vertices);t.splitPointsByFragment=(e,t)=>o.default.isNil(e)?[]:o.default.isEmpty(t)?[e]:o.default.reduce(t,((e,t)=>(e.push(t.vertices),e)),[]);t.addNewFragment=(e,t)=>{const r=e.vertices,n=t,o=[...r,...n],i=[...e.multiple_polygon_vertices??[{vertices:r}],{vertices:n}];return{...e,vertices:o,multiple_polygon_vertices:i}};const a=(e,t)=>{if(o.default.isEmpty(t))return;let r=0;return o.default.map(t,(t=>{const n=e.slice(r,r+t.vertices.length);return r+=t.vertices.length,{vertices:n}}))};t.getFragmentsFromVertices=a;t.moveAndClampPolygon=(e,t,r,n)=>{const o=e.vertices.map((e=>({...e,x:e.x+t,y:e.y+r})));return i.clampPolygonAnnotationVertices(o,n),{...e,vertices:o,multiple_polygon_vertices:a(o,e.multiple_polygon_vertices)}};t.updatePathVertex=(e,t,r)=>{const n=Object.assign([],e.vertices,{[t]:r});return{vertices:n,multiple_polygon_vertices:a(n,e.multiple_polygon_vertices)}};t.addPathVertex=(e,t,r)=>{const n=[...e.vertices.slice(0,t),r,...e.vertices.slice(t)];if(o.default.isEmpty(e.multiple_polygon_vertices))return{vertices:n};const i=[];let a=t;return o.default.each(e.multiple_polygon_vertices,(e=>{let t=e;a>=0&&a<=e.vertices.length&&(t={vertices:[...e.vertices.slice(0,a),r,...e.vertices.slice(a)]}),i.push(t),a-=e.vertices.length})),{vertices:n,multiple_polygon_vertices:i}}},260160:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getBoundingBox=s,t.getLineLength=l,t.getPolygonArea=function(e){if(e.length<4)return l(e);const t=new a.geom.GeometryFactory;return t.createPolygon(t.createLinearRing(e.map((({x:e,y:t})=>new a.geom.Coordinate(e,t)))),[]).getArea()},t.standardizeExtremalPoints=function(e){if(!e||!e.vertices)return{};const t=[...e.vertices].sort(((e,t)=>e.x-t.x)),r=[...e.vertices].sort(((e,t)=>e.y-t.y));return{top:r[0],bottom:r[r.length-1],left:t[0],right:t[t.length-1]}},t.extremalPointAnnotToBoxAnnot=function(e){if(!e)return e;const t=s(e.vertices),r=o.default.map(t,"x"),n=o.default.map(t,"y"),a=o.default.min(r),l=o.default.min(n),u=o.default.max(r),c=o.default.max(n);return{...e,height:c-l,width:u-a,top:l,left:a,vertices:t,type:i.AnnotationGeometry.ExtremalPoints}},t.getGeneralizedBoundingBox=void 0;var n,o=(n=r(298784))&&n.__esModule?n:{default:n},i=r(308408),a=r(593539);function s(e){if(0===e.length)throw new Error("Cannot find bounding box of empty array");const t=o.default.map(e,"x"),r=o.default.map(e,"y"),n=o.default.min(t),i=o.default.min(r),a=o.default.max(t),s=o.default.max(r);return[{x:n,y:i},{x:n,y:s},{x:a,y:s},{x:a,y:i}]}function l(e){if(e.length<2)throw new Error("Cannot find distance of line with less than 3 vertices");return(new a.geom.GeometryFactory).createLineString(e.map((({x:e,y:t})=>new a.geom.Coordinate(e,t)))).getLength()}t.getGeneralizedBoundingBox=e=>{const t=[];for(const r of e)if(i.isBoxAnnotation(r)){const e=r.x+r.width/2,n=r.y+r.height/2,o=Math.atan(r.height/r.width),i=Math.sqrt(r.width**2+r.height**2)/2,a=t=>({x:e+i*Math.cos(t),y:n+i*Math.sin(t)});t.push(a(o+(r.rotation??0))),t.push(a(Math.PI-o+(r.rotation??0))),t.push(a(Math.PI+o+(r.rotation??0))),t.push(a(-o+(r.rotation??0)))}return s(t)}},136622:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.clampAnnotation=t.clampCuboidAnnotation=t.clampPolygonAnnotation=t.clampPolygonAnnotationVertices=t.clampBoxAnnotation=t.getHallucination=t.getAllHallucinations=t.getCuboidInterpolation=t.getLinearPrediction=t.getTranslationVector=t.getKeyFrames=void 0;var n,o=(n=r(298784))&&n.__esModule?n:{default:n},i=r(308408),a=r(43356),s=r(311311);const l=(e,t,r)=>{const n=o.default.map(e.frames,((e,t)=>({frame:e,frameIndex:t}))),i=r?({frame:e})=>!e||!e.keyframeType:({frame:e})=>!e,a=o.default.reject(n,i).map((({frameIndex:e})=>e));return{left:o.default.filter(a,(e=>e<t)),right:o.default.filter(a,(e=>e>t))}};t.getKeyFrames=l;const u=e=>{const{frameIndex:t,keyframe1Index:r,keyframe2Index:n,keyframe1:o,keyframe2:i}=e,{x:s,y:l}=a.getDims[o.geometry](o),{x:u,y:c}=a.getDims[i.geometry](i),d={x:(f={x:u,y:c}).x-(h={x:s,y:l}).x,y:f.y-h.y};var f,h;return{x:d.x/(n-r)*(t-r),y:d.y/(n-r)*(t-r)}};t.getTranslationVector=u;const c=(e,t,r,n,i)=>{const a=e.frames[t],s=e.frames[r];return a||s?s?a?i?o.default.cloneDeep(a):f({frameIndex:n,keyframe1Index:t,keyframe2Index:r,keyframe1:a,keyframe2:s},e.geometry):o.default.cloneDeep(s):o.default.cloneDeep(a):null};t.getLinearPrediction=c;const d=(e,t,r,n,o)=>(o-n)/(r-t)*(e-t)+n,f=(e,t)=>{switch(t){case i.AnnotationGeometry.Point:return h(e);case i.AnnotationGeometry.Line:case i.AnnotationGeometry.Polygon:return m(e);case i.AnnotationGeometry.Box:return p(e);case i.AnnotationGeometry.Ellipse:return y(e);case i.AnnotationGeometry.Cuboid:return g(e);default:return e.keyframe1}},h=e=>{const{keyframe1:t}=e,r=u(e),n=o.default.cloneDeep(t);return n.x+=r.x,n.y+=r.y,n},p=e=>{const{frameIndex:t,keyframe1Index:r,keyframe2Index:n,keyframe1:i,keyframe2:a}=e,s=o.default.cloneDeep(i);return s.width=d(t,r,n,i.width,a.width),s.height=d(t,r,n,i.height,a.height),s.x=d(t,r,n,i.x,a.x),s.y=d(t,r,n,i.y,a.y),s},m=e=>{const{keyframe1:t}=e,r=u(e),n=o.default.cloneDeep(t);if(n.vertices=n.vertices.map((e=>({x:e.x+r.x,y:e.y+r.y}))),n.multiple_polygon_vertices){const e=n;e.multiple_polygon_vertices=s.getFragmentsFromVertices(e.vertices,e.multiple_polygon_vertices)}return n},g=e=>{const{frameIndex:t,keyframe1Index:r,keyframe2Index:n,keyframe1:i,keyframe2:a}=e,s=o.default.cloneDeep(i);return s.face.x1=d(t,r,n,i.face.x1,a.face.x1),s.face.x2=d(t,r,n,i.face.x2,a.face.x2),s.face.y1=d(t,r,n,i.face.y1,a.face.y1),s.face.y2=d(t,r,n,i.face.y2,a.face.y2),i.edge&&a.edge&&(s.edge={ex:d(i.edge.ex,i.face.x1,i.face.x2,s.face.x1,s.face.x2),ey1:d(i.edge.ey1,i.face.y1,i.face.y2,s.face.y1,s.face.y2),ey2:d(i.edge.ey2,i.face.y1,i.face.y2,s.face.y1,s.face.y2)}),s};t.getCuboidInterpolation=g;const y=e=>{const{frameIndex:t,keyframe1Index:r,keyframe2Index:n,keyframe1:i,keyframe2:a}=e,s=o.default.cloneDeep(i);return s.width=d(t,r,n,i.width,a.width),s.height=d(t,r,n,i.height,a.height),s.center[0]=d(t,r,n,i.center[0],a.center[0]),s.center[1]=d(t,r,n,i.center[1],a.center[1]),s};t.getAllHallucinations=(e,t,r)=>{const n=o.default.map(e.frames,(e=>e?.keyframeType?e:void 0));let a;const s=o.default.map(n,((e,t)=>{const r=e?.keyframeType;if(!r)return a;a=r===i.KeyframeType.End?void 0:t}));let l;const u=o.default.map([...n].reverse(),((t,r)=>{const n=t?.keyframeType;if(!n)return l;l=n===i.KeyframeType.Start?void 0:e.frames.length-r-1})).reverse();return o.default.map(n,((n,o)=>{if(a=s[o],l=u[o],void 0!==a&&void 0!==l){let n=c(e,a,l,o,r);return n&&(n={...n,..._(n,t),keyframeType:void 0}),n}}))};t.getHallucination=(e,t,r,n,i)=>{const a=l(e,t);let s=null;if(o.default.isEmpty(a.left)||o.default.isEmpty(a.right))if(o.default.isEmpty(a.left)){if(!o.default.isEmpty(a.right)){const[r,n]=o.default.take(a.right,2);s=c(e,r,n,t,i)}}else{const[r,n]=o.default.reverse(o.default.takeRight(a.left,2));s=c(e,r,n,t,i)}else{const r=o.default.last(a.left),n=o.default.first(a.right);s=c(e,r,n,t,i)}return s&&(s={...s,...n?{keyframeType:void 0}:{},..._(s,r)}),s};const b=(e,t)=>{if(!t)return e;const{x:r,y:n,width:i,height:a}=e;let s=r+i,l=n+a;s=o.default.clamp(s,2,t.width),l=o.default.clamp(l,2,t.height);let u=o.default.clamp(r,0,t.width-2),c=o.default.clamp(n,0,t.height-2),d=s-u,f=l-c;return d<2&&(u-=Math.floor((2-d)/2),d=2),f<2&&(c-=Math.floor((2-f)/2),f=2),0===d||0===f?{...e,x:0,y:0,width:100,height:100}:{...e,x:u,y:c,width:d,height:f}};t.clampBoxAnnotation=b;const T=(e,t,r)=>{const n=t?.width??Number.MAX_SAFE_INTEGER,i=t?.height??Number.MAX_SAFE_INTEGER;let a,s=0,l=0;if(r)a=e=>{e.forEach((e=>{e.x=o.default.clamp(e.x,0,n),e.y=o.default.clamp(e.y,0,i)}))};else{let t;t=Array.isArray(e)?e:o.default.concat([],...Object.values(e));const r=o.default.minBy(t,"x")?.x??0,u=o.default.maxBy(t,"x")?.x??n,c=o.default.minBy(t,"y")?.y??0,d=o.default.maxBy(t,"y")?.y??i;s=r>=0?o.default.clamp(u,0,n)-u:o.default.clamp(r,0,n)-r,l=c>=0?o.default.clamp(d,0,i)-d:o.default.clamp(c,0,i)-c,a=e=>{e.forEach((e=>{e.x+=s,e.y+=l}))}}return Array.isArray(e)?a(e):Object.values(e).forEach((e=>a(e))),e};t.clampPolygonAnnotationVertices=T;const v=(e,t,r)=>(T(e.vertices,t,r),e);t.clampPolygonAnnotation=v;const x=(e,t)=>{const r=[{x:e.face.x1,y:e.face.y1},{x:e.face.x1,y:e.face.y2},{x:e.face.x2,y:e.face.y1},{x:e.face.x2,y:e.face.y2}];e.edge&&r.push({x:e.edge.ex,y:e.edge.ey1},{x:e.edge.ex,y:e.edge.ey2},{x:e.edge.ex,y:e.edge.ey1},{x:e.edge.ex,y:e.edge.ey2});const n=T(r,t),o=n[0].x,i=n[0].y,a=n[3].x,s=n[3].y;if(e.face={x1:o,x2:a,y1:i,y2:s},e.edge){const t=r[4].x,n=r[4].y,o=r[5].y;e.edge={ex:t,ey1:n,ey2:o}}return e};t.clampCuboidAnnotation=x;const _=(e,t)=>{switch(e.geometry){case i.AnnotationGeometry.Box:return b(e,t);case i.AnnotationGeometry.Point:return((e,t)=>(e.x=o.default.clamp(e.x,0,t.width-0),e.y=o.default.clamp(e.y,0,t.height-0),e))(e,t);case i.AnnotationGeometry.Line:return((e,t)=>(T(e.vertices,t),e))(e,t);case i.AnnotationGeometry.Polygon:return v(e,t);case i.AnnotationGeometry.Cuboid:return x(e,t);default:return e}};t.clampAnnotation=_},132764:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(31928),o=6378137;function i(e){var t=0;if(e&&e.length>0){t+=Math.abs(a(e[0]));for(var r=1;r<e.length;r++)t-=Math.abs(a(e[r]))}return t}function a(e){var t,r,n,i,a,l,u=0,c=e.length;if(c>2){for(l=0;l<c;l++)l===c-2?(n=c-2,i=c-1,a=0):l===c-1?(n=c-1,i=0,a=1):(n=l,i=l+1,a=l+2),t=e[n],r=e[i],u+=(s(e[a][0])-s(t[0]))*Math.sin(s(r[1]));u=u*o*o/2}return u}function s(e){return e*Math.PI/180}t.default=function(e){return n.geomReduce(e,(function(e,t){return e+function(e){var t,r=0;switch(e.type){case"Polygon":return i(e.coordinates);case"MultiPolygon":for(t=0;t<e.coordinates.length;t++)r+=i(e.coordinates[t]);return r;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0}return 0}(t)}),0)}},903779:function(e,t){"use strict";function r(e,t,r){void 0===r&&(r={});var n={type:"Feature"};return(0===r.id||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=t||{},n.geometry=e,n}function n(e,t,n){if(void 0===n&&(n={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!h(e[0])||!h(e[1]))throw new Error("coordinates must contain numbers");return r({type:"Point",coordinates:e},t,n)}function o(e,t,n){void 0===n&&(n={});for(var o=0,i=e;o<i.length;o++){var a=i[o];if(a.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var s=0;s<a[a.length-1].length;s++)if(a[a.length-1][s]!==a[0][s])throw new Error("First and last Position are not equivalent.")}return r({type:"Polygon",coordinates:e},t,n)}function i(e,t,n){if(void 0===n&&(n={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");return r({type:"LineString",coordinates:e},t,n)}function a(e,t){void 0===t&&(t={});var r={type:"FeatureCollection"};return t.id&&(r.id=t.id),t.bbox&&(r.bbox=t.bbox),r.features=e,r}function s(e,t,n){return void 0===n&&(n={}),r({type:"MultiLineString",coordinates:e},t,n)}function l(e,t,n){return void 0===n&&(n={}),r({type:"MultiPoint",coordinates:e},t,n)}function u(e,t,n){return void 0===n&&(n={}),r({type:"MultiPolygon",coordinates:e},t,n)}function c(e,r){void 0===r&&(r="kilometers");var n=t.factors[r];if(!n)throw new Error(r+" units is invalid");return e*n}function d(e,r){void 0===r&&(r="kilometers");var n=t.factors[r];if(!n)throw new Error(r+" units is invalid");return e/n}function f(e){return 180*(e%(2*Math.PI))/Math.PI}function h(e){return!isNaN(e)&&null!==e&&!Array.isArray(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.earthRadius=6371008.8,t.factors={centimeters:100*t.earthRadius,centimetres:100*t.earthRadius,degrees:t.earthRadius/111325,feet:3.28084*t.earthRadius,inches:39.37*t.earthRadius,kilometers:t.earthRadius/1e3,kilometres:t.earthRadius/1e3,meters:t.earthRadius,metres:t.earthRadius,miles:t.earthRadius/1609.344,millimeters:1e3*t.earthRadius,millimetres:1e3*t.earthRadius,nauticalmiles:t.earthRadius/1852,radians:1,yards:1.0936*t.earthRadius},t.unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:.001,kilometres:.001,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/t.earthRadius,yards:1.0936133},t.areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046},t.feature=r,t.geometry=function(e,t,r){switch(void 0===r&&(r={}),e){case"Point":return n(t).geometry;case"LineString":return i(t).geometry;case"Polygon":return o(t).geometry;case"MultiPoint":return l(t).geometry;case"MultiLineString":return s(t).geometry;case"MultiPolygon":return u(t).geometry;default:throw new Error(e+" is invalid")}},t.point=n,t.points=function(e,t,r){return void 0===r&&(r={}),a(e.map((function(e){return n(e,t)})),r)},t.polygon=o,t.polygons=function(e,t,r){return void 0===r&&(r={}),a(e.map((function(e){return o(e,t)})),r)},t.lineString=i,t.lineStrings=function(e,t,r){return void 0===r&&(r={}),a(e.map((function(e){return i(e,t)})),r)},t.featureCollection=a,t.multiLineString=s,t.multiPoint=l,t.multiPolygon=u,t.geometryCollection=function(e,t,n){return void 0===n&&(n={}),r({type:"GeometryCollection",geometries:e},t,n)},t.round=function(e,t){if(void 0===t&&(t=0),t&&!(t>=0))throw new Error("precision must be a positive number");var r=Math.pow(10,t||0);return Math.round(e*r)/r},t.radiansToLength=c,t.lengthToRadians=d,t.lengthToDegrees=function(e,t){return f(d(e,t))},t.bearingToAzimuth=function(e){var t=e%360;return t<0&&(t+=360),t},t.radiansToDegrees=f,t.degreesToRadians=function(e){return e%360*Math.PI/180},t.convertLength=function(e,t,r){if(void 0===t&&(t="kilometers"),void 0===r&&(r="kilometers"),!(e>=0))throw new Error("length must be a positive number");return c(d(e,t),r)},t.convertArea=function(e,r,n){if(void 0===r&&(r="meters"),void 0===n&&(n="kilometers"),!(e>=0))throw new Error("area must be a positive number");var o=t.areaFactors[r];if(!o)throw new Error("invalid original units");var i=t.areaFactors[n];if(!i)throw new Error("invalid final units");return e/o*i},t.isNumber=h,t.isObject=function(e){return!!e&&e.constructor===Object},t.validateBBox=function(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(4!==e.length&&6!==e.length)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach((function(e){if(!h(e))throw new Error("bbox must only contain numbers")}))},t.validateId=function(e){if(!e)throw new Error("id is required");if(-1===["string","number"].indexOf(typeof e))throw new Error("id must be a number or a string")}},31928:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(903779);function o(e,t,r){if(null!==e)for(var n,i,a,s,l,u,c,d,f=0,h=0,p=e.type,m="FeatureCollection"===p,g="Feature"===p,y=m?e.features.length:1,b=0;b<y;b++){l=(d=!!(c=m?e.features[b].geometry:g?e.geometry:e)&&"GeometryCollection"===c.type)?c.geometries.length:1;for(var T=0;T<l;T++){var v=0,x=0;if(null!==(s=d?c.geometries[T]:c)){u=s.coordinates;var _=s.type;switch(f=!r||"Polygon"!==_&&"MultiPolygon"!==_?0:1,_){case null:break;case"Point":if(!1===t(u,h,b,v,x))return!1;h++,v++;break;case"LineString":case"MultiPoint":for(n=0;n<u.length;n++){if(!1===t(u[n],h,b,v,x))return!1;h++,"MultiPoint"===_&&v++}"LineString"===_&&v++;break;case"Polygon":case"MultiLineString":for(n=0;n<u.length;n++){for(i=0;i<u[n].length-f;i++){if(!1===t(u[n][i],h,b,v,x))return!1;h++}"MultiLineString"===_&&v++,"Polygon"===_&&x++}"Polygon"===_&&v++;break;case"MultiPolygon":for(n=0;n<u.length;n++){for(x=0,i=0;i<u[n].length;i++){for(a=0;a<u[n][i].length-f;a++){if(!1===t(u[n][i][a],h,b,v,x))return!1;h++}x++}v++}break;case"GeometryCollection":for(n=0;n<s.geometries.length;n++)if(!1===o(s.geometries[n],t,r))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function i(e,t){var r;switch(e.type){case"FeatureCollection":for(r=0;r<e.features.length&&!1!==t(e.features[r].properties,r);r++);break;case"Feature":t(e.properties,0)}}function a(e,t){if("Feature"===e.type)t(e,0);else if("FeatureCollection"===e.type)for(var r=0;r<e.features.length&&!1!==t(e.features[r],r);r++);}function s(e,t){var r,n,o,i,a,s,l,u,c,d,f=0,h="FeatureCollection"===e.type,p="Feature"===e.type,m=h?e.features.length:1;for(r=0;r<m;r++){for(s=h?e.features[r].geometry:p?e.geometry:e,u=h?e.features[r].properties:p?e.properties:{},c=h?e.features[r].bbox:p?e.bbox:void 0,d=h?e.features[r].id:p?e.id:void 0,a=(l=!!s&&"GeometryCollection"===s.type)?s.geometries.length:1,o=0;o<a;o++)if(null!==(i=l?s.geometries[o]:s))switch(i.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===t(i,f,u,c,d))return!1;break;case"GeometryCollection":for(n=0;n<i.geometries.length;n++)if(!1===t(i.geometries[n],f,u,c,d))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===t(null,f,u,c,d))return!1;f++}}function l(e,t){s(e,(function(e,r,o,i,a){var s,l=null===e?null:e.type;switch(l){case null:case"Point":case"LineString":case"Polygon":return!1!==t(n.feature(e,o,{bbox:i,id:a}),r,0)&&void 0}switch(l){case"MultiPoint":s="Point";break;case"MultiLineString":s="LineString";break;case"MultiPolygon":s="Polygon"}for(var u=0;u<e.coordinates.length;u++){var c={type:s,coordinates:e.coordinates[u]};if(!1===t(n.feature(c,o),r,u))return!1}}))}function u(e,t){l(e,(function(e,r,i){var a=0;if(e.geometry){var s=e.geometry.type;if("Point"!==s&&"MultiPoint"!==s){var l,u=0,c=0,d=0;return!1!==o(e,(function(o,s,f,h,p){if(void 0===l||r>u||h>c||p>d)return l=o,u=r,c=h,d=p,void(a=0);var m=n.lineString([l,o],e.properties);if(!1===t(m,r,i,p,a))return!1;a++,l=o}))&&void 0}}}))}function c(e,t){if(!e)throw new Error("geojson is required");l(e,(function(e,r,o){if(null!==e.geometry){var i=e.geometry.type,a=e.geometry.coordinates;switch(i){case"LineString":if(!1===t(e,r,o,0,0))return!1;break;case"Polygon":for(var s=0;s<a.length;s++)if(!1===t(n.lineString(a[s],e.properties),r,o,s))return!1}}}))}t.coordAll=function(e){var t=[];return o(e,(function(e){t.push(e)})),t},t.coordEach=o,t.coordReduce=function(e,t,r,n){var i=r;return o(e,(function(e,n,o,a,s){i=0===n&&void 0===r?e:t(i,e,n,o,a,s)}),n),i},t.featureEach=a,t.featureReduce=function(e,t,r){var n=r;return a(e,(function(e,o){n=0===o&&void 0===r?e:t(n,e,o)})),n},t.findPoint=function(e,t){if(t=t||{},!n.isObject(t))throw new Error("options is invalid");var r,o=t.featureIndex||0,i=t.multiFeatureIndex||0,a=t.geometryIndex||0,s=t.coordIndex||0,l=t.properties;switch(e.type){case"FeatureCollection":o<0&&(o=e.features.length+o),l=l||e.features[o].properties,r=e.features[o].geometry;break;case"Feature":l=l||e.properties,r=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":r=e;break;default:throw new Error("geojson is invalid")}if(null===r)return null;var u=r.coordinates;switch(r.type){case"Point":return n.point(u,l,t);case"MultiPoint":return i<0&&(i=u.length+i),n.point(u[i],l,t);case"LineString":return s<0&&(s=u.length+s),n.point(u[s],l,t);case"Polygon":return a<0&&(a=u.length+a),s<0&&(s=u[a].length+s),n.point(u[a][s],l,t);case"MultiLineString":return i<0&&(i=u.length+i),s<0&&(s=u[i].length+s),n.point(u[i][s],l,t);case"MultiPolygon":return i<0&&(i=u.length+i),a<0&&(a=u[i].length+a),s<0&&(s=u[i][a].length-s),n.point(u[i][a][s],l,t)}throw new Error("geojson is invalid")},t.findSegment=function(e,t){if(t=t||{},!n.isObject(t))throw new Error("options is invalid");var r,o=t.featureIndex||0,i=t.multiFeatureIndex||0,a=t.geometryIndex||0,s=t.segmentIndex||0,l=t.properties;switch(e.type){case"FeatureCollection":o<0&&(o=e.features.length+o),l=l||e.features[o].properties,r=e.features[o].geometry;break;case"Feature":l=l||e.properties,r=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":r=e;break;default:throw new Error("geojson is invalid")}if(null===r)return null;var u=r.coordinates;switch(r.type){case"Point":case"MultiPoint":return null;case"LineString":return s<0&&(s=u.length+s-1),n.lineString([u[s],u[s+1]],l,t);case"Polygon":return a<0&&(a=u.length+a),s<0&&(s=u[a].length+s-1),n.lineString([u[a][s],u[a][s+1]],l,t);case"MultiLineString":return i<0&&(i=u.length+i),s<0&&(s=u[i].length+s-1),n.lineString([u[i][s],u[i][s+1]],l,t);case"MultiPolygon":return i<0&&(i=u.length+i),a<0&&(a=u[i].length+a),s<0&&(s=u[i][a].length-s-1),n.lineString([u[i][a][s],u[i][a][s+1]],l,t)}throw new Error("geojson is invalid")},t.flattenEach=l,t.flattenReduce=function(e,t,r){var n=r;return l(e,(function(e,o,i){n=0===o&&0===i&&void 0===r?e:t(n,e,o,i)})),n},t.geomEach=s,t.geomReduce=function(e,t,r){var n=r;return s(e,(function(e,o,i,a,s){n=0===o&&void 0===r?e:t(n,e,o,i,a,s)})),n},t.lineEach=c,t.lineReduce=function(e,t,r){var n=r;return c(e,(function(e,o,i,a){n=0===o&&void 0===r?e:t(n,e,o,i,a)})),n},t.propEach=i,t.propReduce=function(e,t,r){var n=r;return i(e,(function(e,o){n=0===o&&void 0===r?e:t(n,e,o)})),n},t.segmentEach=u,t.segmentReduce=function(e,t,r){var n=r,o=!1;return u(e,(function(e,i,a,s,l){n=!1===o&&void 0===r?e:t(n,e,i,a,s,l),o=!0})),n}},533637:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return i}});class n{constructor(){this.ids=[],this.values=[],this.length=0}clear(){this.length=0}push(e,t){let r=this.length++;for(this.ids[r]=e,this.values[r]=t;r>0;){const e=r-1>>1,n=this.values[e];if(t>=n)break;this.ids[r]=this.ids[e],this.values[r]=n,r=e}this.ids[r]=e,this.values[r]=t}pop(){if(0===this.length)return;const e=this.ids[0];if(this.length--,this.length>0){const e=this.ids[0]=this.ids[this.length],t=this.values[0]=this.values[this.length],r=this.length>>1;let n=0;for(;n<r;){let e=1+(n<<1);const r=e+1;let o=this.ids[e],i=this.values[e];const a=this.values[r];if(r<this.length&&a<i&&(e=r,o=this.ids[r],i=a),i>=t)break;this.ids[n]=o,this.values[n]=i,n=e}this.ids[n]=e,this.values[n]=t}return e}peek(){if(0!==this.length)return this.ids[0]}peekValue(){if(0!==this.length)return this.values[0]}}const o=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class i{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[t,r]=new Uint8Array(e,0,2);if(251!==t)throw new Error("Data does not appear to be in a Flatbush format.");if(r>>4!==3)throw new Error(`Got v${r>>4} data when expected v3.`);const[n]=new Uint16Array(e,2,1),[a]=new Uint32Array(e,4,1);return new i(a,n,o[15&r],e)}constructor(e,t=16,r=Float64Array,i){if(void 0===e)throw new Error("Missing required argument: numItems.");if(isNaN(e)||e<=0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+t,2),65535);let a=e,s=a;this._levelBounds=[4*a];do{a=Math.ceil(a/this.nodeSize),s+=a,this._levelBounds.push(4*s)}while(1!==a);this.ArrayType=r||Float64Array,this.IndexArrayType=s<16384?Uint16Array:Uint32Array;const l=o.indexOf(this.ArrayType),u=4*s*this.ArrayType.BYTES_PER_ELEMENT;if(l<0)throw new Error(`Unexpected typed array class: ${r}.`);i&&i instanceof ArrayBuffer?(this.data=i,this._boxes=new this.ArrayType(this.data,8,4*s),this._indices=new this.IndexArrayType(this.data,8+u,s),this._pos=4*s,this.minX=this._boxes[this._pos-4],this.minY=this._boxes[this._pos-3],this.maxX=this._boxes[this._pos-2],this.maxY=this._boxes[this._pos-1]):(this.data=new ArrayBuffer(8+u+s*this.IndexArrayType.BYTES_PER_ELEMENT),this._boxes=new this.ArrayType(this.data,8,4*s),this._indices=new this.IndexArrayType(this.data,8+u,s),this._pos=0,this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,new Uint8Array(this.data,0,2).set([251,48+l]),new Uint16Array(this.data,2,1)[0]=t,new Uint32Array(this.data,4,1)[0]=e),this._queue=new n}add(e,t,r,n){const o=this._pos>>2;return this._indices[o]=o,this._boxes[this._pos++]=e,this._boxes[this._pos++]=t,this._boxes[this._pos++]=r,this._boxes[this._pos++]=n,e<this.minX&&(this.minX=e),t<this.minY&&(this.minY=t),r>this.maxX&&(this.maxX=r),n>this.maxY&&(this.maxY=n),o}finish(){if(this._pos>>2!==this.numItems)throw new Error(`Added ${this._pos>>2} items when expected ${this.numItems}.`);if(this.numItems<=this.nodeSize)return this._boxes[this._pos++]=this.minX,this._boxes[this._pos++]=this.minY,this._boxes[this._pos++]=this.maxX,void(this._boxes[this._pos++]=this.maxY);const e=this.maxX-this.minX,t=this.maxY-this.minY,r=new Uint32Array(this.numItems);for(let n=0;n<this.numItems;n++){let o=4*n;const i=this._boxes[o++],a=this._boxes[o++],s=this._boxes[o++],l=this._boxes[o++],u=Math.floor(65535*((i+s)/2-this.minX)/e),d=Math.floor(65535*((a+l)/2-this.minY)/t);r[n]=c(u,d)}l(r,this._boxes,this._indices,0,this.numItems-1,this.nodeSize);for(let n=0,o=0;n<this._levelBounds.length-1;n++){const e=this._levelBounds[n];for(;o<e;){const t=o;let r=1/0,n=1/0,i=-1/0,a=-1/0;for(let s=0;s<this.nodeSize&&o<e;s++)r=Math.min(r,this._boxes[o++]),n=Math.min(n,this._boxes[o++]),i=Math.max(i,this._boxes[o++]),a=Math.max(a,this._boxes[o++]);this._indices[this._pos>>2]=t,this._boxes[this._pos++]=r,this._boxes[this._pos++]=n,this._boxes[this._pos++]=i,this._boxes[this._pos++]=a}}}search(e,t,r,n,o){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let i=this._boxes.length-4;const a=[],l=[];for(;void 0!==i;){const u=Math.min(i+4*this.nodeSize,s(i,this._levelBounds));for(let s=i;s<u;s+=4){const u=0|this._indices[s>>2];r<this._boxes[s]||(n<this._boxes[s+1]||e>this._boxes[s+2]||t>this._boxes[s+3]||(i<4*this.numItems?(void 0===o||o(u))&&l.push(u):a.push(u)))}i=a.pop()}return l}neighbors(e,t,r=1/0,n=1/0,o){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let i=this._boxes.length-4;const l=this._queue,u=[],c=n*n;for(;void 0!==i;){const n=Math.min(i+4*this.nodeSize,s(i,this._levelBounds));for(let r=i;r<n;r+=4){const n=0|this._indices[r>>2],s=a(e,this._boxes[r],this._boxes[r+2]),u=a(t,this._boxes[r+1],this._boxes[r+3]),c=s*s+u*u;i<4*this.numItems?(void 0===o||o(n))&&l.push(-n-1,c):l.push(n,c)}for(;l.length&&l.peek()<0;){if(l.peekValue()>c)return l.clear(),u;if(u.push(-l.pop()-1),u.length===r)return l.clear(),u}i=l.pop()}return l.clear(),u}}function a(e,t,r){return e<t?t-e:e<=r?0:e-r}function s(e,t){let r=0,n=t.length-1;for(;r<n;){const o=r+n>>1;t[o]>e?n=o:r=o+1}return t[r]}function l(e,t,r,n,o,i){if(Math.floor(n/i)>=Math.floor(o/i))return;const a=e[n+o>>1];let s=n-1,c=o+1;for(;;){do{s++}while(e[s]<a);do{c--}while(e[c]>a);if(s>=c)break;u(e,t,r,s,c)}l(e,t,r,n,c,i),l(e,t,r,c+1,o,i)}function u(e,t,r,n,o){const i=e[n];e[n]=e[o],e[o]=i;const a=4*n,s=4*o,l=t[a],u=t[a+1],c=t[a+2],d=t[a+3];t[a]=t[s],t[a+1]=t[s+1],t[a+2]=t[s+2],t[a+3]=t[s+3],t[s]=l,t[s+1]=u,t[s+2]=c,t[s+3]=d;const f=r[n];r[n]=r[o],r[o]=f}function c(e,t){let r=e^t,n=65535^r,o=65535^(e|t),i=e&(65535^t),a=r|n>>1,s=r>>1^r,l=o>>1^n&i>>1^o,u=r&o>>1^i>>1^i;r=a,n=s,o=l,i=u,a=r&r>>2^n&n>>2,s=r&n>>2^n&(r^n)>>2,l^=r&o>>2^n&i>>2,u^=n&o>>2^(r^n)&i>>2,r=a,n=s,o=l,i=u,a=r&r>>4^n&n>>4,s=r&n>>4^n&(r^n)>>4,l^=r&o>>4^n&i>>4,u^=n&o>>4^(r^n)&i>>4,r=a,n=s,o=l,i=u,l^=r&o>>8^n&i>>8,u^=n&o>>8^(r^n)&i>>8,r=l^l>>1,n=u^u>>1;let c=e^t,d=n|65535^(c|r);return c=16711935&(c|c<<8),c=252645135&(c|c<<4),c=858993459&(c|c<<2),c=1431655765&(c|c<<1),d=16711935&(d|d<<8),d=252645135&(d|d<<4),d=858993459&(d|d<<2),d=1431655765&(d|d<<1),(d<<1|c)>>>0}},844955:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(408116),o=r(202347),i=r(338834),a=r(785944),s=r(359207),l=r(370),u=r(343521),c=(n.default.multiply,Object.assign({},n.default,o.default,i.default,l.default,{random:s.default,fromRoots:u.default,allRoots:a.default}));t.default=c},785944:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(408116),o=r(202347),i=r(338834),{clip0:a,evaluate:s,differentiate:l,toCasStr:u}=n.default,{brent:c,quadraticRoots:d}=o.default,{rootMagnitudeUpperBound_fujiwara:f,positiveRootUpperBound_LMQ:h,positiveRootLowerBound_LMQ:p,negativeRootUpperBound_LMQ:m,negativeRootLowerBound_LMQ:g}=i.default,y=Number.POSITIVE_INFINITY;t.default=function e(t,r=-y,n=+y){let o=(t=a(t)).length-1,i=function(e,t){return r=>r>=e&&r<=t}(r,n);if(2===o)return d(t).filter(i);if(o>2){let o,a;r===-y||n===+y?(o=r===-y?g(t):r,a=n===+y?h(t):n):(o=r,a=n);let u=e(l(t),o,a).filter(i);return u[0]!==o&&u.unshift(o),u[u.length-1]!==a&&u.push(a),function(e,t){let r,n=[],o=s(e),i=t[0];for(let a=1;a<t.length;a++){let e,s=t[a],l=o(i),u=o(s);0===l*u?0===l?e=i:0===u&&a===t.length-1&&(e=s):l*u<0&&(e=c(o,i,s)),void 0!==e&&e!==r&&(n.push(e),r=e),i=s}return n}(t,u)}return 1===o?[-t[1]/t[0]].filter(i):[]}},408116:function(e,t){"use strict";function r(e,t){let r=e.length-1,n=t.length-1,o=r-n,i=0,s=0;o>0?s=-o:o<0&&(i=+o);let l=Math.max(r,n),u=[];for(let a=0;a<l+1;a++){let r=e[a+i],n=t[a+s];u.push((r||0)-(n||0))}return a(u)}function n(e){let t=[],r=e.length-1;for(let n=0;n<r;n++)t.push((r-n)*e[n]);return t}function o(e,t){let r=e.length-1,n=t.length-1,o=r+n,i=new Array(o+1).fill(0);for(let a=0;a<r+1;a++)for(let s=0;s<n+1;s++)i[o-(a+s)]+=e[r-a]*t[n-s];return a(i)}function i(e,t){if(0===e)return[];let r=t.length-1,n=[];for(let o=0;o<r+1;o++)n.push(e*t[o]);return a(n)}function a(e){return 0!==e[0]?e:a(e.slice(1))}function s(e){let t=0;for(let r=0;r<e.length;r++){let n=Math.abs(e[r]);n>t&&(t=n)}return t}Object.defineProperty(t,"__esModule",{value:!0});let l={equal:function(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0},add:function(e,t){let r=e.length-1,n=t.length-1,o=r-n,i=0,s=0;o>0?s=-o:o<0&&(i=+o);let l=Math.max(r,n),u=[];for(let a=0;a<l+1;a++){let r=e[a+i],n=t[a+s];u.push((r||0)+(n||0))}return a(u)},subtract:r,multiplyByConst:i,negate:function(e){return i(-1,e)},differentiate:n,multiply:o,degree:function(e){return e.length-1},evaluate:function(e,t){function r(t){let r=e[0];for(let n=1;n<e.length;n++)r=e[n]+r*t;return r}return void 0===t?r:r(t)},evaluateAt0:function(e){return e[e.length-1]},signChanges:function(e){let t=e.length-1,r=0,n=Math.sign(e[0]);for(let o=1;o<t+1;o++){let t=Math.sign(e[o]);t!==n&&0!==t&&(r++,n=t)}return r},invert:function(e){return e.slice().reverse()},changeVariables:function(e,t,r){let n=e.length-1,o=[];for(let a=0;a<n+1;a++)o.push(new Array(n+1).fill(0));o[0][0]=1;for(let a=1;a<=n;a++){o[0][a]=r*o[0][a-1];for(let e=1;e<=a;e++)o[e][a]=r*o[e][a-1]+t*o[e-1][a-1]}let i=new Array(n+1).fill(0);for(let a=0;a<=n;a++){i[n-a]=0;for(let t=a;t<=n;t++){let r=o[a][t]*e[n-t];i[n-a]+=r}}return i},reflectAboutYAxis:function(e){let t=e.length-1,r=e.slice();for(let n=0;n<t+1;n++)n%2&&(r[n]=-r[n]);return r},sturmChain:function(e){function t(e,t){e.length,t.length;let n=e[1]/e[0]-t[1]/t[0];return r(o(i(e[0]/t[0],t),[1,n]),e)}let a=[];a.push(e),a.push(n(e));let s=1;for(;a[s].length-1>0;){let e=t(a[s-1],a[s]);for(;a[s].length-e.length<1;)e.shift();a.push(e),s++}return a},clip:function e(t,r){r=void 0===r?Number.EPSILON:r;let n=s(t);if(0===n)return[];if(Math.abs(t[0])>r*n)return t;let o=t.slice(1);for(;Math.abs(o[0])<r*n;)o=o.slice(1);return e(o,r)},clip0:a,deflate:function(e,t){let r=e.length-1,n=[e[0]];for(let o=1;o<r;o++)n.push(e[o]+t*n[o-1]);return n},maxCoefficient:s,toCasStr:function(e){let t=e.length-1,r="";for(let n=0;n<t+1;n++){let o=e[n].toString();r+=n===t?o:n===t-1?"x*"+o+" + ":"x^"+(t-n).toString()+"*"+o+" + "}return r}};t.default=l},370:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(408116),{evaluate:o}=n.default;let i={hornerErrorBound:function(e,t){const r=Number.EPSILON;return 2*(e.length-1)*r*function(e,t){let r=e.length-1,n=0;for(let o=0;o<r;o++)n+=Math.abs(e[o]*Math.pow(t,r-o));return n}(e,t)}};t.default=i},343521:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(408116),{multiply:o}=n.default;t.default=function(e){let t=[1];for(let r=0;r<e.length;r++)t=o(t,[1,-e[r]]);return t}},359207:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(343521),o=123456789,i=4294967296;function a(e){return function(t,r,n,i,a=o,s=0){let l=[];for(let o=0;o<t;o++){let t=e(r,n,i,a,s),o=t.p;a=t.seed,l.push(o)}return l}}function s(e){return(134775813*e+1)%i}function l(e,t,r,n=o,a=0){let l=[];for(let o=0;o<e;o++){n=u(n=s(n),l,n/i*(r-t)+t,a)}return l=l.slice(0,e),{vs:l,seed:n}}function u(e,t,r,n){return e=s(e),t.push(r),e/i<n&&(e=u(e,t,r,n)),e}function c(e,t=0,r=1,i=o,a=0){let s=l(e,t,r,i,a);return i=s.seed,{p:n.default(s.vs),seed:i}}function d(e,t=-1,r=1,n=o){let i=l(e,t=void 0===t?-1:t,r=void 0===r?1:r,n=void 0===n?o:n);return n=i.seed,{p:i.vs,seed:n}}let f={flatRoots:c,flatRootsArr:a(c),flatCoefficients:d,flatCoefficientsArr:a(d)};t.default=f},338834:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(408116),{invert:o,negate:i,reflectAboutYAxis:a}=n.default;const s=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536,131072,262144,524288,1048576,2097152];function l(e){let t=e.length-1;if(t<1)return 0;e[0]<0&&(e=i(e));let r=[];for(let o=0;o<t;o++)r.push(1);let n=0;for(let o=0;o<=t;o++){if(e[o]>=0)continue;let t=Number.POSITIVE_INFINITY,i=!1;for(let n=0;n<o;n++){if(e[n]<=0)continue;let a,l=r[n];a=l>20?Math.pow(2,l):s[l];let u=Math.pow(-e[o]/(e[n]/a),1/(o-n));r[n]++,t>u&&(t=u),i=!0}i&&n<t&&(n=t)}return n}function u(e){let t=l(o(e));return 0===t?0:1/t}let c={rootMagnitudeUpperBound_fujiwara:function(e){let t=e.length-1,r=e[0],n=[];for(let o=1;o<t;o++){let t=Math.pow(Math.abs(e[o]/r),1/o);n.push(t)}return n.push(Math.pow(Math.abs(e[t]/2*r),1/t)),2*Math.max.apply(void 0,n)},positiveRootUpperBound_LMQ:l,positiveRootLowerBound_LMQ:u,negativeRootUpperBound_LMQ:function(e){return-u(a(e))},negativeRootLowerBound_LMQ:function(e){return-l(a(e))},rootMagnitudeUpperBound_rouche:function(e){var t;return e.length,1+1/e[0]*(t=e.slice(1),Math.max(...t.map((e=>Math.abs(e)))))}};t.default=c},202347:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(408116),{sturmChain:o,evaluate:i,signChanges:a}=n.default;let s={quadraticRoots:function(e){let t,r,[n,o,i]=e,a=o*o-4*n*i;return a<0?[]:0===a?[-o/(2*n)]:(a=Math.sqrt(a),o>=0?(t=(-o-a)/(2*n),r=2*i/(-o-a)):(t=2*i/(-o+a),r=(-o+a)/(2*n)),t<r?[t,r]:[r,t])},numRootsWithin:function(e,t,r){let n=o(e),s=(i(e),n.map((e=>i(e)(t)))),l=n.map((e=>i(e)(r)));return a(s)-a(l)},brent:function(e,t,r){if(t===r)return t;let n,o=e(t),i=e(r);if(o*i>0)throw new Error("Root not bracketed");if(Math.abs(o)<Math.abs(i)){n=t,t=r,r=n;let e=o;o=i,i=e}n=t;let a,s=!0;for(;;){let l,u=2*Number.EPSILON*Math.abs(r),c=e(n);if(o!==c&&i!==c){let e=o-c,a=o-i,s=i-c;l=((t*i*s-r*o*e)*c+n*o*a*i)/(a*e*s)}else l=r-i*((r-t)/(i-o));let d=(3*t+r)/4,f=Math.abs(r-n),h=Math.abs(l-r),p=Math.abs(n-a);!(l>d&&l<r||l<d&&l>r)||s&&(h>=f/2||f<u)||!s&&(h>=p/2||p<u)?(l=(t+r)/2,s=!0):s=!1;let m=e(l);if(a=n,n=r,o*m<0?r=l:t=l,Math.abs(o)<Math.abs(i)){let e=t;t=r,r=e}if(0===i)return r;if(0===m)return l;if(Math.abs(t-r)<=u)return r;o=e(t),i=e(r)}},bisection:function(e,t,r){if(t===r)return t;r<t&&([t,r]=[r,t]);let n=e(t),o=e(r);if(0===n)return t;if(0===o)return r;if(n*o>0)throw new Error("Root not bracketed");for(;;){let o=t+(r-t)/2,i=e(o);if(0===i)return o;n*i<0?r=o:t=o;let a=2*Number.EPSILON*Math.abs(r);if(Math.abs(t-r)<=a)return r}}};t.default=s},650580:function(e,t,r){var n=r(728579),o=r(467213),i=n.DEFAULT_COMPARATOR,a=n.reverseComparator;function s(e,t,r,n){for(var i,a=r,s=n,l=t[n],u=2*n+1;u<a;)(i=u+1)<a&&e(t[u],t[i])>=0&&(u=i),t[n]=t[u],u=2*(n=u)+1;t[n]=l,o.siftDown(e,t,s,n)}function l(e,t,r,n){for(var o,i,a=n,l=new e(n);a>0;)o=r[--a],0!==a&&(i=r[0],r[0]=o,s(t,r,--n,0),o=i),l[a]=o;return l}function u(e,t,r){if(2===arguments.length&&(r=t,t=null),this.ArrayClass=e,this.capacity=r,this.items=new e(r),this.clear(),this.comparator=t||i,"number"!==typeof r&&r<=0)throw new Error("mnemonist/FixedReverseHeap.constructor: capacity should be a number > 0.");if("function"!==typeof this.comparator)throw new Error("mnemonist/FixedReverseHeap.constructor: given comparator should be a function.");this.comparator=a(this.comparator)}u.prototype.clear=function(){this.size=0},u.prototype.push=function(e){return this.size<this.capacity?(this.items[this.size]=e,o.siftDown(this.comparator,this.items,0,this.size),this.size++):this.comparator(e,this.items[0])>0&&o.replace(this.comparator,this.items,e),this.size},u.prototype.peek=function(){return this.items[0]},u.prototype.consume=function(){var e=l(this.ArrayClass,this.comparator,this.items,this.size);return this.size=0,e},u.prototype.toArray=function(){return l(this.ArrayClass,this.comparator,this.items.slice(0,this.size),this.size)},u.prototype.inspect=function(){var e=this.toArray();return Object.defineProperty(e,"constructor",{value:u,enumerable:!1}),e},"undefined"!==typeof Symbol&&(u.prototype[Symbol.for("nodejs.util.inspect.custom")]=u.prototype.inspect),e.exports=u},467213:function(e,t,r){var n=r(848210),o=r(728579),i=r(413118),a=o.DEFAULT_COMPARATOR,s=o.reverseComparator;function l(e,t,r,n){for(var o,i,a=t[n];n>r&&e(a,i=t[o=n-1>>1])<0;)t[n]=i,n=o;t[n]=a}function u(e,t,r){for(var n,o=t.length,i=r,a=t[r],s=2*r+1;s<o;)(n=s+1)<o&&e(t[s],t[n])>=0&&(s=n),t[r]=t[s],s=2*(r=s)+1;t[r]=a,l(e,t,i,r)}function c(e,t,r){t.push(r),l(e,t,0,t.length-1)}function d(e,t){var r=t.pop();if(0!==t.length){var n=t[0];return t[0]=r,u(e,t,0),n}return r}function f(e,t,r){if(0===t.length)throw new Error("mnemonist/heap.replace: cannot pop an empty heap.");var n=t[0];return t[0]=r,u(e,t,0),n}function h(e,t,r){var n;return 0!==t.length&&e(t[0],r)<0&&(n=t[0],t[0]=r,r=n,u(e,t,0)),r}function p(e,t){for(var r=t.length>>1;--r>=0;)u(e,t,r)}function m(e,t){for(var r=t.length,n=0,o=new Array(r);n<r;)o[n++]=d(e,t);return o}function g(e){if(this.clear(),this.comparator=e||a,"function"!==typeof this.comparator)throw new Error("mnemonist/Heap.constructor: given comparator should be a function.")}function y(e){if(this.clear(),this.comparator=e||a,"function"!==typeof this.comparator)throw new Error("mnemonist/MaxHeap.constructor: given comparator should be a function.");this.comparator=s(this.comparator)}g.prototype.clear=function(){this.items=[],this.size=0},g.prototype.push=function(e){return c(this.comparator,this.items,e),++this.size},g.prototype.peek=function(){return this.items[0]},g.prototype.pop=function(){return 0!==this.size&&this.size--,d(this.comparator,this.items)},g.prototype.replace=function(e){return f(this.comparator,this.items,e)},g.prototype.pushpop=function(e){return h(this.comparator,this.items,e)},g.prototype.consume=function(){return this.size=0,m(this.comparator,this.items)},g.prototype.toArray=function(){return m(this.comparator,this.items.slice())},g.prototype.inspect=function(){var e=this.toArray();return Object.defineProperty(e,"constructor",{value:g,enumerable:!1}),e},"undefined"!==typeof Symbol&&(g.prototype[Symbol.for("nodejs.util.inspect.custom")]=g.prototype.inspect),y.prototype=g.prototype,g.from=function(e,t){var r,n=new g(t);return r=i.isArrayLike(e)?e.slice():i.toArray(e),p(n.comparator,r),n.items=r,n.size=r.length,n},y.from=function(e,t){var r,n=new y(t);return r=i.isArrayLike(e)?e.slice():i.toArray(e),p(n.comparator,r),n.items=r,n.size=r.length,n},g.siftUp=u,g.siftDown=l,g.push=c,g.pop=d,g.replace=f,g.pushpop=h,g.heapify=p,g.consume=m,g.nsmallest=function(e,t,r){2===arguments.length&&(r=t,t=e,e=a);var o,l,u,c,d=s(e),h=1/0;if(1===t){if(i.isArrayLike(r)){for(o=0,l=r.length;o<l;o++)u=r[o],(h===1/0||e(u,h)<0)&&(h=u);return(c=new r.constructor(1))[0]=h,c}return n(r,(function(t){(h===1/0||e(t,h)<0)&&(h=t)})),[h]}if(i.isArrayLike(r)){if(t>=r.length)return r.slice().sort(e);for(c=r.slice(0,t),p(d,c),o=t,l=r.length;o<l;o++)d(r[o],c[0])>0&&f(d,c,r[o]);return c.sort(e)}var m=i.guessLength(r);return null!==m&&m<t&&(t=m),c=new Array(t),o=0,n(r,(function(e){o<t?c[o]=e:(o===t&&p(d,c),d(e,c[0])>0&&f(d,c,e)),o++})),c.length>o&&(c.length=o),c.sort(e)},g.nlargest=function(e,t,r){2===arguments.length&&(r=t,t=e,e=a);var o,l,u,c,d=s(e),h=-1/0;if(1===t){if(i.isArrayLike(r)){for(o=0,l=r.length;o<l;o++)u=r[o],(h===-1/0||e(u,h)>0)&&(h=u);return(c=new r.constructor(1))[0]=h,c}return n(r,(function(t){(h===-1/0||e(t,h)>0)&&(h=t)})),[h]}if(i.isArrayLike(r)){if(t>=r.length)return r.slice().sort(d);for(c=r.slice(0,t),p(e,c),o=t,l=r.length;o<l;o++)e(r[o],c[0])>0&&f(e,c,r[o]);return c.sort(d)}var m=i.guessLength(r);return null!==m&&m<t&&(t=m),c=new Array(t),o=0,n(r,(function(r){o<t?c[o]=r:(o===t&&p(e,c),e(r,c[0])>0&&f(e,c,r)),o++})),c.length>o&&(c.length=o),c.sort(d)},g.MinHeap=g,g.MaxHeap=y,e.exports=g},138385:function(e,t,r){var n=r(413118),o=r(800670),i=r(728579).createTupleComparator,a=r(650580),s=r(412295).O;function l(e,t,r,n){var o,i,a=0;for(o=0;o<e;o++)a+=(i=t[o][r]-n[o])*i;return a}function u(e,t,r,n){for(var i,a,l,u,c,d,f,h,p=n.length,m=o.getPointerArray(p+1),g=new m(p),y=new m(p),b=new m(p),T=[[0,0,r.length,-1,0]],v=0;0!==T.length;)h=(i=T.pop())[0],d=i[1],f=i[2],a=i[3],l=i[4],s(t[h],r,d,f),c=r[u=d+((p=f-d)>>>1)],g[v]=c,a>-1&&(0===l?y[a]=v+1:b[a]=v+1),h=(h+1)%e,u!==d&&u!==f-1&&T.push([h,u+1,f,v,1]),u!==d&&T.push([h,d,u,v,0]),v++;return{axes:t,labels:n,pivots:g,lefts:y,rights:b}}function c(e,t){this.dimensions=e,this.visited=0,this.axes=t.axes,this.labels=t.labels,this.pivots=t.pivots,this.lefts=t.lefts,this.rights=t.rights,this.size=this.labels.length}c.prototype.nearestNeighbor=function(e){var t=1/0,r=null,n=this.dimensions,o=this.axes,i=this.pivots,a=this.lefts,s=this.rights,u=0;return function c(d,f){u++;var h=a[f],p=s[f],m=i[f],g=l(n,o,m,e);if(!(g<t&&(r=m,t=g,0===g))){var y=o[d][m]-e[d];d=(d+1)%n,y>0?0!==h&&c(d,h-1):0!==p&&c(d,p-1),y*y<t&&(y>0?0!==p&&c(d,p-1):0!==h&&c(d,h-1))}}(0,0),this.visited=u,this.labels[r]};var d=i(3),f=i(2);c.prototype.kNearestNeighbors=function(e,t){if(e<=0)throw new Error("mnemonist/kd-tree.kNearestNeighbors: k should be a positive number.");if(1===(e=Math.min(e,this.size)))return[this.nearestNeighbor(t)];var r=new a(Array,d,e),n=this.dimensions,o=this.axes,i=this.pivots,s=this.lefts,u=this.rights,c=0;!function a(d,f){var h=s[f],p=u[f],m=i[f],g=l(n,o,m,t);r.push([g,c++,m]);var y=t[d],b=o[d][m],T=y-b;d=(d+1)%n,y<b?0!==h&&a(d,h-1):0!==p&&a(d,p-1),(T*T<r.peek()[0]||r.size<e)&&(y<b?0!==p&&a(d,p-1):0!==h&&a(d,h-1))}(0,0),this.visited=c;for(var f=r.consume(),h=0;h<f.length;h++)f[h]=this.labels[f[h][2]];return f},c.prototype.linearKNearestNeighbors=function(e,t){if(e<=0)throw new Error("mnemonist/kd-tree.kNearestNeighbors: k should be a positive number.");e=Math.min(e,this.size);var r,n,o,i=new a(Array,f,e);for(r=0,n=this.size;r<n;r++)o=l(this.dimensions,this.axes,this.pivots[r],t),i.push([o,r]);var s=i.consume();for(r=0;r<s.length;r++)s[r]=this.labels[this.pivots[s[r][1]]];return s},c.prototype.inspect=function(){var e,t,r,n=new Map;for(n.dimensions=this.dimensions,Object.defineProperty(n,"constructor",{value:c,enumerable:!1}),e=0;e<this.size;e++){for(r=new Array(this.dimensions),t=0;t<this.dimensions;t++)r[t]=this.axes[t][e];n.set(this.labels[e],r)}return n},"undefined"!==typeof Symbol&&(c.prototype[Symbol.for("nodejs.util.inspect.custom")]=c.prototype.inspect),c.from=function(e,t){var r=function(e,t){var r,n,i,a,s=t.length,l=new Array(e),u=new Array(s),c=new(o.getPointerArray(s))(s),d=!0;for(n=0;n<e;n++){for(r=new Float64Array(s),i=0;i<s;i++)a=t[i],r[i]=a[1][n],d&&(u[i]=a[0],c[i]=i);d=!1,l[n]=r}return{axes:l,ids:c,labels:u}}(t,n.toArray(e));return new c(t,u(t,r.axes,r.ids,r.labels))},c.fromAxes=function(e,t){return t||(t=o.indices(e[0].length)),new c(e.length,u(e.length,e,o.indices(t.length),t))},e.exports=c},412295:function(e,t){var r=new Float64Array(64),n=new Float64Array(64);t.O=function(e,t,o,i){var a,s,l,u,c,d;for(r[0]=o,n[0]=i,s=0;s>=0;)if((l=r[s])<(u=n[s]-1)){for(a=e[c=t[l]];l<u;){for(;e[t[u]]>=a&&l<u;)u--;for(l<u&&(t[l++]=t[u]);e[t[l]]<=a&&l<u;)l++;l<u&&(t[u--]=t[l])}t[l]=c,r[s+1]=l+1,n[s+1]=n[s],n[s++]=l,n[s]-r[s]>n[s-1]-r[s-1]&&(d=r[s],r[s]=r[s-1],r[s-1]=d,d=n[s],n[s]=n[s-1],n[s-1]=d)}else s--;return t}},540742:function(e,t,r){var n=r(800670);function o(e){var t=n.getPointerArray(e),r=n.getPointerArray(Math.log2(e));this.size=e,this.dimension=e,this.parents=new t(e),this.ranks=new r(e);for(var o=0;o<e;o++)this.parents[o]=o}o.prototype.find=function(e){for(var t,r,n=e;n!==(t=this.parents[n]);)n=t;for(;(r=this.parents[e])!==n;)this.parents[e]=n,e=r;return n},o.prototype.union=function(e,t){var r=this.find(e),n=this.find(t);if(r===n)return this;this.dimension--;var o=this.ranks[e],i=this.ranks[t];return o<i?this.parents[r]=n:o>i?this.parents[n]=r:(this.parents[n]=r,this.ranks[r]++),this},o.prototype.connected=function(e,t){return this.find(e)===this.find(t)},o.prototype.mapping=function(){for(var e,t={},r=new(n.getPointerArray(this.dimension))(this.size),o=0,i=0,a=this.parents.length;i<a;i++)"undefined"===typeof t[e=this.find(i)]?(r[i]=o,t[e]=o++):r[i]=t[e];return r},o.prototype.compile=function(){for(var e,t={},r=new Array(this.dimension),n=0,o=0,i=this.parents.length;o<i;o++)"undefined"===typeof t[e=this.find(o)]?(r[n]=[o],t[e]=n++):r[t[e]].push(o);return r},o.prototype.inspect=function(){var e=this.compile();return Object.defineProperty(e,"constructor",{value:o,enumerable:!1}),e},"undefined"!==typeof Symbol&&(o.prototype[Symbol.for("nodejs.util.inspect.custom")]=o.prototype.inspect),e.exports=o},728579:function(e,t){t.DEFAULT_COMPARATOR=function(e,t){return e<t?-1:e>t?1:0},t.DEFAULT_REVERSE_COMPARATOR=function(e,t){return e<t?1:e>t?-1:0},t.reverseComparator=function(e){return function(t,r){return e(r,t)}},t.createTupleComparator=function(e){return 2===e?function(e,t){return e[0]<t[0]?-1:e[0]>t[0]?1:e[1]<t[1]?-1:e[1]>t[1]?1:0}:function(t,r){for(var n=0;n<e;){if(t[n]<r[n])return-1;if(t[n]>r[n])return 1;n++}return 0}}},413118:function(e,t,r){var n=r(848210),o=r(800670);function i(e){return"number"===typeof e.length?e.length:"number"===typeof e.size?e.size:void 0}t.isArrayLike=function(e){return Array.isArray(e)||o.isTypedArray(e)},t.guessLength=i,t.toArray=function(e){var t=i(e),r="number"===typeof t?new Array(t):[],o=0;return n(e,(function(e){r[o++]=e})),r},t.toArrayWithIndices=function(e){var t=i(e),r="number"===typeof t?o.getPointerArray(t):Array,a="number"===typeof t?new Array(t):[],s="number"===typeof t?new r(t):[],l=0;return n(e,(function(e){a[l]=e,s[l]=l++})),[a,s]}},800670:function(e,t){var r=Math.pow(2,8)-1,n=Math.pow(2,16)-1,o=Math.pow(2,32)-1,i=Math.pow(2,7)-1,a=Math.pow(2,15)-1,s=Math.pow(2,31)-1;t.getPointerArray=function(e){var t=e-1;if(t<=r)return Uint8Array;if(t<=n)return Uint16Array;if(t<=o)return Uint32Array;throw new Error("mnemonist: Pointer Array of size > 4294967295 is not supported.")},t.getSignedPointerArray=function(e){var t=e-1;return t<=i?Int8Array:t<=a?Int16Array:t<=s?Int32Array:Float64Array},t.getNumberType=function(e){return e===(0|e)?-1===Math.sign(e)?e<=127&&e>=-128?Int8Array:e<=32767&&e>=-32768?Int16Array:Int32Array:e<=255?Uint8Array:e<=65535?Uint16Array:Uint32Array:Float64Array};var l={Uint8Array:1,Int8Array:2,Uint16Array:3,Int16Array:4,Uint32Array:5,Int32Array:6,Float32Array:7,Float64Array:8};t.getMinimalRepresentation=function(e,r){var n,o,i,a,s,u=null,c=0;for(a=0,s=e.length;a<s;a++)i=r?r(e[a]):e[a],o=t.getNumberType(i),(n=l[o.name])>c&&(c=n,u=o);return u},t.isTypedArray=function(e){return"undefined"!==typeof ArrayBuffer&&ArrayBuffer.isView(e)},t.concat=function(){var e,t,r,n=0;for(e=0,r=arguments.length;e<r;e++)n+=arguments[e].length;var o=new arguments[0].constructor(n);for(e=0,t=0;e<r;e++)o.set(arguments[e],t),t+=arguments[e].length;return o},t.indices=function(e){for(var r=new(t.getPointerArray(e))(e),n=0;n<e;n++)r[n]=n;return r}},289624:function(e){var t=parseInt(Number.MAX_SAFE_INTEGER/2)||(1<<26)*(1<<26);function r(){this.C=null,this.row_covered=[],this.col_covered=[],this.n=0,this.Z0_r=0,this.Z0_c=0,this.marked=null,this.path=null}function n(e,t){return(new r).compute(e,t)}r.prototype.pad_matrix=function(e,t){t=t||0;var r,n=0,o=e.length;for(r=0;r<o;++r)e[r].length>n&&(n=e[r].length);o=n>o?n:o;var i=[];for(r=0;r<o;++r){for(var a=(e[r]||[]).slice();o>a.length;)a.push(t);i.push(a)}return i},r.prototype.compute=function(e,t){(t=t||{}).padValue=t.padValue||0,this.C=this.pad_matrix(e,t.padValue),this.n=this.C.length,this.original_length=e.length,this.original_width=e[0].length;for(var r=[];r.length<this.n;)r.push(!1);this.row_covered=r.slice(),this.col_covered=r.slice(),this.Z0_r=0,this.Z0_c=0,this.path=this.__make_matrix(2*this.n,0),this.marked=this.__make_matrix(this.n,0);for(var n=1,o={1:this.__step1,2:this.__step2,3:this.__step3,4:this.__step4,5:this.__step5,6:this.__step6};;){var i=o[n];if(!i)break;n=i.apply(this)}for(var a=[],s=0;s<this.original_length;++s)for(var l=0;l<this.original_width;++l)1==this.marked[s][l]&&a.push([s,l]);return a},r.prototype.__make_matrix=function(e,t){for(var r=[],n=0;n<e;++n){r[n]=[];for(var o=0;o<e;++o)r[n][o]=t}return r},r.prototype.__step1=function(){for(var e=0;e<this.n;++e)for(var t=Math.min.apply(Math,this.C[e]),r=0;r<this.n;++r)this.C[e][r]-=t;return 2},r.prototype.__step2=function(){for(var e=0;e<this.n;++e)for(var t=0;t<this.n;++t)if(0===this.C[e][t]&&!this.col_covered[t]&&!this.row_covered[e]){this.marked[e][t]=1,this.col_covered[t]=!0,this.row_covered[e]=!0;break}return this.__clear_covers(),3},r.prototype.__step3=function(){for(var e=0,t=0;t<this.n;++t)for(var r=0;r<this.n;++r)1==this.marked[t][r]&&0==this.col_covered[r]&&(this.col_covered[r]=!0,++e);return e>=this.n?7:4},r.prototype.__step4=function(){for(var e=-1,t=-1,r=-1;;){var n=this.__find_a_zero();if(e=n[0],t=n[1],e<0)return 6;if(this.marked[e][t]=2,!((r=this.__find_star_in_row(e))>=0))return this.Z0_r=e,this.Z0_c=t,5;t=r,this.row_covered[e]=!0,this.col_covered[t]=!1}},r.prototype.__step5=function(){var e=0;this.path[e][0]=this.Z0_r,this.path[e][1]=this.Z0_c;for(var t=!1;!t;){var r=this.__find_star_in_col(this.path[e][1]);if(r>=0?(e++,this.path[e][0]=r,this.path[e][1]=this.path[e-1][1]):t=!0,!t){var n=this.__find_prime_in_row(this.path[e][0]);e++,this.path[e][0]=this.path[e-1][0],this.path[e][1]=n}}return this.__convert_path(this.path,e),this.__clear_covers(),this.__erase_primes(),3},r.prototype.__step6=function(){for(var e=this.__find_smallest(),t=0;t<this.n;++t)for(var r=0;r<this.n;++r)this.row_covered[t]&&(this.C[t][r]+=e),this.col_covered[r]||(this.C[t][r]-=e);return 4},r.prototype.__find_smallest=function(){for(var e=t,r=0;r<this.n;++r)for(var n=0;n<this.n;++n)this.row_covered[r]||this.col_covered[n]||e>this.C[r][n]&&(e=this.C[r][n]);return e},r.prototype.__find_a_zero=function(){for(var e=0;e<this.n;++e)for(var t=0;t<this.n;++t)if(0===this.C[e][t]&&!this.row_covered[e]&&!this.col_covered[t])return[e,t];return[-1,-1]},r.prototype.__find_star_in_row=function(e){for(var t=0;t<this.n;++t)if(1==this.marked[e][t])return t;return-1},r.prototype.__find_star_in_col=function(e){for(var t=0;t<this.n;++t)if(1==this.marked[t][e])return t;return-1},r.prototype.__find_prime_in_row=function(e){for(var t=0;t<this.n;++t)if(2==this.marked[e][t])return t;return-1},r.prototype.__convert_path=function(e,t){for(var r=0;r<=t;++r)this.marked[e[r][0]][e[r][1]]=1==this.marked[e[r][0]][e[r][1]]?0:1},r.prototype.__clear_covers=function(){for(var e=0;e<this.n;++e)this.row_covered[e]=!1,this.col_covered[e]=!1},r.prototype.__erase_primes=function(){for(var e=0;e<this.n;++e)for(var t=0;t<this.n;++t)2==this.marked[e][t]&&(this.marked[e][t]=0)},n.version="1.2.2",n.format_matrix=function(e){var t,r,n=[];for(t=0;t<e.length;++t)for(r=0;r<e[t].length;++r){var o=String(e[t][r]).length;(!n[r]||o>=n[r])&&(n[r]=o)}var i="";for(t=0;t<e.length;++t){for(r=0;r<e[t].length;++r){for(var a=String(e[t][r]);a.length<n[r];)a=" "+a;i+=a,r!=e[t].length-1&&(i+=" ")}t!=e[t].length-1&&(i+="\n")}return i},n.make_cost_matrix=function(e,t){var r,n;if(!t){var o=-1/0;for(r=0;r<e.length;++r)for(n=0;n<e[r].length;++n)e[r][n]>o&&(o=e[r][n]);t=function(e){return o-e}}var i=[];for(r=0;r<e.length;++r){var a=e[r];for(i[r]=[],n=0;n<a.length;++n)i[r][n]=t(e[r][n])}return i},n.Munkres=r,e.exports&&(e.exports=n)},848210:function(e,t,r){var n=r(971694),o=n.ARRAY_BUFFER_SUPPORT,i=n.SYMBOL_SUPPORT;e.exports=function(e,t){var r,n,a,s,l;if(!e)throw new Error("obliterator/forEach: invalid iterable.");if("function"!==typeof t)throw new Error("obliterator/forEach: expecting a callback.");if(Array.isArray(e)||o&&ArrayBuffer.isView(e)||"string"===typeof e||"[object Arguments]"===e.toString())for(a=0,s=e.length;a<s;a++)t(e[a],a);else if("function"!==typeof e.forEach)if(i&&Symbol.iterator in e&&"function"!==typeof e.next&&(e=e[Symbol.iterator]()),"function"!==typeof e.next)for(n in e)e.hasOwnProperty(n)&&t(e[n],n);else for(r=e,a=0;!0!==(l=r.next()).done;)t(l.value,a),a++;else e.forEach(t)}},971694:function(e,t){t.ARRAY_BUFFER_SUPPORT="undefined"!==typeof ArrayBuffer,t.SYMBOL_SUPPORT="undefined"!==typeof Symbol},373291:function(e,t,r){var n,o=r(681009),i=r(521835),a=r(567671),s=r(689048),l=r(900571),u=r(693928),c=!1,d=i();function f(e,t,r){var o=n.segments(e),i=n.segments(t),a=r(n.combine(o,i));return n.polygon(a)}n={buildLog:function(e){return!0===e?c=o():!1===e&&(c=!1),!1!==c&&c.list},epsilon:function(e){return d.epsilon(e)},segments:function(e){var t=a(!0,d,c);return e.regions.forEach(t.addRegion),{segments:t.calculate(e.inverted),inverted:e.inverted}},combine:function(e,t){return{combined:a(!1,d,c).calculate(e.segments,e.inverted,t.segments,t.inverted),inverted1:e.inverted,inverted2:t.inverted}},selectUnion:function(e){return{segments:l.union(e.combined,c),inverted:e.inverted1||e.inverted2}},selectIntersect:function(e){return{segments:l.intersect(e.combined,c),inverted:e.inverted1&&e.inverted2}},selectDifference:function(e){return{segments:l.difference(e.combined,c),inverted:e.inverted1&&!e.inverted2}},selectDifferenceRev:function(e){return{segments:l.differenceRev(e.combined,c),inverted:!e.inverted1&&e.inverted2}},selectXor:function(e){return{segments:l.xor(e.combined,c),inverted:e.inverted1!==e.inverted2}},polygon:function(e){return{regions:s(e.segments,d,c),inverted:e.inverted}},polygonFromGeoJSON:function(e){return u.toPolygon(n,e)},polygonToGeoJSON:function(e){return u.fromPolygon(n,d,e)},union:function(e,t){return f(e,t,n.selectUnion)},intersect:function(e,t){return f(e,t,n.selectIntersect)},difference:function(e,t){return f(e,t,n.selectDifference)},differenceRev:function(e,t){return f(e,t,n.selectDifferenceRev)},xor:function(e,t){return f(e,t,n.selectXor)}},"object"===typeof window&&(window.PolyBool=n),e.exports=n},681009:function(e){e.exports=function(){var e,t=0,r=!1;function n(t,r){return e.list.push({type:t,data:r?JSON.parse(JSON.stringify(r)):void 0}),e}return e={list:[],segmentId:function(){return t++},checkIntersection:function(e,t){return n("check",{seg1:e,seg2:t})},segmentChop:function(e,t){return n("div_seg",{seg:e,pt:t}),n("chop",{seg:e,pt:t})},statusRemove:function(e){return n("pop_seg",{seg:e})},segmentUpdate:function(e){return n("seg_update",{seg:e})},segmentNew:function(e,t){return n("new_seg",{seg:e,primary:t})},segmentRemove:function(e){return n("rem_seg",{seg:e})},tempStatus:function(e,t,r){return n("temp_status",{seg:e,above:t,below:r})},rewind:function(e){return n("rewind",{seg:e})},status:function(e,t,r){return n("status",{seg:e,above:t,below:r})},vert:function(t){return t===r?e:(r=t,n("vert",{x:t}))},log:function(e){return"string"!==typeof e&&(e=JSON.stringify(e,!1,"  ")),n("log",{txt:e})},reset:function(){return n("reset")},selected:function(e){return n("selected",{segs:e})},chainStart:function(e){return n("chain_start",{seg:e})},chainRemoveHead:function(e,t){return n("chain_rem_head",{index:e,pt:t})},chainRemoveTail:function(e,t){return n("chain_rem_tail",{index:e,pt:t})},chainNew:function(e,t){return n("chain_new",{pt1:e,pt2:t})},chainMatch:function(e){return n("chain_match",{index:e})},chainClose:function(e){return n("chain_close",{index:e})},chainAddHead:function(e,t){return n("chain_add_head",{index:e,pt:t})},chainAddTail:function(e,t){return n("chain_add_tail",{index:e,pt:t})},chainConnect:function(e,t){return n("chain_con",{index1:e,index2:t})},chainReverse:function(e){return n("chain_rev",{index:e})},chainJoin:function(e,t){return n("chain_join",{index1:e,index2:t})},done:function(){return n("done")}}}},521835:function(e){e.exports=function(e){"number"!==typeof e&&(e=1e-10);var t={epsilon:function(t){return"number"===typeof t&&(e=t),e},pointAboveOrOnLine:function(t,r,n){var o=r[0],i=r[1],a=n[0],s=n[1],l=t[0];return(a-o)*(t[1]-i)-(s-i)*(l-o)>=-e},pointBetween:function(t,r,n){var o=t[1]-r[1],i=n[0]-r[0],a=t[0]-r[0],s=n[1]-r[1],l=a*i+o*s;return!(l<e)&&!(l-(i*i+s*s)>-e)},pointsSameX:function(t,r){return Math.abs(t[0]-r[0])<e},pointsSameY:function(t,r){return Math.abs(t[1]-r[1])<e},pointsSame:function(e,r){return t.pointsSameX(e,r)&&t.pointsSameY(e,r)},pointsCompare:function(e,r){return t.pointsSameX(e,r)?t.pointsSameY(e,r)?0:e[1]<r[1]?-1:1:e[0]<r[0]?-1:1},pointsCollinear:function(t,r,n){var o=t[0]-r[0],i=t[1]-r[1],a=r[0]-n[0],s=r[1]-n[1];return Math.abs(o*s-a*i)<e},linesIntersect:function(t,r,n,o){var i=r[0]-t[0],a=r[1]-t[1],s=o[0]-n[0],l=o[1]-n[1],u=i*l-a*s;if(Math.abs(u)<e)return!1;var c=t[0]-n[0],d=t[1]-n[1],f=(s*d-l*c)/u,h=(i*d-a*c)/u,p={alongA:0,alongB:0,pt:[t[0]+f*i,t[1]+f*a]};return p.alongA=f<=-e?-2:f<e?-1:f-1<=-e?0:f-1<e?1:2,p.alongB=h<=-e?-2:h<e?-1:h-1<=-e?0:h-1<e?1:2,p},pointInsideRegion:function(t,r){for(var n=t[0],o=t[1],i=r[r.length-1][0],a=r[r.length-1][1],s=!1,l=0;l<r.length;l++){var u=r[l][0],c=r[l][1];c-o>e!=a-o>e&&(i-u)*(o-c)/(a-c)+u-n>e&&(s=!s),i=u,a=c}return s}};return t}},693928:function(e){var t={toPolygon:function(e,t){function r(t){if(t.length<=0)return e.segments({inverted:!1,regions:[]});function r(t){var r=t.slice(0,t.length-1);return e.segments({inverted:!1,regions:[r]})}for(var n=r(t[0]),o=1;o<t.length;o++)n=e.selectDifference(e.combine(n,r(t[o])));return n}if("Polygon"===t.type)return e.polygon(r(t.coordinates));if("MultiPolygon"===t.type){for(var n=e.segments({inverted:!1,regions:[]}),o=0;o<t.coordinates.length;o++)n=e.selectUnion(e.combine(n,r(t.coordinates[o])));return e.polygon(n)}throw new Error("PolyBool: Cannot convert GeoJSON object to PolyBool polygon")},fromPolygon:function(e,t,r){function n(e,r){return t.pointInsideRegion([.5*(e[0][0]+e[1][0]),.5*(e[0][1]+e[1][1])],r)}function o(e){return{region:e,children:[]}}r=e.polygon(e.segments(r));var i=o(null);function a(e,t){for(var r=0;r<e.children.length;r++){if(n(t,(s=e.children[r]).region))return void a(s,t)}var i=o(t);for(r=0;r<e.children.length;r++){var s;n((s=e.children[r]).region,t)&&(i.children.push(s),e.children.splice(r,1),r--)}e.children.push(i)}for(var s=0;s<r.regions.length;s++){var l=r.regions[s];l.length<3||a(i,l)}function u(e,t){for(var r=0,n=e[e.length-1][0],o=e[e.length-1][1],i=[],a=0;a<e.length;a++){var s=e[a][0],l=e[a][1];i.push([s,l]),r+=l*n-s*o,n=s,o=l}return r<0!==t&&i.reverse(),i.push([i[0][0],i[0][1]]),i}var c=[];function d(e){var t=[u(e.region,!1)];c.push(t);for(var r=0;r<e.children.length;r++)t.push(f(e.children[r]))}function f(e){for(var t=0;t<e.children.length;t++)d(e.children[t]);return u(e.region,!0)}for(s=0;s<i.children.length;s++)d(i.children[s]);return c.length<=0?{type:"Polygon",coordinates:[]}:1==c.length?{type:"Polygon",coordinates:c[0]}:{type:"MultiPolygon",coordinates:c}}};e.exports=t},567671:function(e,t,r){var n=r(159186);e.exports=function(e,t,r){function o(e,t,n){return{id:r?r.segmentId():-1,start:e,end:t,myFill:{above:n.myFill.above,below:n.myFill.below},otherFill:null}}var i=n.create();function a(e,r){i.insertBefore(e,(function(n){return function(e,r,n,o,i,a){var s=t.pointsCompare(r,i);return 0!==s?s:t.pointsSame(n,a)?0:e!==o?e?1:-1:t.pointAboveOrOnLine(n,o?i:a,o?a:i)?1:-1}(e.isStart,e.pt,r,n.isStart,n.pt,n.other.pt)<0}))}function s(e,t){var r=function(e,t){var r=n.node({isStart:!0,pt:e.start,seg:e,primary:t,other:null,status:null});return a(r,e.end),r}(e,t);return function(e,t,r){var o=n.node({isStart:!1,pt:t.end,seg:t,primary:r,other:e,status:null});e.other=o,a(o,e.pt)}(r,e,t),r}function l(e,t){var n=o(t,e.seg.end,e.seg);return function(e,t){r&&r.segmentChop(e.seg,t),e.other.remove(),e.seg.end=t,e.other.pt=t,a(e.other,e.pt)}(e,t),s(n,e.primary)}function u(o,a){var s=n.create();function u(e){return s.findTransition((function(r){return function(e,r){var n=e.seg.start,o=e.seg.end,i=r.seg.start,a=r.seg.end;return t.pointsCollinear(n,i,a)?t.pointsCollinear(o,i,a)||t.pointAboveOrOnLine(o,i,a)?1:-1:t.pointAboveOrOnLine(n,i,a)?1:-1}(e,r.ev)>0}))}function c(e,n){var o=e.seg,i=n.seg,a=o.start,s=o.end,u=i.start,c=i.end;r&&r.checkIntersection(o,i);var d=t.linesIntersect(a,s,u,c);if(!1===d){if(!t.pointsCollinear(a,s,u))return!1;if(t.pointsSame(a,c)||t.pointsSame(s,u))return!1;var f=t.pointsSame(a,u),h=t.pointsSame(s,c);if(f&&h)return n;var p=!f&&t.pointBetween(a,u,c),m=!h&&t.pointBetween(s,u,c);if(f)return m?l(n,s):l(e,c),n;p&&(h||(m?l(n,s):l(e,c)),l(n,a))}else 0===d.alongA&&(-1===d.alongB?l(e,u):0===d.alongB?l(e,d.pt):1===d.alongB&&l(e,c)),0===d.alongB&&(-1===d.alongA?l(n,a):0===d.alongA?l(n,d.pt):1===d.alongA&&l(n,s));return!1}for(var d=[];!i.isEmpty();){var f=i.getHead();if(r&&r.vert(f.pt[0]),f.isStart){r&&r.segmentNew(f.seg,f.primary);var h=u(f),p=h.before?h.before.ev:null,m=h.after?h.after.ev:null;function g(){if(p){var e=c(f,p);if(e)return e}return!!m&&c(f,m)}r&&r.tempStatus(f.seg,!!p&&p.seg,!!m&&m.seg);var y,b=g();if(b){var T;if(e)(T=null===f.seg.myFill.below||f.seg.myFill.above!==f.seg.myFill.below)&&(b.seg.myFill.above=!b.seg.myFill.above);else b.seg.otherFill=f.seg.myFill;r&&r.segmentUpdate(b.seg),f.other.remove(),f.remove()}if(i.getHead()!==f){r&&r.rewind(f.seg);continue}if(e)T=null===f.seg.myFill.below||f.seg.myFill.above!==f.seg.myFill.below,f.seg.myFill.below=m?m.seg.myFill.above:o,f.seg.myFill.above=T?!f.seg.myFill.below:f.seg.myFill.below;else if(null===f.seg.otherFill)y=m?f.primary===m.primary?m.seg.otherFill.above:m.seg.myFill.above:f.primary?a:o,f.seg.otherFill={above:y,below:y};r&&r.status(f.seg,!!p&&p.seg,!!m&&m.seg),f.other.status=h.insert(n.node({ev:f}))}else{var v=f.status;if(null===v)throw new Error("PolyBool: Zero-length segment detected; your epsilon is probably too small or too large");if(s.exists(v.prev)&&s.exists(v.next)&&c(v.prev.ev,v.next.ev),r&&r.statusRemove(v.ev.seg),v.remove(),!f.primary){var x=f.seg.myFill;f.seg.myFill=f.seg.otherFill,f.seg.otherFill=x}d.push(f.seg)}i.getHead().remove()}return r&&r.done(),d}return e?{addRegion:function(e){for(var n,o,i,a=e[e.length-1],l=0;l<e.length;l++){n=a,a=e[l];var u=t.pointsCompare(n,a);0!==u&&s((o=u<0?n:a,i=u<0?a:n,{id:r?r.segmentId():-1,start:o,end:i,myFill:{above:null,below:null},otherFill:null}),!0)}},calculate:function(e){return u(e,!1)}}:{calculate:function(e,t,r,n){return e.forEach((function(e){s(o(e.start,e.end,e),!0)})),r.forEach((function(e){s(o(e.start,e.end,e),!1)})),u(t,n)}}}},159186:function(e){e.exports={create:function(){var e={root:{root:!0,next:null},exists:function(t){return null!==t&&t!==e.root},isEmpty:function(){return null===e.root.next},getHead:function(){return e.root.next},insertBefore:function(t,r){for(var n=e.root,o=e.root.next;null!==o;){if(r(o))return t.prev=o.prev,t.next=o,o.prev.next=t,void(o.prev=t);n=o,o=o.next}n.next=t,t.prev=n,t.next=null},findTransition:function(t){for(var r=e.root,n=e.root.next;null!==n&&!t(n);)r=n,n=n.next;return{before:r===e.root?null:r,after:n,insert:function(e){return e.prev=r,e.next=n,r.next=e,null!==n&&(n.prev=e),e}}}};return e},node:function(e){return e.prev=null,e.next=null,e.remove=function(){e.prev.next=e.next,e.next&&(e.next.prev=e.prev),e.prev=null,e.next=null},e}}},689048:function(e){e.exports=function(e,t,r){var n=[],o=[];return e.forEach((function(e){var i=e.start,a=e.end;if(t.pointsSame(i,a))console.warn("PolyBool: Warning: Zero-length segment detected; your epsilon is probably too small or too large");else{r&&r.chainStart(e);for(var s={index:0,matches_head:!1,matches_pt1:!1},l={index:0,matches_head:!1,matches_pt1:!1},u=s,c=0;c<n.length;c++){var d=(g=n[c])[0],f=(g[1],g[g.length-1]);g[g.length-2];if(t.pointsSame(d,i)){if(A(c,!0,!0))break}else if(t.pointsSame(d,a)){if(A(c,!0,!1))break}else if(t.pointsSame(f,i)){if(A(c,!1,!0))break}else if(t.pointsSame(f,a)&&A(c,!1,!1))break}if(u===s)return n.push([i,a]),void(r&&r.chainNew(i,a));if(u===l){r&&r.chainMatch(s.index);var h=s.index,p=s.matches_pt1?a:i,m=s.matches_head,g=n[h],y=m?g[0]:g[g.length-1],b=m?g[1]:g[g.length-2],T=m?g[g.length-1]:g[0],v=m?g[g.length-2]:g[1];return t.pointsCollinear(b,y,p)&&(m?(r&&r.chainRemoveHead(s.index,p),g.shift()):(r&&r.chainRemoveTail(s.index,p),g.pop()),y=b),t.pointsSame(T,p)?(n.splice(h,1),t.pointsCollinear(v,T,y)&&(m?(r&&r.chainRemoveTail(s.index,y),g.pop()):(r&&r.chainRemoveHead(s.index,y),g.shift())),r&&r.chainClose(s.index),void o.push(g)):void(m?(r&&r.chainAddHead(s.index,p),g.unshift(p)):(r&&r.chainAddTail(s.index,p),g.push(p)))}var x=s.index,_=l.index;r&&r.chainConnect(x,_);var M=n[x].length<n[_].length;s.matches_head?l.matches_head?M?(k(x),P(x,_)):(k(_),P(_,x)):P(_,x):l.matches_head?P(x,_):M?(k(x),P(_,x)):(k(_),P(x,_))}function A(e,t,r){return u.index=e,u.matches_head=t,u.matches_pt1=r,u===s?(u=l,!1):(u=null,!0)}function k(e){r&&r.chainReverse(e),n[e].reverse()}function P(e,o){var i=n[e],a=n[o],s=i[i.length-1],l=i[i.length-2],u=a[0],c=a[1];t.pointsCollinear(l,s,u)&&(r&&r.chainRemoveTail(e,s),i.pop(),s=l),t.pointsCollinear(s,u,c)&&(r&&r.chainRemoveHead(o,u),a.shift()),r&&r.chainJoin(e,o),n[e]=i.concat(a),n.splice(o,1)}})),o}},900571:function(e){function t(e,t,r){var n=[];return e.forEach((function(e){var o=(e.myFill.above?8:0)+(e.myFill.below?4:0)+(e.otherFill&&e.otherFill.above?2:0)+(e.otherFill&&e.otherFill.below?1:0);0!==t[o]&&n.push({id:r?r.segmentId():-1,start:e.start,end:e.end,myFill:{above:1===t[o],below:2===t[o]},otherFill:null})})),r&&r.selected(n),n}var r={union:function(e,r){return t(e,[0,2,1,0,2,2,0,0,1,0,1,0,0,0,0,0],r)},intersect:function(e,r){return t(e,[0,0,0,0,0,2,0,2,0,0,1,1,0,2,1,0],r)},difference:function(e,r){return t(e,[0,0,0,0,2,0,2,0,1,1,0,0,0,1,2,0],r)},differenceRev:function(e,r){return t(e,[0,2,1,0,0,0,1,1,0,2,0,2,0,0,0,0],r)},xor:function(e,r){return t(e,[0,2,1,0,2,0,0,1,1,0,0,2,0,1,2,0],r)}};e.exports=r},527352:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(268748),o=[],i=function(e){return o.push(e)},a=function(e){e&&(i(e),c(e)||e.children.forEach(a))},s=function(e){var t=o.pop();return t?(t.children=e,t.height=1,t.leaf=!0,t.minX=1/0,t.minY=1/0,t.minZ=1/0,t.maxX=-1/0,t.maxY=-1/0,t.maxZ=-1/0):t={children:e,height:1,leaf:!0,minX:1/0,minY:1/0,minZ:1/0,maxX:-1/0,maxY:-1/0,maxZ:-1/0},t},l=[],u=function(e,t){var r=l.pop();return r?(r.dist=e,r.node=t):r={dist:e,node:t},r},c=function(e){return e.leaf},d=function(e,t){return e.leaf},f=function(e,t,r){if(!r)return t.indexOf(e);for(var n=0;n<t.length;n++)if(r(e,t[n]))return n;return-1},h=function(e){p(e,0,e.children.length,e)},p=function(e,t,r,n){var o=n;o?(o.minX=1/0,o.minY=1/0,o.minZ=1/0,o.maxX=-1/0,o.maxY=-1/0,o.maxZ=-1/0):o=s([]);for(var i=t,a=void 0;i<r;i++)a=e.children[i],m(o,a);return o},m=function(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.minZ=Math.min(e.minZ,t.minZ),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e.maxZ=Math.max(e.maxZ,t.maxZ),e},g=function(e){return(e.maxX-e.minX)*(e.maxY-e.minY)*(e.maxZ-e.minZ)},y=function(e){return e.maxX-e.minX+(e.maxY-e.minY)+(e.maxZ-e.minZ)},b=function(e,t){var r=Math.min(e.minX,t.minX),n=Math.min(e.minY,t.minY),o=Math.min(e.minZ,t.minZ);return(Math.max(e.maxX,t.maxX)-r)*(Math.max(e.maxY,t.maxY)-n)*(Math.max(e.maxZ,t.maxZ)-o)},T=function(e,t){var r=Math.max(e.minX,t.minX),n=Math.max(e.minY,t.minY),o=Math.max(e.minZ,t.minZ),i=Math.min(e.maxX,t.maxX),a=Math.min(e.maxY,t.maxY),s=Math.min(e.maxZ,t.maxZ);return Math.max(0,i-r)*Math.max(0,a-n)*Math.max(0,s-o)},v=function(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&e.minZ<=t.minZ&&t.maxX<=e.maxX&&t.maxY<=e.maxY&&t.maxZ<=e.maxZ};t.intersects=function(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.minZ<=e.maxZ&&t.maxX>=e.minX&&t.maxY>=e.minY&&t.maxZ>=e.minZ},t.boxRayIntersects=function(e,t,r,n,o,i,a){var s=(e.minX-t)*o,l=(e.maxX-t)*o,u=(e.minY-r)*i,c=(e.maxY-r)*i,d=(e.minZ-n)*a,f=(e.maxZ-n)*a,h=Math.min(d,f),p=Math.max(d,f),m=Math.min(u,c),g=Math.max(u,c),y=Math.min(s,l),b=Math.max(s,l),T=Math.max(0,y,m,h);return Math.min(b,g,p)>=T?T:1/0};var x=function(e,t,r,o,i){for(var a,s=[t,r];s.length;)(r=s.pop())-(t=s.pop())<=o||(a=t+Math.ceil((r-t)/o/2)*o,n(e,a,t,r,i),s.push(t,a,a,r))},_=function(e,t){return e.minX-t.minX},M=function(e,t){return e.minY-t.minY},A=function(e,t){return e.minZ-t.minZ},k=function(){function e(e){void 0===e&&(e=16),this.maxEntries=Math.max(e,8),this.minEntries=Math.max(4,Math.ceil(.4*this.maxEntries)),this.clear()}return e.alloc=function(){return this.pool.pop()||new this},e.free=function(e){e.clear(),this.pool.push(e)},e.prototype.search=function(e){var r=this.data,n=[];if(!t.intersects(e,r))return n;for(var o=[];r;){for(var i=0,a=r.children.length;i<a;i++){var s=r.children[i];t.intersects(e,s)&&(d(r)?n.push(s):v(e,s)?this._all(s,n):o.push(s))}r=o.pop()}return n},e.prototype.collides=function(e){var r=this.data;if(!t.intersects(e,r))return!1;for(var n=[];r;){for(var o=0,i=r.children.length;o<i;o++){var a=r.children[o];if(t.intersects(e,a)){if(d(r)||v(e,a))return!0;n.push(a)}}r=n.pop()}return!1},e.prototype.raycastInv=function(e,r,n,o,i,a,s){void 0===s&&(s=1/0);var c=this.data;if(o===1/0&&i===1/0&&a===1/0)return u(1/0,void 0);if(t.boxRayIntersects(c,e,r,n,o,i,a)===1/0)return u(1/0,void 0);for(var f,h=[u(0,c)],p=function(e,t){var r=h[e];h[e]=h[t],h[t]=r},m=function(){var e=h[0],t=h.length-1;h[0]=h[t],h.length=t;for(var r=0;;){var n=r<<1|1;if(n>=t)break;var o=n+1;if(o<t&&h[o].dist<h[n].dist&&(n=o),h[r].dist<h[n].dist)break;p(r,n),r=n}return function(e){l.push(e)}(e),e.node},g=function(e,t){var r=h.length;for(h.push(u(e,t));r>0;){var n=r-1>>1;if(h[n].dist<=h[r].dist)break;p(r,n),r=n}},y=s;h.length&&h[0].dist<y;)for(var b=0,T=(c=m()).children.length;b<T;b++){var v=c.children[b],x=t.boxRayIntersects(v,e,r,n,o,i,a);if(d(c)){if(x<y){if(0===x)return u(x,v);y=x,f=v}}else g(x,v)}return u(y<s?y:1/0,f)},e.prototype.raycast=function(e,t,r,n,o,i,a){return void 0===a&&(a=1/0),this.raycastInv(e,t,r,1/n,1/o,1/i,a)},e.prototype.all=function(){return this._all(this.data,[])},e.prototype.load=function(e){if(!e||!e.length)return this;if(e.length<this.minEntries){for(var t=0,r=e.length;t<r;t++)this.insert(e[t]);return this}var n=this.build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this.splitRoot(this.data,n);else{if(this.data.height<n.height){var o=this.data;this.data=n,n=o}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this},e.prototype.insert=function(e){return e&&this._insert(e,this.data.height-1),this},e.prototype.clear=function(){return this.data&&a(this.data),this.data=s([]),this},e.prototype.remove=function(e,t){if(!e)return this;for(var r,n,o=this.data,i=0,a=!1,s=[],l=[];o||s.length;){if(o||(o=s.pop(),i=l.pop(),n=s[s.length-1],a=!0),c(o)&&-1!==(r=f(e,o.children,t)))return o.children.splice(r,1),s.push(o),this.condense(s),this;a||c(o)||!v(o,e)?n?(i++,o=n.children[i],a=!1):o=void 0:(s.push(o),l.push(i),i=0,n=o,o=o.children[0])}return this},e.prototype.toJSON=function(){return this.data},e.prototype.fromJSON=function(e){return a(this.data),this.data=e,this},e.prototype.build=function(e,t,r,n){var o,i=r-t+1,a=this.maxEntries;if(i<=a)return o=s(e.slice(t,r+1)),h(o),o;n||(n=Math.ceil(Math.log(i)/Math.log(a)),a=Math.ceil(i/Math.pow(a,n-1))),(o=s([])).leaf=!1,o.height=n;var l=Math.ceil(i/a),u=l*Math.ceil(Math.pow(a,2/3)),c=l*Math.ceil(Math.pow(a,1/3));x(e,t,r,c,_);for(var d=t;d<=r;d+=c){var f=Math.min(d+c-1,r);x(e,d,f,u,M);for(var p=d;p<=f;p+=u){var m=Math.min(p+u-1,f);x(e,p,m,l,A);for(var g=p;g<=m;g+=l){var y=Math.min(g+l-1,m);o.children.push(this.build(e,g,y,n-1))}}}return h(o),o},e.prototype._all=function(e,t){for(var r=[];e;)c(e)?t.push.apply(t,e.children):r.push.apply(r,e.children),e=r.pop();return t},e.prototype.chooseSubtree=function(e,t,r,n){for(var o,i,a;n.push(t),!c(t)&&n.length-1!==r;){o=i=1/0;for(var s=0,l=t.children.length;s<l;s++){var u=t.children[s],d=g(u),f=b(e,u)-d;f<i?(i=f,o=d<o?d:o,a=u):f===i&&d<o&&(o=d,a=u)}t=a||t.children[0]}return t},e.prototype.split=function(e,t){var r=e[t],n=r.children.length,o=this.minEntries;this.chooseSplitAxis(r,o,n);var i=this.chooseSplitIndex(r,o,n),a=s(r.children.splice(i,r.children.length-i));a.height=r.height,a.leaf=r.leaf,h(r),h(a),t?e[t-1].children.push(a):this.splitRoot(r,a)},e.prototype.splitRoot=function(e,t){this.data=s([e,t]),this.data.height=e.height+1,this.data.leaf=!1,h(this.data)},e.prototype.chooseSplitIndex=function(e,t,r){for(var n,o=1/0,i=1/0,a=t;a<=r-t;a++){var s=p(e,0,a),l=p(e,a,r),u=T(s,l),c=g(s)+g(l);u<o?(o=u,n=a,i=c<i?c:i):u===o&&c<i&&(i=c,n=a)}return n},e.prototype.chooseSplitAxis=function(e,t,r){var n=this.allDistMargin(e,t,r,_),o=this.allDistMargin(e,t,r,M),i=this.allDistMargin(e,t,r,A);n<o&&n<i?e.children.sort(_):o<n&&o<i&&e.children.sort(M)},e.prototype.allDistMargin=function(e,t,r,n){e.children.sort(n);for(var o=p(e,0,t),i=p(e,r-t,r),a=y(o)+y(i),s=t;s<r-t;s++){var l=e.children[s];m(o,l),a+=y(o)}for(s=r-t-1;s>=t;s--){l=e.children[s];m(i,l),a+=y(i)}return a},e.prototype.adjustParentBBoxes=function(e,t,r){for(var n=r;n>=0;n--)m(t[n],e)},e.prototype.condense=function(e){for(var t=e.length-1,r=void 0;t>=0;t--)0===e[t].children.length?t>0?((r=e[t-1].children).splice(r.indexOf(e[t]),1),i(e[t])):this.clear():h(e[t])},e.prototype._insert=function(e,t,r){var n=[],o=this.chooseSubtree(e,this.data,t,n);for(o.children.push(e),m(o,e);t>=0&&n[t].children.length>this.maxEntries;)this.split(n,t),t--;this.adjustParentBBoxes(e,n,t)},e.pool=[],e}();t.RBush3D=k},268748:function(e){e.exports=function(){"use strict";function e(e,r,o,i,a){t(e,r,o||0,i||e.length-1,a||n)}function t(e,n,o,i,a){for(;i>o;){if(i-o>600){var s=i-o+1,l=n-o+1,u=Math.log(s),c=.5*Math.exp(2*u/3),d=.5*Math.sqrt(u*c*(s-c)/s)*(l-s/2<0?-1:1);t(e,n,Math.max(o,Math.floor(n-l*c/s+d)),Math.min(i,Math.floor(n+(s-l)*c/s+d)),a)}var f=e[n],h=o,p=i;for(r(e,o,n),a(e[i],f)>0&&r(e,o,i);h<p;){for(r(e,h,p),h++,p--;a(e[h],f)<0;)h++;for(;a(e[p],f)>0;)p--}0===a(e[o],f)?r(e,o,p):r(e,++p,i),p<=n&&(o=p+1),n<=p&&(i=p-1)}}function r(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function n(e,t){return e<t?-1:e>t?1:0}return e}()},555956:function(e,t){"use strict";var r=function(e,t,n={}){this.data=void 0,this.columns=void 0,this.valueMaps=void 0,this.storedResults=void 0,this.lastUpdated=void 0,this.validScales=["nominal","ordinal","interval","metric"],this.zTable=void 0,this.factorials=[1,1,2,6,24,120,720,5040,40320,362880,3628800,39916800,479001600,6227020800,87178291200,1307674368e3,20922789888e3,355687428096e3,6402373705728e3,0x1b02b9306890000,243290200817664e4,0x46e7261f127a0000],this.defaultOptions={epsilon:1e-5,excludeColumns:["ID","id"],incompleteBetaIterations:40,incompleteGammaIterations:80,maxBarnardsN:200,spougeConstant:40,suppressWarnings:!1,zTableIterations:25},this.init=function(e,t,r={}){for(var n in"undefined"===typeof e&&this.errorMessage("No data was supplied."),this.defaultOptions){var o="object"===typeof r&&this.has(r,n)&&this.has(this.defaultOptions,n)?r[n]:this.defaultOptions[n];Object.defineProperty(this,n,{value:o,writable:!1})}return"undefined"!==typeof e&&this.updateData(e,t),this},this.updateData=function(e,t){this.addData(e),"object"===typeof t&&this.assignValueMap(t),e.constructor===Array&&"object"!==typeof t&&(this.errorMessage("It is strongly encouraged to initalise statistics.js with a variable table that defines the scale of measurement of each variable (e.g. nominal, metric.). All variables will be assumed as nominal and subsequent analyses will likely be flawed."),o.apply(this))},this.addData=function(e){try{let t=typeof e;if("string"!==t&&"object"!==t||null===e)throw"Input variable data is neither an object nor a JSON encoded string. The variable type is "+t+". The data could not be properly imported.";return"string"===t&&(e=JSON.parse(e)),this.data=this.data?this.data.concat(e):e,this.lastUpdated=Date.now(),!0}catch(t){return this.errorMessage(t)}},this.addRow=function(e){if("undefined"===typeof e)return this.errorMessage("Add Row: No data was given.");let t="undefined"!==typeof this.data?this.data:[];return t.push(e),this.data=t,this.lastUpdated=Date.now(),!0},this.removeRow=function(e,t=!1){if("undefined"===typeof e)return this.errorMessage("Remove row: No index was given.");let r=this.data,n=this.has(this.columns,"id")||this.has(this.columns,"ID");if(t&&n){let e=-1,n=0;for(;-1===e&&n<r.length;)(this.has(r[n],"id")&&r[n].id===t||this.has(r[n],"ID")&&r[n].ID===t)&&(e=n);r.splice(n,1)}else{if(t&&!n&&this.errorMessage('Remove row: There is no column "id" or "ID". The index '+e+" will be treated as the number of the row, starting at 0."),e>r.length-1)return this.errorMessage("Remove row: The stored data has only "+r.length+" rows and index "+e+" is too large. Indexes start at 0.");r.splice(e,1)}return this.data=r,this.lastUpdated=Date.now(),!0},this.reset=function(){try{return this.data=void 0,this.storedResults=void 0,this.lastUpdated=Date.now(),!0}catch(e){this.errorMessage(e.message)}},this.assignValueMap=function(e){let t={},r={};for(var n in e){if(!this.has(e,n)||this.excludeColumns.indexOf(n)>-1)continue;let o,i=e[n],a=i;if("object"===typeof i&&this.has(i,"scale")&&(this.has(i,"valueMap")&&(o=i.valueMap),a=i.scale),"undefined"!==typeof o||"nominal"!==a&&"ordinal"!==a||(o=this.getUniqueValues(this.data.map((e=>e[n])))),"undefined"!==typeof o&&(r[n]=o),this.validScales.indexOf(a)>-1)t[n]=a;else{t[n]="nominal";let e='"'+a+'" scale for variable "'+n+'" is invalid. It was assumed as nominal. Valid scales of measurement include: '+this.validScales.join(", ");this.errorMessage(e)}}this.columns=t,this.valueMaps=r,this.sanitizeColumns()};var o=function(){let e={},t=["th","st","nd","rd"];for(var r=0;r<this.data.length;r++)if("object"!==typeof this.data[r]){let e=r%100,n=r+(t[(e-20)%10]||t[e]||t[0]);this.errorMessage("The "+n+" row was ignored because it is not an object.")}else for(var n in Object.keys(this.data[r]))!n in e&&(e[n]="nominal");this.columns=e,this.lastUpdated=Date.now()};this.sanitizeColumns=function(){let e=this.columns,t=this.data;for(var r=0;r<t.length;r++){let o=t[r];for(var n in e){let i=o[n],a=i;switch(e[n]){case"metric":case"interval":a=this.isNumeric(i)?i:NaN;break;case"ordinal":if("undefined"!==typeof this.valueMaps){let e=this.valueMaps[n];"undefined"!==typeof e&&(a=e.indexOf(i))}}t[r][n]=a}}this.data=t,this.lastUpdated=Date.now()},this.setScale=function(e,t){return"undefined"===typeof t?(this.errorMessage("This method needs to be called with valid values for both the variable and the scale of measurement to set."),!1):this.has(this.columns,e)?-1===this.validScales.indexOf(t)?(this.errorMessage('"'+t+'" is not a valid scale of measurement. Valid scales include: '+this.validScales.join(", ")),!1):(this.columns[e]=t,!0):(this.errorMessage('There is no variable "'+e+'" defined.'),!1)},this.getScale=function(e){if("undefined"!==typeof e&&this.has(this.columns,e))return this.columns[e]},this.getValueMap=function(e){if("undefined"!==typeof e&&this.has(this.columns,e))return this.valueMaps[e]},this.applyValueMap=function(e,t){let r=this.getValueMap(e);if("ordinal"===this.getScale(e)&&"undefined"!==typeof r)return"undefined"===t&&(t=this.getColumn(e)),t.map((e=>r[e]))},this.checkLastUpdated=function(e,t){return!(""===e||!this.has(this.columns,e)||"undefined"===typeof e||"undefined"===typeof t)&&("undefined"===typeof this.storedResults||"undefined"===typeof this.storedResults[e]||"undefined"===typeof this.storedResults[e][t]||"undefined"===typeof this.storedResults[e][t].lastUpdated||this.storedResults[e][t].lastUpdated<this.lastUpdated)},this.updateStatistics=function(e,t,r){if("undefined"!==typeof e&&"undefined"!==typeof t&&"undefined"!==typeof r){var n={value:r,lastUpdated:Date.now()};"undefined"===typeof this.storedResults?this.storedResults={column:{parameter:n}}:"undefined"===typeof this.storedResults[e]?this.storedResults[e]={parameter:n}:this.storedResults[e][t]=n}},this.getStatistics=function(e,t){if("undefined"!==typeof e&&"undefined"!==typeof t&&this.has(this.columns,e)&&"undefined"!==typeof this.storedResults[e][t].value)return this.storedResults[e][t].value},this.getColumn=function(e){return"undefined"===typeof e?this.errorMessage("Get column: No column to sort was specified."):this.has(this.columns,e)?this.data.map((t=>t[e])):this.errorMessage('Get column: The column "'+e+'" was not found.')},this.sortColumn=function(e,t="asc"){return"undefined"===typeof e?this.errorMessage("Sort column: No column to sort was specified."):this.has(this.columns,e)?this.sort(this.getColumn(e),t):this.errorMessage('Sort column: The column "'+e+'" was not found.')},this.sortDataByColumn=function(e,{data:t=this.data,order:r="asc",changeOriginal:n=!1}={}){return t!==this.data||"undefined"!==typeof e&&this.has(this.columns,e)?t===this.data||this.has(t[0],e)?function(e,t,r,n){return t.sort((function(t,o){return n.isNumeric(t[e])&&n.isNumeric(o[e])?("asc"===r?1:-1)*(t[e]-o[e]):0}))}(e,n?t:this.deepCopy(t),r,this):this.errorMessage('Sort data by column: The column "'+e+'" does not exist.'):this.errorMessage("Sort data by column: No column was specified or this column does not exist.")},this.sort=function(e,t="asc"){return"undefined"===typeof e?this.errorMessage("Sort: No values given."):e.constructor!==Array||0===e.length?this.errorMessage("Sort: No array or an empty array of values was given."):function(e,t,r){return e.sort(((e,n)=>t.isNumeric(e)&&t.isNumeric(n)?("asc"===r?1:-1)*(e-n):0))}(this.deepCopy(e),this,t)},this.getUniqueValues=function(e){if("undefined"===typeof e)return this.errorMessage("Get unique values: No values given.");let t=this.validateInput(e,"nominal","get unique values");return!1!==t?this.sort(t.data.filter(((e,r)=>t.data.indexOf(e)===r))):void 0},this.reduceToPairs=function(e,t){if("undefined"===typeof t||"undefined"===typeof e)return this.errorMessage("This method requires two variables to be compared.");let r=this.validateInput(e,"nominal");if(!1===r)return;let n=this.validateInput(t,"nominal");if(!1===n)return;let o=r.length>=n.length?r.length:n.length,i=[],a=[],s=[],l="string"===typeof e?e:"first",u="string"===typeof t?t:"second";for(var c=0;c<o;c++){let e=r.data[c],t=n.data[c];if(void 0!==typeof e&&void 0!==typeof t&&!isNaN(e)&&!isNaN(t)){i.push(e),a.push(t);let r={};r[l]=e,r[u]=t,s.push(r)}}return{length:i.length,missings:o-i.length,valuesFirst:i,valuesSecond:a,valuesCombined:s}},this.validateInput=function(e,t="metric",r=""){let n={};if("string"!==typeof e&&(e.constructor!==Array||e.constructor===Array&&0==e.length))return this.errorMessage("No properly formatted data was supplied. Specify a column by its name (string) or supply an array of values."),!1;if("string"===typeof e&&""!==e)n.data=this.getColumn(e),n.scale=this.getScale(e),n.length=n.data.length;else{if(!(e.constructor===Array&&e.length>0))return!1;if(!1===this.validateData(e,t))return!1;n.data=e,n.scale=t,n.length=n.data.length}if(0==n.length)return this.errorMessage("The supplied data or the data of the supplied column contains no values."),!1;if(!i.apply(this,[n.scale,t])){let e=this.validScales.slice(this.validScales.indexOf(t)).join(", "),o=""!==r?r.charAt(0).toUpperCase()+r.slice(1):"This statistical method";return o+=" is only defined for these scales of measurement: "+e+". The scale of the supplied data is "+n.scale+".",this.errorMessage(o),!1}return n},this.validateData=function(t,r="metric"){if("undefined"===typeof t||e.constructor!==Array)return this.errorMessage("Validate data: Specify an array storing the values to be validated.");if("nominal"===r)return!0;for(var n=0;n<t.length;n++)if(!this.isNumeric(t[n]))return this.errorMessage("Validate data: The supplied data contains non-numeric values: "+t[n]+" at index "+n),!1;return!0},this.isNumeric=function(e){return"undefined"!==typeof e?!Array.isArray(e)&&!isNaN(parseFloat(e))&&isFinite(e):void 0};var i=function(e,t){return this.validScales.indexOf(e)>=this.validScales.indexOf(t)};return this.errorMessage=function(e){if(!this.suppressWarnings)try{throw new TypeError("string"==typeof e?e:e.message)}catch(t){console.error("statistics.js: "+t.message)}},this.has=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},this.deepCopy=function(e){let t=Array.isArray(e)?[]:{};for(let r in e){let n=e[r];t[r]="object"===typeof n?this.deepCopy(n):n}return t},r.prototype.assignRanks=function(e,{data:t=this.data,order:r="asc",handleTiedValues:n="mean",returnFrequencies:o=!1}={}){if("undefined"===typeof e)return this.errorMessage("Assign ranks: You need to specify a column to be ranked.");let i=this.deepCopy(this.sortDataByColumn(e,{data:t,order:r,changeOriginal:!1})),a={};for(var s=0;s<i.length;s++){let t=i[s][e];a[t]=a[t]?a[t]+1:1}let l=0,u=[];for(s=0;s<i.length;s++){let t=i[s][e],r=s+1,o="rank-"+e;1===a[t]?l=0:"mean"===n?(l++,r=s+a[t]/2-l+1.5):"random"===n&&(0===u.length&&(u=Array.from(new Array(a[t]),((e,t)=>t+s+1))),r=u[Math.floor(Math.random()*u.length)],u.splice(u.indexOf(r),1)),l==a[t]&&(l=0),i[s][o]=r}return o?{data:i,frequencies:a}:i},r.prototype.contingencyTable=function(e,t){if("undefined"===typeof t)return this.errorMessage("A contingency table requires two columns to analyze.");if(!this.has(this.columns,e))return this.errorMessage('There is no variable "'+e+'" defined.');if(!this.has(this.columns,t))return this.errorMessage('There is no variable "'+t+'" defined.');let r=this.getScale(e),n=this.getScale(t);if("nominal"!==r&&"ordinal"!==r||"nominal"!==n&&"ordinal"!==n)return this.errorMessage("Both variables need to be nominal for. They are "+r+" and "+n+".");let o=this.getValueMap(e),i=this.getValueMap(t);if("undefined"===typeof o||"undefined"===typeof i)return this.errorMessage("Contingency table: There are no valid values.");let a={total:{total:0}},s=this.data;for(var l=0;l<s.length;l++){let r=s[l][e],n=s[l][t];"undefined"===typeof a[r]&&(a[r]={total:0}),a[r][n]="undefined"!==typeof a[r][n]?a[r][n]+1:1,a.total[r]="undefined"!==typeof a.total[r]?a.total[r]+1:1,a.total[n]="undefined"!==typeof a.total[n]?a.total[n]+1:1,a[r].total++,a.total.total++}let u={detailled:a};return o.length<=2&&i.length<=2&&(u.a=a[o[0]][i[0]]||0,u.b=a[o[0]][i[1]]||0,u.c=a[o[1]][i[0]]||0,u.d=a[o[1]][i[1]]||0),u},this.showData=function(e){if("string"===typeof e&&this.has(this.columns,e))"ordinal"===this.getScale(e)?console.log(this.applyValueMap(e)):console.log(this.getColumn(e));else if("undefined"===typeof e){let e=this.valueMaps,n=this.data;if("undefined"!==typeof e)for(var t in e)if(this.has(e,t)&&"undefined"!==typeof e[t]&&"ordinal"===this.getScale(t))for(var r=0;r<n.length;r++)n[r][t]=e[t][n[r][t]];console.table(n)}else console.log(e)},this.scatterPlot=function(e=this.data,{canvas:t=null,xAxis:r=null,yAxis:n=null,width:o=null,height:i=null,dotRadius:a=4,showGrid:s=!1,minNumberXMarks:l=8,minNumberYMarks:u=8,background:c="#FFFFFF",dotColor:d="#000000",gridColor:f="#CCCCCC",axisColor:h="#000000"}={}){if("undefined"===typeof e)return this.errorMessage("Scatter plot: No data given.");if(e.constructor!==Array||0===e.length)return this.errorMessage("Scotter plot: Data is not an array or empty.");if(l<=0||u<=0)return this.errorMessage("Scotter plot: The number of line to plot must be larger than 0.");let p=typeof e[0];if("object"===p&&(!r||!n))return this.errorMessage("Scatter plot: The variables for the x and y axes need to be supplied.");let m={},g=1/0,y=-1/0,b=1/0,T=-1/0,v=0;for(var x=0;x<e.length;x++){let t,o,i=[];if("number"===p||e[0].constructor===Array){if(!this.isNumeric(e[x]))continue;t=x,o=e[x]}else if("object"===p){if(!this.has(e[x],r)||!this.has(e[x],n)||!this.isNumeric(e[x][r])||!this.isNumeric(e[x][n]))continue;t=e[x][r],o=e[x][n]}this.has(m,t)?i=m[t]:v+=1,i.push(o),m[t]=i,t>y&&(y=t),t<g&&(g=t),o>T&&(T=o),o<b&&(b=o)}g/y<.1&&(g=0),b/T<.1&&(b=0),null===t&&(t=document.createElement("canvas"));let _=t.getContext("2d"),M=o?.1*o:.1*(y-g);for(var A in(o=(o?o-2*M:y-g)+2*a)<400&&(o=400),(i=(i?i-2*M:T-b)+2*a)<400&&(i=400),M<40&&(M=40),t.width=o,t.height=i,_.fillStyle="transparent",_.fillRect(0,0,o,i),_.fillStyle=d,m)for(var k=0;k<m[A].length;k++){let e=(A-g)*(o-a)/(y-g),t=i-(m[A][k]-b)*(i-a)/(T-b)-a;_.fillRect(e,t,a,a)}const P=function(e,t,r,n,o,i=h){e.strokeStyle=i,e.beginPath(),e.moveTo(Math.floor(t),Math.floor(r)),e.lineTo(Math.floor(n),Math.floor(o)),e.stroke(),e.strokeStyle=h};let E=document.createElement("canvas"),I=E.getContext("2d"),L=o+2*M-2*a,w=i+2*M-2*a;E.width=L,E.height=w,I.fillStyle=c,I.fillRect(0,0,L,w),I.fillStyle=h,I.font=.2*M+"px Arial",I.textAlign="center",I.textBaseline="middle";let C=Math.round((y-g)/l),F=C>=1?Math.pow(10,parseInt(C).toString().length-1):Math.pow(10,-2);C=Math.round(C/F)*F;let O=0,S=0,D=0;if(C>0)for(x=0;x<l||O<=y&&S<=o-2*M;x++)O=Math.round(g/F)*F+x*C,S=.5*M+(O-g)*(o-a)/(y-g),S>L-.5*M||S<.5*M||(P(I,S,w-.4*M,S,w-.6*M),s&&P(I,S,w-.6*M,S,.5*M,f),I.fillText(O,S,w-.2*M));let N=(T-b)/u,R=N>=1?Math.pow(10,parseInt(N).toString().length-1):Math.pow(10,-2);if(N=Math.round(N/R)*R,O=0,N>0)for(x=0;x<u||O<=T&&D<=i-2*M;x++)O=Math.round(b/R)*R+x*N,D=1.5*M-2*a+i-(O-b)*(i-a)/(T-b),D>w-.5*M||D<.5*M||(P(I,.4*M,D,.6*M,D),s&&P(I,.6*M,D,o+M-2*a,D,f),I.fillText(O,.2*M,D));return P(I,.5*M,w-.5*M,L-M,w-.5*M),P(I,.5*M,w-.5*M,.5*M,.5*M),I.drawImage(t,.5*M-.5*a,1.5*M-1.5*a),_.drawImage(E,0,0,o,i),t},this.init(e,t,n)};e.exports&&(t=e.exports=r),t.Statistics=r,r.prototype.mean=function(e){return"undefined"!==typeof e?this.arithmeticMean(e):void 0},r.prototype.arithmeticMean=function(e){if("undefined"===typeof e)return this.errorMessage("Arithmetic mean: No data was supplied.");if("string"===typeof e&&!1===this.checkLastUpdated(e,"mean"))return this.getStatistics(e,"mean");let t=this.validateInput(e,"interval","arithmetic mean");if(!1===t)return;let r=this.sumExact(t.data)/t.length;return"string"===typeof e&&this.updateStatistics(e,"mean",r),r},r.prototype.geometricMean=function(e){if("undefined"===typeof e)return this.errorMessage("Geometric mean: No data was supplied.");if("string"===typeof e&&!1===this.checkLastUpdated(e,"geometricMean"))return this.getStatistics(e,"geometricMean");let t=this.validateInput(e,"metric","geometric mean");if(!1===t)return;let r,n=!1;return r=t.data.reduce(((e,t)=>t>0?e*t:(n=!0,e)),1),!n&&t.length>0?r=Math.pow(r,1/t.length):(this.errorMessage("Geometric mean is not defined because the data contains non-positive values."),r=void 0),"string"===typeof e&&this.updateStatistics(e,"geometricMean",r),r},r.prototype.harmonicMean=function(e){if("undefined"===typeof e)return this.errorMessage("Harmonic mean: No data was supplied.");if("string"===typeof e&&!1===this.checkLastUpdated(e,"harmonicMean"))return this.getStatistics(e,"harmonicMean");let t=this.validateInput(e,"metric","harmonicMean");if(!1===t)return;let r=!1,n=!1,o=t.data.reduce(((e,t)=>t<0?(n=!0,0):0!==t?e+1/t:(r=!0,0)),0);return o=r?0:t.length/o,o=n?void 0:o,"string"===typeof e&&this.updateStatistics(e,"harmonicMean",o),o},r.prototype.rootMeanSquare=function(e){if("undefined"===typeof e)return this.errorMessage("Root mean square: No data was supplied.");if("string"===typeof e&&!1===this.checkLastUpdated(e,"rootMeanSquare"))return this.getStatistics(e,"rootMeanSquare");let t=this.validateInput(e,"interval","root mean square");if(!1===t)return;let r=Math.sqrt(t.data.reduce(((e,t)=>e+t*t),0)/t.length);return"string"===typeof e&&this.updateStatistics(e,"rootMeanSquare",r),r},r.prototype.cubicMean=function(e){if("undefined"===typeof e)return this.errorMessage("Cubic mean: No data was supplied.");if("string"===typeof e&&!1===this.checkLastUpdated(e,"cubicMean"))return this.getStatistics(e,"cubicMean");let t=this.validateInput(e,"interval","cubic mean");if(!1===t)return;let r=t.data.reduce(((e,t)=>e+t*t*t),0);return r=r>=0&&t.length>0?Math.pow(r/t.length,1/3):void 0,"string"===typeof e&&this.updateStatistics(e,"cubicMean",r),r},r.prototype.winsorisedMean=function(e,t=.2){if("undefined"===typeof e)return this.errorMessage("Winsorised mean: No data was supplied.");if(t<0||t>.5)return this.errorMessage("winsorisedMean should be called with a percentage value within the range of [0, 0.5].");if(.5===t)return this.median(e);let r=this.validateInput(e,"interval","Winsorised (truncated) mean");if(!1===r)return;let n=Math.floor(r.length*t),o=this.sort(r.data).slice(n,r.length-n);return o=Array(n).fill(o[0]).concat(o).concat(Array(n).fill(o[o.length-1])),this.sumExact(o)/r.length},r.prototype.gastwirthCohenMean=function(e,{alpha:t=.25,lambda:r=.25}={}){if("undefined"===typeof e)return this.errorMessage("Gastwirth-Cohen mean: No data was supplied.");if(!1===this.validateInput(e,"ordinal","Gastwirth-Cohen Mean"))return;if(!this.isNumeric(t)||t<0||t>.5)return this.errorMessage("Gastwirth-Cohen mean should be called with an alpha value within the range of [0, 0.5].");if(!this.isNumeric(r)||r<0||r>.5)return this.errorMessage("Gastwirth-Cohen mean should be called with a lambda value within the range of [0, 0.5].");let n,o=this.quantile(e,t),i=this.quantile(e,1-t),a=this.median(e);return"undefined"!==typeof o&&"undefined"!==typeof i&&"undefined"!==typeof a&&(n=r*(o+i)+(1-2*r)*a),n},r.prototype.midRange=function(e){if("undefined"===typeof e)return this.errorMessage("Mid-range: No data was supplied.");if(!1===this.validateInput(e,"interval","mid-range"))return;let t=this.minimum(e),r=this.maximum(e);return"undefined"!==typeof t&&"undefined"!==typeof r?.5*(t+r):void 0},r.prototype.median=function(e){if("undefined"===typeof e)return this.errorMessage("Median: No data was supplied.");if("string"===typeof e&&!1===this.checkLastUpdated(e,"median"))return this.getStatistics(e,"median");let t=this.quantile(e,.5);return"string"===typeof e&&this.updateStatistics(e,"median",t),t},r.prototype.mode=function(e){if("undefined"===typeof e)return this.errorMessage("Mode: No data was supplied.");if("string"===typeof e&&!1===this.checkLastUpdated(e,"mode"))return this.getStatistics(e,"mode");let t=this.validateInput(e,"nominal","mode");if(!1===t)return;let r=t.data,n=[],o=[r[0]],i=1;for(var a=1;a<t.length;a++){let e=r[a];n[e]=null==n[e]?1:n[e]+1,n[e]>i?(o=[e],i=n[e]):n[e]===i&&o.push(e)}return 1===o.length&&(o=o[0]),"string"===typeof e&&this.updateStatistics(e,"mode",o),o},r.prototype.minimum=function(e){if("undefined"===typeof e)return this.errorMessage("Minimum: No data was supplied.");if("string"===typeof e&&!1===this.checkLastUpdated(e,"minimum"))return this.getStatistics(e,"minimum");let t=this.validateInput(e,"ordinal","minimum");if(!1===t)return;let r=1/0,n=t.length;for(;n--;)t.data[n]<r&&(r=t.data[n]);return"string"===typeof e&&this.updateStatistics(e,"minimum",r),r},r.prototype.maximum=function(e){if("undefined"===typeof e)return this.errorMessage("Maximum: No data was supplied.");if("string"===typeof e&&!1===this.checkLastUpdated(e,"maximum"))return this.getStatistics(e,"maximum");let t=this.validateInput(e,"ordinal","maximum");if(!1===t)return;let r=-1/0,n=t.length;for(;n--;)t.data[n]>r&&(r=t.data[n]);return"string"===typeof e&&this.updateStatistics(e,"maximum",r),r},r.prototype.range=function(e){if("undefined"===typeof e)return this.errorMessage("Range: No data was supplied.");if("string"===typeof e&&!1===this.checkLastUpdated(e,"range"))return this.getStatistics(e,"range");let t,r;if("string"===typeof e&&"nominal"===this.getScale(e)){if(t=this.validateInput(e,"nominal","range"),!1===t)return;r=this.getUniqueValues(t.data)}else{if(t=this.validateInput(e,"ordinal","range"),!1===t)return;let n=this.sort(t.data);r=n[t.length-1]-n[0]}return"string"===typeof e&&this.updateStatistics(e,"range",r),r},r.prototype.variance=function(e,t=!0){if("undefined"===typeof e)return this.errorMessage("Variance: No data was supplied.");if("string"===typeof e&&!1===this.checkLastUpdated(e,"variance"))return this.getStatistics(e,"variance");let r=this.validateInput(e,"interval","variance");if(!1===r)return;if(r.length<2)return this.errorMessage("The data supplied to compute variance needs to contain at least two datasets.");let n=0;if(this.isNumeric(t)){for(var o=0;o<r.length;o++)n+=Math.pow(t-r.data[o],2);n/=r.length-1}else{let e=0,i=0;for(o=0;o<r.length;o++){e+=1;let t=r.data[o]-i;i+=t/e,n+=t*(r.data[o]-i)}t&&e>1?n/=e-1:!t&&e>0?n/=e:n=void 0}return"string"===typeof e&&this.updateStatistics(e,"variance",n),n},r.prototype.standardDeviation=function(e,t=!0){if("undefined"===typeof e)return this.errorMessage("Standard deviation: No data was supplied.");if("string"===typeof e&&!1===this.checkLastUpdated(e,"standardDeviation"))return this.getStatistics(e,"standardDeviation");let r=this.validateInput(e,"interval","standard deviation");if(!1===r)return;if(r.length<2)return this.errorMessage("The data supplied to compute standardDeviation needs to contain at least two datasets.");let n=Math.sqrt(this.variance(e,t));return"string"===typeof e&&this.updateStatistics(e,"standardDeviation",n),n},r.prototype.coefficientOfVariation=function(e,t){if("undefined"===typeof e)return this.errorMessage("Coefficient of variation: No data was supplied.");let r=this.validateInput(e,"interval","coefficient of variation");if(!1===r)return;let n=this.standardDeviation(r.data),o="undefined"===typeof t?this.mean(r.data):t;return"undefined"!==typeof n&&"undefined"!==typeof o&&0!==o?n/o:void 0},r.prototype.indexOfDispersion=function(e,t){if("undefined"===typeof e)return this.errorMessage("Index of dispersion: No data was supplied.");let r=this.validateInput(e,"interval","coefficient of variation");if(!1===r)return;let n=this.variance(r.data),o="undefined"===typeof t?this.mean(r.data):t;return"undefined"!==typeof n&&"undefined"!==typeof o&&0!==o?n/o:void 0},r.prototype.geometricStandardDeviation=function(e){if("undefined"===typeof e)return this.errorMessage("Geomtric standard deviation: No data was supplied.");if("string"===typeof e&&!1===this.checkLastUpdated(e,"geometricStandardDeviation"))return this.getStatistics(e,"geometricStandardDeviation");let t=this.validateInput(e,"interval","geometric standard deviation");if(!1===t)return;let r=t.length,n=this.geometricMean(e),o=0,i=!1;for(var a=0;a<r;a++)t.data[a]<=0?i=!0:o+=Math.pow(Math.log(t.data[a]/n),2);return o=i?void 0:Math.exp(Math.sqrt(o/r)),"string"===typeof e&&this.updateStatistics(e,"geometricStandardDeviation",o),o},r.prototype.medianAbsoluteDeviation=function(e){if("undefined"===typeof e)return this.errorMessage("Median absolute deviation: No data was supplied.");let t=this.validateInput(e,"interval","median absolute deviation");if(!1===t)return;let r=t.data,n=this.median(r);return"undefined"!==typeof n?(r=r.map((e=>Math.abs(e-n))),this.median(r)):void 0},r.prototype.cumulativeFrequency=function(e,t){if("undefined"===typeof e)return this.errorMessage("Cumulative frequency: No data was supplied.");if("undefined"===typeof t||!this.isNumeric(t))return void this.errorMessage("You need to specify a boundary for the cumulative frequency analysis that is either an integer or a floating point number.");let r=this.validateInput(e,"ordinal","cumulative frequency analysis");if(!1===r)return;let n=this.sort(r.data),o=0;for(;t>=n[o];)o++;return o},r.prototype.frequencies=function(e){if("undefined"===typeof e)return this.errorMessage("Frequencies: No data was supplied.");let t=this.validateInput(e,"nominal","frequencies");if(!1===t)return;let r=t.data,n={},o=[];for(var i=0;i<t.length;i++){let e=r[i];null==n[e]?(o.push(e),n[e]=1):n[e]++}return o=o.sort(((e,t)=>n[t]-n[e])),o=o.map((e=>({value:e,absolute:n[e],relative:n[e]/t.length}))),o},r.prototype.quantile=function(e,t=.5){if("undefined"===typeof e)return this.errorMessage("Quantile: No data was supplied.");if(!this.isNumeric(t)||t<0||t>1)return this.errorMessage("Quantiles should be called with a percentage value within the range of [0, 1].");let r=this.validateInput(e,"ordinal","quantile");if(!1===r)return;let n=t*r.length,o=this.sort(r.data);return n%1===0?.5*(o[n]+o[n-1]):o[Math.floor(n)]},r.prototype.quartiles=function(e){if("undefined"===typeof e)return this.errorMessage("Quartiles: No data was supplied.");if("string"===typeof e&&!1===this.checkLastUpdated(e,"quartiles"))return this.getStatistics(e,"quartiles");let t=[this.quantile(e,.25),this.quantile(e,.75)];return"undefined"!==typeof t[0]&&"undefined"!==typeof t[1]?(this.updateStatistics(e,"quartiles",t),t):void 0},r.prototype.interQuartileRange=function(e){if("undefined"===typeof e)return this.errorMessage("Interquartile range: No data was supplied.");let t=this.validateInput(e,"interval","interquartile range");if(!1===t)return;let r=this.quartiles(t.data);return"undefined"!==typeof r?r[1]-r[0]:void 0},r.prototype.skewness=function(e,t=!1){if("undefined"===typeof e)return this.errorMessage("Skewness: No data was supplied.");if("string"===typeof e&&!1===this.checkLastUpdated(e,"skewness"))return this.getStatistics(e,"skewness");let r=this.validateInput(e,"ordinal","skewness");if(!1===r)return;if(r.length<2)return;let n=this.mean(e),o=this.standardDeviation(e,!1),i=0;for(var a=0;a<r.length;a++)i+=Math.pow(r.data[a]-n,3);let s=i/Math.pow(o,3);return s*=t?r.length/((r.length-1)*(r.length-2)):1/r.length,"string"===typeof e&&this.updateStatistics(e,"skewness",s),s},r.prototype.kurtosis=function(e){if("undefined"===typeof e)return this.errorMessage("Kurtosis: No data was supplied.");if("string"===typeof e&&!1===this.checkLastUpdated(e,"kurtosis"))return this.getStatistics(e,"kurtosis");let t=this.validateInput(e,"ordinal","kurtosis");if(!1===t)return;if(t.length<2)return;let r=this.mean(e),n=this.standardDeviation(e),o=0;for(var i=0;i<t.length;i++)o+=Math.pow(t.data[i]-r,4);let a=o/(t.length*Math.pow(n,4));return"string"===typeof e&&this.updateStatistics(e,"kurtosis",a),a},r.prototype.excessKurtosis=function(e){if("undefined"===typeof e)return this.errorMessage("Excess kurtosis: No data was supplied.");let t=this.kurtosis(e);return"undefined"!==typeof t?t-3:void 0},r.prototype.sum=function(e){return"undefined"===typeof e?this.errorMessage("Sum: No data given."):("string"===typeof e&&this.has(this.columns,e)&&(e=this.getColumn(e)),0!=e.length?e.reduce(((e,t)=>this.isNumeric(t)?e+t:e),0):void 0)},r.prototype.sumExact=function(e){if("undefined"===typeof e)return this.errorMessage("Sum exact: No data given.");if("string"===typeof e&&this.has(this.columns,e)&&(e=this.getColumn(e)),0==e.length)return;let t=0,r=0;for(var n=0;n<e.length;n++){let o=this.isNumeric(e[n])?e[n]:0;o-=r;let i=t+o;r=i-t-o,t=i}return t},r.prototype.product=function(e){return"undefined"===typeof e?this.errorMessage("Product: No data given."):("string"===typeof e&&this.has(this.columns,e)&&(e=this.getColumn(e)),0===e.length?1:e.reduce(((e,t)=>this.isNumeric(t)?e*t:e),1))},r.prototype.factorial=function(e){return this.isNumeric(e)&&!Number.isInteger(e)?this.gamma(e):"undefined"!==typeof this.factorials[e]?this.factorials[e]:this.computeFactorial(e)},r.prototype.computeFactorial=function(e){if("undefined"===typeof e||!this.isNumeric(e)||e<0)return;if("undefined"!==typeof this.factorials[e])return this.factorials[e];if(!Number.isInteger(e))return this.gamma(e);let t=1,r=1;for(;e>r;)r++,t*=r,"undefined"===typeof this.factorials[r]&&(this.factorials[r]=t);return t},r.prototype.binomialCoefficient=function(e=1,t=1){if(e<t||t<0)return this.errorMessage("The binomial coefficient is only defined for n and k with n \u2265 k \u2265 0. N is "+e+" and k is "+t+".");if(!Number.isInteger(e)||!Number.isInteger(t))return this.errorMessage("The binomial coefficient is only defined for integers n and k.");let r=[];for(var n=1;n<=t;n++)r.push((e+1-n)/n);return this.product(r)},r.prototype.gamma=function(e,t=!1){if("undefined"!==typeof e&&this.isNumeric(e)&&!(e<0))return Number.isInteger(e)&&"undefined"!==typeof this.factorials[e-1]?this.factorials[e-1]:t?this.gammaSpouge(e):this.gammaStirling(e)},r.prototype.gammaSpouge=function(e){if("undefined"===typeof e||!this.isNumeric(e)||e<0)return;if(Number.isInteger(e)&&"undefined"!==typeof this.factorials[e-1])return this.factorials[e-1];const t=this.spougeConstant;let r=Math.pow(e+t,e+.5),n=1,o=0,i=Math.sqrt(2*Math.PI);r*=Math.exp(-e-t),r/=e;for(var a=1;a<t;a++)e++,o=Math.pow(t-a,a-.5),o*=Math.exp(t-a),o/=n,i+=o/e,n*=-a;return i*r},r.prototype.gammaStirling=function(e){if("undefined"===typeof e||!this.isNumeric(e)||e<0)return;if(Number.isInteger(e)&&"undefined"!==typeof this.factorials[e-1])return this.factorials[e-1];let t=1/(10*e);return t=1/(12*e-t),t=.36787944117144233*(t+e),t=Math.pow(t,e),t*=Math.sqrt(6.283185307179586/e),t},r.prototype.incompleteGamma=function(e,t){if("undefined"===typeof t)return this.errorMessage("The incomplete lower gamma function is only defined for two numeric variables s and x.");if(!this.isNumeric(e)||!this.isNumeric(t))return this.errorMessage("The incomplete lower gamma function is only defined for numeric variables s and x.");if(t<0)return this.errorMessage("The incomplete lower gamma function is defined for x > 0.");let r=this.incompleteGammaIterations,n=1;for(var o=0;o<r;o++){let i=r-o;n=t+(i-e)/(1+i/n)}return this.gamma(e,!0)-Math.exp(-t)*Math.pow(t,e)/n},r.prototype.regularisedGamma=function(e,t){return"undefined"===typeof t?this.errorMessage("The regularised lower gamma function is only defined for two numeric variables s and x."):this.isNumeric(e)&&this.isNumeric(t)?t<0?this.errorMessage("The regularised lower gamma function is defined for x > 0."):this.incompleteGamma(e,t)/this.gamma(e,!0):this.errorMessage("The regularised lower gamma function is only defined for numeric variables s and x.")},r.prototype.beta=function(e,t){return"undefined"===typeof t?this.errorMessage("The beta function is only defined for two numeric variables a and b."):this.isNumeric(e)&&this.isNumeric(t)?e<=0||t<=0?this.errorMessage("The beta function is defined for a and b with a > 0 and b > 0."):Number.isInteger(e)&&Number.isInteger(t)&&e>0&&t>0?this.factorial(e-1)*this.factorial(t-1)/this.factorial(e+t-1):this.gamma(e,!0)*this.gamma(t,!0)/this.gamma(e+t,!0):this.errorMessage("The beta function is only defined for numeric variables a and b.")},r.prototype.incompleteBeta=function(e,t,r){if("undefined"===typeof r)return this.errorMessage("The incomplete beta function is only defined for two numeric variables a and b.");if(!this.isNumeric(e)||!this.isNumeric(t)||!this.isNumeric(r))return this.errorMessage("The incomplete beta function is only defined for numeric variables x, a and b.");if(e<0||e>1)return this.errorMessage("The incomplete beta function is defined for x \u2265 0 and x \u2266 1.");if(t<=0||r<=0)return this.errorMessage("The incomplete beta function is defined for a and b with a > 0 and b > 0.");if(1==e)return this.beta(t,r);var n=function(e,t,r,n){if(e%2==0){let o=.5*e;return o*(r-o)*n/((t+2*o-1)*(t+2*o))}{let o=.5*e-.5;return-(t+o)*(t+r+o)*n/((t+2*o)*(t+2*o+1))}};let o=Math.pow(e,t)*Math.pow(1-e,r)/t,i=this.incompleteBetaIterations,a=1;for(var s=0;s<i;s++){a=1+n(i-s,t,r,e)/a}return o/a},r.prototype.regularisedBeta=function(e,t,r){if("undefined"===typeof r)return this.errorMessage("The regularised beta function is only defined for two numeric variables a and b.");if(!this.isNumeric(e)||!this.isNumeric(t)||!this.isNumeric(r))return this.errorMessage("The regularised beta function is only defined for numeric variables x, a and b.");if(e>1||e<0)return this.errorMessage("The regularised beta function is defined for x \u2265 0 and x \u2266 1.");if(t<=0||r<=0)return this.errorMessage("The regularised beta function is defined for a and b with a > 0 and b > 0.");if(!Number.isInteger(t)||!Number.isInteger(r))return this.incompleteBeta(e,t,r)/this.beta(t,r);let n=this.epsilon+1,o=t,i=0;for(;n>=this.epsilon;)n=this.binomialCoefficient(r+o-1,o)*Math.pow(e,o),i+=n,o++;return i*Math.pow(1-e,r)},r.prototype.covariance=function(e,t,r=!0){if("undefined"===typeof t)return this.errorMessage("Covariance requires two variables to be compared.");let n=this.validateInput(e,"interval","covariance");if(!1===n)return;let o=this.validateInput(t,"interval","covariance");if(!1===o)return;let i=this.reduceToPairs(n.data,o.data);if(0===i.length)return;let a=this.mean(i.valuesFirst),s=this.mean(i.valuesSecond),l=0;for(var u=0;u<i.length;u++)l+=(i.valuesFirst[u]-a)*(i.valuesSecond[u]-s);return r&&i.length>1?l/=i.length-1:!r&&i.length>0?l/=i.length:l=void 0,{covariance:l,missings:i.missings}},r.prototype.correlationCoefficient=function(e,t){if("undefined"===typeof t)return this.errorMessage("Pearson correlation coefficient requires two variables to be compared.");let r=this.validateInput(e,"interval","Pearson correlation coefficient");if(!1===r)return;let n=this.validateInput(t,"interval","Pearson correlation coefficient");if(!1===n)return;let o=r.length>=n.length?r.length:n.length,i=r.data,a=n.data,s=[],l=0,u=0;for(var c=0;c<o;c++){let e=i[c],t=a[c];void 0===typeof e||void 0===typeof t||isNaN(e)||isNaN(t)||(l+=e,u+=t,s.push([e,t]))}let d=o-s.length;if(o=s.length,0===o)return;l/=o,u/=o;let f=0,h=0,p=0;for(c=0;c<o;c++){let e=s[c][0]-l,t=s[c][1]-u;f+=e*t,h+=e*e,p+=t*t}return{correlationCoefficient:h>0&&p>0?f/Math.sqrt(h*p):0,missings:d}},r.prototype.spearmansRho=function(e,t,r=!1){if("undefined"===typeof t)return this.errorMessage("Spearman's Rho requires two variables to be compared.");if(!1===this.validateInput(e,"ordinal","Spearman's Rho"))return;if(!1===this.validateInput(t,"ordinal","Spearman's Rho"))return;let n=this.reduceToPairs(e,t),o=n.length;if(0===o)return;let i=this.assignRanks(e,{data:n.valuesCombined,returnFrequencies:!0,order:"desc"}),a=i.frequencies;i=this.assignRanks(t,{data:i.data,returnFrequencies:!0,order:"desc"});let s=i.frequencies;i=i.data;let l=6*i.reduce(((r,n)=>r+Math.pow(n["rank-"+e]-n["rank-"+t],2)),0);if(r){let e=Object.values(a).reduce(((e,t)=>e+Math.pow(t,3)-t)),t=Object.values(s).reduce(((e,t)=>e+Math.pow(t,3)-t));l=(Math.pow(o,3)-o-.5*e-.5*t-l)/Math.sqrt((Math.pow(o,3)-o-e)*(Math.pow(o,3)-o-t))}else l=1-l/(Math.pow(o,3)-o);let u=o-2,c=Math.sqrt((u-1)/1.06)*this.fisherTransformation(l),d=1-this.normalCumulativeValue(Math.abs(c)),f=l*Math.sqrt(u/(1-l*l)),h=1-this.studentsTCumulativeValue(Math.abs(f),u);return{rho:l,significanceNormal:{zScore:c,pOneTailed:d,pTwoTailed:2*d},significanceStudent:{degreesOfFreedom:u,tStatistic:f,pOneTailed:h,pTwoTailed:2*h},missings:n.missings}},r.prototype.kendallsTau=function(e,t){if("undefined"===typeof t)return this.errorMessage("Kendall's Tau requires two columns to analyze.");if(!1===this.validateInput(e,"ordinal","Kendall's Tau"))return;if(!1===this.validateInput(t,"ordinal","Kendall's Tau"))return;let r=this.reduceToPairs(e,t),n=r.length,o=r.valuesCombined,i=0,a=0,s={},l={},u=0;for(var c=0;c<n-1;c++)for(var d=c+1;d<n;d++){let r=o[c][e],n=o[d][e],f=o[c][t],h=o[d][t];r===n?f===h?u+=1:s[f]=this.has(s,f)?s[f]+1:1:f===h?l[f]=this.has(l,f)?l[f]+1:1:Math.sign(r-n)===Math.sign(f-h)?i+=1:a+=1}let f=i-a,h=Object.keys(s).length+Object.keys(l).length===0?2*f/(n*(n-1)):void 0,p=3*f/Math.sqrt(.5*n*(n-1)*(2*n+5)),m=this.normalCumulativeValue(-Math.abs(p)),g=2<r.length?2:r.length,y=2*g*f/(n*n*(g-1)),b=h,T=p,v=m;if("undefined"===typeof h){b=f/Math.sqrt((i+a+Object.keys(s).length)*(i+a+Object.keys(l).length));let e=0,t=0,r=0,o=0,u=0,c=0;for(var x in s)e+=x*(x-1)*(2*x+5),r+=x*(x-1),o+=x*(x-1)*(x-2);for(var x in l)t+=x*(x-1)*(2*x+5),o+=x*(x-1)/(2*n*(n-1)),c+=x*(x-1)*(x-2)/(9*n*(n-1)*(n-2));T=n*(n-1)*(2*n+5),T=(T-e-t)/18+r*o+u*c,T=f/Math.sqrt(T),v=this.normalCumulativeValue(-Math.abs(T))}return{a:"undefined"!==typeof h?{tauA:h,z:p,pOneTailed:m,pTwoTailed:2*m}:void 0,b:"undefined"!==typeof h?{tauB:h,z:p,pOneTailed:m,pTwoTailed:2*m}:{tauB:b,z:T,pOneTailed:v,pTwoTailed:2*v},c:{tauC:y},missings:r.missings}},r.prototype.goodmanKruskalsGamma=function(e,t){if("undefined"===typeof t)return this.errorMessage("Goodman and Kruskal's Gamma requires two columns to analyze.");if(!1===this.validateInput(e,"ordinal","Goodman and Kruskal's Gamma"))return;if(!1===this.validateInput(t,"ordinal","Goodman and Kruskal's Gamma"))return;let r=this.reduceToPairs(e,t),n=r.valuesCombined,o=r.length,i=0,a=0;for(var s=0;s<o-1;s++)for(var l=s+1;l<o;l++){let r=n[s][e],o=n[l][e],u=n[s][t],c=n[l][t];r!==o&&u!==c&&(Math.sign(r-o)===Math.sign(u-c)?i+=1:a+=1)}let u=(i-a)/(i+a),c=u*Math.sqrt((i+a)/(o*(1-u*u))),d=1-this.studentsTCumulativeValue(Math.abs(c),o-2);return{gamma:u,tStatistic:c,pOneTailed:d,pTwoTailed:2*d,missings:r.missings}},r.prototype.fisherTransformation=function(e){return"undefined"===typeof e||!this.isNumeric(e)||e<-1||e>1?this.errorMessage("Fisher transformation is only defined for a Pearson correlation coefficient within the interval of [-1, 1]."):Math.atanh(e)||.5*Math.log((1+e)/(1-e))},r.prototype.linearRegression=function(e,t){if("undefined"===typeof t)return this.errorMessage("Linear regression requires two columns to compare.");let r=this.validateInput(e,"interval","linear regression");if(!1===r)return;let n=this.validateInput(t,"interval","linear regression");if(!1===n)return;let o=this.reduceToPairs(r.data,n.data),i=o.valuesFirst,a=o.valuesSecond,s=(o.missings,o.length);if(0===s)return;let l=this.mean(i),u=this.mean(a),c=0,d=0,f=0;for(var h=0;h<s;h++){let e=i[h]-l,t=a[h]-u;f+=e*t,c+=e*e,d+=t*t}if(0===c||0===d)return;let p=f/c,m=f/d,g=u-p*l,y=l-m*u,b=f/Math.sqrt(c*d),T=b*b,v=s>2?1-(1-T)*(s-1)/(s-2):void 0,x=180*Math.acos(b)/Math.PI;return x>90&&(x=180-x),{regressionFirst:{beta1:g,beta2:p},regressionSecond:{beta1:y,beta2:m},coefficientOfDetermination:T,coefficientOfDeterminationCorrected:v,correlationCoefficient:b,phi:x}},r.prototype.normalProbabilityDensity=function(e,t=0,r=1){if("undefined"===typeof e)return this.errorMessage("Normal probability density: no x is given.");if(r<=0)return this.errorMessage("Normal probability density: variance must be larger than 0.");let n=-Math.pow(e-t,2)/(2*r);return Math.exp(n)/Math.sqrt(2*Math.PI*r)},r.prototype.normalDistribution=function(e=0,t=1){if(t<=0)return this.errorMessage("Normal distribution: variance must be larger than 0.");let r=0,n=1,o={};for(;n>=this.epsilon&&(n=this.normalProbabilityDensity(e+r,e,t),!(n<this.epsilon));)o[(e+r).toFixed(2)]=n,o[(e-r).toFixed(2)]=n,r+=.01;return o},r.prototype.normalCumulativeValue=function(e){if("undefined"===typeof e)return this.errorMessage("Normal cumulative value: no z is given.");let t=e,r=e;for(var n=1;n<this.zTableIterations;n++)r*=e*e/(2*n+1),t+=r;return Math.round(1e5*(.5+t/Math.sqrt(2*Math.PI)*Math.exp(-.5*e*e)))/1e5},r.prototype.normalCumulativeDistribution=function(){let e=this.zTable;if("undefined"===typeof e){e={};for(var t=0;t<=4.09;t+=.01){e[(Math.round(100*t)/100).toFixed(2)]=this.normalCumulativeValue(t)}this.zTable=e}return e},r.prototype.binomialProbabilityMass=function(e,t=10,r=.5){return"undefined"===typeof e?this.errorMessage("Binomial probability mass: the required argument k was not given."):e<0||!Number.isInteger(e)?this.errorMessage("Binomial probability mass: k must be a non-negative integer."):t<0||!Number.isInteger(t)?this.errorMessage("Binomial probability mass: n must be a non-negative integer."):r<0||r>1?this.errorMessage("Binomial probability mass: The probability must lie within the range of [0, 1]."):this.binomialCoefficient(t,e)*Math.pow(r,e)*Math.pow(1-r,t-e)},r.prototype.binomialDistribution=function(e=10,t=.5){if(e<0||!Number.isInteger(e))return this.errorMessage("Binomial distribution: n must be a non-negative integer.");if(t<0||t>1)return this.errorMessage("Binomial distribution: The probability must lie within the range of [0, 1].");let r=0,n=0,o=0,i=[],a=1;for(;r<=e;)n=a*Math.pow(t,r)*Math.pow(1-t,e-r),i.push(n),o+=n,r++,a=a*(e+1-r)/r;return i},r.prototype.binomialCumulativeValue=function(e,t=10,r=.5){return"undefined"===typeof e?this.errorMessage("Binomial cumulative distribution value: the required argument k was not given."):e<0||!Number.isInteger(e)?this.errorMessage("Binomial cumulative distribution value: k must be a non-negative integer."):t<0||!Number.isInteger(t)?this.errorMessage("Binomial cumulative distribution value: n must be a non-negative integer."):r<0||r>1?this.errorMessage("Binomial cumulative distribution value: The probability must lie within the range of [0, 1]."):this.regularisedBeta(1-r,t-e,e+1)},r.prototype.binomialCumulativeDistribution=function(e=10,t=.5){if(e<0||!Number.isInteger(e))return this.errorMessage("Binomial cumulative distribution: n must be a non-negative integer.");if(t<0||t>1)return this.errorMessage("Binomial cumulative distribution: The probability must lie within the range of [0, 1].");let r=this.binomialDistribution(e,t),n=0;return r.map((function(e){return n=this.sumExact([n,e]),n}),this)},r.prototype.poissonProbabilityMass=function(e,t=1){if("undefined"===typeof e||!Number.isInteger(e))return this.errorMessage("Poisson probability mass: the required argument k must be an integer.");if(e<0||t<=0)return this.errorMessage("Poisson probability mass: Both k and lambda must be larger than 0.");if(e>10){let n=1;for(var r=1;r<=e;r++)n*=t*Math.exp(-t/e)/r;return n}return Math.exp(-t)*Math.pow(t,e)/this.factorial(e)},r.prototype.poissonDistribution=function(e=1){if(e<=0)return this.errorMessage("Poisson distribution: Lambda must be larger than 0.");let t=0,r=0,n=[];for(;r<1-this.epsilon;){let o=this.poissonProbabilityMass(t,e);n.push(o),r+=o,t++}return n},r.prototype.poissonCumulativeValue=function(e,t=1){if("undefined"===typeof e||!Number.isInteger(e))return this.errorMessage("Poisson cumulative distribution: The number of cumulative events k must be supplied.");if(e<0||t<=0)return this.errorMessage("Poisson distribution: Both k and lambda must be larger than 0.");let r=this.poissonDistribution(t);return e<r.length-1?this.sumExact(r.slice(0,e+1)):1},r.prototype.poissonCumulativeDistribution=function(e=1){if(e<=0)return this.errorMessage("Poisson distribution: lambda must be larger than 0.");let t=this.poissonDistribution(e),r=0;return t.map((function(e){return r=this.sumExact([r,e]),r}),this)},r.prototype.studentsTProbabilityDensity=function(e,t){if("undefined"===typeof t)return this.errorMessage("Student's t-distribution probability density: no value for degrees of freedom (df) given.");if(t<=0)return this.errorMessage("Student's t-distribution probability density: degrees of freedom (df) must be larger than 0.");let r=Math.pow(1+e*e/t,-.5*(t+1));return r/=Math.sqrt(t)*this.beta(.5,.5*t),r},r.prototype.studentsTDistribution=function(e){if("undefined"===typeof e)return this.errorMessage("Student's t-distribution: no value for degrees of freedom (df) given.");if(e<=0)return this.errorMessage("Student's t-distribution: degrees of freedom (df) must be larger than 0.");let t=0,r=1,n={};for(;r>=this.epsilon&&(r=this.studentsTProbabilityDensity(t,e),!(r<this.epsilon));)n[t.toFixed(2)]=r,n[(-t).toFixed(2)]=r,t+=.01;return n},r.prototype.studentsTCumulativeValue=function(e,t){return"undefined"===typeof t?this.errorMessage("Student's cumulative t-distribution value: no value for degrees of freedom (df) given."):t<=0?this.errorMessage("Student's cumulative t-distribution value: degrees of freedom (df) must be larger than 0."):e<=0?.5*this.regularisedBeta(t/(e*e+t),.5*t,.5):.5+.5*this.regularisedBeta(e*e/(e*e+t),.5,.5*t)},r.prototype.studentsTCumulativeDistribution=function(e){if("undefined"===typeof e)return this.errorMessage("Student's cumulative t-distribution: no value for degrees of freedom (df) given.");if(e<=0)return this.errorMessage("Student's cumulative t-distribution: degrees of freedom (df) must be larger than 0.");let t=0,r=0,n=-.1,o={};for(;r<=1-this.epsilon&&(r=this.studentsTCumulativeValue(t,e),!(n>=r));)o[t.toFixed(2)]=r,o[(-t).toFixed(2)]=r,n=r,t+=.01;return o},r.prototype.chiSquaredProbabilityDensity=function(e,t){return"undefined"===typeof t?this.errorMessage("Chi squared distribution probability density: no value for degrees of freedom (df) given."):t<=0?this.errorMessage("Chi squared distribution probability density: degrees of freedom (df) must be larger than 0."):e<=0?0:Math.pow(e,.5*t-1)*Math.exp(-.5*e)/(Math.pow(2,.5*t)*this.gamma(.5*t,!0))},r.prototype.chiSquaredDistribution=function(e){if("undefined"===typeof e)return this.errorMessage("Chi squared distribution: no value for degrees of freedom (df) given.");if(e<=0)return this.errorMessage("Chi squared distribution: degrees of freedom (df) must be larger than 0.");let t=.01,r=1,n={"0.00":0};for(;(e<=2&&r>=this.epsilon||e>2&&t<=e-2||e>2&&r>=this.epsilon)&&(r=this.chiSquaredProbabilityDensity(t,e),!(r<this.epsilon&&t>=e-2&&e>2));)n[t.toFixed(2)]=r,t+=.01;return n},r.prototype.chiSquaredCumulativeValue=function(e,t){return"undefined"===typeof t?this.errorMessage("Chi squared cumulative distribution value: no value for degrees of freedom (df) given."):t<=0?this.errorMessage("Chi squared cumulative distribution value: degrees of freedom (df) must be larger than 0."):e<=0?0:this.regularisedGamma(.5*t,.5*e)},r.prototype.chiSquaredCumulativeDistribution=function(e){if("undefined"===typeof e)return this.errorMessage("Chi squared cumulative distribution: no value for degrees of freedom (df) given.");if(e<=0)return this.errorMessage("Chi squared cumulative distribution: degrees of freedom (df) must be larger than 0.");let t=.01,r=0,n={"0.00":0};for(;r<=1-this.epsilon&&(r=this.chiSquaredCumulativeValue(t,e),!(r>=1-this.epsilon));)r>0&&(n[t.toFixed(2)]=r),t+=.01;return n},r.prototype.barnardsTest=function(e,t){if("undefined"===typeof t)return this.errorMessage("Barnard's test: No data was supplied.");let r=this.contingencyTable(e,t,"Barnard's test");if("undefined"===typeof r)return;let{a:n,b:o,c:i,d:a}=r,s=n+o+i+a;if(s>this.maxBarnardsN)return this.errorMessage("Barnard's test is a resource-intensive method, relative to the total number of datasets to analyze. There are "+s+" datasets in the supplied data, exceeding the maxinum of "+this.maxBarnardsN+'. You can change this number by changing the "maxBarnardsN" option (be cautious).');var l=(n+o)/s;l=l*(1-l)*(1/(n+i)+1/(o+a)),l=(o/(o+a)-n/(n+i))/Math.sqrt(l),isNaN(l)&&(l=0);let u=[];for(var c=0;c<1;c=this.sumExact([c,.001])){let e=0;for(var d=0;d<=n+i;d++)for(var f=0;f<=o+a;f++){let t=(d+f)/s;if(t=t*(1-t)*(1/(n+i)+1/(o+a)),t=(d/(n+i)-f/(o+a))/Math.sqrt(t),!isNaN(t)&&Math.abs(t)>=Math.abs(l)){let t=this.binomialCoefficient(n+i,d)*this.binomialCoefficient(o+a,f);t*=Math.pow(c,d+f)*Math.pow(1-c,s-d-f),e+=isNaN(t)?0:t}}u.push({nuisance:c,significance:e})}return u=this.sortDataByColumn("significance",{data:u,order:"desc"}),{wald:l,nuisance:u[0].nuisance,pOneTailed:.5*u[0].significance,pTwoTailed:u[0].significance}},r.prototype.binomialTest=function(e,t,r=.5){if("undefined"===typeof t)return this.errorMessage("Binomial test requires the data to test and a value which is hypotethised to be observed with a probability of alpha.");if(r<0||r>1)return this.errorMessage("Binomial test is only defined for probabilities alpha with alpha \u2265 0 and alpha \u2266 1.");let n=this.getScale(e);if("interval"===n||"metric"===n)return this.errorMessage("Binomial test is only defined for data of nominal or ordinal dichotomic scale.");let o=this.validateInput(e,"nominal","binomial test");if(!1===o)return;let i=this.getUniqueValues(o.data);if(i.length>2)return this.errorMessage("Binomial test is only defined for dichotomic data. The supplied data has "+i.length+" unique values.");if(2===i.length&&i.indexOf(t)<0)return this.errorMessage('The value "'+t+'" was not found in the supplied data.');let a=o.data.filter((function(e){return e===t})).length,s=this.binomialProbabilityMass(a,o.length,r),l=this.binomialCumulativeValue(a-1,o.length,r),u=1-l-s;return{pExactly:s,pFewer:l,pAtMost:l+s,pMore:u,pAtLeast:u+s}},r.prototype.signTest=function(e,t){if("undefined"===typeof t)return this.errorMessage("Sign test: No data was supplied.");let r=this.validateInput(e,"ordinal","sign test"),n=this.validateInput(t,"ordinal","sign test");if(!1===r||!1===n)return;if(0===r.length||0===n.length)return;let o=this.reduceToPairs(r.data,n.data),i=(o.missings,o.length),a=o.valuesFirst,s=o.valuesSecond,l=0;for(var u=0;u<i;u++)a[u]>s[u]&&(l+=1);let c=this.binomialProbabilityMass(l,i),d=this.binomialCumulativeValue(l-1,i),f=1-d-c;return{positives:l,pExactly:c,pFewer:d,pAtMost:d+c,pMore:f,pAtLeast:f+c}},r.prototype.fishersExactTest=function(e,t){if("undefined"===typeof t)return this.errorMessage("Fisher's exact test requires two columns to analyze.");let r=this.contingencyTable(e,t,"Fisher's exact test");if("undefined"===typeof r)return;let{a:n,b:o,c:i,d:a}=r;return this.binomialCoefficient(n+o,n)*this.binomialCoefficient(i+a,i)/this.binomialCoefficient(n+o+i+a,n+i)},r.prototype.mannWhitneyU=function(e,t){if("undefined"===typeof t)return this.errorMessage("Mann-Whitney-U test requires two columns to analyze.");let r=this.validateInput(e,"nominal","Mann-Whitney-U test"),n=this.validateInput(t,"ordinal","Mann-Whitney-U test");if(!1===r||!1===n)return;if(0===r.length||0===n.length)return;this.sort(n.data);let o=this.getUniqueValues(r.data);if(2!==o.length)return this.errorMessage('The Mann-Whitney-U test requires the independent variable to have exactly two unique values. Variable "'+independentValue+'" has '+o.length+" different values: "+r.data.join(", "));let i=this.assignRanks(t),a=i.reduce(((r,n)=>n[e]===o[0]?r+n["rank-"+t]:r),0),s=i.reduce(((t,r)=>r[e]===o[0]?t+1:t),0),l=i.reduce(((r,n)=>n[e]===o[1]?r+n["rank-"+t]:r),0),u=i.reduce(((t,r)=>r[e]===o[1]?t+1:t),0),c=s*(.5*s+u+.5)-a,d=u*(.5*u+s+.5)-l,f=Math.min(c,d),h=(f-.5*s*u)/Math.sqrt(s*u*(s+u+1)/12),p=1-this.normalCumulativeValue(Math.abs(h));return{MannWhitneyU:f,zScore:h,pOneTailed:p,pTwoTailed:2*p}},r.prototype.chiSquaredTest=function(e,t){if("undefined"===typeof t)return this.errorMessage("Chi Squared Test: You need to specify two variables, either of nominal or ordinal scale.");let r=this.getScale(e),n=this.getScale(t);if("ordinal"!==r&&"nominal"!==r||"ordinal"!==n&&"nominal"!==n)return this.errorMessage("Chi Squared Test: Both variables need to be either of nominal or ordinal scale.");let o=this.contingencyTable(e,t);if("undefined"===typeof o)return this.errorMessage("Chi Squared Test: Failed to create a contingency table. Please make sure your data is prepared correctly.");o=o.detailled;let i,a=o.total.total,s=0,l=Object.keys(o).length-1;for(var u in l=(l-1)*(Object.keys(o.total).length-l-2),o)if(this.has(o,u)&&"total"!==u){let e=o[u].total;for(var c in o[u])if(this.has(o[u],c)&&"total"!==c){let t=e*o.total[c]/a;s+=Math.pow(o[u][c]-t,2)/t}}return i=s<0||l<1?0:1-this.chiSquaredCumulativeValue(s,l),{PearsonChiSquared:s,degreesOfFreedom:l,significance:i}},r.prototype.studentsTTestOneSample=function(e,t){if("undefined"===typeof t||!this.isNumeric(t))return this.errorMessage("Student's t-test (one sample) requires data and the mean for which the null hypothesis should hold true.");let r=this.validateInput(e,"interval","student's t-test (one sample)");if(!1===r)return;if(0===r.length)return;let n=this.mean(r.data),o=this.standardDeviation(r.data),i=Math.sqrt(r.length)*(n-t)/o,a=r.length-1,s=this.studentsTCumulativeValue(Math.abs(i),a);return s>.5&&(s=1-s),{tStatistic:i,degreesOfFreedom:a,pOneSided:s,pTwoSided:2*s}},r.prototype.studentsTTestTwoSamples=function(e,t,{nullHypothesisDifference:r=0,dependent:n=!1}={}){if("undefined"===typeof t)return this.errorMessage("Student's t-test (two sample) requires data for two columns and the difference of their means for which the null hypothesis should hold true.");let o=this.validateInput(e,"interval","student's t-test (two sample)"),i=this.validateInput(t,"interval","student's t-test (two sample)");if(!1===o||!1===i)return;let a,s,l=o.length,u=i.length,c={};if(0===l||0===u)return;if(n){let e=this.reduceToPairs(o.data,i.data),t=e.valuesFirst,n=e.valuesSecond,u=0,f=0;for(var d=0;d<e.length;d++)f+=t[d]-n[d];f/=e.length;for(d=0;d<e.length;d++)u+=Math.pow(t[d]-n[d]-f,2);u=Math.sqrt(u/(e.length-1)),a=Math.sqrt(l)*(f-r)/u,s=e.length-1,c={tStatistic:a,degreesOfFreedom:s,missings:e.missings}}else{let e=this.mean(o.data),t=this.mean(i.data),n=this.variance(o.data),d=this.variance(i.data);a=(e-t-r)/Math.sqrt(((l-1)*n+(u-1)*d)/(l+u-2)),a*=Math.sqrt(l*u/(l+u)),s=l+u-2,c={tStatistic:a,degreesOfFreedom:s}}let f=this.studentsTCumulativeValue(a,s);return f>.5&&(f=1-f),c.pOneSided=f,c.pTwoSided=2*f,c},r.prototype.gaussianError=function(e){if("undefined"===typeof e||!this.isNumeric(e))return this.errorMessage("Gaussian Error Function: No valid value for x supplied. X needs to be numeric.");let t=1/(1+.5*Math.abs(e)),r=-e*e-1.26551223+1.00002368*t+.37409196*t*t+.09678418*Math.pow(t,3)-.18628806*Math.pow(t,4)+.27886807*Math.pow(t,5)-1.13520398*Math.pow(t,6)+1.48851587*Math.pow(t,7)-.82215223*Math.pow(t,8)+.17087277*Math.pow(t,9);return r=Math.exp(r)*t,e>=0?1-r:r-1},r.prototype.inverseGaussianError=function(e){if("undefined"===typeof e||!this.isNumeric(e))return this.errorMessage("Inverse Gaussian Error Function: No valid value for x supplied. X needs to be numeric.");if(e>1)return this.errorMessage("Inverse Gaussian Error Function: x can not be larger than 1.");if(e<-1)return this.errorMessage("Inverse Gaussian Error Function: x can not be smaller than -1.");var t,r=-Math.log((1-e)*(1+e));return r<5?(r-=2.5,t=Number(3.43273939e-7)+Number(2.81022636e-8)*r,t=Number(-35233877e-13)+t*r,t=1.50140941+(t=.246640727+(t=(t=(t=.00021858087+(t=Number(-439150654e-14)+t*r)*r)*r-.00125372503)*r-.00417768164)*r)*r):t=2.83297682+(t=1.00167406+(t=.00943887047+(t=(t=.00573950773+(t=(t=.00134934322+(t=.000100950558-.000200214257*(r=Math.sqrt(r)-3))*r)*r-.00367342844)*r)*r-.0076224613)*r)*r)*r,(t*e).toFixed(7)},r.prototype.probit=function(e){return"undefined"!==typeof e&&this.isNumeric(e)?e<0||e>1?this.errorMessage("Probit is only defined for quantiles p with 1 \u2265 p \u2265 0."):0===e?-1/0:1===e?1/0:Math.sqrt(2)*this.inverseGaussianError(2*e-1):this.errorMessage("Probit: No valid value for quantile supplied. quantile needs to be numeric.")},r.prototype.fisherYatesShuffle=function(e,t=Math.random){if("undefined"===typeof e)return this.errorMessage("Fisher-Yates shuffle: No data given.");let r=this.validateInput(e,"nominal","");if(!1===r)return;let n,o,i=r.data,a=r.length;for(;a;)o=Math.floor(t()*a--),n=i[a],i[a]=i[o],i[o]=n;return i},r.prototype.xorshift=function(e,t=0){if("undefined"===typeof e||e.constructor!==Array||4!==e.length)return this.errorMessage("Xorshift needs to be seeded with an array consisting of four numbers.");if(!Number.isInteger(t)||t<0)return this.errorMessage("Xorshift: startIndex must be a non-negative integer.");let r=0,n=4,o=new Uint32Array(64);o[0]=e[0],o[1]=e[1],o[2]=e[2],o[3]=e[3];const i=function(e,t,r){for(var n=t;n<r;n++){let t=(e[0]^e[0]<<11)>>>0;e[0]=e[1],e[1]=e[2],e[2]=e[3],e[3]=((e[3]^e[3]>>>19)>>>0^(t^t>>>8)>>>0)>>>0,e[n]=e[3]}return e};this.next=function(e=!0){let t=o[n];return r+=1,n++>=64&&(n=4,i(o,4,64)),e?t/4294967296:t},o=i(o,4,64);for(var a=0,s=t;a<s;a++)this.next()},r.prototype.boxMuller=function(e=0,t=1,{randomSourceA:r=Math.random,randomSourceB:n=Math.random}={}){let o=0,i=0,a=0,s=0;do{o=r(),a+=1}while((o<=0||o>=1)&&a<50);do{i=n(),s+=1}while((i<=0||i>=1)&&s<50);for(;o<=0||o>=1;)o=Math.random();for(;i<=0||i>=1;)i=Math.random();return Math.sqrt(-2*Math.log(o))*Math.cos(2*Math.PI*i)*t+e},r.prototype.ziggurat=function(e=0,t=1){let r=123456789,n=[128],o=[128],i=[128];const a=function(){let e=r,t=r;return t^=t<<13,t^=t>>>17,t^=t<<5,r=t,e+t|0},s=function(){return.5*(1+a()/-Math.pow(2,31))};!function(){r^=(new Date).getTime();let e=2147483648,t=3.442619855899,a=t,s=.00991256303526217,l=s/Math.exp(-.5*t*t);i[0]=Math.floor(t*e/l),i[1]=0,n[0]=l/e,n[127]=t/e,o[0]=1,o[127]=Math.exp(-.5*t*t);for(var u=126;u>=1;u--)t=Math.sqrt(-2*Math.log(s/t+Math.exp(-.5*t*t))),i[u+1]=Math.floor(t*e/a),a=t,o[u]=Math.exp(-.5*t*t),n[u]=t/e}(),this.next=function(){let r=a(),l=127&r,u=Math.abs(r)<i[l]?r*n[l]:function(e,t){let r,l,u=3.442619855899,c=1/u;for(;;){if(r=e*n[t],0===t){for(r=-Math.log(s())*c,l=-Math.log(s());l+l<r*r;)r=-Math.log(s())*c,l=-Math.log(s());return e>0?u+r:-u-r}if(o[t]+s()*(o[t-1]-o[t])<Math.exp(-.5*r*r))return r;if(t=127&(e=a()),Math.abs(e)<i[t])return e*n[t]}}(r,l);return u*t+e}}}}]);